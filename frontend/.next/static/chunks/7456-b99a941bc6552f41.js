"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7456],{29552:function(e,s,t){var a=t(3827),n=t(64090),r=t(71272);s.Z=e=>{let{variant:s="default"}=e,t=(0,n.useRef)(null);return(0,n.useEffect)(()=>{if(!t.current)return;let e=t.current,a=e.getContext("2d");if(!a)return;let n=()=>{e.width=window.innerWidth,e.height=window.innerHeight};n(),window.addEventListener("resize",n);let r=[],l="minimal"===s?50:100;class i{update(){this.x+=this.speedX,this.y+=this.speedY,this.x>e.width?this.x=0:this.x<0&&(this.x=e.width),this.y>e.height?this.y=0:this.y<0&&(this.y=e.height)}draw(){a&&(a.fillStyle=this.color,a.beginPath(),a.arc(this.x,this.y,this.size,0,2*Math.PI),a.fill())}constructor(){this.x=Math.random()*e.width,this.y=Math.random()*e.height,this.size=2*Math.random()+.5,this.speedX=.5*Math.random()-.25,this.speedY=.5*Math.random()-.25,this.color="hsla(".concat(60*Math.random()+200,", 70%, 60%, ").concat(.8*Math.random()+.2,")")}}let c=()=>{if(a)for(let e=0;e<r.length;e++)for(let s=e;s<r.length;s++){let t=r[e].x-r[s].x,n=r[e].y-r[s].y,l=Math.sqrt(t*t+n*n);if(l<150){let t=1-l/150;a.strokeStyle="rgba(150, 150, 255, ".concat(.15*t,")"),a.lineWidth=.8,a.beginPath(),a.moveTo(r[e].x,r[e].y),a.lineTo(r[s].x,r[s].y),a.stroke()}}},d=()=>{if(a){for(let t of(a.clearRect(0,0,e.width,e.height),"default"===s&&o(),r))t.update(),t.draw();c(),requestAnimationFrame(d)}},o=()=>{if(!a)return;a.strokeStyle="rgba(100, 100, 255, 0.1)",a.beginPath(),a.lineWidth=1.5,a.arc(0,0,200,0,.5*Math.PI),a.stroke(),a.beginPath(),a.arc(e.width,e.height,250,Math.PI,1.5*Math.PI),a.stroke(),a.beginPath(),a.lineWidth=.8;let s=e.width/2,t=e.height/2,n=.4*Math.min(e.width,e.height);a.moveTo(s-n/2,t-n/2),a.lineTo(s+n/2,t-n/2),a.lineTo(s+n/2,t+n/2),a.lineTo(s-n/2,t+n/2),a.lineTo(s-n/2,t-n/2),a.stroke()};return(()=>{for(let e=0;e<l;e++)r.push(new i)})(),d(),()=>{window.removeEventListener("resize",n)}},[s]),(0,a.jsxs)("div",{className:"fixed inset-0 -z-10 overflow-hidden",children:[(0,a.jsx)("canvas",{ref:t,className:"absolute inset-0 w-full h-full"}),(0,a.jsx)("div",{className:"absolute top-0 -left-[10%] w-[50%] h-[50%] bg-primary/10 rounded-full blur-[150px] -z-10"}),(0,a.jsx)("div",{className:"absolute bottom-[10%] right-[10%] w-[40%] h-[40%] bg-secondary/10 rounded-full blur-[150px] -z-10"}),(0,a.jsx)(r.E.div,{className:"absolute top-[20%] right-[10%] w-16 h-16 border border-primary/20 rounded-full",animate:{y:[0,15,0],opacity:[.6,.9,.6],scale:[1,1.05,1]},transition:{duration:6,repeat:1/0,ease:"easeInOut"}}),(0,a.jsx)(r.E.div,{className:"absolute top-[10%] left-[20%] w-24 h-24 border border-secondary/30 rounded-xl rotate-45",animate:{y:[0,-20,0],opacity:[.3,.6,.3],rotate:[45,35,45]},transition:{duration:8,repeat:1/0,ease:"easeInOut"}}),(0,a.jsx)(r.E.div,{className:"absolute bottom-[30%] left-[5%] w-20 h-20 bg-gradient-to-tr from-primary/5 to-secondary/5 rounded-lg",animate:{x:[0,10,0],opacity:[.4,.7,.4],rotate:[0,10,0]},transition:{duration:7,repeat:1/0,ease:"easeInOut"}})]})}},62665:function(e,s,t){var a=t(3827),n=t(29552);let r={lg:"max-w-5xl",xl:"max-w-7xl",full:"w-full max-w-none"},l={sm:"py-6",md:"py-10",lg:"py-16"};s.Z=function(e){let{title:s,description:t,actions:i,children:c,backgroundVariant:d="minimal",maxWidth:o="xl",padding:u="md",contentClassName:m="",headerClassName:h=""}=e,x=["relative","mx-auto","w-full","px-4",r[o],l[u],m].filter(Boolean).join(" "),f=s||t||i;return(0,a.jsxs)("main",{className:"relative min-h-screen overflow-hidden",children:["none"!==d&&(0,a.jsx)(n.Z,{variant:"default"===d?"default":"minimal"}),(0,a.jsxs)("div",{className:x,children:[f&&(0,a.jsxs)("div",{className:["mb-8","flex flex-col gap-4","sm:flex-row sm:items-center sm:justify-between",h].filter(Boolean).join(" "),children:[(0,a.jsxs)("div",{className:"space-y-1",children:[s&&(0,a.jsx)("h1",{className:"text-2xl font-bold md:text-3xl",children:s}),t&&(0,a.jsx)("p",{className:"max-w-2xl text-base text-default-500 md:text-lg",children:t})]}),i&&(0,a.jsx)("div",{className:"flex flex-wrap items-center gap-2 sm:justify-end",children:i})]}),(0,a.jsx)("div",{className:"relative z-10",children:c})]})]})}},929:function(e,s,t){t.d(s,{Z:function(){return i}});var a=t(3827),n=t(67945),r=t(51055),l=t(63983);function i(e){let{type:s="transaction",className:t=""}=e;return"statistics"===s?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(e=>(0,a.jsx)(n.w,{className:"w-full",children:(0,a.jsxs)(r.G,{className:"space-y-3",children:[(0,a.jsx)(l.X,{className:"rounded-lg",children:(0,a.jsx)("div",{className:"h-3 w-3/4 rounded-lg bg-default-200"})}),(0,a.jsx)(l.X,{className:"rounded-lg",children:(0,a.jsx)("div",{className:"h-6 w-2/3 rounded-lg bg-default-200"})})]})},e))}):"category"===s?(0,a.jsx)(n.w,{className:"w-full",children:(0,a.jsxs)(r.G,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(l.X,{className:"rounded-lg",children:(0,a.jsx)("div",{className:"h-6 w-32 rounded-lg bg-default-200"})}),(0,a.jsx)(l.X,{className:"rounded-lg",children:(0,a.jsx)("div",{className:"h-8 w-48 rounded-lg bg-default-200"})})]}),(0,a.jsx)(l.X,{className:"rounded-lg",children:(0,a.jsx)("div",{className:"h-[300px] w-full rounded-lg bg-default-200"})}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(e=>(0,a.jsx)(n.w,{className:"w-full",children:(0,a.jsxs)(r.G,{className:"space-y-2",children:[(0,a.jsx)(l.X,{className:"rounded-lg",children:(0,a.jsx)("div",{className:"h-3 w-3/4 rounded-lg bg-default-200"})}),(0,a.jsx)(l.X,{className:"rounded-lg",children:(0,a.jsx)("div",{className:"h-5 w-2/3 rounded-lg bg-default-200"})})]})},e))})]})}):"table"===s?(0,a.jsxs)("div",{className:"space-y-3 ".concat(t),children:[(0,a.jsx)("div",{className:"flex space-x-2 mb-4",children:[1,2,3,4].map(e=>(0,a.jsx)(l.X,{className:"rounded-lg",children:(0,a.jsx)("div",{className:"h-8 w-24 rounded-lg bg-default-200"})},e))}),[1,2,3,4,5].map(e=>(0,a.jsx)("div",{className:"flex space-x-4 items-center",children:(0,a.jsx)(l.X,{className:"rounded-lg",children:(0,a.jsx)("div",{className:"h-10 w-full rounded-lg bg-default-200"})})},e))]}):(0,a.jsx)("div",{className:"space-y-3 ".concat(t),children:[1,2,3,4,5].map(e=>(0,a.jsx)(n.w,{className:"w-full",children:(0,a.jsx)(r.G,{children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.X,{className:"rounded-lg",children:(0,a.jsx)("div",{className:"h-3 w-24 rounded-lg bg-default-200"})}),(0,a.jsx)(l.X,{className:"rounded-lg",children:(0,a.jsx)("div",{className:"h-3 w-32 rounded-lg bg-default-200"})})]}),(0,a.jsx)(l.X,{className:"rounded-lg",children:(0,a.jsx)("div",{className:"h-6 w-20 rounded-lg bg-default-200"})})]})})},e))})}},76663:function(e,s,t){t.d(s,{s:function(){return C},Z:function(){return S}});var a=t(3827),n=t(64090),r=t(10732),l=t(67945),i=t(51055),c=t(26856),d=t(25908),o=t(70294),u=t(47385),m=t(69426),h=t(52235),x=t(55621),f=t(20372),j=t(2391),g=t(36747),p=t(62456),v=t(82995),y=t(97307),N=t(22169);function b(e){let{value:s,onChange:t,label:r,placeholder:l="选择日期",className:i}=e,[c,d]=(0,n.useState)(!1);return(0,a.jsxs)(f.j,{isOpen:c,onOpenChange:d,children:[(0,a.jsx)(j.b,{children:(0,a.jsx)(u.Y,{label:r,placeholder:l,value:s?(0,p.WU)(s,"yyyy-MM-dd",{locale:v.U}):"",readOnly:!0,classNames:{input:"cursor-pointer"},endContent:(0,a.jsxs)("div",{className:"flex items-center",children:[s&&(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),t(void 0)},className:"text-default-400 hover:text-default-900 focus:outline-none mr-2",children:"✕"}),(0,a.jsx)(y.Z,{className:"h-5 w-5 text-default-400"})]}),className:i})}),(0,a.jsx)(g.g,{children:(0,a.jsx)("div",{className:"p-1",children:(0,a.jsx)(w,{mode:"single",selected:s,onSelect:e=>{t(e),d(!1)},initialFocus:!0})})})]})}function w(e){let{mode:s,selected:t,onSelect:r,initialFocus:l}=e,[i,c]=(0,n.useState)(t||new Date),d=i.getFullYear(),o=i.getMonth(),u=new Date(d,o+1,0).getDate(),m=new Date(d,o,1).getDay(),h=e=>{r(new Date(d,o,e))},x=[],f=1;for(let e=0;e<6;e++){let s=[];for(let t=0;t<7;t++)0===e&&t<m?s.push(null):f<=u?(s.push(f),f++):s.push(null);x.push(s)}return(0,a.jsxs)("div",{className:"p-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("button",{onClick:()=>{c(new Date(d,o-1,1))},className:"p-1",children:"<"}),(0,a.jsx)("h3",{children:(0,p.WU)(i,"yyyy年MM月",{locale:v.U})}),(0,a.jsx)("button",{onClick:()=>{c(new Date(d,o+1,1))},className:"p-1",children:">"})]}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:["日","一","二","三","四","五","六"].map(e=>(0,a.jsx)("div",{className:"text-sm font-medium",children:e},e))}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1",children:x.map((e,s)=>(0,a.jsx)(n.Fragment,{children:e.map((e,n)=>(0,a.jsx)("div",{className:(0,N.cn)("h-8 w-8 p-0 flex items-center justify-center rounded-full text-sm",null===e?"invisible":"cursor-pointer hover:bg-primary-100",t&&e===t.getDate()&&o===t.getMonth()&&d===t.getFullYear()?"bg-primary text-white":""),onClick:()=>null!==e&&h(e),children:e},"".concat(s,"-").concat(n)))},s))})]})}function S(e){let{onFilter:s}=e,[t,l]=(0,n.useState)({});return(0,a.jsx)(r.A,{size:"sm",onPress:()=>s(t),children:"过滤"})}function C(e){var s,t;let{isOpen:f,onClose:j,onApply:g,initialFilter:p={}}=e,[v,y]=(0,n.useState)(p),{categories:N}=(0,x.L)();return((0,n.useEffect)(()=>{y(p)},[p]),f)?(0,a.jsx)(l.w,{className:"w-full max-w-md mx-auto",children:(0,a.jsxs)(i.G,{className:"p-5",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-bold",children:"交易筛选"}),(0,a.jsx)(r.A,{isIconOnly:!0,variant:"light",onPress:j,children:(0,a.jsx)(h.Z,{size:18})})]}),(0,a.jsx)(c.j,{className:"my-3"}),(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-md font-medium mb-2",children:"交易类型"}),(0,a.jsxs)(d.X,{value:v.type,onValueChange:e=>y(s=>({...s,type:e})),children:[(0,a.jsx)(o.J,{value:"all",children:"全部"}),(0,a.jsx)(o.J,{value:"income",children:"收入"}),(0,a.jsx)(o.J,{value:"expense",children:"支出"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-md font-medium mb-2",children:"金额范围"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(u.Y,{type:"number",label:"最小金额",placeholder:"0",value:(null===(s=v.minAmount)||void 0===s?void 0:s.toString())||"",onChange:e=>y(s=>({...s,minAmount:e.target.value?Number(e.target.value):void 0})),className:"flex-1"}),(0,a.jsx)(u.Y,{type:"number",label:"最大金额",placeholder:"不限",value:(null===(t=v.maxAmount)||void 0===t?void 0:t.toString())||"",onChange:e=>y(s=>({...s,maxAmount:e.target.value?Number(e.target.value):void 0})),className:"flex-1"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-md font-medium mb-2",children:"日期范围"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(b,{label:"开始日期",value:v.startDate?new Date(v.startDate):void 0,onChange:e=>y(s=>({...s,startDate:e?e.toISOString().split("T")[0]:void 0})),className:"flex-1"}),(0,a.jsx)(b,{label:"结束日期",value:v.endDate?new Date(v.endDate):void 0,onChange:e=>y(s=>({...s,endDate:e?e.toISOString().split("T")[0]:void 0})),className:"flex-1"})]})]}),N&&N.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-md font-medium mb-2",children:"分类"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:N.map(e=>{var s;return(0,a.jsx)(m.K,{isSelected:null===(s=v.categoryIds)||void 0===s?void 0:s.includes(Number(e.id)),onValueChange:s=>{y(t=>{let a=t.categoryIds||[];return s?{...t,categoryIds:[...a,Number(e.id)]}:{...t,categoryIds:a.filter(s=>s!==Number(e.id))}})},children:e.name},e.id)})})]})]}),(0,a.jsx)(c.j,{className:"my-4"}),(0,a.jsxs)("div",{className:"flex justify-between gap-2",children:[(0,a.jsx)(r.A,{variant:"flat",color:"danger",onPress:()=>{y({})},className:"flex-1",children:"重置"}),(0,a.jsx)(r.A,{color:"primary",onPress:()=>{g(v),j()},className:"flex-1",children:"应用筛选"})]})]})}):null}},11546:function(e,s,t){var a=t(3827),n=t(4248),r=t(99510),l=t(22561),i=t(7725),c=t(56178),d=t(14078),o=t(47385),u=t(2646),m=t(10732),h=t(55621),x=t(79991),f=t(96770),j=t(64090);s.Z=e=>{let{isOpen:s,onClose:t,transaction:g}=e,[p,v]=(0,j.useState)("expense"),[y,N]=(0,j.useState)(""),[b,w]=(0,j.useState)(""),[S,C]=(0,j.useState)(""),[D,A]=(0,j.useState)(new Date().toISOString().split("T")[0]),{categories:I=[],isLoading:Y}=(0,h.L)(),{showToast:P}=(0,f.useToast)(),M=(0,x.lr)(),O=(0,x.wI)(),k=I.filter(e=>e.type===p);(0,j.useEffect)(()=>{if(g){var e;v(g.type),N(g.amount.toString()),w((null===(e=g.category_id)||void 0===e?void 0:e.toString())||""),C(g.description),A(g.date)}},[g]);let E=()=>{v("expense"),N(""),w(""),C(""),A(new Date().toISOString().split("T")[0])},T=()=>{E(),t()},R=async e=>{if(e.preventDefault(),!y||!b||!S||!D){P("请填写所有必填字段","error");return}let s=I.find(e=>e.id.toString()===b);if(!s){P("请选择有效的分类","error");return}let a={type:p,amount:Number(y),category_id:Number(b),description:S,date:D,category_name:s.name,category_icon:s.icon};try{g?(await O.mutateAsync({...a,id:g.id}),P("修改成功","success")):(await M.mutateAsync(a),P("添加成功","success")),t(),E()}catch(e){P("操作失败："+(e instanceof Error?e.message:"未知错误"),"error")}};return(0,a.jsx)(n.R,{isOpen:s,onClose:T,size:"lg",children:(0,a.jsx)(r.A,{children:(0,a.jsxs)("form",{onSubmit:R,children:[(0,a.jsx)(l.k,{children:g?"编辑交易":"新增交易"}),(0,a.jsx)(i.I,{className:"gap-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)(c.g,{label:"类型",selectedKeys:new Set([p]),onChange:e=>v(e.target.value),"aria-label":"选择交易类型",children:[(0,a.jsx)(d.R,{value:"expense","aria-label":"支出",children:"支出"},"expense"),(0,a.jsx)(d.R,{value:"income","aria-label":"收入",children:"收入"},"income")]}),(0,a.jsx)(o.Y,{type:"number",label:"金额",value:y,onChange:e=>N(e.target.value),"aria-label":"输入金额"}),(0,a.jsx)(c.g,{label:"分类",selectedKeys:b?new Set([b]):new Set,onChange:e=>w(e.target.value),isLoading:Y,"aria-label":"选择交易分类",errorMessage:0!==k.length||Y?void 0:"请先选择一个家庭并添加分类",children:k.map(e=>(0,a.jsx)(d.R,{value:e.id.toString(),textValue:e.name,"aria-label":e.name,children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{"aria-hidden":"true",children:e.icon}),(0,a.jsx)("span",{children:e.name})]})},e.id.toString()))}),(0,a.jsx)(o.Y,{type:"date",label:"日期",value:D,onChange:e=>A(e.target.value),"aria-label":"选择日期"}),(0,a.jsx)(o.Y,{className:"md:col-span-2",label:"描述",value:S,onChange:e=>C(e.target.value),"aria-label":"输入交易描述"})]})}),(0,a.jsxs)(u.R,{children:[(0,a.jsx)(m.A,{color:"danger",variant:"light",onPress:T,children:"取消"}),(0,a.jsx)(m.A,{color:"primary",type:"submit",children:g?"保存":"添加"})]})]})})})}},12751:function(e,s,t){t.d(s,{Z:function(){return O}});var a=t(3827),n=t(64090),r=t(2210),l=t(10732),i=t(4248),c=t(99510),d=t(22561),o=t(7725),u=t(47385),m=t(2646),h=t(45228),x=t(60463),f=t(80954),j=t(35061),g=t(1310),p=t(25548),v=t(24424),y=t(25570),N=t(89539),b=t.n(N),w=t(79991),S=t(96770),C=t(52131),D=t(929),A=t(11546),I=t(76663);function Y(e){let{isOpen:s,onClose:t}=e,r=(0,n.useRef)(null),[h,x]=(0,n.useState)(null),{mutate:j,isPending:g}=(0,w.En)(),{showToast:p}=(0,S.useToast)(),v=async()=>{if(!h){p("请选择要导入的文件","error");return}let e=new FormData;e.append("file",h);try{await j(e),t(),x(null),r.current&&(r.current.value="")}catch(e){console.error("导入失败:",e)}};return(0,a.jsx)(i.R,{isOpen:s,onClose:t,children:(0,a.jsxs)(c.A,{children:[(0,a.jsx)(d.k,{children:"导入交易记录"}),(0,a.jsx)(o.I,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-default-500",children:"请选择要导入的CSV文件，文件格式如下："}),(0,a.jsx)("pre",{className:"text-xs bg-default-100 p-2 rounded-lg",children:"日期,类型,金额,分类,描述 2024-03-01,expense,100,餐饮,午餐 2024-03-02,income,5000,工资,3月工资"}),(0,a.jsx)(u.Y,{type:"file",accept:".csv",ref:r,onChange:e=>{var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];if(t){if("text/csv"!==t.type){p("请选择CSV文件","error");return}x(t)}},startContent:(0,a.jsx)(f.Z,{className:"h-4 w-4"}),description:"支持.csv格式文件"})]})}),(0,a.jsxs)(m.R,{children:[(0,a.jsx)(l.A,{variant:"bordered",onPress:t,children:"取消"}),(0,a.jsx)(l.A,{color:"primary",onPress:v,isLoading:g,isDisabled:!h,children:"导入"})]})]})})}function P(e){let{isOpen:s,onClose:t}=e,[r,h]=(0,n.useState)(b()().startOf("month").format("YYYY-MM-DD")),[x,f]=(0,n.useState)(b()().format("YYYY-MM-DD")),{mutate:g,isPending:p}=(0,w.v9)(),{showToast:v}=(0,S.useToast)(),y=async()=>{if(!r||!x){v("请选择日期范围","error");return}if(b()(r).isAfter(x)){v("开始日期不能晚于结束日期","error");return}try{await g({startDate:r,endDate:x}),t()}catch(e){console.error("导出失败:",e)}};return(0,a.jsx)(i.R,{isOpen:s,onClose:t,children:(0,a.jsxs)(c.A,{children:[(0,a.jsx)(d.k,{children:"导出交易记录"}),(0,a.jsx)(o.I,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-default-500",children:"请选择要导出的日期范围："}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(u.Y,{type:"date",label:"开始日期",value:r,onChange:e=>h(e.target.value)}),(0,a.jsx)(u.Y,{type:"date",label:"结束日期",value:x,onChange:e=>f(e.target.value)})]})]})}),(0,a.jsxs)(m.R,{children:[(0,a.jsx)(l.A,{variant:"bordered",onPress:t,children:"取消"}),(0,a.jsx)(l.A,{color:"primary",startContent:(0,a.jsx)(j.Z,{className:"h-4 w-4"}),onPress:y,isLoading:p,children:"导出"})]})]})})}var M=t(8207);function O(){let[e,s]=(0,n.useState)(1),[t,N]=(0,n.useState)({}),{user:O,isGuest:k,enterGuestMode:E,exitGuestMode:T}=(0,C.useAuth)(),{transactions:R,isLoading:Z,error:L}=(0,w.nC)(null==O?void 0:O.currentFamilyId),{mutate:z}=(0,w.A3)(),{showToast:F}=(0,S.useToast)(),{isOpen:X,onOpen:q,onClose:_}=(0,r.q)(),{isOpen:K,onOpen:U,onClose:Q}=(0,r.q)(),{isOpen:G,onOpen:W,onClose:B}=(0,r.q)(),[J,V]=(0,n.useState)(""),[H,$]=(0,n.useState)(null),[ee,es]=(0,n.useState)(!1),[et,ea]=(0,n.useState)(!1),en=(0,n.useRef)(null);(0,y.MG)({count:R.length,getScrollElement:()=>en.current,estimateSize:()=>70,overscan:10});let er=(0,n.useMemo)(()=>R?R.filter(e=>!0):[],[R,t]),el=e=>{if(k){F("访客模式下无法编辑","error");return}$(e),es(!0)},ei=e=>{if(k){F("访客模式下无法删除","error");return}$(e),ea(!0)},ec=async()=>{try{await E(J),_(),V(""),F("已进入访客模式","success")}catch(e){F("访客密码错误","error")}},ed=(e,s)=>k?"****":"".concat("expense"===s?"-":"+").concat(e.toFixed(2));return Z?(0,a.jsx)(D.Z,{type:"transaction"}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center sticky top-0 bg-background/70 backdrop-blur-lg z-10 py-2 px-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(I.Z,{onFilter:N}),(null==O?void 0:O.privacy_mode)&&(0,a.jsx)(l.A,{size:"sm",variant:"flat",startContent:k?(0,a.jsx)(h.Z,{className:"h-4 w-4"}):(0,a.jsx)(x.Z,{className:"h-4 w-4"}),onPress:k?()=>T():q,children:k?"退出访客模式":"访客模式"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(l.A,{size:"sm",variant:"flat",startContent:(0,a.jsx)(f.Z,{className:"h-4 w-4"}),onPress:U,isDisabled:k,children:"导入"}),(0,a.jsx)(l.A,{size:"sm",variant:"flat",startContent:(0,a.jsx)(j.Z,{className:"h-4 w-4"}),onPress:W,isDisabled:k,children:"导出"})]})]}),(0,a.jsx)("div",{ref:en,className:"h-[calc(100vh-350px)] md:h-[calc(100vh-230px)] overflow-auto px-4",children:0===er.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,a.jsx)("div",{className:"bg-default-100 rounded-full p-6 mb-4",children:(0,a.jsx)(M.Z,{className:"h-10 w-10 text-default-400"})}),(0,a.jsx)("p",{className:"text-default-500",children:"暂无交易记录"}),(0,a.jsx)(l.A,{color:"primary",variant:"flat",className:"mt-4",startContent:(0,a.jsx)(g.Z,{className:"h-4 w-4"}),onPress:()=>es(!0),isDisabled:k,children:"添加交易"})]}):(0,a.jsx)("div",{className:"space-y-2 pb-4",children:er.map((e,s)=>{let t=b()(e.date).format("YYYY-MM-DD"),r=0===s||t!==b()(er[s-1].date).format("YYYY-MM-DD");return(0,a.jsxs)(n.Fragment,{children:[r&&(0,a.jsx)("div",{className:"sticky top-0 bg-background/80 backdrop-blur-md py-2 px-1 text-sm font-medium border-b z-10 mt-2 first:mt-0",children:t===b()().format("YYYY-MM-DD")?"今天":t===b()().subtract(1,"day").format("YYYY-MM-DD")?"昨天":b()(t).format("MM月DD日 ddd")}),(0,a.jsxs)("div",{className:"p-3 rounded-lg hover:bg-default-100 transition-colors cursor-pointer flex justify-between items-center border-b border-default-100",onClick:()=>el(e),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-full ".concat("expense"===e.type?"bg-danger/10 text-danger":"bg-success/10 text-success"),children:(0,a.jsx)("span",{className:"text-xl",children:e.category||"\uD83D\uDCB0"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.category||"未分类"}),(0,a.jsx)("div",{className:"text-xs text-default-400",children:e.description||"无描述"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end",children:[(0,a.jsx)("div",{className:"font-semibold ".concat("expense"===e.type?"text-danger":"text-success"),children:ed(e.amount,e.type)}),(0,a.jsxs)("div",{className:"flex gap-1 mt-1",children:[(0,a.jsx)("span",{onClick:e=>e.stopPropagation(),children:(0,a.jsx)(l.A,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>el(e),className:"h-6 w-6 min-w-0",isDisabled:k,children:(0,a.jsx)(p.Z,{className:"h-3 w-3"})})}),(0,a.jsx)("span",{onClick:e=>e.stopPropagation(),children:(0,a.jsx)(l.A,{isIconOnly:!0,size:"sm",color:"danger",variant:"light",onPress:()=>ei(e),className:"h-6 w-6 min-w-0",isDisabled:k,children:(0,a.jsx)(v.Z,{className:"h-3 w-3"})})})]})]})]})]},e.id)})})}),(0,a.jsx)(i.R,{isOpen:X,onClose:_,children:(0,a.jsxs)(c.A,{children:[(0,a.jsx)(d.k,{children:"访客模式"}),(0,a.jsx)(o.I,{children:(0,a.jsx)(u.Y,{type:"password",label:"访客密码",placeholder:"请输入访客密码",value:J,onChange:e=>V(e.target.value)})}),(0,a.jsxs)(m.R,{children:[(0,a.jsx)(l.A,{variant:"bordered",onPress:_,children:"取消"}),(0,a.jsx)(l.A,{color:"primary",onPress:ec,children:"确认"})]})]})}),(0,a.jsx)(Y,{isOpen:K,onClose:Q}),(0,a.jsx)(P,{isOpen:G,onClose:B}),(0,a.jsx)(A.Z,{isOpen:ee,onClose:()=>es(!1),transaction:H}),(0,a.jsx)(i.R,{isOpen:et,onClose:()=>ea(!1),children:(0,a.jsxs)(c.A,{children:[(0,a.jsx)(d.k,{children:"确认删除"}),(0,a.jsx)(o.I,{children:"确定要删除这条交易记录吗？"}),(0,a.jsxs)(m.R,{children:[(0,a.jsx)(l.A,{variant:"bordered",onPress:()=>ea(!1),children:"取消"}),(0,a.jsx)(l.A,{color:"danger",onPress:()=>{H&&z(H.id),ea(!1),$(null)},children:"删除"})]})]})})]})}},55621:function(e,s,t){t.d(s,{L:function(){return l}});var a=t(64090),n=t(58222),r=t(52131);function l(){let[e,s]=(0,a.useState)([]),[t,l]=(0,a.useState)(!0),[i,c]=(0,a.useState)(null),{user:d}=(0,r.useAuth)(),o=(0,a.useCallback)(async()=>{if(!d){s([]),c(null),l(!1);return}try{l(!0);let e="/categories";d.currentFamilyId?e+="?familyId=".concat(d.currentFamilyId):d.id&&(e+="?userId=".concat(d.id));let t=await (0,n.Io)(e);s(t.data),c(null)}catch(e){console.error("获取分类失败",e),c(e),s([])}finally{l(!1)}},[d]);return(0,a.useEffect)(()=>{o()},[o]),{categories:e,isLoading:t,error:i,refetch:o}}},79991:function(e,s,t){t.d(s,{A3:function(){return m},En:function(){return x},lr:function(){return o},nC:function(){return d},v9:function(){return h},wI:function(){return u}});var a=t(64090),n=t(96770),r=t(47082),l=t(20568),i=t(58222),c=t(49079);function d(e){let[s,t]=(0,a.useState)([]),[r,l]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null),{showToast:o}=(0,n.useToast)(),u=(0,a.useRef)(!1),m=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{e&&(u.current=!1,m.current=!1);let s=async()=>{if(!e){t([]),l(!1);return}if(!u.current||!m.current)try{l(!0),u.current=!0;let s=await (0,i.Io)("/families/".concat(e,"/transactions"));t(s.data),d(null),m.current=!1}catch(e){console.error("获取交易记录失败",e),o&&o((0,i.we)(e,"获取交易记录失败"),"error"),d(e),t([]),m.current=!0}finally{l(!1)}};!e||u.current&&m.current?e||(t([]),l(!1)):s()},[e,o]),{transactions:s,isLoading:r,error:c}}function o(){let e=(0,r.NL)(),{showToast:s}=(0,n.useToast)();return(0,l.D)({mutationFn:async e=>(await (0,i.Io)("/transactions",{method:"POST",body:JSON.stringify(e)})).data,onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),s("创建成功","success")},onError:e=>{console.error("创建交易失败:",e),s((0,i.we)(e,"创建交易失败"),"error")}})}function u(){let e=(0,r.NL)(),{showToast:s}=(0,n.useToast)();return(0,l.D)({mutationFn:async e=>(await (0,i.Io)("/transactions/".concat(e.id),{method:"PUT",body:JSON.stringify(e)})).data,onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),s("更新成功","success")},onError:e=>{console.error("更新交易失败:",e),s((0,i.we)(e,"更新交易失败"),"error")}})}function m(){let e=(0,r.NL)(),{showToast:s}=(0,n.useToast)();return(0,l.D)({mutationFn:async e=>{await (0,i.Io)("/transactions/".concat(e),{method:"DELETE"})},onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),e.invalidateQueries({queryKey:["categoryStats"]}),s("删除成功","success")},onError:e=>{401===e.status?s("请先登录","error"):s("删除失败","error")}})}function h(){let{showToast:e}=(0,n.useToast)();return(0,l.D)({mutationFn:async e=>{let{startDate:s,endDate:t}=e,a=new URLSearchParams;a.append("startDate",s),a.append("endDate",t);let n="".concat(c.env.NEXT_PUBLIC_API_URL||"http://localhost:3001/api","/transactions/export?").concat(a.toString()),r=localStorage.getItem("token"),l=await fetch(n,{method:"GET",headers:{Accept:"application/octet-stream",...r?{Authorization:"Bearer ".concat(r)}:{}}});if(!l.ok)throw Error("导出失败");let i=await l.blob(),d=window.URL.createObjectURL(i),o=document.createElement("a"),u="交易记录_".concat(s,"_").concat(t,".csv");return o.href=d,o.setAttribute("download",u),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(d),i},onSuccess:()=>{e("导出成功","success")},onError:s=>{console.error("导出失败:",s),e("导出失败","error")}})}function x(){let e=(0,r.NL)(),{showToast:s}=(0,n.useToast)();return(0,l.D)({mutationFn:async e=>(await (0,i.Io)("/transactions/import",{method:"POST",body:e,headers:{Accept:"application/json"}})).data,onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),e.invalidateQueries({queryKey:["categoryStats"]}),s("导入成功","success")},onError:e=>{console.error("导入失败:",e),s("导入失败: "+(e instanceof Error?e.message:"未知错误"),"error")}})}},22169:function(e,s,t){t.d(s,{cn:function(){return r}});var a=t(75504),n=t(51367);function r(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,n.m6)((0,a.W)(s))}}}]);