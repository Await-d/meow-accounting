(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8894,7641,2131,3121],{46669:function(e,t,r){Promise.resolve().then(r.bind(r,87641))},47907:function(e,t,r){"use strict";var n=r(15313);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},87641:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var n=r(3827),a=r(64090),o=r(67945),s=r(51055),c=r(52131),u=r(63121),l=r(72949),i=r(44469),d=r(62665);function f(){let{user:e}=(0,c.useAuth)(),{currentRoute:t}=(0,u.useRoute)(),[r,f]=(0,a.useState)("month");return(0,n.jsx)(d.Z,{title:(null==t?void 0:t.name)||"统计分析",description:"浏览收支趋势与分类分布，快速洞察家庭财务健康状况。",backgroundVariant:"minimal",children:(0,n.jsx)(o.w,{className:"border border-default-100 bg-background/60 backdrop-blur-md",children:(0,n.jsxs)(s.G,{className:"space-y-8",children:[(0,n.jsx)(l.gy,{}),(0,n.jsx)(i.Z,{timeRange:r,onTimeRangeChange:f})]})})})}},96770:function(e,t,r){"use strict";r.r(t),r.d(t,{ToastProvider:function(){return u},useToast:function(){return c}});var n=r(3827),a=r(64090),o=r(10963);let s=(0,a.createContext)(void 0);function c(){let e=(0,a.useContext)(s);if(!e)throw Error("useToast must be used within a ToastProvider");return e}function u(e){let{children:t}=e;return(0,n.jsxs)(s.Provider,{value:{showToast:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r={duration:3e3,style:{padding:"16px",borderRadius:"8px"}};switch(t){case"success":o.Am.success(e,r);break;case"error":o.Am.error(e,r);break;case"warning":(0,o.Am)(e,{...r,icon:"⚠️"});break;default:(0,o.Am)(e,{...r,icon:"ℹ️"})}}},children:[t,(0,n.jsx)(o.x7,{position:"top-center"})]})}},26632:function(e,t,r){"use strict";r.d(t,{AW:function(){return o},Kz:function(){return a},P8:function(){return s}});var n=r(77785);let a={[n.Yt.DASHBOARD]:{component:()=>Promise.all([r.e(7674),r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(7530),r.e(9178),r.e(3614),r.e(5784),r.e(7385),r.e(6288),r.e(224),r.e(4187),r.e(1945),r.e(8704),r.e(414),r.e(4322),r.e(568),r.e(5961),r.e(4642),r.e(4788),r.e(6373),r.e(8792),r.e(5769),r.e(1581),r.e(6573),r.e(9430),r.e(3135),r.e(2616),r.e(5626),r.e(3530),r.e(7456),r.e(2949),r.e(7923),r.e(8026)]).then(r.bind(r,27923)).then(e=>e.default),permission:n.wI.PRIVATE,layout:()=>Promise.all([r.e(9390),r.e(9178),r.e(3614),r.e(7108)]).then(r.bind(r,17108)).then(e=>e.default)},[n.Yt.TRANSACTIONS]:{component:()=>Promise.all([r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(7530),r.e(9178),r.e(3614),r.e(5784),r.e(7385),r.e(6288),r.e(224),r.e(4187),r.e(1945),r.e(8704),r.e(414),r.e(4322),r.e(568),r.e(5961),r.e(4788),r.e(1581),r.e(2616),r.e(3121),r.e(7456),r.e(1731)]).then(r.bind(r,47646)).then(e=>e.default),permission:n.wI.FAMILY,layout:()=>Promise.all([r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(7530),r.e(9178),r.e(3614),r.e(6288),r.e(3121),r.e(3345)]).then(r.bind(r,33345)).then(e=>e.default)},[n.Yt.STATISTICS]:{component:()=>Promise.all([r.e(7674),r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(7530),r.e(9178),r.e(3614),r.e(5784),r.e(7385),r.e(6288),r.e(224),r.e(4187),r.e(1945),r.e(8704),r.e(414),r.e(4322),r.e(568),r.e(5961),r.e(4642),r.e(4788),r.e(6373),r.e(8792),r.e(5769),r.e(1581),r.e(6573),r.e(3121),r.e(7456),r.e(2949),r.e(7641)]).then(r.bind(r,87641)).then(e=>e.default),permission:n.wI.FAMILY,layout:()=>Promise.all([r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(7530),r.e(9178),r.e(3614),r.e(6288),r.e(3121),r.e(8891)]).then(r.bind(r,18891)).then(e=>e.default)},[n.Yt.SETTINGS]:{component:()=>Promise.all([r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(1077)]).then(r.bind(r,1077)).then(e=>e.default),permission:n.wI.PRIVATE,layout:()=>Promise.all([r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(9178),r.e(3614),r.e(8792),r.e(1207)]).then(r.bind(r,31207)).then(e=>e.default)},[n.Yt.CUSTOM]:{component:()=>Promise.all([r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(9178),r.e(3614),r.e(6288),r.e(3121),r.e(7386)]).then(r.bind(r,7386)).then(e=>e.default),permission:n.wI.PRIVATE,layout:()=>Promise.all([r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(7530),r.e(9178),r.e(3614),r.e(510)]).then(r.bind(r,20510)).then(e=>e.default)}};function o(e,t,r,o){switch(a[e],t){case n.wI.PUBLIC:return!0;case n.wI.PRIVATE:return!!r;case n.wI.FAMILY:case n.wI.ADMIN:return!!r&&!!o;default:return!1}}async function s(e,t){let r=a[t];if(!r)throw Error("未找到路由类型 ".concat(t," 对应的组件"));try{let e=await r.component(),t=r.layout?await r.layout():null;return{Component:e,Layout:t,permission:r.permission}}catch(e){throw console.error("加载路由组件失败: ".concat(e)),e}}},52131:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return g},useAuth:function(){return w}});var n=r(3827),a=r(64090),o=r(47907),s=r(96770),c=r(58222),u=r(94564),l=r(37963),i=r(77785),d=r(26632);let f=async e=>{let t=await (0,c.Io)("/auth/login",{method:"POST",body:JSON.stringify(e)});return console.log("ssss",t),t.data},h=async e=>(await (0,c.Io)("/auth/register",{method:"POST",body:JSON.stringify(e)})).data,m=async e=>(await (0,c.Io)("/auth/verify-guest",{method:"POST",body:JSON.stringify({password:e})})).data,y=async e=>(await (0,c.Io)("/user/settings",{method:"PATCH",body:JSON.stringify(e)})).data,p=(0,a.createContext)(void 0);function g(e){let{children:t}=e,[r,c]=(0,a.useState)(null),[g,w]=(0,a.useState)(!1),[S,b]=(0,a.useState)(!1),I=(0,o.useRouter)(),{showToast:C}=(0,s.useToast)(),v=e=>{try{let t=(0,l.o)(e),r=Date.now()/1e3;if(t.exp&&t.exp<r)return(0,u.gy)(),localStorage.removeItem("isGuest"),null;return{id:t.id,username:t.username,email:t.email,role:t.role,privacy_mode:t.privacy_mode,default_route:t.default_route,permissions:t.permissions}}catch(e){return console.error("解析 token 失败:",e),(0,u.gy)(),localStorage.removeItem("isGuest"),null}},P=async e=>{if(!e||!e.default_route){I.push("/dashboard");return}try{let t=e.default_route,r=t.split("/")[1];if(!(0,d.AW)(r,i.wI.PRIVATE,"string"==typeof e.id?parseInt(e.id,10):e.id,e.currentFamilyId?"string"==typeof e.currentFamilyId?parseInt(e.currentFamilyId,10):e.currentFamilyId:void 0)){console.warn("用户无权访问默认路由，重定向到仪表盘"),I.push("/dashboard");return}await (0,d.P8)(t,r),I.push(t)}catch(e){console.error("路由导航失败:",e),I.push("/dashboard")}};(0,a.useEffect)(()=>{let e=(0,u.LP)(),t="true"===localStorage.getItem("isGuest"),r=window.location.pathname,n=r.startsWith("/auth/"),a="/"===r||"/about"===r;if(e){let r=v(e);r?(c(r),w(t),n&&P(r)):n||a||I.push("/auth/login")}else n||a||I.push("/auth/login")},[I]);let k=async(e,t)=>{try{let{token:r,user:n}=await f({email:e,password:t});(0,u.o4)(r),c(n),w(!1),localStorage.setItem("isGuest","false"),C("登录成功","success"),P(n)}catch(e){throw C("登录失败","error"),e}},T=async e=>{try{let{token:t,user:r}=await h(e);(0,u.o4)(t),c(r),w(!1),localStorage.setItem("isGuest","false"),C("注册成功","success"),P(r)}catch(e){throw C("注册失败","error"),e}},A=async e=>{try{await m(e),w(!0),localStorage.setItem("isGuest","true")}catch(e){throw e}},E=async e=>{try{let t=await y(e);return c(t),t}catch(e){throw e instanceof Error?C(e.message,"error"):C("更新设置失败","error"),e}};return(0,n.jsx)(p.Provider,{value:{user:r,isGuest:g,isLoading:S,setUser:c,updateUser:e=>{c(e)},updateSettings:E,login:k,register:T,logout:()=>{(0,u.gy)(),localStorage.removeItem("isGuest"),c(null),w(!1),I.push("/auth/login")},enterGuestMode:A,exitGuestMode:()=>{w(!1),localStorage.removeItem("isGuest")},handleUnauthorized:()=>{(0,u.gy)(),localStorage.removeItem("isGuest"),localStorage.removeItem("currentFamilyId"),c(null),w(!1),"/auth/login"!==window.location.pathname&&(C("登录已过期，请重新登录","error"),I.push("/auth/login"))}},children:t})}function w(){let e=(0,a.useContext)(p);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},63121:function(e,t,r){"use strict";r.r(t),r.d(t,{RouteProvider:function(){return S},useRoute:function(){return b}});var n=r(3827),a=r(64090),o=r(47907),s=r(52131),c=r(77785),u=r(58222),l=r(41310),i=r(26632);let d={[c.Yt.DASHBOARD]:1,[c.Yt.TRANSACTIONS]:2,[c.Yt.STATISTICS]:3,[c.Yt.SETTINGS]:4,[c.Yt.CUSTOM]:5},f={maxConcurrent:2,interval:5e3,timeout:1e4};function h(){let e=(0,a.useRef)(new Set),t=(0,a.useRef)(new Set),r=(0,a.useCallback)(e=>d[e.type]||1/0,[]),n=(0,a.useCallback)(e=>[...e].sort((e,t)=>r(e)-r(t)),[r]),o=(0,a.useCallback)(async r=>{if(!(e.current.has(r.path)||t.current.has(r.path))){e.current.add(r.path);try{let e=i.Kz[r.type];if(!e)return;let n=new Promise((e,t)=>{setTimeout(()=>t(Error("预热超时")),f.timeout)}),a=Promise.all([e.component(),e.layout?e.layout():Promise.resolve(null)]);await Promise.race([a,n]),t.current.add(r.path)}catch(e){console.warn("路由预热失败: ".concat(r.path),e)}finally{e.current.delete(r.path)}}},[]),s=(0,a.useCallback)(async e=>{let t=n(e),r=[];for(let e=0;e<t.length;e+=f.maxConcurrent)r.push(t.slice(e,e+f.maxConcurrent));for(let e of r)await Promise.all(e.map(e=>o(e))),r.indexOf(e)<r.length-1&&await new Promise(e=>setTimeout(e,f.interval))},[o,n]),c=(0,a.useCallback)(e=>t.current.has(e),[]),u=(0,a.useCallback)(()=>({preheating:Array.from(e.current),preheated:Array.from(t.current)}),[]),l=(0,a.useCallback)(()=>{e.current.clear(),t.current.clear()},[]);return(0,a.useEffect)(()=>()=>{l()},[l]),{preheatRoute:o,preheatRoutes:s,isRoutePreheated:c,getPreheatStatus:u,clearPreheatCache:l,getRoutePriority:r,sortRoutesByPriority:n}}let m={maxSize:5242880,maxAge:18e5,minPriority:3},y="route_params";var p=r(56288);let g=(0,a.createContext)(void 0);function w(e){let{children:t}=e,r=(0,o.useRouter)(),d=(0,o.usePathname)(),f=(0,o.useSearchParams)(),{user:w}=(0,s.useAuth)(),[S,b]=(0,a.useState)(),[I,C]=(0,a.useState)({}),[v,P]=(0,a.useState)([]),[k,T]=(0,a.useState)([]),[A,E]=(0,a.useState)(!1),[O,R]=(0,a.useState)(!1),{showToast:x}=(0,l.p)(),{getCachedRoute:N,cacheRoute:L,clearExpiredCache:D}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{maxSize:t,maxAge:r,minPriority:n}={...m,...e},[o,s]=(0,a.useState)(new Map),{getRoutePriority:c}=h(),u=(0,a.useRef)(0),l=(0,a.useCallback)(e=>JSON.stringify(e).length,[]),i=(0,a.useCallback)(e=>Date.now()-e.lastAccessed>r,[r]),d=(0,a.useCallback)(e=>c(e)<=n,[c,n]),f=(0,a.useCallback)(e=>{let t=o.get(e);return t?i(t)?(o.delete(e),u.current-=t.size,s(new Map(o)),null):(t.lastAccessed=Date.now(),s(new Map(o)),t):null},[o,i]),y=(0,a.useCallback)(e=>{let r=Array.from(o.entries());if(Date.now(),r.forEach(e=>{let[t,r]=e;i(r)&&(o.delete(t),u.current-=r.size)}),u.current+e>t)for(let[n,a]of r.filter(e=>{let[t,r]=e;return!i(r)}).sort((e,t)=>{let r=t[1].priority-e[1].priority;return 0!==r?r:e[1].lastAccessed-t[1].lastAccessed})){if(u.current+e<=t)break;o.delete(n),u.current-=a.size}s(new Map(o))},[o,i,t]);return{getCachedRoute:f,cacheRoute:(0,a.useCallback)(e=>{if(!d(e))return;let r=l(e),n=c(e);u.current+r>t&&y(r);let a={...e,lastAccessed:Date.now(),priority:n,size:r};o.set(e.path,a),u.current+=r,s(new Map(o))},[d,l,c,t,y,o]),clearExpiredCache:(0,a.useCallback)(()=>{let e=!1;o.forEach((t,r)=>{i(t)&&(o.delete(r),u.current-=t.size,e=!0)}),e&&s(new Map(o))},[o,i]),getCacheStats:(0,a.useCallback)(()=>({totalSize:u.current,itemCount:o.size,maxSize:t,usage:u.current/t*100}),[o,t])}}(),{preloadRoute:F,preloadRoutes:G}=function(){let e=(0,a.useCallback)(async e=>{try{let t=i.Kz[e.type];if(!t)return;let r=t.component(),n=t.layout?t.layout():Promise.resolve(null);await Promise.all([r,n])}catch(t){console.error("预加载路由失败: ".concat(e.path),t)}},[]),t=(0,a.useCallback)(async t=>{let r=t.map(t=>e(t));await Promise.allSettled(r)},[e]);return{preloadRoute:e,preloadRoutes:t,preloadRouteType:(0,a.useCallback)(async e=>{try{let t=i.Kz[e];if(!t)return;let r=t.component(),n=t.layout?t.layout():Promise.resolve(null);await Promise.all([r,n])}catch(t){console.error("预加载路由类型失败: ".concat(e),t)}},[])}}(),{addToHistory:M,goBack:_,goForward:j,getCurrentRoute:z,getHistorySummary:U}=function(){let[e,t]=(0,a.useState)([]),[r,n]=(0,a.useState)(-1),o=(0,a.useCallback)(e=>{t(t=>{var a;if((null===(a=t[r])||void 0===a?void 0:a.path)===e.path)return t;let o=t.slice(0,r+1);return o.push(e),o.length>20&&o.shift(),n(o.length-1),o})},[r]),s=(0,a.useCallback)(()=>r>0?(n(e=>e-1),e[r-1]):null,[e,r]),c=(0,a.useCallback)(()=>r<e.length-1?(n(e=>e+1),e[r+1]):null,[e,r]);return{addToHistory:o,goBack:s,goForward:c,getCurrentRoute:(0,a.useCallback)(()=>e[r]||null,[e,r]),clearHistory:(0,a.useCallback)(()=>{t([]),n(-1)},[]),getHistorySummary:(0,a.useCallback)(()=>({canGoBack:r>0,canGoForward:r<e.length-1,historyLength:e.length,currentIndex:r}),[e.length,r])}}(),{startRouteLoad:J,endRouteLoad:Y,getPerformanceReport:H,clearPerformanceData:B}=function(){let[e,t]=(0,a.useState)({}),r=(0,a.useCallback)(e=>performance.now(),[]);return{startRouteLoad:r,endRouteLoad:(0,a.useCallback)(function(e,r,n,a){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=a?performance.now()-a:0;t(t=>{let n=t[e]||{accessCount:0,errorCount:0,totalLoadTime:0,averageLoadTime:0,lastAccessed:new Date().toISOString()},a={...n,accessCount:n.accessCount+1,errorCount:r?n.errorCount:n.errorCount+1,totalLoadTime:n.totalLoadTime+(o?0:s),averageLoadTime:o?n.averageLoadTime:(n.totalLoadTime+s)/(n.accessCount+1),lastAccessed:new Date().toISOString()};return{...t,[e]:a}})},[]),getPerformanceReport:(0,a.useCallback)(()=>{let t=Object.keys(e);if(0===t.length)return{totalRoutes:0,totalAccesses:0,totalErrors:0,averageLoadTime:0,mostAccessed:null,mostErrors:null,routeStats:{}};let r=0,n=0,a=0,o=t[0],s=t[0];return t.forEach(t=>{let c=e[t];r+=c.accessCount,n+=c.errorCount,a+=c.totalLoadTime,c.accessCount>e[o].accessCount&&(o=t),c.errorCount>e[s].errorCount&&(s=t)}),{totalRoutes:t.length,totalAccesses:r,totalErrors:n,averageLoadTime:a/r,mostAccessed:{path:o,...e[o]},mostErrors:{path:s,...e[s]},routeStats:e}},[e]),clearPerformanceData:(0,a.useCallback)(()=>{t({})},[])}}(),{preheatRoute:V,preheatRoutes:W,isRoutePreheated:K,getPreheatStatus:q,getRoutePriority:X}=h(),{saveParams:Z,getParams:Q,clearParams:$}=function(){let[e,t]=(0,a.useState)({});(0,a.useEffect)(()=>{try{let e=localStorage.getItem(y);e&&t(JSON.parse(e))}catch(e){console.error("Failed to load route params:",e)}},[]);let r=(0,a.useCallback)(e=>{try{localStorage.setItem(y,JSON.stringify(e))}catch(e){console.error("Failed to save route params:",e)}},[]);return{saveParams:(0,a.useCallback)((e,n)=>{t(t=>{let a={...t,[e]:n};return r(a),a})},[r]),getParams:(0,a.useCallback)(t=>e[t],[e]),clearParams:(0,a.useCallback)(e=>{e?t(t=>{let{[e]:n,...a}=t;return r(a),a}):(t({}),localStorage.removeItem(y))},[r])}}(),ee=(0,a.useCallback)(()=>{let e={};return f.forEach((t,r)=>{"page"===r||"limit"===r?e[r]=parseInt(t):e[r]=t}),e},[f]),et=e=>{let t=new URLSearchParams;return Object.entries(e).forEach(e=>{let[r,n]=e;null!=n&&t.append(r,String(n))}),t.toString()},er=(0,a.useCallback)(e=>null==S||!S.validateParams||S.validateParams(e),[S]),en=(0,a.useCallback)(e=>{let t={...I,...e};if(er(t)){let e=et(t);r.push("".concat(d).concat(e?"?".concat(e):"")),C(t),d&&Z(d,t)}},[I,d,r,er,Z]);(0,a.useEffect)(()=>{let e=ee();if(Object.keys(e).length>0)C(e),d&&Z(d,e);else if(d){let e=Q(d);e&&Object.keys(e).length>0&&en(e)}},[d,ee,Q,Z,en]);let ea=(0,a.useCallback)(()=>{d&&($(d),C({}),r.push(d))},[d,r,$]),eo=(0,a.useCallback)(async()=>{if(w){E(!0);try{let e=await (0,u.Io)("/routes/user/routes");P(e.data)}catch(e){console.error("获取用户路由失败:",e)}finally{E(!1)}}},[w]),es=(0,a.useCallback)(async e=>{if(w){R(!0);try{let t=await (0,u.Io)("/routes/family/".concat(e,"/routes"));T(t.data)}catch(e){console.error("获取家庭路由失败:",e)}finally{R(!1)}}},[w]);(0,a.useEffect)(()=>{w&&eo()},[w,eo]),(0,a.useEffect)(()=>{(null==w?void 0:w.currentFamilyId)&&es(w.currentFamilyId)},[null==w?void 0:w.currentFamilyId,es]);let ec=(0,a.useCallback)(async e=>{if(w)try{let t=await (0,u.Io)("/api/routes",{method:"POST",body:JSON.stringify(e)});return e.family_id?es(e.family_id):eo(),x("路由创建成功","success"),t.data.id}catch(e){console.error("创建路由失败:",e),x("创建路由失败","error")}},[w,es,eo,x]),eu=(0,a.useCallback)(async e=>{let{id:t,data:r}=e;if(w)try{await (0,u.Io)("/api/routes/".concat(t),{method:"PUT",body:JSON.stringify(r)}),eo(),w.currentFamilyId&&es(w.currentFamilyId)}catch(e){throw console.error("更新路由失败:",e),e}},[w,eo,es]),el=(0,a.useCallback)(async e=>{if(w)try{await (0,u.Io)("/api/routes/".concat(e),{method:"DELETE"}),eo(),w.currentFamilyId&&es(w.currentFamilyId)}catch(e){throw console.error("删除路由失败:",e),e}},[w,eo,es]),ei=(0,a.useCallback)(()=>[{key:c.wI.PUBLIC,label:"公开"},{key:c.wI.PRIVATE,label:"私有"},{key:c.wI.FAMILY,label:"家庭"},{key:c.wI.ADMIN,label:"管理员"}],[]),ed=e=>(0,i.AW)(e.type,e.permission,null==w?void 0:w.id,null==w?void 0:w.currentFamilyId);(0,a.useEffect)(()=>{S&&W([...v,...k].filter(e=>e.type===S.type&&(!S.id||e.id!==S.id)))},[S,v,k,W]);let ef=(0,a.useCallback)(async(e,t)=>{let n=[...v,...k].find(t=>t.path===e);if(n&&!ed(n)){p.Am.error("无权访问该路由");return}try{let a=J(e),o=N(e);if(o){b(o),M(o),r.push("".concat(e).concat(t?et(t):"")),t&&C(t),Y(e,!0,void 0,a,!0);return}if(K(e)){n&&(L(n),b(n),M(n)),r.push("".concat(e).concat(t?et(t):"")),t&&C(t),Y(e,!0,void 0,a,!1);return}r.push("".concat(e).concat(t?et(t):"")),t&&C(t),n&&(await V(n),L(n),b(n),M(n)),Y(e,!0,void 0,a,!1)}catch(t){console.error("导航失败:",t),Y(e,!1,t),p.Am.error("导航失败")}},[r,v,k,ed,J,Y,N,K,V,L,M,et]),eh=(0,a.useCallback)(async()=>{let e=_();e&&await ef(e.path,e.params||{})},[_,ef]),em=(0,a.useCallback)(async()=>{let e=j();e&&await ef(e.path,e.params||{})},[j,ef]);(0,a.useEffect)(()=>{let e=setInterval(D,6e4);return()=>clearInterval(e)},[D]);let ey=(0,a.useCallback)(()=>{let e=H(),{preheated:t,preheating:r}=q();return{...e,cacheHitRate:0,preheatingStatus:{total:r.length+t.length,completed:t.length}}},[H,q]);return(0,n.jsx)(g.Provider,{value:{currentRoute:S,params:I,userRoutes:v,familyRoutes:k,isLoadingUserRoutes:A,isLoadingFamilyRoutes:O,fetchUserRoutes:eo,fetchFamilyRoutes:es,createRoute:ec,updateRoute:eu,deleteRoute:el,getPermissionOptions:ei,navigateToRoute:ef,checkAccess:ed,handleGoBack:eh,handleGoForward:em,getHistorySummary:U,getPerformanceReport:ey,getCacheStats:()=>({totalSize:0,itemCount:0,maxSize:0,usage:0}),getPreheatStatus:q,updateParams:en,validateParams:er,clearPerformanceData:B,resetParams:ea},children:t})}function S(e){let{children:t}=e;return(0,n.jsx)(a.Suspense,{fallback:(0,n.jsx)("div",{children:"Loading routes..."}),children:(0,n.jsx)(w,{children:t})})}function b(){let e=(0,a.useContext)(g);if(!e)throw Error("useRoute must be used within a RouteProvider");return e}},41310:function(e,t,r){"use strict";r.d(t,{p:function(){return a}});var n=r(10963);function a(){return{showToast:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r={duration:3e3,style:{padding:"16px",borderRadius:"8px"}};switch(t){case"success":n.Am.success(e,r);break;case"error":n.Am.error(e,r);break;case"warning":(0,n.Am)(e,{...r,icon:"⚠️"});break;default:(0,n.Am)(e,{...r,icon:"ℹ️"})}}}}},58222:function(e,t,r){"use strict";r.d(t,{AW:function(){return A},Cp:function(){return N},Ds:function(){return m},HL:function(){return w},Hb:function(){return u},Io:function(){return f},KX:function(){return p},M$:function(){return L},Ml:function(){return R},Nq:function(){return E},Ny:function(){return S},P9:function(){return b},R5:function(){return x},_c:function(){return I},dx:function(){return y},fM:function(){return T},fq:function(){return v},h8:function(){return O},hQ:function(){return l},le:function(){return g},ot:function(){return C},qW:function(){return P},rr:function(){return k},we:function(){return h}});var n=r(77785),a=r(94564);let o=r(49079).env.NEXT_PUBLIC_API_URL||"http://localhost:3001/api",s=null,c=null;function u(e){s=e}function l(e){c=e}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error";c?c(e,t):console["error"===t?"error":"warning"===t?"warn":"log"](e)}let d={400:e=>{console.warn("请求参数错误: ".concat(e)),i("请求参数错误: ".concat(e),"warning")},401:e=>{(0,a.gy)(),localStorage.removeItem("isGuest"),localStorage.removeItem("currentFamilyId"),s?s():"/auth/login"!==window.location.pathname&&(i("登录已过期，请重新登录"+window.location.pathname,"error"),window.location.href="/auth/login")},403:e=>{console.warn("无权访问: ".concat(e)),i("无权访问: ".concat(e),"error")},404:e=>{console.warn("资源不存在: ".concat(e)),i("资源不存在: ".concat(e),"warning")},422:e=>{console.warn("数据验证失败: ".concat(e)),i("数据验证失败: ".concat(e),"warning")},429:e=>{console.warn("请求过多，请稍后再试: ".concat(e)),i("请求过多，请稍后再试","warning")},500:e=>{console.error("服务器错误: ".concat(e)),i("服务器内部错误，请稍后再试: ".concat(e),"error")},502:e=>{console.error("网关错误: ".concat(e)),i("服务器网关错误，请稍后再试","error")},503:e=>{console.error("服务不可用: ".concat(e)),i("服务暂时不可用，请稍后再试","error")},504:e=>{console.error("网关超时: ".concat(e)),i("请求超时，请检查网络连接后重试","error")}};async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="".concat(o).concat(e),s=(0,a.LP)(),c={"Content-Type":"application/json",...s?{Authorization:"Bearer ".concat(s)}:{}};try{let e=await fetch(r,{...t,headers:{...c,...t.headers}}),a=await e.json();if(console.log("sssssss",a),!e.ok){let t=d[e.status];throw t&&t(a.message||"请求失败"),new n.Hx(e.status,a.message||"请求失败")}return{data:a,message:a.message,status:e.status}}catch(e){if(e instanceof n.Hx)throw e;throw new n.Hx(500,e instanceof Error?e.message:"网络错误")}}let h=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"请求失败";if(e instanceof n.Hx)switch(e.status){case 400:return"请求参数错误: ".concat(e.message);case 403:return"无权访问: ".concat(e.message);case 404:return"资源不存在: ".concat(e.message);case 429:return"请求过于频繁，请稍后再试";case 500:case 502:case 503:return"服务器错误: ".concat(e.message);default:return e.message||t}return(null==e?void 0:e.message)||t};async function m(e){return(await f("/routes/predictions?user_id=".concat(e),{method:"GET"})).data}async function y(e){return(await f("/routes/".concat(e,"/optimization"),{method:"GET"})).data}async function p(e){let t=new URLSearchParams;e.startDate&&t.append("startDate",e.startDate),e.endDate&&t.append("endDate",e.endDate),e.routeIds&&e.routeIds.length>0&&e.routeIds.forEach(e=>t.append("routeIds[]",e.toString()));let r="".concat(o,"/routes/export?").concat(t.toString(),"&format=").concat(e.format),s=(0,a.LP)(),c=await fetch(r,{method:"GET",headers:{...s?{Authorization:"Bearer ".concat(s)}:{}}});if(!c.ok){let e=await c.json();throw new n.Hx(c.status,e.message||"导出失败")}return await c.blob()}async function g(e){let t=new URLSearchParams;return t.append("type",e.type),e.startDate&&t.append("startDate",e.startDate),e.endDate&&t.append("endDate",e.endDate),e.routeIds&&e.routeIds.length>0&&e.routeIds.forEach(e=>t.append("routeIds[]",e.toString())),(await f("/routes/visualization?".concat(t.toString()),{method:"GET"})).data}async function w(e){return f("/categories",{method:"POST",body:JSON.stringify(e)})}async function S(e,t){return f("/categories/".concat(e),{method:"PUT",body:JSON.stringify(t)})}async function b(e){return f("/categories/".concat(e),{method:"DELETE"})}async function I(){return f("/routes")}async function C(e){return f("/routes",{method:"POST",body:JSON.stringify(e)})}async function v(e,t){return f("/routes/".concat(e),{method:"PUT",body:JSON.stringify(t)})}async function P(e){return f("/routes/".concat(e),{method:"DELETE"})}async function k(e){return f("/routes/".concat(e,"/toggle"),{method:"POST"})}async function T(e){return f("/routes/".concat(e,"/stats"))}async function A(){return f("/users")}async function E(e,t){return f("/users/".concat(e),{method:"PUT",body:JSON.stringify(t)})}async function O(e){return f("/users/".concat(e),{method:"DELETE"})}async function R(e){return f("/users/".concat(e,"/freeze"),{method:"POST"})}async function x(e){return f("/users/".concat(e,"/unfreeze"),{method:"POST"})}async function N(e){return f("/auth/change-password",{method:"POST",body:JSON.stringify(e)})}async function L(e){return f("/users/privacy",{method:"PUT",body:JSON.stringify(e)})}},77785:function(e,t,r){"use strict";var n,a,o,s;r.d(t,{Hx:function(){return c},Yt:function(){return n},wI:function(){return a}});class c extends Error{constructor(e,t){super(t),this.status=e,this.name="APIError"}}(o=n||(n={})).DASHBOARD="dashboard",o.TRANSACTIONS="transactions",o.STATISTICS="statistics",o.SETTINGS="settings",o.CUSTOM="custom",(s=a||(a={})).PUBLIC="public",s.PRIVATE="private",s.FAMILY="family",s.ADMIN="admin"},94564:function(e,t,r){"use strict";function n(){return localStorage.getItem("token")}function a(e){localStorage.setItem("token",e)}function o(){localStorage.removeItem("token")}r.d(t,{LP:function(){return n},gy:function(){return o},o4:function(){return a}})},37963:function(e,t,r){"use strict";r.d(t,{o:function(){return a}});class n extends Error{}function a(e,t){let r;if("string"!=typeof e)throw new n("Invalid token specified: must be a string");t||(t={});let a=!0===t.header?0:1,o=e.split(".")[a];if("string"!=typeof o)throw new n("Invalid token specified: missing part #".concat(a+1));try{r=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var r;return r=t,decodeURIComponent(atob(r).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}catch(e){return atob(t)}}(o)}catch(e){throw new n("Invalid token specified: invalid base64 for part #".concat(a+1," (").concat(e.message,")"))}try{return JSON.parse(r)}catch(e){throw new n("Invalid token specified: invalid json for part #".concat(a+1," (").concat(e.message,")"))}}n.prototype.name="InvalidTokenError"}},function(e){e.O(0,[7674,6034,9390,9689,7945,7530,9178,3614,2178,5784,7385,6288,224,4187,1945,8704,414,4322,568,5961,4642,4788,6373,8792,5769,1581,6573,7456,2949,2971,8069,1744],function(){return e(e.s=46669)}),_N_E=e.O()}]);