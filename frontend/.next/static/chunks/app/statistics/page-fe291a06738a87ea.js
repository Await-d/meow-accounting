(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8894,7641,2131,3121],{46669:function(e,t,r){Promise.resolve().then(r.bind(r,87641))},47907:function(e,t,r){"use strict";var a=r(15313);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},87641:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var a=r(3827),n=r(64090),o=r(67945),s=r(73031),c=r(51055),u=r(52131),l=r(63121),i=r(4103),d=r(44469);function f(){let{user:e}=(0,u.useAuth)(),{currentRoute:t}=(0,l.useRoute)(),[r,f]=(0,n.useState)("month");return(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)(o.w,{children:[(0,a.jsx)(s.u,{children:(0,a.jsx)("h1",{className:"text-2xl font-bold",children:(null==t?void 0:t.name)||"统计分析"})}),(0,a.jsx)(c.G,{children:(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsx)(i.gy,{}),(0,a.jsx)(d.Z,{timeRange:r,onTimeRangeChange:f})]})})]})})}},96770:function(e,t,r){"use strict";r.r(t),r.d(t,{ToastProvider:function(){return u},useToast:function(){return c}});var a=r(3827),n=r(64090),o=r(10963);let s=(0,n.createContext)(void 0);function c(){let e=(0,n.useContext)(s);if(!e)throw Error("useToast must be used within a ToastProvider");return e}function u(e){let{children:t}=e;return(0,a.jsxs)(s.Provider,{value:{showToast:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r={duration:3e3,style:{padding:"16px",borderRadius:"8px"}};switch(t){case"success":o.Am.success(e,r);break;case"error":o.Am.error(e,r);break;case"warning":(0,o.Am)(e,{...r,icon:"⚠️"});break;default:(0,o.Am)(e,{...r,icon:"ℹ️"})}}},children:[t,(0,a.jsx)(o.x7,{position:"top-center"})]})}},26632:function(e,t,r){"use strict";r.d(t,{AW:function(){return o},Kz:function(){return n},P8:function(){return s}});var a=r(77785);let n={[a.Yt.DASHBOARD]:{component:()=>Promise.all([r.e(7674),r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(7530),r.e(5784),r.e(9178),r.e(7385),r.e(3614),r.e(6288),r.e(4187),r.e(224),r.e(1945),r.e(8704),r.e(414),r.e(4322),r.e(5961),r.e(4642),r.e(4788),r.e(568),r.e(6373),r.e(8792),r.e(5769),r.e(3509),r.e(2132),r.e(9430),r.e(3135),r.e(3735),r.e(5626),r.e(7294),r.e(2751),r.e(4103),r.e(7923),r.e(8026)]).then(r.bind(r,27923)).then(e=>e.default),permission:a.wI.PRIVATE,layout:()=>Promise.all([r.e(9390),r.e(9178),r.e(3614),r.e(7108)]).then(r.bind(r,17108)).then(e=>e.default)},[a.Yt.TRANSACTIONS]:{component:()=>Promise.all([r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(7530),r.e(5784),r.e(7385),r.e(6288),r.e(4187),r.e(224),r.e(1945),r.e(8704),r.e(414),r.e(4322),r.e(5961),r.e(4788),r.e(568),r.e(3509),r.e(3735),r.e(3121),r.e(2751),r.e(1731)]).then(r.bind(r,47646)).then(e=>e.default),permission:a.wI.FAMILY,layout:()=>Promise.all([r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(7530),r.e(9178),r.e(3614),r.e(6288),r.e(3121),r.e(3345)]).then(r.bind(r,33345)).then(e=>e.default)},[a.Yt.STATISTICS]:{component:()=>Promise.all([r.e(7674),r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(7530),r.e(5784),r.e(9178),r.e(7385),r.e(3614),r.e(6288),r.e(4187),r.e(224),r.e(1945),r.e(8704),r.e(414),r.e(4322),r.e(5961),r.e(4642),r.e(4788),r.e(568),r.e(6373),r.e(8792),r.e(5769),r.e(3509),r.e(2132),r.e(3121),r.e(2751),r.e(4103),r.e(7641)]).then(r.bind(r,87641)).then(e=>e.default),permission:a.wI.FAMILY,layout:()=>Promise.all([r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(7530),r.e(9178),r.e(3614),r.e(6288),r.e(3121),r.e(8891)]).then(r.bind(r,18891)).then(e=>e.default)},[a.Yt.SETTINGS]:{component:()=>Promise.all([r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(1077)]).then(r.bind(r,1077)).then(e=>e.default),permission:a.wI.PRIVATE,layout:()=>Promise.all([r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(9178),r.e(3614),r.e(8792),r.e(1207)]).then(r.bind(r,31207)).then(e=>e.default)},[a.Yt.CUSTOM]:{component:()=>Promise.all([r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(6288),r.e(3121),r.e(7386)]).then(r.bind(r,7386)).then(e=>e.default),permission:a.wI.PRIVATE,layout:()=>Promise.all([r.e(6034),r.e(9390),r.e(9689),r.e(7945),r.e(7530),r.e(9178),r.e(3614),r.e(510)]).then(r.bind(r,20510)).then(e=>e.default)}};function o(e,t,r,o){switch(n[e],t){case a.wI.PUBLIC:return!0;case a.wI.PRIVATE:return!!r;case a.wI.FAMILY:case a.wI.ADMIN:return!!r&&!!o;default:return!1}}async function s(e,t){let r=n[t];if(!r)throw Error("未找到路由类型 ".concat(t," 对应的组件"));try{let e=await r.component(),t=r.layout?await r.layout():null;return{Component:e,Layout:t,permission:r.permission}}catch(e){throw console.error("加载路由组件失败: ".concat(e)),e}}},52131:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return g},useAuth:function(){return w}});var a=r(3827),n=r(64090),o=r(47907),s=r(96770),c=r(58222),u=r(94564),l=r(37963),i=r(77785),d=r(26632);let f=async e=>{let t=await (0,c.Io)("/auth/login",{method:"POST",body:JSON.stringify(e)});return console.log("ssss",t),t.data},h=async e=>(await (0,c.Io)("/auth/register",{method:"POST",body:JSON.stringify(e)})).data,m=async e=>(await (0,c.Io)("/auth/verify-guest",{method:"POST",body:JSON.stringify({password:e})})).data,p=async e=>(await (0,c.Io)("/user/settings",{method:"PATCH",body:JSON.stringify(e)})).data,y=(0,n.createContext)(void 0);function g(e){let{children:t}=e,[r,c]=(0,n.useState)(null),[g,w]=(0,n.useState)(!1),[S,I]=(0,n.useState)(!1),b=(0,o.useRouter)(),{showToast:C}=(0,s.useToast)(),v=e=>{try{let t=(0,l.o)(e),r=Date.now()/1e3;if(t.exp&&t.exp<r)return(0,u.gy)(),localStorage.removeItem("isGuest"),null;return{id:t.id,username:t.username,email:t.email,role:t.role,privacy_mode:t.privacy_mode,default_route:t.default_route,permissions:t.permissions}}catch(e){return console.error("解析 token 失败:",e),(0,u.gy)(),localStorage.removeItem("isGuest"),null}},P=async e=>{if(!e||!e.default_route){b.push("/dashboard");return}try{let t=e.default_route,r=t.split("/")[1];if(!(0,d.AW)(r,i.wI.PRIVATE,"string"==typeof e.id?parseInt(e.id,10):e.id,e.currentFamilyId?"string"==typeof e.currentFamilyId?parseInt(e.currentFamilyId,10):e.currentFamilyId:void 0)){console.warn("用户无权访问默认路由，重定向到仪表盘"),b.push("/dashboard");return}await (0,d.P8)(t,r),b.push(t)}catch(e){console.error("路由导航失败:",e),b.push("/dashboard")}};(0,n.useEffect)(()=>{let e=(0,u.LP)(),t="true"===localStorage.getItem("isGuest"),r=window.location.pathname,a=r.startsWith("/auth/"),n="/"===r||"/about"===r;if(e){let r=v(e);r?(c(r),w(t),a&&P(r)):a||n||b.push("/auth/login")}else a||n||b.push("/auth/login")},[b]);let k=async(e,t)=>{try{let{token:r,user:a}=await f({email:e,password:t});(0,u.o4)(r),c(a),w(!1),localStorage.setItem("isGuest","false"),C("登录成功","success"),P(a)}catch(e){throw C("登录失败","error"),e}},T=async e=>{try{let{token:t,user:r}=await h(e);(0,u.o4)(t),c(r),w(!1),localStorage.setItem("isGuest","false"),C("注册成功","success"),P(r)}catch(e){throw C("注册失败","error"),e}},A=async e=>{try{await m(e),w(!0),localStorage.setItem("isGuest","true")}catch(e){throw e}},E=async e=>{try{let t=await p(e);return c(t),t}catch(e){throw e instanceof Error?C(e.message,"error"):C("更新设置失败","error"),e}};return(0,a.jsx)(y.Provider,{value:{user:r,isGuest:g,isLoading:S,setUser:c,updateUser:e=>{c(e)},updateSettings:E,login:k,register:T,logout:()=>{(0,u.gy)(),localStorage.removeItem("isGuest"),c(null),w(!1),b.push("/auth/login")},enterGuestMode:A,exitGuestMode:()=>{w(!1),localStorage.removeItem("isGuest")},handleUnauthorized:()=>{(0,u.gy)(),localStorage.removeItem("isGuest"),localStorage.removeItem("currentFamilyId"),c(null),w(!1),"/auth/login"!==window.location.pathname&&(C("登录已过期，请重新登录","error"),b.push("/auth/login"))}},children:t})}function w(){let e=(0,n.useContext)(y);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},63121:function(e,t,r){"use strict";r.r(t),r.d(t,{RouteProvider:function(){return S},useRoute:function(){return I}});var a=r(3827),n=r(64090),o=r(47907),s=r(52131),c=r(77785),u=r(58222),l=r(41310),i=r(26632);let d={[c.Yt.DASHBOARD]:1,[c.Yt.TRANSACTIONS]:2,[c.Yt.STATISTICS]:3,[c.Yt.SETTINGS]:4,[c.Yt.CUSTOM]:5},f={maxConcurrent:2,interval:5e3,timeout:1e4};function h(){let e=(0,n.useRef)(new Set),t=(0,n.useRef)(new Set),r=(0,n.useCallback)(e=>d[e.type]||1/0,[]),a=(0,n.useCallback)(e=>[...e].sort((e,t)=>r(e)-r(t)),[r]),o=(0,n.useCallback)(async r=>{if(!(e.current.has(r.path)||t.current.has(r.path))){e.current.add(r.path);try{let e=i.Kz[r.type];if(!e)return;let a=new Promise((e,t)=>{setTimeout(()=>t(Error("预热超时")),f.timeout)}),n=Promise.all([e.component(),e.layout?e.layout():Promise.resolve(null)]);await Promise.race([n,a]),t.current.add(r.path)}catch(e){console.warn("路由预热失败: ".concat(r.path),e)}finally{e.current.delete(r.path)}}},[]),s=(0,n.useCallback)(async e=>{let t=a(e),r=[];for(let e=0;e<t.length;e+=f.maxConcurrent)r.push(t.slice(e,e+f.maxConcurrent));for(let e of r)await Promise.all(e.map(e=>o(e))),r.indexOf(e)<r.length-1&&await new Promise(e=>setTimeout(e,f.interval))},[o,a]),c=(0,n.useCallback)(e=>t.current.has(e),[]),u=(0,n.useCallback)(()=>({preheating:Array.from(e.current),preheated:Array.from(t.current)}),[]),l=(0,n.useCallback)(()=>{e.current.clear(),t.current.clear()},[]);return(0,n.useEffect)(()=>()=>{l()},[l]),{preheatRoute:o,preheatRoutes:s,isRoutePreheated:c,getPreheatStatus:u,clearPreheatCache:l,getRoutePriority:r,sortRoutesByPriority:a}}let m={maxSize:5242880,maxAge:18e5,minPriority:3},p="route_params";var y=r(56288);let g=(0,n.createContext)(void 0);function w(e){let{children:t}=e,r=(0,o.useRouter)(),d=(0,o.usePathname)(),f=(0,o.useSearchParams)(),{user:w}=(0,s.useAuth)(),[S,I]=(0,n.useState)(),[b,C]=(0,n.useState)({}),[v,P]=(0,n.useState)([]),[k,T]=(0,n.useState)([]),[A,E]=(0,n.useState)(!1),[x,R]=(0,n.useState)(!1),{showToast:O}=(0,l.p)(),{getCachedRoute:N,cacheRoute:D,clearExpiredCache:L}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{maxSize:t,maxAge:r,minPriority:a}={...m,...e},[o,s]=(0,n.useState)(new Map),{getRoutePriority:c}=h(),u=(0,n.useRef)(0),l=(0,n.useCallback)(e=>JSON.stringify(e).length,[]),i=(0,n.useCallback)(e=>Date.now()-e.lastAccessed>r,[r]),d=(0,n.useCallback)(e=>c(e)<=a,[c,a]),f=(0,n.useCallback)(e=>{let t=o.get(e);return t?i(t)?(o.delete(e),u.current-=t.size,s(new Map(o)),null):(t.lastAccessed=Date.now(),s(new Map(o)),t):null},[o,i]),p=(0,n.useCallback)(e=>{let r=Array.from(o.entries());if(Date.now(),r.forEach(e=>{let[t,r]=e;i(r)&&(o.delete(t),u.current-=r.size)}),u.current+e>t)for(let[a,n]of r.filter(e=>{let[t,r]=e;return!i(r)}).sort((e,t)=>{let r=t[1].priority-e[1].priority;return 0!==r?r:e[1].lastAccessed-t[1].lastAccessed})){if(u.current+e<=t)break;o.delete(a),u.current-=n.size}s(new Map(o))},[o,i,t]);return{getCachedRoute:f,cacheRoute:(0,n.useCallback)(e=>{if(!d(e))return;let r=l(e),a=c(e);u.current+r>t&&p(r);let n={...e,lastAccessed:Date.now(),priority:a,size:r};o.set(e.path,n),u.current+=r,s(new Map(o))},[d,l,c,t,p,o]),clearExpiredCache:(0,n.useCallback)(()=>{let e=!1;o.forEach((t,r)=>{i(t)&&(o.delete(r),u.current-=t.size,e=!0)}),e&&s(new Map(o))},[o,i]),getCacheStats:(0,n.useCallback)(()=>({totalSize:u.current,itemCount:o.size,maxSize:t,usage:u.current/t*100}),[o,t])}}(),{preloadRoute:j,preloadRoutes:F}=function(){let e=(0,n.useCallback)(async e=>{try{let t=i.Kz[e.type];if(!t)return;let r=t.component(),a=t.layout?t.layout():Promise.resolve(null);await Promise.all([r,a])}catch(t){console.error("预加载路由失败: ".concat(e.path),t)}},[]),t=(0,n.useCallback)(async t=>{let r=t.map(t=>e(t));await Promise.allSettled(r)},[e]);return{preloadRoute:e,preloadRoutes:t,preloadRouteType:(0,n.useCallback)(async e=>{try{let t=i.Kz[e];if(!t)return;let r=t.component(),a=t.layout?t.layout():Promise.resolve(null);await Promise.all([r,a])}catch(t){console.error("预加载路由类型失败: ".concat(e),t)}},[])}}(),{addToHistory:G,goBack:_,goForward:z,getCurrentRoute:M,getHistorySummary:U}=function(){let[e,t]=(0,n.useState)([]),[r,a]=(0,n.useState)(-1),o=(0,n.useCallback)(e=>{t(t=>{var n;if((null===(n=t[r])||void 0===n?void 0:n.path)===e.path)return t;let o=t.slice(0,r+1);return o.push(e),o.length>20&&o.shift(),a(o.length-1),o})},[r]),s=(0,n.useCallback)(()=>r>0?(a(e=>e-1),e[r-1]):null,[e,r]),c=(0,n.useCallback)(()=>r<e.length-1?(a(e=>e+1),e[r+1]):null,[e,r]);return{addToHistory:o,goBack:s,goForward:c,getCurrentRoute:(0,n.useCallback)(()=>e[r]||null,[e,r]),clearHistory:(0,n.useCallback)(()=>{t([]),a(-1)},[]),getHistorySummary:(0,n.useCallback)(()=>({canGoBack:r>0,canGoForward:r<e.length-1,historyLength:e.length,currentIndex:r}),[e.length,r])}}(),{startRouteLoad:Y,endRouteLoad:H,getPerformanceReport:J,clearPerformanceData:B}=function(){let[e,t]=(0,n.useState)({}),r=(0,n.useCallback)(e=>performance.now(),[]);return{startRouteLoad:r,endRouteLoad:(0,n.useCallback)(function(e,r,a,n){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=n?performance.now()-n:0;t(t=>{let a=t[e]||{accessCount:0,errorCount:0,totalLoadTime:0,averageLoadTime:0,lastAccessed:new Date().toISOString()},n={...a,accessCount:a.accessCount+1,errorCount:r?a.errorCount:a.errorCount+1,totalLoadTime:a.totalLoadTime+(o?0:s),averageLoadTime:o?a.averageLoadTime:(a.totalLoadTime+s)/(a.accessCount+1),lastAccessed:new Date().toISOString()};return{...t,[e]:n}})},[]),getPerformanceReport:(0,n.useCallback)(()=>{let t=Object.keys(e);if(0===t.length)return{totalRoutes:0,totalAccesses:0,totalErrors:0,averageLoadTime:0,mostAccessed:null,mostErrors:null,routeStats:{}};let r=0,a=0,n=0,o=t[0],s=t[0];return t.forEach(t=>{let c=e[t];r+=c.accessCount,a+=c.errorCount,n+=c.totalLoadTime,c.accessCount>e[o].accessCount&&(o=t),c.errorCount>e[s].errorCount&&(s=t)}),{totalRoutes:t.length,totalAccesses:r,totalErrors:a,averageLoadTime:n/r,mostAccessed:{path:o,...e[o]},mostErrors:{path:s,...e[s]},routeStats:e}},[e]),clearPerformanceData:(0,n.useCallback)(()=>{t({})},[])}}(),{preheatRoute:V,preheatRoutes:W,isRoutePreheated:K,getPreheatStatus:q,getRoutePriority:X}=h(),{saveParams:Q,getParams:Z,clearParams:$}=function(){let[e,t]=(0,n.useState)({});(0,n.useEffect)(()=>{try{let e=localStorage.getItem(p);e&&t(JSON.parse(e))}catch(e){console.error("Failed to load route params:",e)}},[]);let r=(0,n.useCallback)(e=>{try{localStorage.setItem(p,JSON.stringify(e))}catch(e){console.error("Failed to save route params:",e)}},[]);return{saveParams:(0,n.useCallback)((e,a)=>{t(t=>{let n={...t,[e]:a};return r(n),n})},[r]),getParams:(0,n.useCallback)(t=>e[t],[e]),clearParams:(0,n.useCallback)(e=>{e?t(t=>{let{[e]:a,...n}=t;return r(n),n}):(t({}),localStorage.removeItem(p))},[r])}}(),ee=(0,n.useCallback)(()=>{let e={};return f.forEach((t,r)=>{"page"===r||"limit"===r?e[r]=parseInt(t):e[r]=t}),e},[f]),et=e=>{let t=new URLSearchParams;return Object.entries(e).forEach(e=>{let[r,a]=e;null!=a&&t.append(r,String(a))}),t.toString()},er=(0,n.useCallback)(e=>null==S||!S.validateParams||S.validateParams(e),[S]),ea=(0,n.useCallback)(e=>{let t={...b,...e};if(er(t)){let e=et(t);r.push("".concat(d).concat(e?"?".concat(e):"")),C(t),d&&Q(d,t)}},[b,d,r,er,Q]);(0,n.useEffect)(()=>{let e=ee();if(Object.keys(e).length>0)C(e),d&&Q(d,e);else if(d){let e=Z(d);e&&Object.keys(e).length>0&&ea(e)}},[d,ee,Z,Q,ea]);let en=(0,n.useCallback)(()=>{d&&($(d),C({}),r.push(d))},[d,r,$]),eo=(0,n.useCallback)(async()=>{if(w){E(!0);try{let e=await (0,u.Io)("/routes/user/routes");P(e.data)}catch(e){console.error("获取用户路由失败:",e)}finally{E(!1)}}},[w]),es=(0,n.useCallback)(async e=>{if(w){R(!0);try{let t=await (0,u.Io)("/routes/family/".concat(e,"/routes"));T(t.data)}catch(e){console.error("获取家庭路由失败:",e)}finally{R(!1)}}},[w]);(0,n.useEffect)(()=>{w&&eo()},[w,eo]),(0,n.useEffect)(()=>{(null==w?void 0:w.currentFamilyId)&&es(w.currentFamilyId)},[null==w?void 0:w.currentFamilyId,es]);let ec=(0,n.useCallback)(async e=>{if(w)try{let t=await (0,u.Io)("/api/routes",{method:"POST",body:JSON.stringify(e)});return e.family_id?es(e.family_id):eo(),O("路由创建成功","success"),t.data.id}catch(e){console.error("创建路由失败:",e),O("创建路由失败","error")}},[w,es,eo,O]),eu=(0,n.useCallback)(async e=>{let{id:t,data:r}=e;if(w)try{await (0,u.Io)("/api/routes/".concat(t),{method:"PUT",body:JSON.stringify(r)}),eo(),w.currentFamilyId&&es(w.currentFamilyId)}catch(e){throw console.error("更新路由失败:",e),e}},[w,eo,es]),el=(0,n.useCallback)(async e=>{if(w)try{await (0,u.Io)("/api/routes/".concat(e),{method:"DELETE"}),eo(),w.currentFamilyId&&es(w.currentFamilyId)}catch(e){throw console.error("删除路由失败:",e),e}},[w,eo,es]),ei=(0,n.useCallback)(()=>[{key:c.wI.PUBLIC,label:"公开"},{key:c.wI.PRIVATE,label:"私有"},{key:c.wI.FAMILY,label:"家庭"},{key:c.wI.ADMIN,label:"管理员"}],[]),ed=e=>(0,i.AW)(e.type,e.permission,null==w?void 0:w.id,null==w?void 0:w.currentFamilyId);(0,n.useEffect)(()=>{S&&W([...v,...k].filter(e=>e.type===S.type&&(!S.id||e.id!==S.id)))},[S,v,k,W]);let ef=(0,n.useCallback)(async(e,t)=>{let a=[...v,...k].find(t=>t.path===e);if(a&&!ed(a)){y.Am.error("无权访问该路由");return}try{let n=Y(e),o=N(e);if(o){I(o),G(o),r.push("".concat(e).concat(t?et(t):"")),t&&C(t),H(e,!0,void 0,n,!0);return}if(K(e)){a&&(D(a),I(a),G(a)),r.push("".concat(e).concat(t?et(t):"")),t&&C(t),H(e,!0,void 0,n,!1);return}r.push("".concat(e).concat(t?et(t):"")),t&&C(t),a&&(await V(a),D(a),I(a),G(a)),H(e,!0,void 0,n,!1)}catch(t){console.error("导航失败:",t),H(e,!1,t),y.Am.error("导航失败")}},[r,v,k,ed,Y,H,N,K,V,D,G,et]),eh=(0,n.useCallback)(async()=>{let e=_();e&&await ef(e.path,e.params||{})},[_,ef]),em=(0,n.useCallback)(async()=>{let e=z();e&&await ef(e.path,e.params||{})},[z,ef]);(0,n.useEffect)(()=>{let e=setInterval(L,6e4);return()=>clearInterval(e)},[L]);let ep=(0,n.useCallback)(()=>{let e=J(),{preheated:t,preheating:r}=q();return{...e,cacheHitRate:0,preheatingStatus:{total:r.length+t.length,completed:t.length}}},[J,q]);return(0,a.jsx)(g.Provider,{value:{currentRoute:S,params:b,userRoutes:v,familyRoutes:k,isLoadingUserRoutes:A,isLoadingFamilyRoutes:x,fetchUserRoutes:eo,fetchFamilyRoutes:es,createRoute:ec,updateRoute:eu,deleteRoute:el,getPermissionOptions:ei,navigateToRoute:ef,checkAccess:ed,handleGoBack:eh,handleGoForward:em,getHistorySummary:U,getPerformanceReport:ep,getCacheStats:()=>({totalSize:0,itemCount:0,maxSize:0,usage:0}),getPreheatStatus:q,updateParams:ea,validateParams:er,clearPerformanceData:B,resetParams:en},children:t})}function S(e){let{children:t}=e;return(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading routes..."}),children:(0,a.jsx)(w,{children:t})})}function I(){let e=(0,n.useContext)(g);if(!e)throw Error("useRoute must be used within a RouteProvider");return e}},41310:function(e,t,r){"use strict";r.d(t,{p:function(){return n}});var a=r(10963);function n(){return{showToast:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r={duration:3e3,style:{padding:"16px",borderRadius:"8px"}};switch(t){case"success":a.Am.success(e,r);break;case"error":a.Am.error(e,r);break;case"warning":(0,a.Am)(e,{...r,icon:"⚠️"});break;default:(0,a.Am)(e,{...r,icon:"ℹ️"})}}}}},58222:function(e,t,r){"use strict";r.d(t,{AW:function(){return P},Cp:function(){return x},Ds:function(){return m},Hb:function(){return u},Io:function(){return f},KX:function(){return y},Ml:function(){return A},Nq:function(){return k},R5:function(){return E},_c:function(){return w},dx:function(){return p},fM:function(){return v},fq:function(){return I},h8:function(){return T},hQ:function(){return l},le:function(){return g},ot:function(){return S},qW:function(){return b},rr:function(){return C},we:function(){return h}});var a=r(77785),n=r(94564);let o=r(49079).env.NEXT_PUBLIC_API_URL||"http://localhost:3001/api",s=null,c=null;function u(e){s=e}function l(e){c=e}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error";c?c(e,t):console["error"===t?"error":"warning"===t?"warn":"log"](e)}let d={400:e=>{console.warn("请求参数错误: ".concat(e)),i("请求参数错误: ".concat(e),"warning")},401:e=>{(0,n.gy)(),localStorage.removeItem("isGuest"),localStorage.removeItem("currentFamilyId"),s?s():"/auth/login"!==window.location.pathname&&(i("登录已过期，请重新登录"+window.location.pathname,"error"),window.location.href="/auth/login")},403:e=>{console.warn("无权访问: ".concat(e)),i("无权访问: ".concat(e),"error")},404:e=>{console.warn("资源不存在: ".concat(e)),i("资源不存在: ".concat(e),"warning")},422:e=>{console.warn("数据验证失败: ".concat(e)),i("数据验证失败: ".concat(e),"warning")},429:e=>{console.warn("请求过多，请稍后再试: ".concat(e)),i("请求过多，请稍后再试","warning")},500:e=>{console.error("服务器错误: ".concat(e)),i("服务器内部错误，请稍后再试: ".concat(e),"error")},502:e=>{console.error("网关错误: ".concat(e)),i("服务器网关错误，请稍后再试","error")},503:e=>{console.error("服务不可用: ".concat(e)),i("服务暂时不可用，请稍后再试","error")},504:e=>{console.error("网关超时: ".concat(e)),i("请求超时，请检查网络连接后重试","error")}};async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="".concat(o).concat(e),s=(0,n.LP)(),c={"Content-Type":"application/json",...s?{Authorization:"Bearer ".concat(s)}:{}};try{let e=await fetch(r,{...t,headers:{...c,...t.headers}}),n=await e.json();if(console.log("sssssss",n),!e.ok){let t=d[e.status];throw t&&t(n.message||"请求失败"),new a.Hx(e.status,n.message||"请求失败")}return{data:n,message:n.message,status:e.status}}catch(e){if(e instanceof a.Hx)throw e;throw new a.Hx(500,e instanceof Error?e.message:"网络错误")}}let h=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"请求失败";if(e instanceof a.Hx)switch(e.status){case 400:return"请求参数错误: ".concat(e.message);case 403:return"无权访问: ".concat(e.message);case 404:return"资源不存在: ".concat(e.message);case 429:return"请求过于频繁，请稍后再试";case 500:case 502:case 503:return"服务器错误: ".concat(e.message);default:return e.message||t}return(null==e?void 0:e.message)||t};async function m(e){return(await f("/routes/predictions?user_id=".concat(e),{method:"GET"})).data}async function p(e){return(await f("/routes/".concat(e,"/optimization"),{method:"GET"})).data}async function y(e){let t=new URLSearchParams;e.startDate&&t.append("startDate",e.startDate),e.endDate&&t.append("endDate",e.endDate),e.routeIds&&e.routeIds.length>0&&e.routeIds.forEach(e=>t.append("routeIds[]",e.toString()));let r="".concat(o,"/routes/export?").concat(t.toString(),"&format=").concat(e.format),s=(0,n.LP)(),c=await fetch(r,{method:"GET",headers:{...s?{Authorization:"Bearer ".concat(s)}:{}}});if(!c.ok){let e=await c.json();throw new a.Hx(c.status,e.message||"导出失败")}return await c.blob()}async function g(e){let t=new URLSearchParams;return t.append("type",e.type),e.startDate&&t.append("startDate",e.startDate),e.endDate&&t.append("endDate",e.endDate),e.routeIds&&e.routeIds.length>0&&e.routeIds.forEach(e=>t.append("routeIds[]",e.toString())),(await f("/routes/visualization?".concat(t.toString()),{method:"GET"})).data}async function w(){return f("/routes")}async function S(e){return f("/routes",{method:"POST",body:JSON.stringify(e)})}async function I(e,t){return f("/routes/".concat(e),{method:"PUT",body:JSON.stringify(t)})}async function b(e){return f("/routes/".concat(e),{method:"DELETE"})}async function C(e){return f("/routes/".concat(e,"/toggle"),{method:"POST"})}async function v(e){return f("/routes/".concat(e,"/stats"))}async function P(){return f("/users")}async function k(e,t){return f("/users/".concat(e),{method:"PUT",body:JSON.stringify(t)})}async function T(e){return f("/users/".concat(e),{method:"DELETE"})}async function A(e){return f("/users/".concat(e,"/freeze"),{method:"POST"})}async function E(e){return f("/users/".concat(e,"/unfreeze"),{method:"POST"})}async function x(e){return f("/auth/change-password",{method:"POST",body:JSON.stringify(e)})}},77785:function(e,t,r){"use strict";var a,n,o,s;r.d(t,{Hx:function(){return c},Yt:function(){return a},wI:function(){return n}});class c extends Error{constructor(e,t){super(t),this.status=e,this.name="APIError"}}(o=a||(a={})).DASHBOARD="dashboard",o.TRANSACTIONS="transactions",o.STATISTICS="statistics",o.SETTINGS="settings",o.CUSTOM="custom",(s=n||(n={})).PUBLIC="public",s.PRIVATE="private",s.FAMILY="family",s.ADMIN="admin"},94564:function(e,t,r){"use strict";function a(){return localStorage.getItem("token")}function n(e){localStorage.setItem("token",e)}function o(){localStorage.removeItem("token")}r.d(t,{LP:function(){return a},gy:function(){return o},o4:function(){return n}})},73031:function(e,t,r){"use strict";r.d(t,{u:function(){return l}});var a=r(32281),n=r(84449),o=r(72874),s=r(5142),c=r(3827),u=(0,n.Gp)((e,t)=>{var r;let{as:n,className:u,children:l,...i}=e,d=(0,o.gy)(t),{slots:f,classNames:h}=(0,a.R)(),m=(0,s.W)(null==h?void 0:h.header,u);return(0,c.jsx)(n||"div",{ref:d,className:null==(r=f.header)?void 0:r.call(f,{class:m}),...i,children:l})});u.displayName="NextUI.CardHeader";var l=u},37963:function(e,t,r){"use strict";r.d(t,{o:function(){return n}});class a extends Error{}function n(e,t){let r;if("string"!=typeof e)throw new a("Invalid token specified: must be a string");t||(t={});let n=!0===t.header?0:1,o=e.split(".")[n];if("string"!=typeof o)throw new a("Invalid token specified: missing part #".concat(n+1));try{r=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var r;return r=t,decodeURIComponent(atob(r).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}catch(e){return atob(t)}}(o)}catch(e){throw new a("Invalid token specified: invalid base64 for part #".concat(n+1," (").concat(e.message,")"))}try{return JSON.parse(r)}catch(e){throw new a("Invalid token specified: invalid json for part #".concat(n+1," (").concat(e.message,")"))}}a.prototype.name="InvalidTokenError"}},function(e){e.O(0,[7674,6034,9390,9689,7945,7530,2178,5784,9178,7385,3614,6288,4187,224,1945,8704,414,4322,5961,4642,4788,568,6373,8792,5769,3509,2132,2751,4103,2971,8069,1744],function(){return e(e.s=46669)}),_N_E=e.O()}]);