(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6968],{28354:function(e,s,n){Promise.resolve().then(n.bind(n,40282))},40282:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return _}});var r=n(3827),i=n(64090),l=n(2210),a=n(45623),o=n(67945),c=n(51055),t=n(50535),m=n(9410),d=n(75129),x=n(63053),u=n(77058),h=n(36685),j=n(92339),v=n(49977),y=n(10732),f=n(4248),g=n(99510),p=n(22561),F=n(7725),A=n(47385),b=n(56178),C=n(14078),w=n(2646),z=n(47082),N=n(94642),E=n(20568),J=n(56288),O=n(52131),P=n(58222);function _(){let{user:e}=(0,O.useAuth)(),s=(null==e?void 0:e.role)==="admin"||(null==e?void 0:e.role)==="owner",n=(0,z.NL)(),[_,q]=(0,i.useState)(1),{isOpen:R,onOpen:S,onClose:k}=(0,l.q)(),{isOpen:D,onOpen:K,onClose:X}=(0,l.q)(),{isOpen:I,onOpen:Q,onClose:Y}=(0,l.q)(),[M,G]=(0,i.useState)(null),[L,W]=(0,i.useState)({username:"",email:"",role:"",maxFamilies:1,maxFamilyJoins:2}),{data:B,isLoading:H}=(0,N.a)({queryKey:["users"],queryFn:P.AW,enabled:s}),T=(null==B?void 0:B.data)||[],U=(0,E.D)({mutationFn:e=>{let{id:s,data:n}=e;return(0,P.Nq)(s,n)},onSuccess:()=>{n.invalidateQueries({queryKey:["users"]}),J.Am.success("用户更新成功"),k()},onError:e=>{J.Am.error("更新失败: ".concat(e instanceof Error?e.message:"未知错误"))}}),V=(0,E.D)({mutationFn:P.h8,onSuccess:()=>{n.invalidateQueries({queryKey:["users"]}),J.Am.success("用户删除成功"),X()},onError:e=>{J.Am.error("删除失败: ".concat(e instanceof Error?e.message:"未知错误"))}}),Z=(0,E.D)({mutationFn:P.Ml,onSuccess:()=>{n.invalidateQueries({queryKey:["users"]}),J.Am.success("用户已冻结")},onError:e=>{J.Am.error("冻结失败: ".concat(e instanceof Error?e.message:"未知错误"))}}),$=(0,E.D)({mutationFn:P.R5,onSuccess:()=>{n.invalidateQueries({queryKey:["users"]}),J.Am.success("用户已解冻")},onError:e=>{J.Am.error("解冻失败: ".concat(e instanceof Error?e.message:"未知错误"))}}),ee=e=>{G(e),W({username:e.username,email:e.email,role:e.role,maxFamilies:e.maxFamilies||1,maxFamilyJoins:e.maxFamilyJoins||2}),S()},es=e=>{G(e),K()},en=e=>{e.is_frozen?$.mutate(e.id):Z.mutate(e.id)},er=e=>{G(e),W({...L,maxFamilies:e.maxFamilies||1,maxFamilyJoins:e.maxFamilyJoins||2}),Q()},ei=Math.ceil(((null==T?void 0:T.length)||0)/10),el=i.useMemo(()=>{let e=(_-1)*10;return(null==T?void 0:T.slice(e,e+10))||[]},[_,T]);return s?H?(0,r.jsx)("div",{className:"flex justify-center items-center h-[400px]",children:(0,r.jsx)(a.c,{size:"lg"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"flex justify-between items-center",children:(0,r.jsx)("h2",{className:"text-xl font-bold",children:"用户管理"})}),(0,r.jsx)(o.w,{children:(0,r.jsx)(c.G,{children:(0,r.jsxs)(t.b,{"aria-label":"用户列表",bottomContent:ei>1?(0,r.jsx)("div",{className:"flex w-full justify-center",children:(0,r.jsx)(m.g,{isCompact:!0,showControls:!0,showShadow:!0,color:"primary",page:_,total:ei,onChange:q})}):null,children:[(0,r.jsxs)(d.J,{children:[(0,r.jsx)(x.j,{children:"用户名"}),(0,r.jsx)(x.j,{children:"邮箱"}),(0,r.jsx)(x.j,{children:"角色"}),(0,r.jsx)(x.j,{children:"状态"}),(0,r.jsx)(x.j,{children:"家庭限制"}),(0,r.jsx)(x.j,{children:"操作"})]}),(0,r.jsx)(u.y,{items:el,emptyContent:"暂无用户数据",children:e=>(0,r.jsxs)(h.g,{children:[(0,r.jsx)(j.X,{children:e.username}),(0,r.jsx)(j.X,{children:e.email}),(0,r.jsx)(j.X,{children:(0,r.jsx)(v.z,{color:"admin"===e.role?"primary":"owner"===e.role?"secondary":"default",variant:"flat",size:"sm",children:"admin"===e.role?"管理员":"owner"===e.role?"所有者":"普通用户"})}),(0,r.jsx)(j.X,{children:(0,r.jsx)(v.z,{color:e.is_frozen?"danger":"success",variant:"flat",size:"sm",children:e.is_frozen?"已冻结":"正常"})}),(0,r.jsx)(j.X,{children:(0,r.jsxs)("div",{className:"text-xs",children:[(0,r.jsxs)("div",{children:["可创建: ",e.maxFamilies||1,"个家庭"]}),(0,r.jsxs)("div",{children:["可加入: ",e.maxFamilyJoins||2,"个家庭"]})]})}),(0,r.jsx)(j.X,{children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(y.A,{size:"sm",variant:"light",onPress:()=>ee(e),children:"编辑"}),(0,r.jsx)(y.A,{size:"sm",color:e.is_frozen?"success":"warning",variant:"light",onPress:()=>en(e),children:e.is_frozen?"解冻":"冻结"}),(0,r.jsx)(y.A,{size:"sm",color:"primary",variant:"light",onPress:()=>er(e),children:"限制"}),(0,r.jsx)(y.A,{size:"sm",color:"danger",variant:"light",onPress:()=>es(e),isDisabled:"owner"===e.role,children:"删除"})]})})]},e.id)})]})})}),(0,r.jsx)(f.R,{isOpen:R,onClose:k,children:(0,r.jsxs)(g.A,{children:[(0,r.jsx)(p.k,{children:"编辑用户"}),(0,r.jsxs)(F.I,{children:[(0,r.jsx)(A.Y,{label:"用户名",value:L.username,onChange:e=>W({...L,username:e.target.value})}),(0,r.jsx)(A.Y,{label:"邮箱",value:L.email,onChange:e=>W({...L,email:e.target.value})}),(0,r.jsxs)(b.g,{label:"角色",selectedKeys:[L.role],onChange:e=>W({...L,role:e.target.value}),isDisabled:(null==M?void 0:M.role)==="owner",children:[(0,r.jsx)(C.R,{value:"user",children:"普通用户"},"user"),(0,r.jsx)(C.R,{value:"admin",children:"管理员"},"admin"),(0,r.jsx)(C.R,{value:"owner",children:"所有者"},"owner")]})]}),(0,r.jsxs)(w.R,{children:[(0,r.jsx)(y.A,{variant:"flat",onPress:k,children:"取消"}),(0,r.jsx)(y.A,{color:"primary",onPress:()=>{M&&U.mutate({id:M.id,data:{username:L.username,email:L.email,role:L.role}})},children:"保存"})]})]})}),(0,r.jsx)(f.R,{isOpen:D,onClose:X,children:(0,r.jsxs)(g.A,{children:[(0,r.jsx)(p.k,{children:"确认删除"}),(0,r.jsx)(F.I,{children:(0,r.jsxs)("p",{children:['确定要删除用户 "',null==M?void 0:M.username,'" 吗？此操作不可撤销。']})}),(0,r.jsxs)(w.R,{children:[(0,r.jsx)(y.A,{variant:"flat",onPress:X,children:"取消"}),(0,r.jsx)(y.A,{color:"danger",onPress:()=>{M&&V.mutate(M.id)},children:"删除"})]})]})}),(0,r.jsx)(f.R,{isOpen:I,onClose:Y,children:(0,r.jsxs)(g.A,{children:[(0,r.jsx)(p.k,{children:"设置用户限制"}),(0,r.jsxs)(F.I,{children:[(0,r.jsx)(A.Y,{type:"number",label:"最大可创建家庭数",value:L.maxFamilies.toString(),onChange:e=>W({...L,maxFamilies:parseInt(e.target.value)||1}),min:1,max:10}),(0,r.jsx)(A.Y,{type:"number",label:"最大可加入家庭数",value:L.maxFamilyJoins.toString(),onChange:e=>W({...L,maxFamilyJoins:parseInt(e.target.value)||2}),min:1,max:10})]}),(0,r.jsxs)(w.R,{children:[(0,r.jsx)(y.A,{variant:"flat",onPress:Y,children:"取消"}),(0,r.jsx)(y.A,{color:"primary",onPress:()=>{M&&(U.mutate({id:M.id,data:{maxFamilies:L.maxFamilies,maxFamilyJoins:L.maxFamilyJoins}}),Y())},children:"保存"})]})]})})]}):(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"无权访问"}),(0,r.jsx)("p",{children:"只有管理员可以访问此页面"})]})}}},function(e){e.O(0,[6034,9390,9689,7945,7530,2178,5784,7385,6288,224,4187,1945,8704,414,4322,568,5961,4642,4788,6373,3540,2131,2971,8069,1744],function(){return e(e.s=28354)}),_N_E=e.O()}]);