(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6133],{36567:function(e,s,a){Promise.resolve().then(a.bind(a,42267))},42267:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return K}});var l=a(3827),t=a(64090),n=a(49977),r=a(10732),i=a(67945),c=a(51055),d=a(56178),o=a(14078),m=a(50535),u=a(75129),x=a(63053),h=a(77058),f=a(36685),j=a(92339),y=a(4248),N=a(99510),b=a(22561),p=a(7725),g=a(47385),v=a(2646),w=a(25548),I=a(24424),k=a(1310),C=a(46102),P=a(55621),q=a(96770),A=a(52131),S=a(929),E=a(54894),R=a(20003),F=a(8792);function K(){let{categories:e,isLoading:s,error:a}=(0,P.L)(),K=e.filter(e=>e.is_default),T=e.filter(e=>!e.is_default),_=async e=>{},D=async e=>{},O=async e=>{},[z,L]=(0,t.useState)(!1),[X,Z]=(0,t.useState)(!1),[Q,G]=(0,t.useState)(null),[J,M]=(0,t.useState)({name:"",icon:"",type:"expense"}),{showToast:Y}=(0,q.useToast)(),{user:H,isGuest:W}=(0,A.useAuth)(),{families:$=[],currentFamily:B,setCurrentFamily:U}=(0,R.cW)(),V=(0,t.useMemo)(()=>!!H&&("admin"===H.role||"owner"===H.role),[H]),ee=(0,t.useMemo)(()=>[{key:"icon",label:"图标"},{key:"name",label:"名称"},{key:"type",label:"类型"},{key:"actions",label:"操作"}],[V]),es=(0,t.useMemo)(()=>[{key:"icon",label:"图标"},{key:"name",label:"名称"},{key:"type",label:"类型"},{key:"actions",label:"操作"}],[]);console.log("分类数据:",e),console.log("默认分类:",K),console.log("自定义分类:",T),console.log("用户信息:",H);let ea=()=>{if(!J.name||!J.icon||!J.type){Y("请填写完整信息","error");return}if(Q){if(Q.is_default&&!V){Y("只有管理员可以修改默认分类","error");return}D({...Q,name:J.name,icon:J.icon,type:J.type})}else{if(!B&&!J.is_default){Y("请先选择一个家庭","error");return}if(J.is_default&&!V){Y("只有管理员可以创建默认分类","error");return}J.name&&J.icon&&J.type?_({name:J.name,icon:J.icon,type:J.type,is_default:J.is_default||!1}):Y("请填写完整信息","error")}L(!1),G(null),M({name:"",icon:"",type:"expense"})},el=e=>{if(console.log("handleEdit被调用，category:",e),W){Y("访客模式下无法编辑","error");return}if(e.is_default&&!V){Y("只有管理员可以修改默认分类","error");return}G(e),M(e),console.log("准备打开模态框"),L(!0),console.log("模态框应该已打开")},et=e=>{if(console.log("handleDelete被调用，category:",e),W){Y("访客模式下无法删除","error");return}if(e.is_default&&!V){Y("只有管理员可以删除默认分类","error");return}G(e),Z(!0)},en=()=>{Q&&O("string"==typeof Q.id?parseInt(Q.id):Q.id),Z(!1),G(null)},er=(e,s)=>{switch(s){case"icon":return(0,l.jsx)("div",{className:"text-xl",children:e.icon});case"name":return(0,l.jsx)("div",{className:"font-medium",children:e.name});case"type":return(0,l.jsx)(n.z,{color:"expense"===e.type?"danger":"success",variant:"flat",size:"sm",className:"capitalize",children:"expense"===e.type?"支出":"收入"});case"actions":if(!V)return null;return(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(r.A,{isIconOnly:!0,size:"sm",variant:"light",color:"primary",onPress:()=>el(e),className:"rounded-full",children:(0,l.jsx)(w.Z,{className:"h-4 w-4"})}),(0,l.jsx)(r.A,{isIconOnly:!0,size:"sm",color:"danger",variant:"light",onPress:()=>et(e),className:"rounded-full",children:(0,l.jsx)(I.Z,{className:"h-4 w-4"})})]});default:return null}},ei=(e,s)=>{switch(s){case"icon":return(0,l.jsx)("div",{className:"text-xl",children:e.icon});case"name":return(0,l.jsx)("div",{className:"font-medium",children:e.name});case"type":return(0,l.jsx)(n.z,{color:"expense"===e.type?"danger":"success",variant:"flat",size:"sm",className:"capitalize",children:"expense"===e.type?"支出":"收入"});case"actions":return(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(r.A,{isIconOnly:!0,size:"sm",variant:"light",color:"primary",onPress:()=>el(e),isDisabled:W,className:"rounded-full",children:(0,l.jsx)(w.Z,{className:"h-4 w-4"})}),(0,l.jsx)(r.A,{isIconOnly:!0,size:"sm",color:"danger",variant:"light",onPress:()=>et(e),isDisabled:W,className:"rounded-full",children:(0,l.jsx)(I.Z,{className:"h-4 w-4"})})]});default:return null}},ec=()=>{console.log("handleAddDefaultCategory被调用"),G(null),M({name:"",icon:"",type:"expense",is_default:!0}),L(!0)};return s?(0,l.jsx)("div",{className:"w-full",children:(0,l.jsx)("div",{className:"p-4",children:(0,l.jsx)(S.Z,{})})}):a?(0,l.jsx)("div",{className:"w-full p-4",children:(0,l.jsx)(i.w,{children:(0,l.jsxs)(c.G,{className:"flex flex-col items-center justify-center gap-4 py-8",children:[(0,l.jsx)("div",{className:"text-danger text-4xl",children:(0,l.jsx)(E.Z,{className:"h-12 w-12"})}),(0,l.jsx)("h3",{className:"text-xl font-semibold",children:"加载失败"}),(0,l.jsx)("p",{className:"text-default-500",children:a instanceof Error?a.message:"获取分类数据失败，请稍后重试"}),(0,l.jsx)(r.A,{color:"primary",onPress:()=>window.location.reload(),children:"重新加载"})]})})}):B?(0,l.jsxs)("div",{className:"space-y-8 max-w-6xl mx-auto",children:[(0,l.jsx)(i.w,{className:"shadow-sm hover:shadow-md transition-shadow duration-200",children:(0,l.jsx)(c.G,{className:"p-6",children:(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-primary",children:"当前家庭"}),(0,l.jsx)("p",{className:"text-default-500 mt-1",children:B.name})]}),(0,l.jsx)(d.g,{label:"切换家庭",selectedKeys:[B.id.toString()],className:"max-w-xs w-full",size:"sm",onChange:e=>{let s=parseInt(e.target.value),a=$.find(e=>e.id===s);a&&(U(a),Y("已切换到家庭: "+a.name,"success"))},children:$.map(e=>(0,l.jsx)(o.R,{value:e.id,children:e.name},e.id))})]})})}),(0,l.jsx)(i.w,{className:"shadow-sm hover:shadow-md transition-shadow duration-200",children:(0,l.jsxs)(c.G,{className:"p-6",children:[(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-primary",children:"自定义分类"}),(0,l.jsxs)("p",{className:"text-sm text-default-500 mt-1",children:[B.name," 家庭的自定义分类"]})]}),(0,l.jsx)(r.A,{color:"primary",startContent:(0,l.jsx)(k.Z,{className:"h-5 w-5"}),onPress:()=>{if(!B){Y("请先选择一个家庭","error");return}G(null),M({name:"",icon:"",type:"expense"}),L(!0)},isDisabled:W,size:"md",className:"min-w-[140px]",children:"添加分类"})]}),T.length>0?(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)(m.b,{"aria-label":"自定义分类列表",classNames:{base:"min-w-full",table:"min-w-full",thead:"bg-default-50",th:"text-default-700 font-semibold",tr:"hover:bg-default-50 transition-colors border-b border-default-100"},children:[(0,l.jsx)(u.J,{children:es.map(e=>(0,l.jsx)(x.j,{className:"text-sm",children:e.label},e.key))}),(0,l.jsx)(h.y,{items:T,emptyContent:"暂无自定义分类",children:e=>(0,l.jsx)(f.g,{className:"h-14",children:es.map(s=>(0,l.jsx)(j.X,{children:ei(e,s.key)},s.key))},e.id)})]})}):(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center bg-default-50 rounded-lg",children:[(0,l.jsx)("div",{className:"text-default-300 mb-4",children:(0,l.jsx)(C.Z,{className:"h-16 w-16"})}),(0,l.jsx)("p",{className:"text-default-600 font-medium mb-2",children:"暂无自定义分类"}),(0,l.jsx)("p",{className:"text-default-400 text-sm",children:'点击上方"添加分类"按钮创建'})]})]})}),(0,l.jsx)(i.w,{className:"shadow-sm hover:shadow-md transition-shadow duration-200",children:(0,l.jsxs)(c.G,{className:"p-6",children:[(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-primary",children:"默认分类"}),(0,l.jsxs)("p",{className:"text-sm text-default-500 mt-1",children:["系统预设的分类",V?"，管理员可以修改":""]})]}),V&&(0,l.jsx)(r.A,{color:"primary",startContent:(0,l.jsx)(k.Z,{className:"h-5 w-5"}),onPress:ec,isDisabled:W,size:"md",className:"min-w-[140px]",children:"添加默认分类"})]}),K.length>0?(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)(m.b,{"aria-label":"默认分类列表",classNames:{base:"min-w-full",table:"min-w-full",thead:"bg-default-50",th:"text-default-700 font-semibold",tr:"hover:bg-default-50 transition-colors border-b border-default-100"},children:[(0,l.jsx)(u.J,{children:ee.map(e=>(0,l.jsx)(x.j,{className:"text-sm",children:e.label},e.key))}),(0,l.jsx)(h.y,{items:K,emptyContent:"暂无默认分类",children:e=>(0,l.jsx)(f.g,{className:"h-14",children:ee.map(s=>(0,l.jsx)(j.X,{children:er(e,s.key)},s.key))},e.id)})]})}):(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center bg-default-50 rounded-lg",children:[(0,l.jsx)("div",{className:"text-default-300 mb-4",children:(0,l.jsx)(C.Z,{className:"h-16 w-16"})}),(0,l.jsx)("p",{className:"text-default-600 font-medium mb-2",children:"暂无默认分类"}),V&&(0,l.jsx)("p",{className:"text-default-400 text-sm",children:'点击上方"添加默认分类"按钮创建'})]})]})}),(0,l.jsx)(y.R,{isOpen:z,onClose:()=>L(!1),classNames:{base:"max-w-md mx-auto",header:"border-b border-default-100 pb-2",body:"py-6",footer:"border-t border-default-100 pt-2"},backdrop:"blur",children:(0,l.jsxs)(N.A,{children:[(0,l.jsxs)(b.k,{className:"flex flex-col gap-1",children:[(0,l.jsx)("h3",{className:"text-xl font-bold",children:Q?"编辑分类":"添加分类"}),(0,l.jsx)("p",{className:"text-sm text-default-500",children:Q?"修改分类信息":"创建新的分类"})]}),(0,l.jsx)(p.I,{children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)(g.Y,{label:"名称",placeholder:"请输入分类名称",value:J.name,onChange:e=>M({...J,name:e.target.value}),variant:"bordered",labelPlacement:"outside",isRequired:!0,startContent:(0,l.jsx)("div",{className:"pointer-events-none flex items-center",children:(0,l.jsx)("span",{className:"text-default-400 text-sm",children:"名称"})})}),(0,l.jsx)(g.Y,{label:"图标",placeholder:"请输入分类图标",value:J.icon,onChange:e=>M({...J,icon:e.target.value}),variant:"bordered",labelPlacement:"outside",isRequired:!0,startContent:(0,l.jsx)("div",{className:"pointer-events-none flex items-center",children:(0,l.jsx)("span",{className:"text-default-400 text-sm",children:"图标"})})}),(0,l.jsxs)(d.g,{label:"类型",selectedKeys:J.type?[J.type]:[],onChange:e=>M({...J,type:e.target.value}),variant:"bordered",labelPlacement:"outside",isRequired:!0,children:[(0,l.jsx)(o.R,{value:"expense",children:"支出"},"expense"),(0,l.jsx)(o.R,{value:"income",children:"收入"},"income")]})]})}),(0,l.jsxs)(v.R,{children:[(0,l.jsx)(r.A,{variant:"bordered",onPress:()=>L(!1),className:"min-w-[80px]",children:"取消"}),(0,l.jsx)(r.A,{color:"primary",onPress:ea,className:"min-w-[80px]",children:"确定"})]})]})}),(0,l.jsx)(y.R,{isOpen:X,onClose:()=>Z(!1),classNames:{base:"max-w-md mx-auto",header:"border-b border-default-100 pb-2",body:"py-6",footer:"border-t border-default-100 pt-2"},backdrop:"blur",children:(0,l.jsxs)(N.A,{children:[(0,l.jsxs)(b.k,{className:"flex flex-col gap-1",children:[(0,l.jsx)("h3",{className:"text-xl font-bold",children:"确认删除"}),(0,l.jsx)("p",{className:"text-sm text-default-500",children:"此操作不可撤销"})]}),(0,l.jsxs)(p.I,{children:[(0,l.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,l.jsx)("div",{className:"bg-danger-50 p-4 rounded-full mb-4",children:(0,l.jsx)(I.Z,{className:"h-8 w-8 text-danger"})})}),(0,l.jsxs)("p",{className:"text-center",children:["确定要删除 ",(0,l.jsx)("span",{className:"font-bold",children:null==Q?void 0:Q.name})," 分类吗？"]}),(0,l.jsx)("p",{className:"text-center text-default-500 text-sm mt-2",children:"删除后无法恢复，相关的交易记录将失去分类关联。"})]}),(0,l.jsxs)(v.R,{children:[(0,l.jsx)(r.A,{variant:"bordered",onPress:()=>Z(!1),className:"min-w-[80px]",children:"取消"}),(0,l.jsx)(r.A,{color:"danger",onPress:en,className:"min-w-[80px]",children:"删除"})]})]})})]}):(0,l.jsxs)("div",{className:"w-full space-y-8 max-w-6xl mx-auto",children:[(0,l.jsx)(i.w,{className:"shadow-sm hover:shadow-md transition-shadow duration-200",children:(0,l.jsxs)(c.G,{className:"flex flex-col items-center justify-center py-10 text-center",children:[(0,l.jsx)("div",{className:"text-warning mb-6",children:(0,l.jsx)(E.Z,{className:"h-16 w-16"})}),(0,l.jsx)("h3",{className:"text-2xl font-bold mb-3",children:"请选择一个家庭"}),(0,l.jsx)("p",{className:"text-default-500 mb-8 max-w-md",children:"您需要选择一个家庭才能管理自定义分类。自定义分类将与您选择的家庭关联。"}),$.length>0?(0,l.jsxs)("div",{className:"max-w-xs w-full",children:[(0,l.jsx)(d.g,{label:"选择家庭",placeholder:"请选择一个家庭",className:"w-full mb-4",size:"lg",onChange:e=>{let s=parseInt(e.target.value),a=$.find(e=>e.id===s);a&&(U(a),Y("已切换到家庭: "+a.name,"success"))},children:$.map(e=>(0,l.jsx)(o.R,{value:e.id,children:e.name},e.id))}),(0,l.jsx)("p",{className:"text-sm text-default-400",children:"选择一个家庭后，您可以管理该家庭的自定义分类"})]}):(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)("p",{className:"text-default-500 mb-4",children:"您还没有创建任何家庭"}),(0,l.jsx)(r.A,{color:"primary",as:F.default,href:"/settings/family",size:"lg",children:"创建家庭"})]})]})}),(0,l.jsx)(i.w,{className:"shadow-sm hover:shadow-md transition-shadow duration-200",children:(0,l.jsxs)(c.G,{className:"p-6",children:[(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-primary",children:"默认分类"}),(0,l.jsxs)("p",{className:"text-sm text-default-500 mt-1",children:["系统预设的分类",V?"，管理员可以修改":""]})]}),V&&(0,l.jsx)(r.A,{color:"primary",startContent:(0,l.jsx)(k.Z,{className:"h-5 w-5"}),onPress:ec,isDisabled:W,size:"md",className:"min-w-[140px]",children:"添加默认分类"})]}),K.length>0?(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)(m.b,{"aria-label":"默认分类列表",classNames:{base:"min-w-full",table:"min-w-full",thead:"bg-default-50",th:"text-default-700 font-semibold",tr:"hover:bg-default-50 transition-colors border-b border-default-100"},children:[(0,l.jsx)(u.J,{children:ee.map(e=>(0,l.jsx)(x.j,{className:"text-sm",children:e.label},e.key))}),(0,l.jsx)(h.y,{items:K,emptyContent:"暂无默认分类",children:e=>(0,l.jsx)(f.g,{className:"h-14",children:ee.map(s=>(0,l.jsx)(j.X,{children:er(e,s.key)},s.key))},e.id)})]})}):(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center bg-default-50 rounded-lg",children:[(0,l.jsx)("div",{className:"text-default-300 mb-4",children:(0,l.jsx)(C.Z,{className:"h-16 w-16"})}),(0,l.jsx)("p",{className:"text-default-600 font-medium mb-2",children:"暂无默认分类"}),V&&(0,l.jsx)("p",{className:"text-default-400 text-sm",children:'点击上方"添加默认分类"按钮创建'})]})]})}),(0,l.jsx)(y.R,{isOpen:z,onClose:()=>L(!1),classNames:{base:"max-w-md mx-auto",header:"border-b border-default-100 pb-2",body:"py-6",footer:"border-t border-default-100 pt-2"},backdrop:"blur",children:(0,l.jsxs)(N.A,{children:[(0,l.jsxs)(b.k,{className:"flex flex-col gap-1",children:[(0,l.jsx)("h3",{className:"text-xl font-bold",children:Q?"编辑分类":"添加分类"}),(0,l.jsx)("p",{className:"text-sm text-default-500",children:Q?"修改分类信息":"创建新的分类"})]}),(0,l.jsx)(p.I,{children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)(g.Y,{label:"名称",placeholder:"请输入分类名称",value:J.name,onChange:e=>M({...J,name:e.target.value}),variant:"bordered",labelPlacement:"outside",isRequired:!0,startContent:(0,l.jsx)("div",{className:"pointer-events-none flex items-center",children:(0,l.jsx)("span",{className:"text-default-400 text-sm",children:"名称"})})}),(0,l.jsx)(g.Y,{label:"图标",placeholder:"请输入分类图标",value:J.icon,onChange:e=>M({...J,icon:e.target.value}),variant:"bordered",labelPlacement:"outside",isRequired:!0,startContent:(0,l.jsx)("div",{className:"pointer-events-none flex items-center",children:(0,l.jsx)("span",{className:"text-default-400 text-sm",children:"图标"})})}),(0,l.jsxs)(d.g,{label:"类型",selectedKeys:J.type?[J.type]:[],onChange:e=>M({...J,type:e.target.value}),variant:"bordered",labelPlacement:"outside",isRequired:!0,children:[(0,l.jsx)(o.R,{value:"expense",children:"支出"},"expense"),(0,l.jsx)(o.R,{value:"income",children:"收入"},"income")]})]})}),(0,l.jsxs)(v.R,{children:[(0,l.jsx)(r.A,{variant:"bordered",onPress:()=>L(!1),className:"min-w-[80px]",children:"取消"}),(0,l.jsx)(r.A,{color:"primary",onPress:ea,className:"min-w-[80px]",children:"确定"})]})]})}),(0,l.jsx)(y.R,{isOpen:X,onClose:()=>Z(!1),classNames:{base:"max-w-md mx-auto",header:"border-b border-default-100 pb-2",body:"py-6",footer:"border-t border-default-100 pt-2"},backdrop:"blur",children:(0,l.jsxs)(N.A,{children:[(0,l.jsxs)(b.k,{className:"flex flex-col gap-1",children:[(0,l.jsx)("h3",{className:"text-xl font-bold",children:"确认删除"}),(0,l.jsx)("p",{className:"text-sm text-default-500",children:"此操作不可撤销"})]}),(0,l.jsxs)(p.I,{children:[(0,l.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,l.jsx)("div",{className:"bg-danger-50 p-4 rounded-full mb-4",children:(0,l.jsx)(I.Z,{className:"h-8 w-8 text-danger"})})}),(0,l.jsxs)("p",{className:"text-center",children:["确定要删除 ",(0,l.jsx)("span",{className:"font-bold",children:null==Q?void 0:Q.name})," 分类吗？"]}),(0,l.jsx)("p",{className:"text-center text-default-500 text-sm mt-2",children:"删除后无法恢复，相关的交易记录将失去分类关联。"})]}),(0,l.jsxs)(v.R,{children:[(0,l.jsx)(r.A,{variant:"bordered",onPress:()=>Z(!1),className:"min-w-[80px]",children:"取消"}),(0,l.jsx)(r.A,{color:"danger",onPress:en,className:"min-w-[80px]",children:"删除"})]})]})})]})}},929:function(e,s,a){"use strict";a.d(s,{Z:function(){return i}});var l=a(3827),t=a(67945),n=a(51055),r=a(63983);function i(e){let{type:s="transaction",className:a=""}=e;return"statistics"===s?(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(e=>(0,l.jsx)(t.w,{className:"w-full",children:(0,l.jsxs)(n.G,{className:"space-y-3",children:[(0,l.jsx)(r.X,{className:"rounded-lg",children:(0,l.jsx)("div",{className:"h-3 w-3/4 rounded-lg bg-default-200"})}),(0,l.jsx)(r.X,{className:"rounded-lg",children:(0,l.jsx)("div",{className:"h-6 w-2/3 rounded-lg bg-default-200"})})]})},e))}):"category"===s?(0,l.jsx)(t.w,{className:"w-full",children:(0,l.jsxs)(n.G,{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)(r.X,{className:"rounded-lg",children:(0,l.jsx)("div",{className:"h-6 w-32 rounded-lg bg-default-200"})}),(0,l.jsx)(r.X,{className:"rounded-lg",children:(0,l.jsx)("div",{className:"h-8 w-48 rounded-lg bg-default-200"})})]}),(0,l.jsx)(r.X,{className:"rounded-lg",children:(0,l.jsx)("div",{className:"h-[300px] w-full rounded-lg bg-default-200"})}),(0,l.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(e=>(0,l.jsx)(t.w,{className:"w-full",children:(0,l.jsxs)(n.G,{className:"space-y-2",children:[(0,l.jsx)(r.X,{className:"rounded-lg",children:(0,l.jsx)("div",{className:"h-3 w-3/4 rounded-lg bg-default-200"})}),(0,l.jsx)(r.X,{className:"rounded-lg",children:(0,l.jsx)("div",{className:"h-5 w-2/3 rounded-lg bg-default-200"})})]})},e))})]})}):"table"===s?(0,l.jsxs)("div",{className:"space-y-3 ".concat(a),children:[(0,l.jsx)("div",{className:"flex space-x-2 mb-4",children:[1,2,3,4].map(e=>(0,l.jsx)(r.X,{className:"rounded-lg",children:(0,l.jsx)("div",{className:"h-8 w-24 rounded-lg bg-default-200"})},e))}),[1,2,3,4,5].map(e=>(0,l.jsx)("div",{className:"flex space-x-4 items-center",children:(0,l.jsx)(r.X,{className:"rounded-lg",children:(0,l.jsx)("div",{className:"h-10 w-full rounded-lg bg-default-200"})})},e))]}):(0,l.jsx)("div",{className:"space-y-3 ".concat(a),children:[1,2,3,4,5].map(e=>(0,l.jsx)(t.w,{className:"w-full",children:(0,l.jsx)(n.G,{children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(r.X,{className:"rounded-lg",children:(0,l.jsx)("div",{className:"h-3 w-24 rounded-lg bg-default-200"})}),(0,l.jsx)(r.X,{className:"rounded-lg",children:(0,l.jsx)("div",{className:"h-3 w-32 rounded-lg bg-default-200"})})]}),(0,l.jsx)(r.X,{className:"rounded-lg",children:(0,l.jsx)("div",{className:"h-6 w-20 rounded-lg bg-default-200"})})]})})},e))})}},55621:function(e,s,a){"use strict";a.d(s,{L:function(){return r}});var l=a(64090),t=a(58222),n=a(52131);function r(){let[e,s]=(0,l.useState)([]),[a,r]=(0,l.useState)(!0),[i,c]=(0,l.useState)(null),{user:d}=(0,n.useAuth)(),o=(0,l.useRef)(!1);return(0,l.useEffect)(()=>{d&&(o.current=!1);let e=async()=>{if(!o.current||!i)try{r(!0);let e="/categories";(null==d?void 0:d.currentFamilyId)?e+="?familyId=".concat(d.currentFamilyId):(null==d?void 0:d.id)&&(e+="?userId=".concat(d.id));let a=await (0,t.Io)(e);s(a.data),c(null)}catch(e){console.error("获取分类失败",e),c(e),s([]),o.current=!0}finally{r(!1)}};d?e():(s([]),r(!1))},[d]),{categories:e,isLoading:a,error:i}}},20003:function(e,s,a){"use strict";a.d(s,{Hc:function(){return f},Oh:function(){return h},X$:function(){return b},YF:function(){return x},ao:function(){return N},cW:function(){return o},kN:function(){return y},l0:function(){return m},t3:function(){return j},vP:function(){return u}});var l=a(47082),t=a(94642),n=a(20568),r=a(64090),i=a(58222),c=a(96770),d=a(52131);function o(){let{user:e,updateUser:s}=(0,d.useAuth)(),a=(0,l.NL)(),{showToast:n}=(0,c.useToast)(),[o,m]=(0,r.useState)([]),u=(0,r.useRef)(!1),{data:x,isLoading:h,error:f}=(0,t.a)({queryKey:["families"],queryFn:async()=>{try{let e=await (0,i.Io)("/families/user");return u.current=!1,e.data}catch(e){throw console.error("获取家庭列表失败:",e),u.current=!0,e}},enabled:!!e,staleTime:3e5,retry:u.current?0:2}),j=null==x?void 0:x.find(s=>s.id===(null==e?void 0:e.currentFamilyId)),{data:y,isLoading:N,error:b}=(0,t.a)({queryKey:["familyMembers",null==e?void 0:e.currentFamilyId],queryFn:async()=>(await (0,i.Io)("/families/".concat(null==e?void 0:e.currentFamilyId,"/members"))).data,enabled:!!(null==e?void 0:e.currentFamilyId)&&!u.current,staleTime:3e5,gcTime:3e5,retry:1});(0,r.useEffect)(()=>{f&&console.error("获取家庭列表失败:",f)},[f]),(0,r.useEffect)(()=>{b&&console.error("获取家庭成员失败:",b)},[b]);let p=(0,r.useCallback)(l=>{e&&(s({...e,currentFamilyId:l.id}),a.invalidateQueries({queryKey:["familyMembers"]}),a.invalidateQueries({queryKey:["transactions"]}),a.invalidateQueries({queryKey:["categories"]}),a.invalidateQueries({queryKey:["statistics"]}),a.invalidateQueries({queryKey:["categoryStats"]}),a.invalidateQueries({queryKey:["recentTransactions"]}),localStorage.setItem("currentFamilyId",l.id.toString()))},[e,s,a]),g=(0,r.useCallback)(()=>(null==j?void 0:j.owner_id)===(null==e?void 0:e.id)||(null==y?void 0:y.some(s=>s.user_id===(null==e?void 0:e.id)&&"admin"===s.role)),[j,e,y]);return{families:x,members:y||o,currentFamily:j,isLoading:h||N,error:f,setCurrentFamily:p,isAdmin:g}}function m(){let e=(0,l.NL)(),{showToast:s}=(0,c.useToast)();return(0,n.D)({mutationFn:async e=>(await (0,i.Io)("/families",{method:"POST",body:JSON.stringify(e)})).data,onSuccess:()=>{s("家庭创建成功","success"),e.invalidateQueries({queryKey:["families"]})},onError:e=>{s("创建失败: ".concat(e.message),"error")}})}function u(){let e=(0,l.NL)(),{showToast:s}=(0,c.useToast)();return(0,n.D)({mutationFn:async e=>{let{familyId:s,data:a}=e;return(await (0,i.Io)("/families/".concat(s),{method:"PATCH",body:JSON.stringify(a)})).data},onSuccess:()=>{s("家庭信息已更新","success"),e.invalidateQueries({queryKey:["families"]})},onError:e=>{s("更新失败: ".concat(e.message),"error")}})}function x(){let e=(0,l.NL)(),{showToast:s}=(0,c.useToast)();return(0,n.D)({mutationFn:async e=>{await (0,i.Io)("/families/".concat(e),{method:"DELETE"})},onSuccess:()=>{s("家庭已删除","success"),e.invalidateQueries({queryKey:["families"]})},onError:e=>{s("删除失败: ".concat(e.message),"error")}})}function h(){let e=(0,l.NL)(),{showToast:s}=(0,c.useToast)();return(0,n.D)({mutationFn:async e=>{let{familyId:s,data:a}=e;return(await (0,i.Io)("/families/".concat(s,"/members"),{method:"POST",body:JSON.stringify(a)})).data},onSuccess:()=>{s("成员已添加","success"),e.invalidateQueries({queryKey:["family"]})},onError:e=>{s("添加失败: ".concat(e.message),"error")}})}function f(){let e=(0,l.NL)(),{showToast:s}=(0,c.useToast)();return(0,n.D)({mutationFn:async e=>{let{familyId:s,memberId:a,role:l}=e;return(await (0,i.Io)("/families/".concat(s,"/members/").concat(a),{method:"PATCH",body:JSON.stringify({role:l})})).data},onSuccess:()=>{s("成员角色已更新","success"),e.invalidateQueries({queryKey:["family"]})},onError:e=>{s("更新失败: ".concat(e.message),"error")}})}function j(){let e=(0,l.NL)(),{showToast:s}=(0,c.useToast)();return(0,n.D)({mutationFn:async e=>{let{familyId:s,memberId:a}=e;await (0,i.Io)("/families/".concat(s,"/members/").concat(a),{method:"DELETE"})},onSuccess:()=>{s("成员已移除","success"),e.invalidateQueries({queryKey:["family"]})},onError:e=>{s("移除失败: ".concat(e.message),"error")}})}function y(e){return(0,t.a)({queryKey:["familyInvitations",e],queryFn:async()=>e?(await (0,i.Io)("/families/".concat(e,"/invitations"))).data:[],enabled:!!e})}function N(){let e=(0,l.NL)(),{showToast:s}=(0,c.useToast)();return(0,n.D)({mutationFn:async e=>{let{familyId:s,invitationId:a}=e;await (0,i.Io)("/families/".concat(s,"/invitations/").concat(a),{method:"DELETE"})},onSuccess:()=>{s("邀请已删除","success"),e.invalidateQueries({queryKey:["familyInvitations"]})},onError:e=>{s("删除失败: ".concat(e.message),"error")}})}function b(e){return(0,t.a)({queryKey:["userInvitations",e],queryFn:async()=>e&&(await (0,i.Io)("/users/".concat(e,"/invitations"))).data||[],enabled:!!e})}}},function(e){e.O(0,[6034,9390,9689,7945,7530,2178,5784,7385,4187,224,1945,8704,414,4322,5961,4642,4788,568,6373,8792,8755,2131,2971,8069,1744],function(){return e(e.s=36567)}),_N_E=e.O()}]);