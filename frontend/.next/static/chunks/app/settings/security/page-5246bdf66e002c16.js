(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7724],{54150:function(t,n,e){Promise.resolve().then(e.bind(e,6657))},6657:function(t,n,e){"use strict";e.r(n),e.d(n,{default:function(){return f}});var r=e(3827),o=e(64090),a=e(67945),s=e(51055),c=e(47385),u=e(10732),i=e(96770),l=e(58222);function f(){let{showToast:t}=(0,i.useToast)(),[n,e]=(0,o.useState)(""),[f,d]=(0,o.useState)(""),[h,m]=(0,o.useState)(""),[g,p]=(0,o.useState)(!1),w=async r=>{r.preventDefault(),p(!0);try{if(f!==h)throw Error("新密码和确认密码不一致");if(f.length<8)throw Error("新密码必须至少包含8个字符");await (0,l.Cp)({currentPassword:n,newPassword:f}),t("密码修改成功","success"),e(""),d(""),m("")}catch(n){t(n instanceof Error?n.message:"修改密码失败","error")}finally{p(!1)}};return(0,r.jsx)(a.w,{children:(0,r.jsx)(s.G,{className:"gap-4",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"账号安全"}),(0,r.jsxs)("form",{onSubmit:w,className:"space-y-4",children:[(0,r.jsx)(c.Y,{label:"当前密码",type:"password",value:n,onChange:t=>e(t.target.value),isRequired:!0}),(0,r.jsx)(c.Y,{label:"新密码",type:"password",value:f,onChange:t=>d(t.target.value),isRequired:!0}),(0,r.jsx)(c.Y,{label:"确认新密码",type:"password",value:h,onChange:t=>m(t.target.value),isRequired:!0}),(0,r.jsx)(u.A,{type:"submit",color:"primary",isLoading:g,children:"修改密码"})]})]})})})}},96770:function(t,n,e){"use strict";e.r(n),e.d(n,{ToastProvider:function(){return u},useToast:function(){return c}});var r=e(3827),o=e(64090),a=e(10963);let s=(0,o.createContext)(void 0);function c(){let t=(0,o.useContext)(s);if(!t)throw Error("useToast must be used within a ToastProvider");return t}function u(t){let{children:n}=t;return(0,r.jsxs)(s.Provider,{value:{showToast:function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",e={duration:3e3,style:{padding:"16px",borderRadius:"8px"}};switch(n){case"success":a.Am.success(t,e);break;case"error":a.Am.error(t,e);break;case"warning":(0,a.Am)(t,{...e,icon:"⚠️"});break;default:(0,a.Am)(t,{...e,icon:"ℹ️"})}}},children:[n,(0,r.jsx)(a.x7,{position:"top-center"})]})}},58222:function(t,n,e){"use strict";e.d(n,{AW:function(){return E},Cp:function(){return N},Ds:function(){return m},Hb:function(){return u},Io:function(){return d},KX:function(){return p},Ml:function(){return D},Nq:function(){return b},R5:function(){return A},_c:function(){return y},dx:function(){return g},fM:function(){return I},fq:function(){return T},h8:function(){return P},hQ:function(){return i},le:function(){return w},ot:function(){return S},qW:function(){return v},rr:function(){return x},we:function(){return h}});var r=e(77785),o=e(94564);let a=e(49079).env.NEXT_PUBLIC_API_URL||"http://localhost:3001/api",s=null,c=null;function u(t){s=t}function i(t){c=t}function l(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error";c?c(t,n):console["error"===n?"error":"warning"===n?"warn":"log"](t)}let f={400:t=>{console.warn("请求参数错误: ".concat(t)),l("请求参数错误: ".concat(t),"warning")},401:t=>{(0,o.gy)(),localStorage.removeItem("isGuest"),localStorage.removeItem("currentFamilyId"),s?s():"/auth/login"!==window.location.pathname&&(l("登录已过期，请重新登录"+window.location.pathname,"error"),window.location.href="/auth/login")},403:t=>{console.warn("无权访问: ".concat(t)),l("无权访问: ".concat(t),"error")},404:t=>{console.warn("资源不存在: ".concat(t)),l("资源不存在: ".concat(t),"warning")},422:t=>{console.warn("数据验证失败: ".concat(t)),l("数据验证失败: ".concat(t),"warning")},429:t=>{console.warn("请求过多，请稍后再试: ".concat(t)),l("请求过多，请稍后再试","warning")},500:t=>{console.error("服务器错误: ".concat(t)),l("服务器内部错误，请稍后再试: ".concat(t),"error")},502:t=>{console.error("网关错误: ".concat(t)),l("服务器网关错误，请稍后再试","error")},503:t=>{console.error("服务不可用: ".concat(t)),l("服务暂时不可用，请稍后再试","error")},504:t=>{console.error("网关超时: ".concat(t)),l("请求超时，请检查网络连接后重试","error")}};async function d(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e="".concat(a).concat(t),s=(0,o.LP)(),c={"Content-Type":"application/json",...s?{Authorization:"Bearer ".concat(s)}:{}};try{let t=await fetch(e,{...n,headers:{...c,...n.headers}}),o=await t.json();if(console.log("sssssss",o),!t.ok){let n=f[t.status];throw n&&n(o.message||"请求失败"),new r.Hx(t.status,o.message||"请求失败")}return{data:o,message:o.message,status:t.status}}catch(t){if(t instanceof r.Hx)throw t;throw new r.Hx(500,t instanceof Error?t.message:"网络错误")}}let h=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"请求失败";if(t instanceof r.Hx)switch(t.status){case 400:return"请求参数错误: ".concat(t.message);case 403:return"无权访问: ".concat(t.message);case 404:return"资源不存在: ".concat(t.message);case 429:return"请求过于频繁，请稍后再试";case 500:case 502:case 503:return"服务器错误: ".concat(t.message);default:return t.message||n}return(null==t?void 0:t.message)||n};async function m(t){return(await d("/routes/predictions?user_id=".concat(t),{method:"GET"})).data}async function g(t){return(await d("/routes/".concat(t,"/optimization"),{method:"GET"})).data}async function p(t){let n=new URLSearchParams;t.startDate&&n.append("startDate",t.startDate),t.endDate&&n.append("endDate",t.endDate),t.routeIds&&t.routeIds.length>0&&t.routeIds.forEach(t=>n.append("routeIds[]",t.toString()));let e="".concat(a,"/routes/export?").concat(n.toString(),"&format=").concat(t.format),s=(0,o.LP)(),c=await fetch(e,{method:"GET",headers:{...s?{Authorization:"Bearer ".concat(s)}:{}}});if(!c.ok){let t=await c.json();throw new r.Hx(c.status,t.message||"导出失败")}return await c.blob()}async function w(t){let n=new URLSearchParams;return n.append("type",t.type),t.startDate&&n.append("startDate",t.startDate),t.endDate&&n.append("endDate",t.endDate),t.routeIds&&t.routeIds.length>0&&t.routeIds.forEach(t=>n.append("routeIds[]",t.toString())),(await d("/routes/visualization?".concat(n.toString()),{method:"GET"})).data}async function y(){return d("/routes")}async function S(t){return d("/routes",{method:"POST",body:JSON.stringify(t)})}async function T(t,n){return d("/routes/".concat(t),{method:"PUT",body:JSON.stringify(n)})}async function v(t){return d("/routes/".concat(t),{method:"DELETE"})}async function x(t){return d("/routes/".concat(t,"/toggle"),{method:"POST"})}async function I(t){return d("/routes/".concat(t,"/stats"))}async function E(){return d("/users")}async function b(t,n){return d("/users/".concat(t),{method:"PUT",body:JSON.stringify(n)})}async function P(t){return d("/users/".concat(t),{method:"DELETE"})}async function D(t){return d("/users/".concat(t,"/freeze"),{method:"POST"})}async function A(t){return d("/users/".concat(t,"/unfreeze"),{method:"POST"})}async function N(t){return d("/auth/change-password",{method:"POST",body:JSON.stringify(t)})}},77785:function(t,n,e){"use strict";var r,o,a,s;e.d(n,{Hx:function(){return c},Yt:function(){return r},wI:function(){return o}});class c extends Error{constructor(t,n){super(n),this.status=t,this.name="APIError"}}(a=r||(r={})).DASHBOARD="dashboard",a.TRANSACTIONS="transactions",a.STATISTICS="statistics",a.SETTINGS="settings",a.CUSTOM="custom",(s=o||(o={})).PUBLIC="public",s.PRIVATE="private",s.FAMILY="family",s.ADMIN="admin"},94564:function(t,n,e){"use strict";function r(){return localStorage.getItem("token")}function o(t){localStorage.setItem("token",t)}function a(){localStorage.removeItem("token")}e.d(n,{LP:function(){return r},gy:function(){return a},o4:function(){return o}})}},function(t){t.O(0,[6034,9390,9689,7945,7530,2178,5784,7385,2971,8069,1744],function(){return t(t.s=54150)}),_N_E=t.O()}]);