(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8164],{98498:function(e,t,a){Promise.resolve().then(a.bind(a,25665))},47907:function(e,t,a){"use strict";var s=a(15313);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},25665:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var s=a(3827),i=a(64090),r=a(47907),n=a(45623),l=a(67945),o=a(51055),c=a(10732),d=a(58222),h=a(96770),u=a(62665),m=a(52131);function f(e){let{params:t}=e,{token:a}=t,[f,x]=(0,i.useState)(null),[p,g]=(0,i.useState)(!0),[b,w]=(0,i.useState)(null),[y,v]=(0,i.useState)(!1),[j,N]=(0,i.useState)(!1),{showToast:k}=(0,h.useToast)(),P=(0,r.useRouter)(),{user:E}=(0,m.useAuth)();(0,i.useEffect)(()=>{p&&!j&&(async()=>{try{let e=await (0,d.Io)("/families/invitations/".concat(a));x(e.data),g(!1)}catch(e){console.error("获取邀请信息失败:",e),w(e.message||"邀请不存在或已过期"),g(!1)}})()},[a,p,j]),(0,i.useEffect)(()=>{if(!p&&!j&&!E){N(!0);let e="/auth/login?redirect=/invite/".concat(a);console.log("重定向到登录页面:",e),P.push(e)}},[E,a,P,p,j]);let I=async()=>{if(f&&E){v(!0);try{await (0,d.Io)("/families/invitations/".concat(a,"/accept"),{method:"POST"}),k("已成功加入家庭","success"),P.push("/settings/family")}catch(e){k(e.message||"接受邀请失败","error"),v(!1)}}},S=async()=>{if(f&&E){v(!0);try{await (0,d.Io)("/families/invitations/".concat(a,"/reject"),{method:"POST"}),k("已拒绝邀请","success"),P.push("/settings/family")}catch(e){k(e.message||"拒绝邀请失败","error"),v(!1)}}};return p?(0,s.jsx)(u.Z,{title:"加载邀请",description:"正在检索邀请信息，请稍候。",backgroundVariant:"minimal",children:(0,s.jsx)("div",{className:"flex justify-center items-center h-[40vh]",children:(0,s.jsx)(n.c,{size:"lg"})})}):b?(0,s.jsx)(u.Z,{title:"邀请无效",description:b,backgroundVariant:"minimal",children:(0,s.jsx)(l.w,{className:"border border-default-100 bg-background/70 backdrop-blur max-w-md mx-auto",children:(0,s.jsxs)(o.G,{className:"flex flex-col items-center text-center p-8 gap-4",children:[(0,s.jsx)("div",{className:"text-danger text-5xl mb-2",children:"✗"}),(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"邀请无效"}),(0,s.jsx)("p",{className:"text-default-500",children:b}),(0,s.jsx)(c.A,{color:"primary",onPress:()=>P.push("/settings/family"),children:"返回家庭设置"})]})})}):f&&E?(0,s.jsx)(u.Z,{title:"家庭邀请",description:"邀请加入 ".concat(f.family_name," 家庭"),backgroundVariant:"minimal",children:(0,s.jsx)(l.w,{className:"border border-default-100 bg-background/70 backdrop-blur max-w-md mx-auto",children:(0,s.jsxs)(o.G,{className:"flex flex-col items-center text-center p-8 gap-4",children:[(0,s.jsx)("div",{className:"text-primary text-5xl mb-2",children:"\uD83C\uDFE0"}),(0,s.jsxs)("p",{className:"text-default-700",children:["您将以 ",(0,s.jsx)("span",{className:"font-medium",children:"admin"===f.role?"管理员":"成员"})," 身份加入",(0,s.jsx)("span",{className:"font-bold ml-1",children:f.family_name})]}),(0,s.jsxs)("p",{className:"text-default-500",children:["邀请将于 ",new Date(f.expires_at).toLocaleString()," 过期"]}),(0,s.jsxs)("div",{className:"flex gap-4 mt-6 w-full",children:[(0,s.jsx)(c.A,{color:"danger",variant:"flat",onPress:S,isDisabled:y,className:"flex-1",children:"拒绝"}),(0,s.jsx)(c.A,{color:"primary",onPress:I,isDisabled:y,isLoading:y,className:"flex-1",children:"接受"})]})]})})}):(0,s.jsx)(u.Z,{title:"验证身份",description:"正在确认您的账户信息。",backgroundVariant:"minimal",children:(0,s.jsx)("div",{className:"flex justify-center items-center h-[40vh]",children:(0,s.jsx)(n.c,{size:"lg"})})})}},29552:function(e,t,a){"use strict";var s=a(3827),i=a(64090),r=a(71272);t.Z=e=>{let{variant:t="default"}=e,a=(0,i.useRef)(null);return(0,i.useEffect)(()=>{if(!a.current)return;let e=a.current,s=e.getContext("2d");if(!s)return;let i=()=>{e.width=window.innerWidth,e.height=window.innerHeight};i(),window.addEventListener("resize",i);let r=[],n="minimal"===t?50:100;class l{update(){this.x+=this.speedX,this.y+=this.speedY,this.x>e.width?this.x=0:this.x<0&&(this.x=e.width),this.y>e.height?this.y=0:this.y<0&&(this.y=e.height)}draw(){s&&(s.fillStyle=this.color,s.beginPath(),s.arc(this.x,this.y,this.size,0,2*Math.PI),s.fill())}constructor(){this.x=Math.random()*e.width,this.y=Math.random()*e.height,this.size=2*Math.random()+.5,this.speedX=.5*Math.random()-.25,this.speedY=.5*Math.random()-.25,this.color="hsla(".concat(60*Math.random()+200,", 70%, 60%, ").concat(.8*Math.random()+.2,")")}}let o=()=>{if(s)for(let e=0;e<r.length;e++)for(let t=e;t<r.length;t++){let a=r[e].x-r[t].x,i=r[e].y-r[t].y,n=Math.sqrt(a*a+i*i);if(n<150){let a=1-n/150;s.strokeStyle="rgba(150, 150, 255, ".concat(.15*a,")"),s.lineWidth=.8,s.beginPath(),s.moveTo(r[e].x,r[e].y),s.lineTo(r[t].x,r[t].y),s.stroke()}}},c=()=>{if(s){for(let a of(s.clearRect(0,0,e.width,e.height),"default"===t&&d(),r))a.update(),a.draw();o(),requestAnimationFrame(c)}},d=()=>{if(!s)return;s.strokeStyle="rgba(100, 100, 255, 0.1)",s.beginPath(),s.lineWidth=1.5,s.arc(0,0,200,0,.5*Math.PI),s.stroke(),s.beginPath(),s.arc(e.width,e.height,250,Math.PI,1.5*Math.PI),s.stroke(),s.beginPath(),s.lineWidth=.8;let t=e.width/2,a=e.height/2,i=.4*Math.min(e.width,e.height);s.moveTo(t-i/2,a-i/2),s.lineTo(t+i/2,a-i/2),s.lineTo(t+i/2,a+i/2),s.lineTo(t-i/2,a+i/2),s.lineTo(t-i/2,a-i/2),s.stroke()};return(()=>{for(let e=0;e<n;e++)r.push(new l)})(),c(),()=>{window.removeEventListener("resize",i)}},[t]),(0,s.jsxs)("div",{className:"fixed inset-0 -z-10 overflow-hidden",children:[(0,s.jsx)("canvas",{ref:a,className:"absolute inset-0 w-full h-full"}),(0,s.jsx)("div",{className:"absolute top-0 -left-[10%] w-[50%] h-[50%] bg-primary/10 rounded-full blur-[150px] -z-10"}),(0,s.jsx)("div",{className:"absolute bottom-[10%] right-[10%] w-[40%] h-[40%] bg-secondary/10 rounded-full blur-[150px] -z-10"}),(0,s.jsx)(r.E.div,{className:"absolute top-[20%] right-[10%] w-16 h-16 border border-primary/20 rounded-full",animate:{y:[0,15,0],opacity:[.6,.9,.6],scale:[1,1.05,1]},transition:{duration:6,repeat:1/0,ease:"easeInOut"}}),(0,s.jsx)(r.E.div,{className:"absolute top-[10%] left-[20%] w-24 h-24 border border-secondary/30 rounded-xl rotate-45",animate:{y:[0,-20,0],opacity:[.3,.6,.3],rotate:[45,35,45]},transition:{duration:8,repeat:1/0,ease:"easeInOut"}}),(0,s.jsx)(r.E.div,{className:"absolute bottom-[30%] left-[5%] w-20 h-20 bg-gradient-to-tr from-primary/5 to-secondary/5 rounded-lg",animate:{x:[0,10,0],opacity:[.4,.7,.4],rotate:[0,10,0]},transition:{duration:7,repeat:1/0,ease:"easeInOut"}})]})}},62665:function(e,t,a){"use strict";var s=a(3827),i=a(29552);let r={lg:"max-w-5xl",xl:"max-w-7xl",full:"w-full max-w-none"},n={sm:"py-6",md:"py-10",lg:"py-16"};t.Z=function(e){let{title:t,description:a,actions:l,children:o,backgroundVariant:c="minimal",maxWidth:d="xl",padding:h="md",contentClassName:u="",headerClassName:m=""}=e,f=["relative","mx-auto","w-full","px-4",r[d],n[h],u].filter(Boolean).join(" "),x=t||a||l;return(0,s.jsxs)("main",{className:"relative min-h-screen overflow-hidden",children:["none"!==c&&(0,s.jsx)(i.Z,{variant:"default"===c?"default":"minimal"}),(0,s.jsxs)("div",{className:f,children:[x&&(0,s.jsxs)("div",{className:["mb-8","flex flex-col gap-4","sm:flex-row sm:items-center sm:justify-between",m].filter(Boolean).join(" "),children:[(0,s.jsxs)("div",{className:"space-y-1",children:[t&&(0,s.jsx)("h1",{className:"text-2xl font-bold md:text-3xl",children:t}),a&&(0,s.jsx)("p",{className:"max-w-2xl text-base text-default-500 md:text-lg",children:a})]}),l&&(0,s.jsx)("div",{className:"flex flex-wrap items-center gap-2 sm:justify-end",children:l})]}),(0,s.jsx)("div",{className:"relative z-10",children:o})]})]})}},71272:function(e,t,a){"use strict";a.d(t,{E:function(){return h}});var s=a(17388),i=a(99049),r=a(90238),n=a(93911),l=a(98746),o=a(42229),c=a(3709);let d=(0,o.x)({...i.s,...n.E,...r.o,...l.b},c.b),h=(0,s.c)(d)},37963:function(e,t,a){"use strict";a.d(t,{o:function(){return i}});class s extends Error{}function i(e,t){let a;if("string"!=typeof e)throw new s("Invalid token specified: must be a string");t||(t={});let i=!0===t.header?0:1,r=e.split(".")[i];if("string"!=typeof r)throw new s("Invalid token specified: missing part #".concat(i+1));try{a=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var a;return a=t,decodeURIComponent(atob(a).replace(/(.)/g,(e,t)=>{let a=t.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}catch(e){return atob(t)}}(r)}catch(e){throw new s("Invalid token specified: invalid base64 for part #".concat(i+1," (").concat(e.message,")"))}try{return JSON.parse(a)}catch(e){throw new s("Invalid token specified: invalid json for part #".concat(i+1," (").concat(e.message,")"))}}s.prototype.name="InvalidTokenError"}},function(e){e.O(0,[6034,9390,9689,7945,7530,9178,3614,2178,2131,2971,8069,1744],function(){return e(e.s=98498)}),_N_E=e.O()}]);