(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8164],{98498:function(e,t,s){Promise.resolve().then(s.bind(s,25665))},47907:function(e,t,s){"use strict";var a=s(15313);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},25665:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var a=s(3827),n=s(64090),r=s(47907),c=s(45623),i=s(67945),l=s(51055),o=s(10732),u=s(58222),d=s(96770),m=s(52131);function f(e){let{params:t}=e,{token:s}=t,[f,h]=(0,n.useState)(null),[x,p]=(0,n.useState)(!0),[g,j]=(0,n.useState)(null),[v,N]=(0,n.useState)(!1),[w,y]=(0,n.useState)(!1),{showToast:b}=(0,d.useToast)(),S=(0,r.useRouter)(),{user:k}=(0,m.useAuth)();(0,n.useEffect)(()=>{x&&!w&&(async()=>{try{let e=await (0,u.Io)("/families/invitations/".concat(s));h(e.data),p(!1)}catch(e){console.error("获取邀请信息失败:",e),j(e.message||"邀请不存在或已过期"),p(!1)}})()},[s,x,w]),(0,n.useEffect)(()=>{if(!x&&!w&&!k){y(!0);let e="/auth/login?redirect=/invite/".concat(s);console.log("重定向到登录页面:",e),S.push(e)}},[k,s,S,x,w]);let P=async()=>{if(f&&k){N(!0);try{await (0,u.Io)("/families/invitations/".concat(s,"/accept"),{method:"POST"}),b("已成功加入家庭","success"),S.push("/settings/family")}catch(e){b(e.message||"接受邀请失败","error"),N(!1)}}},E=async()=>{if(f&&k){N(!0);try{await (0,u.Io)("/families/invitations/".concat(s,"/reject"),{method:"POST"}),b("已拒绝邀请","success"),S.push("/settings/family")}catch(e){b(e.message||"拒绝邀请失败","error"),N(!1)}}};return x?(0,a.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,a.jsx)(c.c,{size:"lg"})}):g?(0,a.jsx)("div",{className:"max-w-md mx-auto mt-12 p-4",children:(0,a.jsx)(i.w,{children:(0,a.jsxs)(l.G,{className:"flex flex-col items-center text-center p-8 gap-4",children:[(0,a.jsx)("div",{className:"text-danger text-5xl mb-4",children:"✗"}),(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"邀请无效"}),(0,a.jsx)("p",{className:"text-default-500",children:g}),(0,a.jsx)(o.A,{color:"primary",onPress:()=>S.push("/settings/family"),className:"mt-4",children:"返回家庭设置"})]})})}):f&&k?(0,a.jsx)("div",{className:"max-w-md mx-auto mt-12 p-4",children:(0,a.jsx)(i.w,{children:(0,a.jsxs)(l.G,{className:"flex flex-col items-center text-center p-8 gap-4",children:[(0,a.jsx)("div",{className:"text-primary text-5xl mb-4",children:"\uD83C\uDFE0"}),(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"家庭邀请"}),(0,a.jsxs)("p",{className:"text-default-700",children:["您被邀请加入 ",(0,a.jsx)("span",{className:"font-bold",children:f.family_name})," 家庭"]}),(0,a.jsxs)("p",{className:"text-default-500",children:["您将以 ",(0,a.jsx)("span",{className:"font-medium",children:"admin"===f.role?"管理员":"成员"})," 身份加入此家庭"]}),(0,a.jsxs)("div",{className:"text-sm text-default-400 mt-2",children:["邀请将于 ",new Date(f.expires_at).toLocaleString()," 过期"]}),(0,a.jsxs)("div",{className:"flex gap-4 mt-6 w-full",children:[(0,a.jsx)(o.A,{color:"danger",variant:"flat",onPress:E,isDisabled:v,className:"flex-1",children:"拒绝"}),(0,a.jsx)(o.A,{color:"primary",onPress:P,isDisabled:v,isLoading:v,className:"flex-1",children:"接受"})]})]})})}):(0,a.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,a.jsx)(c.c,{size:"lg"})})}},37963:function(e,t,s){"use strict";s.d(t,{o:function(){return n}});class a extends Error{}function n(e,t){let s;if("string"!=typeof e)throw new a("Invalid token specified: must be a string");t||(t={});let n=!0===t.header?0:1,r=e.split(".")[n];if("string"!=typeof r)throw new a("Invalid token specified: missing part #".concat(n+1));try{s=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var s;return s=t,decodeURIComponent(atob(s).replace(/(.)/g,(e,t)=>{let s=t.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}catch(e){return atob(t)}}(r)}catch(e){throw new a("Invalid token specified: invalid base64 for part #".concat(n+1," (").concat(e.message,")"))}try{return JSON.parse(s)}catch(e){throw new a("Invalid token specified: invalid json for part #".concat(n+1," (").concat(e.message,")"))}}a.prototype.name="InvalidTokenError"}},function(e){e.O(0,[6034,9390,9689,7945,7530,2178,2131,2971,8069,1744],function(){return e(e.s=98498)}),_N_E=e.O()}]);