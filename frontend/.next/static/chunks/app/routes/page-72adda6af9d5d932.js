(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2316],{97986:function(e,s,a){Promise.resolve().then(a.bind(a,70374))},70374:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return el}});var t=a(3827),l=a(64090),n=a(2210),r=a(49977),i=a(10732),c=a(67945),d=a(73031),x=a(51055),o=a(88925),h=a(83176),m=a(26587),j=a(81433),u=a(38333),p=a(23356),f=a(22983),g=a(10166),v=a(78720),N=a(29733),y=a(81708),b=a(69475),w=a(36107),z=a(6297),C=a(56288),D=a(58222),S=a(52131),R=a(94642),O=a(77599),Z=a(26490);function A(e){var s;let{prediction:a,isLoading:l=!1}=e;return l?(0,t.jsx)(c.w,{className:"h-40",children:(0,t.jsx)(x.G,{className:"flex items-center justify-center",children:(0,t.jsxs)("div",{className:"animate-pulse",children:[(0,t.jsx)("div",{className:"h-4 bg-default-200 rounded w-3/4 mb-2"}),(0,t.jsx)("div",{className:"h-4 bg-default-200 rounded w-1/2"})]})})}):a&&a.path?(0,t.jsxs)(c.w,{children:[(0,t.jsxs)(x.G,{className:"gap-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("h3",{className:"text-md font-semibold",children:a.name||"未命名路由"}),(0,t.jsxs)(r.z,{color:(s=a.confidence)>=80?"success":s>=50?"warning":"danger",size:"sm",startContent:(0,t.jsx)(N.Z,{size:12}),children:[a.confidence,"% 可能性"]})]}),(0,t.jsx)("p",{className:"text-default-500 text-xs",children:a.path}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-xs text-default-400",children:[(0,t.jsx)(Z.Z,{size:12}),(0,t.jsxs)("span",{children:["最近访问: ",new Date(a.lastAccess).toLocaleString()]})]}),(0,t.jsxs)("div",{className:"text-xs text-default-400",children:["访问次数: ",a.accessCount]})]}),(0,t.jsx)(O.i,{children:(0,t.jsx)(i.A,{size:"sm",variant:"flat",color:"primary",startContent:(0,t.jsx)(y.Z,{size:14}),as:"a",href:a.path,fullWidth:!0,children:"访问路由"})})]}):(0,t.jsx)(c.w,{className:"h-40",children:(0,t.jsx)(x.G,{className:"flex items-center justify-center",children:(0,t.jsx)("p",{className:"text-default-500 text-center",children:"暂无预测数据"})})})}var K=a(14298),T=a(4248),k=a(99510),P=a(22561),q=a(7725),I=a(45623),L=a(23455),V=a(38721),E=a(2646),F=a(97404),_=a(69724),G=a(93276);function H(e){let{isOpen:s,onClose:a,routeId:l,fetchSuggestions:n}=e,{data:r,isLoading:c}=(0,R.a)({queryKey:["routeOptimization",l],queryFn:()=>n(l),enabled:s&&l>0}),d=e=>{switch(e){case"performance":return(0,t.jsx)(F.Z,{className:"text-warning",size:18});case"error":return(0,t.jsx)(_.Z,{className:"text-danger",size:18});case"caching":return(0,t.jsx)(G.Z,{className:"text-success",size:18});default:return(0,t.jsx)(Z.Z,{className:"text-primary",size:18})}},x=e=>{switch(e){case"high":return"danger";case"medium":return"warning";case"low":return"success";default:return"default"}};return(0,t.jsx)(T.R,{isOpen:s,onClose:a,size:"3xl",children:(0,t.jsx)(k.A,{children:e=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(P.k,{className:"flex flex-col gap-1",children:[(0,t.jsx)("h3",{className:"text-lg",children:"路由优化建议"}),(0,t.jsx)("p",{className:"text-sm text-default-500",children:"基于性能数据为您推荐的优化方案"})]}),(0,t.jsx)(q.I,{children:c?(0,t.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,t.jsx)(I.c,{label:"加载优化建议中..."})}):r&&0!==r.length?(0,t.jsx)(L.d,{variant:"bordered",children:r.map(e=>(0,t.jsx)(V.G,{title:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[d(e.category),(0,t.jsx)("span",{children:e.title})]}),subtitle:(0,t.jsx)("span",{className:"text-".concat(x(e.priority)," text-xs"),children:"high"===e.priority?"高优先级":"medium"===e.priority?"中优先级":"低优先级"}),children:(0,t.jsxs)("div",{className:"space-y-2 px-2",children:[(0,t.jsx)("p",{children:e.description}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("strong",{children:"预期影响："})," ",e.impact]})]})},e.id))}):(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("p",{children:"暂无优化建议"}),(0,t.jsx)("p",{className:"text-sm text-default-500",children:"该路由性能状况良好"})]})}),(0,t.jsx)(E.R,{children:(0,t.jsx)(i.A,{color:"primary",variant:"light",onPress:e,children:"关闭"})})]})})})}var J=a(25908),X=a(70294),U=a(26856),M=a(945),Y=a(16015),B=a(20372),W=a(2391),$=a(36747),Q=a(47385),ee=a(97307);function es(e){let{value:s,onChange:a}=e,{startDate:l,endDate:n}=s,r=e=>{let s=new Date,t=new Date;t.setDate(s.getDate()-e),a({startDate:t,endDate:s})},c=e=>e.toISOString().split("T")[0];return(0,t.jsxs)(B.j,{placement:"bottom",children:[(0,t.jsx)(W.b,{children:(0,t.jsxs)(i.A,{variant:"flat",startContent:(0,t.jsx)(ee.Z,{size:16}),children:[c(l)," 至 ",c(n)]})}),(0,t.jsx)($.g,{children:(0,t.jsxs)("div",{className:"p-4 w-80",children:[(0,t.jsx)("h4",{className:"text-sm font-medium mb-4",children:"选择日期范围"}),(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(Q.Y,{type:"date",label:"开始日期",value:c(l),onChange:e=>{let s=new Date(e.target.value);isNaN(s.getTime())||a({startDate:s,endDate:n})},max:c(n)}),(0,t.jsx)(Q.Y,{type:"date",label:"结束日期",value:c(n),onChange:e=>{let s=new Date(e.target.value);isNaN(s.getTime())||a({startDate:l,endDate:s})},min:c(l),max:c(new Date)})]}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[{label:"今天",days:0},{label:"过去7天",days:7},{label:"过去30天",days:30},{label:"过去90天",days:90}].map(e=>(0,t.jsx)(i.A,{size:"sm",variant:"flat",onPress:()=>r(e.days),children:e.label},e.label))})]})]})})]})}function ea(e){let{isOpen:s,onClose:a,onExport:n,dateRange:r,setDateRange:c}=e,[d,x]=l.useState("pdf"),[o,h]=l.useState(!1),[m,j]=l.useState("full"),u=async()=>{h(!0);try{await n(d),a()}catch(e){console.error("导出失败:",e)}finally{h(!1)}},p=[{value:"pdf",label:"PDF文档",icon:(0,t.jsx)(b.Z,{size:16}),description:"生成PDF格式的报告文档"},{value:"excel",label:"Excel表格",icon:(0,t.jsx)(M.Z,{size:16}),description:"生成Excel格式的数据表格"},{value:"csv",label:"CSV数据",icon:(0,t.jsx)(Y.Z,{size:16}),description:"生成CSV格式的原始数据"}];return(0,t.jsx)(T.R,{isOpen:s,onClose:a,size:"lg",children:(0,t.jsx)(k.A,{children:e=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(P.k,{className:"flex flex-col gap-1",children:[(0,t.jsx)("h3",{className:"text-lg",children:"导出分析报告"}),(0,t.jsx)("p",{className:"text-sm text-default-500",children:"导出路由性能和访问数据分析报告"})]}),(0,t.jsxs)(q.I,{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium mb-2",children:"报告类型"}),(0,t.jsxs)(J.X,{value:m,onValueChange:j,children:[(0,t.jsx)(X.J,{value:"full",children:"完整报告（包含所有数据和图表）"}),(0,t.jsx)(X.J,{value:"performance",children:"性能报告（仅包含加载时间和错误率）"}),(0,t.jsx)(X.J,{value:"usage",children:"使用报告（仅包含访问频率和分布）"})]})]}),(0,t.jsx)(U.j,{}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium mb-2",children:"日期范围"}),(0,t.jsx)(es,{value:r,onChange:c})]}),(0,t.jsx)(U.j,{}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium mb-2",children:"导出格式"}),(0,t.jsx)(J.X,{orientation:"horizontal",value:d,onValueChange:x,children:p.map(e=>(0,t.jsx)(X.J,{value:e.value,description:e.description,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[e.icon,e.label]})},e.value))})]})]}),(0,t.jsxs)(E.R,{children:[(0,t.jsx)(i.A,{variant:"flat",onPress:e,children:"取消"}),(0,t.jsx)(i.A,{color:"primary",onPress:u,isLoading:o,startContent:(0,t.jsx)(b.Z,{size:16}),children:"导出"})]})]})})})}let et=[{name:"/dashboard",loadTime:320,errorRate:.5,cacheHitRate:89},{name:"/transactions",loadTime:450,errorRate:1.2,cacheHitRate:76},{name:"/statistics",loadTime:580,errorRate:.8,cacheHitRate:62},{name:"/settings",loadTime:280,errorRate:.2,cacheHitRate:94},{name:"/profile",loadTime:390,errorRate:.7,cacheHitRate:82}];function el(){let{user:e}=(0,S.useAuth)(),s=null==e?void 0:e.id,[a,O]=l.useState({startDate:new Date(Date.now()-2592e6),endDate:new Date}),{isOpen:Z,onOpen:T,onClose:k}=(0,n.q)(),{isOpen:P,onOpen:q,onClose:I}=(0,n.q)(),[L,V]=l.useState(null),{data:E,isLoading:F}=(0,R.a)({queryKey:["routePredictions",s],queryFn:()=>(0,D.Ds)(s||0),enabled:!!s}),{data:_,isLoading:G}=(0,R.a)({queryKey:["routeVisualization",a],queryFn:()=>(0,D.le)({type:"performance",startDate:a.startDate.toISOString(),endDate:a.endDate.toISOString()}),enabled:!!s}),J=[{header:"路由路径",accessorKey:"name",cell:e=>(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsx)("span",{className:"text-sm",children:e.getValue()})})},{header:"加载时间 (ms)",accessorKey:"loadTime",cell:e=>{let s=e.getValue(),a="success";return s>500?a="danger":s>300&&(a="warning"),(0,t.jsxs)(r.z,{color:a,variant:"flat",size:"sm",children:[s," ms"]})}},{header:"错误率 (%)",accessorKey:"errorRate",cell:e=>{let s=e.getValue(),a="success";return s>1?a="danger":s>.5&&(a="warning"),(0,t.jsxs)(r.z,{color:a,variant:"flat",size:"sm",children:[s,"%"]})}},{header:"缓存命中率 (%)",accessorKey:"cacheHitRate",cell:e=>{let s=e.getValue(),a="success";return s<60?a="danger":s<80&&(a="warning"),(0,t.jsxs)(r.z,{color:a,variant:"flat",size:"sm",children:[s,"%"]})}},{header:"操作",cell:e=>{let s=e.row.original.id||1;return(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(i.A,{size:"sm",variant:"flat",color:"primary",startContent:(0,t.jsx)(N.Z,{size:14}),onPress:()=>{V(s),T()},children:"优化建议"}),(0,t.jsx)(i.A,{size:"sm",variant:"flat",startContent:(0,t.jsx)(y.Z,{size:14}),as:"a",href:"/settings/routes?highlight=".concat(s),target:"_blank",children:"管理"})]})}}],X=async e=>{try{let s=await (0,D.KX)({format:e,startDate:a.startDate.toISOString(),endDate:a.endDate.toISOString()}),t=URL.createObjectURL(s),l=document.createElement("a");l.href=t,l.download="route-report-".concat(new Date().toISOString().split("T")[0],".").concat(e),document.body.appendChild(l),l.click(),document.body.removeChild(l),C.Am.success("成功导出".concat(e.toUpperCase(),"报告"))}catch(e){C.Am.error("导出失败: ".concat(e instanceof Error?e.message:"未知错误"))}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"路由管理"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(es,{value:a,onChange:O}),(0,t.jsx)(i.A,{color:"primary",variant:"shadow",startContent:(0,t.jsx)(b.Z,{size:16}),onPress:q,children:"导出报告"})]})]}),(0,t.jsxs)(c.w,{children:[(0,t.jsxs)(d.u,{className:"flex gap-3 px-6 py-4",children:[(0,t.jsx)(w.Z,{size:24,className:"text-primary"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"路由预测"}),(0,t.jsx)("p",{className:"text-sm text-default-500",children:"基于用户行为的路由访问预测"})]})]}),(0,t.jsx)(x.G,{children:(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:F?(0,t.jsx)("div",{className:"col-span-3 text-center py-4",children:"加载中..."}):((null==E?void 0:E.topRoutes)||[,,,].fill({})).map((e,s)=>(0,t.jsx)(A,{prediction:e,isLoading:F},s))})})]}),(0,t.jsxs)(c.w,{children:[(0,t.jsxs)(d.u,{className:"flex gap-3 px-6 py-4",children:[(0,t.jsx)(z.Z,{size:24,className:"text-primary"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"路由性能"}),(0,t.jsx)("p",{className:"text-sm text-default-500",children:"监控路由加载时间和错误率"})]})]}),(0,t.jsx)(x.G,{children:(0,t.jsxs)(o.n,{children:[(0,t.jsx)(h.r,{title:"表格视图",children:(0,t.jsx)(K.w,{columns:J,data:(null==_?void 0:_.data)||et,isLoading:G})},"table"),(0,t.jsx)(h.r,{title:"图表视图",children:(0,t.jsx)("div",{className:"w-full h-80",children:(0,t.jsx)(m.h,{width:"100%",height:"100%",children:(0,t.jsxs)(j.v,{data:(null==_?void 0:_.data)||et,margin:{top:20,right:30,left:20,bottom:5},children:[(0,t.jsx)(u.q,{strokeDasharray:"3 3"}),(0,t.jsx)(p.K,{dataKey:"name"}),(0,t.jsx)(f.B,{}),(0,t.jsx)(g.u,{}),(0,t.jsx)(v.$,{dataKey:"loadTime",name:"加载时间 (ms)",fill:"#8884d8"})]})})})},"chart")]})})]}),(0,t.jsx)(H,{isOpen:Z,onClose:k,routeId:L||0,fetchSuggestions:D.dx}),(0,t.jsx)(ea,{isOpen:P,onClose:I,onExport:X,dateRange:a,setDateRange:O})]})}},14298:function(e,s,a){"use strict";a.d(s,{w:function(){return m}});var t=a(3827),l=a(64090),n=a(50535),r=a(9410),i=a(75129),c=a(63053),d=a(77058),x=a(45623),o=a(36685),h=a(92339);function m(e){let{columns:s,data:a,isLoading:m=!1,pagination:j=!1,pageSize:u=10}=e,[p,f]=l.useState(1),g=Math.ceil(a.length/u),v=l.useMemo(()=>{let e=(p-1)*u,s=e+u;return a.slice(e,s)},[p,a,u]),N=l.useCallback((e,a)=>{let t=s.find(e=>e.accessorKey===a);return(null==t?void 0:t.cell)?t.cell({row:{original:e}}):e[a]},[s]);return(0,t.jsx)("div",{className:"w-full",children:(0,t.jsxs)(n.b,{"aria-label":"数据表格",bottomContent:j&&g>1?(0,t.jsx)("div",{className:"flex w-full justify-center",children:(0,t.jsx)(r.g,{isCompact:!0,showControls:!0,showShadow:!0,color:"primary",page:p,total:g,onChange:f})}):null,children:[(0,t.jsx)(i.J,{children:s.map((e,s)=>(0,t.jsx)(c.j,{children:e.header},e.accessorKey||"column-".concat(s)))}),(0,t.jsx)(d.y,{items:v,loadingContent:(0,t.jsx)(x.c,{}),isLoading:m,emptyContent:m?null:"暂无数据",children:e=>(0,t.jsx)(o.g,{children:s.map(s=>(0,t.jsx)(h.X,{children:N(e,s.accessorKey)},s.accessorKey))},e.id)})]})})}}},function(e){e.O(0,[6034,9390,9689,7945,7530,2178,5784,9178,7385,3614,6288,4187,224,1945,8704,414,4322,4642,4788,6373,5769,3135,1525,2131,2971,8069,1744],function(){return e(e.s=97986)}),_N_E=e.O()}]);