"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2751],{929:function(e,s,a){a.d(s,{Z:function(){return i}});var t=a(3827),n=a(67945),r=a(51055),l=a(63983);function i(e){let{type:s="transaction",className:a=""}=e;return"statistics"===s?(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(e=>(0,t.jsx)(n.w,{className:"w-full",children:(0,t.jsxs)(r.G,{className:"space-y-3",children:[(0,t.jsx)(l.X,{className:"rounded-lg",children:(0,t.jsx)("div",{className:"h-3 w-3/4 rounded-lg bg-default-200"})}),(0,t.jsx)(l.X,{className:"rounded-lg",children:(0,t.jsx)("div",{className:"h-6 w-2/3 rounded-lg bg-default-200"})})]})},e))}):"category"===s?(0,t.jsx)(n.w,{className:"w-full",children:(0,t.jsxs)(r.G,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(l.X,{className:"rounded-lg",children:(0,t.jsx)("div",{className:"h-6 w-32 rounded-lg bg-default-200"})}),(0,t.jsx)(l.X,{className:"rounded-lg",children:(0,t.jsx)("div",{className:"h-8 w-48 rounded-lg bg-default-200"})})]}),(0,t.jsx)(l.X,{className:"rounded-lg",children:(0,t.jsx)("div",{className:"h-[300px] w-full rounded-lg bg-default-200"})}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(e=>(0,t.jsx)(n.w,{className:"w-full",children:(0,t.jsxs)(r.G,{className:"space-y-2",children:[(0,t.jsx)(l.X,{className:"rounded-lg",children:(0,t.jsx)("div",{className:"h-3 w-3/4 rounded-lg bg-default-200"})}),(0,t.jsx)(l.X,{className:"rounded-lg",children:(0,t.jsx)("div",{className:"h-5 w-2/3 rounded-lg bg-default-200"})})]})},e))})]})}):"table"===s?(0,t.jsxs)("div",{className:"space-y-3 ".concat(a),children:[(0,t.jsx)("div",{className:"flex space-x-2 mb-4",children:[1,2,3,4].map(e=>(0,t.jsx)(l.X,{className:"rounded-lg",children:(0,t.jsx)("div",{className:"h-8 w-24 rounded-lg bg-default-200"})},e))}),[1,2,3,4,5].map(e=>(0,t.jsx)("div",{className:"flex space-x-4 items-center",children:(0,t.jsx)(l.X,{className:"rounded-lg",children:(0,t.jsx)("div",{className:"h-10 w-full rounded-lg bg-default-200"})})},e))]}):(0,t.jsx)("div",{className:"space-y-3 ".concat(a),children:[1,2,3,4,5].map(e=>(0,t.jsx)(n.w,{className:"w-full",children:(0,t.jsx)(r.G,{children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.X,{className:"rounded-lg",children:(0,t.jsx)("div",{className:"h-3 w-24 rounded-lg bg-default-200"})}),(0,t.jsx)(l.X,{className:"rounded-lg",children:(0,t.jsx)("div",{className:"h-3 w-32 rounded-lg bg-default-200"})})]}),(0,t.jsx)(l.X,{className:"rounded-lg",children:(0,t.jsx)("div",{className:"h-6 w-20 rounded-lg bg-default-200"})})]})})},e))})}},76663:function(e,s,a){a.d(s,{s:function(){return D},Z:function(){return S}});var t=a(3827),n=a(64090),r=a(10732),l=a(67945),i=a(51055),c=a(26856),d=a(25908),o=a(70294),u=a(47385),m=a(69426),x=a(52235),h=a(55621),j=a(20372),f=a(2391),g=a(36747),p=a(62456),v=a(82995),y=a(97307),N=a(22169);function b(e){let{value:s,onChange:a,label:r,placeholder:l="选择日期",className:i}=e,[c,d]=(0,n.useState)(!1);return(0,t.jsxs)(j.j,{isOpen:c,onOpenChange:d,children:[(0,t.jsx)(f.b,{children:(0,t.jsx)(u.Y,{label:r,placeholder:l,value:s?(0,p.WU)(s,"yyyy-MM-dd",{locale:v.U}):"",readOnly:!0,classNames:{input:"cursor-pointer"},endContent:(0,t.jsxs)("div",{className:"flex items-center",children:[s&&(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),a(void 0)},className:"text-default-400 hover:text-default-900 focus:outline-none mr-2",children:"✕"}),(0,t.jsx)(y.Z,{className:"h-5 w-5 text-default-400"})]}),className:i})}),(0,t.jsx)(g.g,{children:(0,t.jsx)("div",{className:"p-1",children:(0,t.jsx)(w,{mode:"single",selected:s,onSelect:e=>{a(e),d(!1)},initialFocus:!0})})})]})}function w(e){let{mode:s,selected:a,onSelect:r,initialFocus:l}=e,[i,c]=(0,n.useState)(a||new Date),d=i.getFullYear(),o=i.getMonth(),u=new Date(d,o+1,0).getDate(),m=new Date(d,o,1).getDay(),x=e=>{r(new Date(d,o,e))},h=[],j=1;for(let e=0;e<6;e++){let s=[];for(let a=0;a<7;a++)0===e&&a<m?s.push(null):j<=u?(s.push(j),j++):s.push(null);h.push(s)}return(0,t.jsxs)("div",{className:"p-3",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("button",{onClick:()=>{c(new Date(d,o-1,1))},className:"p-1",children:"<"}),(0,t.jsx)("h3",{children:(0,p.WU)(i,"yyyy年MM月",{locale:v.U})}),(0,t.jsx)("button",{onClick:()=>{c(new Date(d,o+1,1))},className:"p-1",children:">"})]}),(0,t.jsx)("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:["日","一","二","三","四","五","六"].map(e=>(0,t.jsx)("div",{className:"text-sm font-medium",children:e},e))}),(0,t.jsx)("div",{className:"grid grid-cols-7 gap-1",children:h.map((e,s)=>(0,t.jsx)(n.Fragment,{children:e.map((e,n)=>(0,t.jsx)("div",{className:(0,N.cn)("h-8 w-8 p-0 flex items-center justify-center rounded-full text-sm",null===e?"invisible":"cursor-pointer hover:bg-primary-100",a&&e===a.getDate()&&o===a.getMonth()&&d===a.getFullYear()?"bg-primary text-white":""),onClick:()=>null!==e&&x(e),children:e},"".concat(s,"-").concat(n)))},s))})]})}function S(e){let{onFilter:s}=e,[a,l]=(0,n.useState)({});return(0,t.jsx)(r.A,{size:"sm",onPress:()=>s(a),children:"过滤"})}function D(e){var s,a;let{isOpen:j,onClose:f,onApply:g,initialFilter:p={}}=e,[v,y]=(0,n.useState)(p),{categories:N}=(0,h.L)();return((0,n.useEffect)(()=>{y(p)},[p]),j)?(0,t.jsx)(l.w,{className:"w-full max-w-md mx-auto",children:(0,t.jsxs)(i.G,{className:"p-5",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-bold",children:"交易筛选"}),(0,t.jsx)(r.A,{isIconOnly:!0,variant:"light",onPress:f,children:(0,t.jsx)(x.Z,{size:18})})]}),(0,t.jsx)(c.j,{className:"my-3"}),(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-md font-medium mb-2",children:"交易类型"}),(0,t.jsxs)(d.X,{value:v.type,onValueChange:e=>y(s=>({...s,type:e})),children:[(0,t.jsx)(o.J,{value:"all",children:"全部"}),(0,t.jsx)(o.J,{value:"income",children:"收入"}),(0,t.jsx)(o.J,{value:"expense",children:"支出"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-md font-medium mb-2",children:"金额范围"}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(u.Y,{type:"number",label:"最小金额",placeholder:"0",value:(null===(s=v.minAmount)||void 0===s?void 0:s.toString())||"",onChange:e=>y(s=>({...s,minAmount:e.target.value?Number(e.target.value):void 0})),className:"flex-1"}),(0,t.jsx)(u.Y,{type:"number",label:"最大金额",placeholder:"不限",value:(null===(a=v.maxAmount)||void 0===a?void 0:a.toString())||"",onChange:e=>y(s=>({...s,maxAmount:e.target.value?Number(e.target.value):void 0})),className:"flex-1"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-md font-medium mb-2",children:"日期范围"}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(b,{label:"开始日期",value:v.startDate?new Date(v.startDate):void 0,onChange:e=>y(s=>({...s,startDate:e?e.toISOString().split("T")[0]:void 0})),className:"flex-1"}),(0,t.jsx)(b,{label:"结束日期",value:v.endDate?new Date(v.endDate):void 0,onChange:e=>y(s=>({...s,endDate:e?e.toISOString().split("T")[0]:void 0})),className:"flex-1"})]})]}),N&&N.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-md font-medium mb-2",children:"分类"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:N.map(e=>{var s;return(0,t.jsx)(m.K,{isSelected:null===(s=v.categoryIds)||void 0===s?void 0:s.includes(Number(e.id)),onValueChange:s=>{y(a=>{let t=a.categoryIds||[];return s?{...a,categoryIds:[...t,Number(e.id)]}:{...a,categoryIds:t.filter(s=>s!==Number(e.id))}})},children:e.name},e.id)})})]})]}),(0,t.jsx)(c.j,{className:"my-4"}),(0,t.jsxs)("div",{className:"flex justify-between gap-2",children:[(0,t.jsx)(r.A,{variant:"flat",color:"danger",onPress:()=>{y({})},className:"flex-1",children:"重置"}),(0,t.jsx)(r.A,{color:"primary",onPress:()=>{g(v),f()},className:"flex-1",children:"应用筛选"})]})]})}):null}},11546:function(e,s,a){var t=a(3827),n=a(4248),r=a(99510),l=a(22561),i=a(7725),c=a(56178),d=a(14078),o=a(47385),u=a(2646),m=a(10732),x=a(55621),h=a(79991),j=a(96770),f=a(64090);s.Z=e=>{let{isOpen:s,onClose:a,transaction:g}=e,[p,v]=(0,f.useState)("expense"),[y,N]=(0,f.useState)(""),[b,w]=(0,f.useState)(""),[S,D]=(0,f.useState)(""),[C,A]=(0,f.useState)(new Date().toISOString().split("T")[0]),{categories:Y=[],isLoading:I}=(0,x.L)(),{showToast:O}=(0,j.useToast)(),P=(0,h.lr)(),k=(0,h.wI)(),R=Y.filter(e=>e.type===p);(0,f.useEffect)(()=>{if(g){var e;v(g.type),N(g.amount.toString()),w((null===(e=g.category_id)||void 0===e?void 0:e.toString())||""),D(g.description),A(g.date)}},[g]);let E=()=>{v("expense"),N(""),w(""),D(""),A(new Date().toISOString().split("T")[0])},M=()=>{E(),a()},T=async e=>{if(e.preventDefault(),!y||!b||!S||!C){O("请填写所有必填字段","error");return}let s=Y.find(e=>e.id.toString()===b);if(!s){O("请选择有效的分类","error");return}let t={type:p,amount:Number(y),category_id:Number(b),description:S,date:C,category_name:s.name,category_icon:s.icon};try{g?(await k.mutateAsync({...t,id:g.id}),O("修改成功","success")):(await P.mutateAsync(t),O("添加成功","success")),a(),E()}catch(e){O("操作失败："+(e instanceof Error?e.message:"未知错误"),"error")}};return(0,t.jsx)(n.R,{isOpen:s,onClose:M,size:"lg",children:(0,t.jsx)(r.A,{children:(0,t.jsxs)("form",{onSubmit:T,children:[(0,t.jsx)(l.k,{children:g?"编辑交易":"新增交易"}),(0,t.jsx)(i.I,{className:"gap-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)(c.g,{label:"类型",selectedKeys:new Set([p]),onChange:e=>v(e.target.value),"aria-label":"选择交易类型",children:[(0,t.jsx)(d.R,{value:"expense","aria-label":"支出",children:"支出"},"expense"),(0,t.jsx)(d.R,{value:"income","aria-label":"收入",children:"收入"},"income")]}),(0,t.jsx)(o.Y,{type:"number",label:"金额",value:y,onChange:e=>N(e.target.value),"aria-label":"输入金额"}),(0,t.jsx)(c.g,{label:"分类",selectedKeys:b?new Set([b]):new Set,onChange:e=>w(e.target.value),isLoading:I,"aria-label":"选择交易分类",errorMessage:0!==R.length||I?void 0:"请先选择一个家庭并添加分类",children:R.map(e=>(0,t.jsx)(d.R,{value:e.id.toString(),textValue:e.name,"aria-label":e.name,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{"aria-hidden":"true",children:e.icon}),(0,t.jsx)("span",{children:e.name})]})},e.id.toString()))}),(0,t.jsx)(o.Y,{type:"date",label:"日期",value:C,onChange:e=>A(e.target.value),"aria-label":"选择日期"}),(0,t.jsx)(o.Y,{className:"md:col-span-2",label:"描述",value:S,onChange:e=>D(e.target.value),"aria-label":"输入交易描述"})]})}),(0,t.jsxs)(u.R,{children:[(0,t.jsx)(m.A,{color:"danger",variant:"light",onPress:M,children:"取消"}),(0,t.jsx)(m.A,{color:"primary",type:"submit",children:g?"保存":"添加"})]})]})})})}},12751:function(e,s,a){a.d(s,{Z:function(){return k}});var t=a(3827),n=a(64090),r=a(2210),l=a(10732),i=a(4248),c=a(99510),d=a(22561),o=a(7725),u=a(47385),m=a(2646),x=a(45228),h=a(60463),j=a(80954),f=a(35061),g=a(1310),p=a(25548),v=a(24424),y=a(25570),N=a(89539),b=a.n(N),w=a(79991),S=a(96770),D=a(52131),C=a(929),A=a(11546),Y=a(76663);function I(e){let{isOpen:s,onClose:a}=e,r=(0,n.useRef)(null),[x,h]=(0,n.useState)(null),{mutate:f,isPending:g}=(0,w.En)(),{showToast:p}=(0,S.useToast)(),v=async()=>{if(!x){p("请选择要导入的文件","error");return}let e=new FormData;e.append("file",x);try{await f(e),a(),h(null),r.current&&(r.current.value="")}catch(e){console.error("导入失败:",e)}};return(0,t.jsx)(i.R,{isOpen:s,onClose:a,children:(0,t.jsxs)(c.A,{children:[(0,t.jsx)(d.k,{children:"导入交易记录"}),(0,t.jsx)(o.I,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-sm text-default-500",children:"请选择要导入的CSV文件，文件格式如下："}),(0,t.jsx)("pre",{className:"text-xs bg-default-100 p-2 rounded-lg",children:"日期,类型,金额,分类,描述 2024-03-01,expense,100,餐饮,午餐 2024-03-02,income,5000,工资,3月工资"}),(0,t.jsx)(u.Y,{type:"file",accept:".csv",ref:r,onChange:e=>{var s;let a=null===(s=e.target.files)||void 0===s?void 0:s[0];if(a){if("text/csv"!==a.type){p("请选择CSV文件","error");return}h(a)}},startContent:(0,t.jsx)(j.Z,{className:"h-4 w-4"}),description:"支持.csv格式文件"})]})}),(0,t.jsxs)(m.R,{children:[(0,t.jsx)(l.A,{variant:"bordered",onPress:a,children:"取消"}),(0,t.jsx)(l.A,{color:"primary",onPress:v,isLoading:g,isDisabled:!x,children:"导入"})]})]})})}function O(e){let{isOpen:s,onClose:a}=e,[r,x]=(0,n.useState)(b()().startOf("month").format("YYYY-MM-DD")),[h,j]=(0,n.useState)(b()().format("YYYY-MM-DD")),{mutate:g,isPending:p}=(0,w.v9)(),{showToast:v}=(0,S.useToast)(),y=async()=>{if(!r||!h){v("请选择日期范围","error");return}if(b()(r).isAfter(h)){v("开始日期不能晚于结束日期","error");return}try{await g({startDate:r,endDate:h}),a()}catch(e){console.error("导出失败:",e)}};return(0,t.jsx)(i.R,{isOpen:s,onClose:a,children:(0,t.jsxs)(c.A,{children:[(0,t.jsx)(d.k,{children:"导出交易记录"}),(0,t.jsx)(o.I,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-sm text-default-500",children:"请选择要导出的日期范围："}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(u.Y,{type:"date",label:"开始日期",value:r,onChange:e=>x(e.target.value)}),(0,t.jsx)(u.Y,{type:"date",label:"结束日期",value:h,onChange:e=>j(e.target.value)})]})]})}),(0,t.jsxs)(m.R,{children:[(0,t.jsx)(l.A,{variant:"bordered",onPress:a,children:"取消"}),(0,t.jsx)(l.A,{color:"primary",startContent:(0,t.jsx)(f.Z,{className:"h-4 w-4"}),onPress:y,isLoading:p,children:"导出"})]})]})})}var P=a(8207);function k(){let[e,s]=(0,n.useState)(1),[a,N]=(0,n.useState)({}),{user:k,isGuest:R,enterGuestMode:E,exitGuestMode:M}=(0,D.useAuth)(),{transactions:T,isLoading:L,error:Z}=(0,w.nC)(null==k?void 0:k.currentFamilyId),{mutate:F}=(0,w.A3)(),{showToast:X}=(0,S.useToast)(),{isOpen:_,onOpen:q,onClose:K}=(0,r.q)(),{isOpen:z,onOpen:U,onClose:Q}=(0,r.q)(),{isOpen:G,onOpen:J,onClose:V}=(0,r.q)(),[B,W]=(0,n.useState)(""),[H,$]=(0,n.useState)(null),[ee,es]=(0,n.useState)(!1),[ea,et]=(0,n.useState)(!1),en=(0,n.useRef)(null);(0,y.MG)({count:T.length,getScrollElement:()=>en.current,estimateSize:()=>70,overscan:10});let er=(0,n.useMemo)(()=>T?T.filter(e=>!0):[],[T,a]),el=e=>{if(R){X("访客模式下无法编辑","error");return}$(e),es(!0)},ei=e=>{if(R){X("访客模式下无法删除","error");return}$(e),et(!0)},ec=async()=>{try{await E(B),K(),W(""),X("已进入访客模式","success")}catch(e){X("访客密码错误","error")}},ed=(e,s)=>R?"****":"".concat("expense"===s?"-":"+").concat(e.toFixed(2));return L?(0,t.jsx)(C.Z,{type:"transaction"}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center sticky top-0 bg-background/70 backdrop-blur-lg z-10 py-2 px-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(Y.Z,{onFilter:N}),(null==k?void 0:k.privacy_mode)&&(0,t.jsx)(l.A,{size:"sm",variant:"flat",startContent:R?(0,t.jsx)(x.Z,{className:"h-4 w-4"}):(0,t.jsx)(h.Z,{className:"h-4 w-4"}),onPress:R?()=>M():q,children:R?"退出访客模式":"访客模式"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(l.A,{size:"sm",variant:"flat",startContent:(0,t.jsx)(j.Z,{className:"h-4 w-4"}),onPress:U,isDisabled:R,children:"导入"}),(0,t.jsx)(l.A,{size:"sm",variant:"flat",startContent:(0,t.jsx)(f.Z,{className:"h-4 w-4"}),onPress:J,isDisabled:R,children:"导出"})]})]}),(0,t.jsx)("div",{ref:en,className:"h-[calc(100vh-350px)] md:h-[calc(100vh-230px)] overflow-auto px-4",children:0===er.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,t.jsx)("div",{className:"bg-default-100 rounded-full p-6 mb-4",children:(0,t.jsx)(P.Z,{className:"h-10 w-10 text-default-400"})}),(0,t.jsx)("p",{className:"text-default-500",children:"暂无交易记录"}),(0,t.jsx)(l.A,{color:"primary",variant:"flat",className:"mt-4",startContent:(0,t.jsx)(g.Z,{className:"h-4 w-4"}),onPress:()=>es(!0),isDisabled:R,children:"添加交易"})]}):(0,t.jsx)("div",{className:"space-y-2 pb-4",children:er.map((e,s)=>{let a=b()(e.date).format("YYYY-MM-DD"),r=0===s||a!==b()(er[s-1].date).format("YYYY-MM-DD");return(0,t.jsxs)(n.Fragment,{children:[r&&(0,t.jsx)("div",{className:"sticky top-0 bg-background/80 backdrop-blur-md py-2 px-1 text-sm font-medium border-b z-10 mt-2 first:mt-0",children:a===b()().format("YYYY-MM-DD")?"今天":a===b()().subtract(1,"day").format("YYYY-MM-DD")?"昨天":b()(a).format("MM月DD日 ddd")}),(0,t.jsxs)("div",{className:"p-3 rounded-lg hover:bg-default-100 transition-colors cursor-pointer flex justify-between items-center border-b border-default-100",onClick:()=>el(e),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 rounded-full ".concat("expense"===e.type?"bg-danger/10 text-danger":"bg-success/10 text-success"),children:(0,t.jsx)("span",{className:"text-xl",children:e.category||"\uD83D\uDCB0"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.category||"未分类"}),(0,t.jsx)("div",{className:"text-xs text-default-400",children:e.description||"无描述"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-end",children:[(0,t.jsx)("div",{className:"font-semibold ".concat("expense"===e.type?"text-danger":"text-success"),children:ed(e.amount,e.type)}),(0,t.jsxs)("div",{className:"flex gap-1 mt-1",children:[(0,t.jsx)("span",{onClick:e=>e.stopPropagation(),children:(0,t.jsx)(l.A,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>el(e),className:"h-6 w-6 min-w-0",isDisabled:R,children:(0,t.jsx)(p.Z,{className:"h-3 w-3"})})}),(0,t.jsx)("span",{onClick:e=>e.stopPropagation(),children:(0,t.jsx)(l.A,{isIconOnly:!0,size:"sm",color:"danger",variant:"light",onPress:()=>ei(e),className:"h-6 w-6 min-w-0",isDisabled:R,children:(0,t.jsx)(v.Z,{className:"h-3 w-3"})})})]})]})]})]},e.id)})})}),(0,t.jsx)(i.R,{isOpen:_,onClose:K,children:(0,t.jsxs)(c.A,{children:[(0,t.jsx)(d.k,{children:"访客模式"}),(0,t.jsx)(o.I,{children:(0,t.jsx)(u.Y,{type:"password",label:"访客密码",placeholder:"请输入访客密码",value:B,onChange:e=>W(e.target.value)})}),(0,t.jsxs)(m.R,{children:[(0,t.jsx)(l.A,{variant:"bordered",onPress:K,children:"取消"}),(0,t.jsx)(l.A,{color:"primary",onPress:ec,children:"确认"})]})]})}),(0,t.jsx)(I,{isOpen:z,onClose:Q}),(0,t.jsx)(O,{isOpen:G,onClose:V}),(0,t.jsx)(A.Z,{isOpen:ee,onClose:()=>es(!1),transaction:H}),(0,t.jsx)(i.R,{isOpen:ea,onClose:()=>et(!1),children:(0,t.jsxs)(c.A,{children:[(0,t.jsx)(d.k,{children:"确认删除"}),(0,t.jsx)(o.I,{children:"确定要删除这条交易记录吗？"}),(0,t.jsxs)(m.R,{children:[(0,t.jsx)(l.A,{variant:"bordered",onPress:()=>et(!1),children:"取消"}),(0,t.jsx)(l.A,{color:"danger",onPress:()=>{H&&F(H.id),et(!1),$(null)},children:"删除"})]})]})})]})}},55621:function(e,s,a){a.d(s,{L:function(){return l}});var t=a(64090),n=a(58222),r=a(52131);function l(){let[e,s]=(0,t.useState)([]),[a,l]=(0,t.useState)(!0),[i,c]=(0,t.useState)(null),{user:d}=(0,r.useAuth)(),o=(0,t.useRef)(!1);return(0,t.useEffect)(()=>{d&&(o.current=!1);let e=async()=>{if(!o.current||!i)try{l(!0);let e="/categories";(null==d?void 0:d.currentFamilyId)?e+="?familyId=".concat(d.currentFamilyId):(null==d?void 0:d.id)&&(e+="?userId=".concat(d.id));let a=await (0,n.Io)(e);s(a.data),c(null)}catch(e){console.error("获取分类失败",e),c(e),s([]),o.current=!0}finally{l(!1)}};d?e():(s([]),l(!1))},[d]),{categories:e,isLoading:a,error:i}}},79991:function(e,s,a){a.d(s,{A3:function(){return m},En:function(){return h},lr:function(){return o},nC:function(){return d},v9:function(){return x},wI:function(){return u}});var t=a(64090),n=a(96770),r=a(47082),l=a(20568),i=a(58222),c=a(49079);function d(e){let[s,a]=(0,t.useState)([]),[r,l]=(0,t.useState)(!0),[c,d]=(0,t.useState)(null),{showToast:o}=(0,n.useToast)(),u=(0,t.useRef)(!1),m=(0,t.useRef)(!1);return(0,t.useEffect)(()=>{e&&(u.current=!1,m.current=!1);let s=async()=>{if(!e){a([]),l(!1);return}if(!u.current||!m.current)try{l(!0),u.current=!0;let s=await (0,i.Io)("/families/".concat(e,"/transactions"));a(s.data),d(null),m.current=!1}catch(e){console.error("获取交易记录失败",e),o&&o((0,i.we)(e,"获取交易记录失败"),"error"),d(e),a([]),m.current=!0}finally{l(!1)}};!e||u.current&&m.current?e||(a([]),l(!1)):s()},[e,o]),{transactions:s,isLoading:r,error:c}}function o(){let e=(0,r.NL)(),{showToast:s}=(0,n.useToast)();return(0,l.D)({mutationFn:async e=>(await (0,i.Io)("/transactions",{method:"POST",body:JSON.stringify(e)})).data,onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),s("创建成功","success")},onError:e=>{console.error("创建交易失败:",e),s((0,i.we)(e,"创建交易失败"),"error")}})}function u(){let e=(0,r.NL)(),{showToast:s}=(0,n.useToast)();return(0,l.D)({mutationFn:async e=>(await (0,i.Io)("/transactions/".concat(e.id),{method:"PUT",body:JSON.stringify(e)})).data,onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),s("更新成功","success")},onError:e=>{console.error("更新交易失败:",e),s((0,i.we)(e,"更新交易失败"),"error")}})}function m(){let e=(0,r.NL)(),{showToast:s}=(0,n.useToast)();return(0,l.D)({mutationFn:async e=>{await (0,i.Io)("/transactions/".concat(e),{method:"DELETE"})},onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),e.invalidateQueries({queryKey:["categoryStats"]}),s("删除成功","success")},onError:e=>{401===e.status?s("请先登录","error"):s("删除失败","error")}})}function x(){let{showToast:e}=(0,n.useToast)();return(0,l.D)({mutationFn:async e=>{let{startDate:s,endDate:a}=e,t=new URLSearchParams;t.append("startDate",s),t.append("endDate",a);let n="".concat(c.env.NEXT_PUBLIC_API_URL||"http://localhost:3001/api","/transactions/export?").concat(t.toString()),r=localStorage.getItem("token"),l=await fetch(n,{method:"GET",headers:{Accept:"application/octet-stream",...r?{Authorization:"Bearer ".concat(r)}:{}}});if(!l.ok)throw Error("导出失败");let i=await l.blob(),d=window.URL.createObjectURL(i),o=document.createElement("a"),u="交易记录_".concat(s,"_").concat(a,".csv");return o.href=d,o.setAttribute("download",u),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(d),i},onSuccess:()=>{e("导出成功","success")},onError:s=>{console.error("导出失败:",s),e("导出失败","error")}})}function h(){let e=(0,r.NL)(),{showToast:s}=(0,n.useToast)();return(0,l.D)({mutationFn:async e=>(await (0,i.Io)("/transactions/import",{method:"POST",body:e,headers:{Accept:"application/json"}})).data,onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),e.invalidateQueries({queryKey:["categoryStats"]}),s("导入成功","success")},onError:e=>{console.error("导入失败:",e),s("导入失败: "+(e instanceof Error?e.message:"未知错误"),"error")}})}},22169:function(e,s,a){a.d(s,{cn:function(){return r}});var t=a(75504),n=a(51367);function r(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];return(0,n.m6)((0,t.W)(s))}}}]);