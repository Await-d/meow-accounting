"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2949],{44469:function(e,a,t){t.d(a,{Z:function(){return I}});var s=t(3827),n=t(69102),r=t.n(n),i=t(64090),l=t(67945),o=t(51055),c=t(77190),d=t(10732),m=t(56178),u=t(14078),x=t(88925),f=t(83176),h=t(59584),p=t(40834),g=t(41196),y=t(46136),j=t(47281),b=t(52131),v=t(929),w=t(4773),N=t(91932),S=t(36254);y.kL.register(y.qi,y.u,y.De);let k=["rgba(54, 162, 235, 0.8)","rgba(255, 99, 132, 0.8)","rgba(75, 192, 192, 0.8)","rgba(255, 159, 64, 0.8)","rgba(153, 102, 255, 0.8)","rgba(255, 205, 86, 0.8)","rgba(201, 203, 207, 0.8)","rgba(100, 255, 100, 0.8)","rgba(200, 100, 100, 0.8)","rgba(100, 100, 255, 0.8)"],E={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){let a=e.label||"",t=e.parsed||0,s=(t/e.dataset.data.reduce((e,a)=>e+a,0)*100).toFixed(1);return"".concat(a,": \xa5").concat(t.toFixed(2)," (").concat(s,"%)")}}}},animation:{animateRotate:!0,animateScale:!0,duration:800,easing:"easeOutQuart"},cutout:"65%"};function I(e){let{timeRange:a,onTimeRangeChange:t}=e,[n,y]=(0,i.useState)("expense"),[I,F]=(0,i.useState)("doughnut"),[q,_]=(0,i.useState)("amount"),[z,C]=(0,i.useState)("desc"),{user:T}=(0,b.useAuth)(),{data:L,isLoading:R,error:D}=(0,j.B)(a),A=(0,i.useRef)(!1);(0,i.useEffect)(()=>{D&&!A.current&&(console.error("获取分类统计数据失败:",D),A.current=!0)},[D]);let K=(0,i.useMemo)(()=>L?[...L.filter(e=>e.type===n)].sort((e,a)=>"amount"===q?"desc"===z?a.amount-e.amount:e.amount-a.amount:"desc"===z?a.name.localeCompare(e.name):e.name.localeCompare(a.name)):[],[L,n,q,z]),P=e=>K&&0!==K.length?{labels:K.map(e=>e.name),datasets:[{data:K.map(e=>e.amount),backgroundColor:K.map((e,a)=>k[a%k.length]),borderWidth:1,hoverOffset:8}]}:{labels:["暂无数据"],datasets:[{data:[1],backgroundColor:["#e5e7eb"]}]},O=(0,i.useMemo)(()=>K&&0!==K.length?K.reduce((e,a)=>e+a.amount,0):0,[K]);return R?(0,s.jsx)(v.Z,{type:"statistics"}):D?(0,s.jsx)(l.w,{className:"w-full",children:(0,s.jsxs)(o.G,{className:"flex flex-col items-center justify-center p-8 text-center",children:[(0,s.jsx)(w.Z,{className:"w-12 h-12 text-warning mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"获取分类统计数据失败"}),(0,s.jsx)("p",{className:"text-default-500 mb-4",children:D instanceof Error?D.message:"请检查网络连接并稍后再试"})]})}):L&&0!==L.length?0===K.length?(0,s.jsx)(l.w,{className:"w-full",children:(0,s.jsxs)(o.G,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)(c.g,{children:[(0,s.jsx)(d.A,{color:"expense"===n?"danger":"default",variant:"expense"===n?"solid":"bordered",onPress:()=>y("expense"),children:"支出"}),(0,s.jsx)(d.A,{color:"income"===n?"success":"default",variant:"income"===n?"solid":"bordered",onPress:()=>y("income"),children:"收入"})]}),(0,s.jsxs)(m.g,{size:"sm",className:"w-36",selectedKeys:[a],onChange:e=>t(e.target.value),children:[(0,s.jsx)(u.R,{value:"week",children:"本周"},"week"),(0,s.jsx)(u.R,{value:"month",children:"本月"},"month"),(0,s.jsx)(u.R,{value:"quarter",children:"本季度"},"quarter"),(0,s.jsx)(u.R,{value:"year",children:"本年"},"year")]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 gap-2",children:[(0,s.jsxs)("p",{className:"text-default-500",children:["暂无","expense"===n?"支出":"收入","分类数据"]}),(0,s.jsxs)(d.A,{color:"expense"===n?"success":"danger",variant:"flat",className:"mt-2",onPress:()=>y("expense"===n?"income":"expense"),children:["查看","expense"===n?"收入":"支出","分类"]})]})]})}):(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 space-y-4",children:[(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 flex justify-between items-center",children:[(0,s.jsxs)(x.n,{selectedKey:n,onSelectionChange:e=>y(e),color:"expense"===n?"danger":"success",variant:"bordered",size:"sm",classNames:{tabList:"gap-2"},children:[(0,s.jsx)(f.r,{title:"支出"},"expense"),(0,s.jsx)(f.r,{title:"收入"},"income")]}),(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 flex items-center gap-2",children:[(0,s.jsxs)(c.g,{size:"sm",children:[(0,s.jsx)(h.e,{content:"饼图",placement:"top",children:(0,s.jsx)(d.A,{isIconOnly:!0,variant:"pie"===I?"solid":"bordered",color:"primary",onPress:()=>F("pie"),children:"◔"})}),(0,s.jsx)(h.e,{content:"环形图",placement:"top",children:(0,s.jsx)(d.A,{isIconOnly:!0,variant:"doughnut"===I?"solid":"bordered",color:"primary",onPress:()=>F("doughnut"),children:"◕"})})]}),(0,s.jsxs)(m.g,{size:"sm",className:"w-24 min-w-fit",selectedKeys:[a],onChange:e=>t(e.target.value),children:[(0,s.jsx)(u.R,{value:"week",children:"本周"},"week"),(0,s.jsx)(u.R,{value:"month",children:"本月"},"month"),(0,s.jsx)(u.R,{value:"quarter",children:"本季度"},"quarter"),(0,s.jsx)(u.R,{value:"year",children:"本年"},"year")]})]})]}),(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 h-64 relative flex items-center justify-center",children:["pie"===I?(0,s.jsx)(g.by,{data:P("pie"),options:E}):(0,s.jsx)(g.$I,{data:P("doughnut"),options:E}),"doughnut"===I&&(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 absolute inset-0 flex items-center justify-center flex-col",children:[(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 text-xs text-default-500",children:["总","expense"===n?"支出":"收入"]}),(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 "+"text-lg font-bold ".concat("expense"===n?"text-danger":"text-success"),children:["\xa5",O.toFixed(2)]})]})]}),(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 space-y-2 h-64 overflow-y-auto pr-1",children:[(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 flex justify-between items-center text-xs text-default-500 px-2 py-1",children:[(0,s.jsx)(d.A,{size:"sm",variant:"light",className:"!p-1 min-w-8 h-6",startContent:"asc"===z?(0,s.jsx)(N.Z,{className:"h-3 w-3"}):(0,s.jsx)(S.Z,{className:"h-3 w-3"}),onPress:()=>C("asc"===z?"desc":"asc"),children:"排序"}),(0,s.jsxs)(c.g,{size:"sm",children:[(0,s.jsx)(d.A,{size:"sm",variant:"name"===q?"solid":"bordered",className:"!p-1 min-w-8 h-6",onPress:()=>_("name"),children:"名称"}),(0,s.jsx)(d.A,{size:"sm",variant:"amount"===q?"solid":"bordered",className:"!p-1 min-w-8 h-6",onPress:()=>_("amount"),children:"金额"})]})]}),K.map((e,a)=>(0,s.jsx)(l.w,{className:"w-full shadow-none border border-default-100 animate-fadeIn",style:{animationDelay:"".concat(50*a,"ms")},children:(0,s.jsxs)(o.G,{className:"py-2 px-3",children:[(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 flex items-center gap-2",children:[(0,s.jsx)("div",{style:{backgroundColor:k[a%k.length]},className:"jsx-93c76048a7f49ee5 w-2 h-2 rounded-full"}),(0,s.jsx)("span",{className:"jsx-93c76048a7f49ee5 text-sm font-medium line-clamp-1",children:e.name})]}),(0,s.jsx)("div",{className:"jsx-93c76048a7f49ee5 "+"text-sm font-semibold ".concat("expense"===n?"text-danger":"text-success"),children:e.amount.toFixed(2)})]}),(0,s.jsx)("div",{className:"jsx-93c76048a7f49ee5 mt-1",children:(0,s.jsx)(p.W,{size:"sm",value:e.amount,maxValue:O,color:"expense"===n?"danger":"success",className:"mt-1",showValueLabel:!0,formatOptions:{style:"percent",minimumFractionDigits:1,maximumFractionDigits:1}})})]})},e.name))]})]}),(0,s.jsx)(r(),{id:"93c76048a7f49ee5",children:"@-webkit-keyframes fadeIn{from{opacity:0;-webkit-transform:translatey(5px);transform:translatey(5px)}to{opacity:1;-webkit-transform:translatey(0);transform:translatey(0)}}@-moz-keyframes fadeIn{from{opacity:0;-moz-transform:translatey(5px);transform:translatey(5px)}to{opacity:1;-moz-transform:translatey(0);transform:translatey(0)}}@-o-keyframes fadeIn{from{opacity:0;-o-transform:translatey(5px);transform:translatey(5px)}to{opacity:1;-o-transform:translatey(0);transform:translatey(0)}}@keyframes fadeIn{from{opacity:0;-webkit-transform:translatey(5px);-moz-transform:translatey(5px);-o-transform:translatey(5px);transform:translatey(5px)}to{opacity:1;-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}}.animate-fadeIn{-webkit-animation:fadeIn.5s ease-out forwards;-moz-animation:fadeIn.5s ease-out forwards;-o-animation:fadeIn.5s ease-out forwards;animation:fadeIn.5s ease-out forwards}"})]}):(0,s.jsx)(l.w,{className:"w-full",children:(0,s.jsxs)(o.G,{className:"flex flex-col items-center justify-center p-8 gap-4",children:[(0,s.jsx)("p",{className:"text-default-500",children:"暂无分类统计数据"}),(0,s.jsx)("p",{className:"text-sm text-default-400",children:"添加更多交易记录以查看分类统计"})]})})}},29836:function(e,a,t){t.d(a,{S:function(){return c}});var s=t(3827),n=t(64090),r=t(67945),i=t(51055),l=t(10732),o=t(77785);class c extends n.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,a){console.error("组件错误:",e,a)}render(){if(this.state.hasError){var e;return this.props.fallback?this.props.fallback:(0,s.jsx)(r.w,{children:(0,s.jsxs)(i.G,{className:"text-center py-8",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:this.state.error instanceof o.Hx?"加载数据失败":"出现了一些问题"}),(0,s.jsx)("p",{className:"text-default-500 mb-4",children:(null===(e=this.state.error)||void 0===e?void 0:e.message)||"请稍后再试"}),(0,s.jsx)(l.A,{color:"primary",onPress:()=>window.location.reload(),children:"刷新页面"})]})})}return this.props.children}constructor(e){super(e),this.state={hasError:!1,error:null}}}},72949:function(e,a,t){t.d(a,{qY:function(){return Q},vL:function(){return P.Z},TT:function(){return O},a_:function(){return K},TR:function(){return D},gy:function(){return q},R5:function(){return T},vQ:function(){return s.Z}}),t(12751);var s=t(11546),n=t(3827),r=t(64090),i=t(63983),l=t(67945),o=t(51055),c=t(10732),d=t(56178),m=t(14078),u=t(50535),x=t(75129),f=t(63053),h=t(77058),p=t(36685),g=t(92339),y=t(49977),j=t(41196),b=t(46136),v=t(35061),w=t(15887),N=t(96770),S=t(77785),k=t(52131),E=t(89539),I=t.n(E);b.kL.register(b.uw,b.f$,b.od,b.jn,b.ZL,b.Dx,b.u,b.De,b.qi);let F={income:{main:"rgb(34, 197, 94)",bg:"rgba(34, 197, 94, 0.5)",hover:"rgba(34, 197, 94, 0.7)"},expense:{main:"rgb(239, 68, 68)",bg:"rgba(239, 68, 68, 0.5)",hover:"rgba(239, 68, 68, 0.7)"}};function q(){let[e,a]=(0,r.useState)("month"),{data:t,isLoading:s,error:b}=(0,w.T)(e),{showToast:E}=(0,N.useToast)(),{handleUnauthorized:q}=(0,k.useAuth)(),_=(0,r.useRef)(null),[z,C]=(0,r.useState)("line");if((0,r.useEffect)(()=>{(null==b?void 0:b.message)&&_.current!==b.message&&(_.current=b.message,b instanceof S.Hx&&401===b.status?q():E("获取统计数据失败","error"))},[null==b?void 0:b.message,q,E]),s||!t)return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)(i.X,{className:"w-48 h-10"}),(0,n.jsx)(i.X,{className:"w-32 h-10"})]}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(e=>(0,n.jsx)(l.w,{className:"w-full",children:(0,n.jsxs)(o.G,{className:"space-y-3",children:[(0,n.jsx)(i.X,{className:"w-3/4 h-4"}),(0,n.jsx)(i.X,{className:"w-2/3 h-6"})]})},e))})]});let T={labels:t.chart.map(a=>{let t=I()(a.date);return"month"===e?t.format("DD日"):"quarter"===e?t.format("MM月DD日"):t.format("MM月")}),datasets:[{label:"收入",data:t.chart.map(e=>e.income),borderColor:F.income.main,backgroundColor:"line"===z?F.income.bg:F.income.main,tension:.4,hoverBackgroundColor:F.income.hover,borderRadius:4},{label:"支出",data:t.chart.map(e=>e.expense),borderColor:F.expense.main,backgroundColor:"line"===z?F.expense.bg:F.expense.main,tension:.4,hoverBackgroundColor:F.expense.hover,borderRadius:4}]},L={responsive:!0,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:20,font:{family:"system-ui",size:12}}},title:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.7)",padding:10,bodyFont:{size:13},callbacks:{label:function(e){let a=e.dataset.label||"";return a&&(a+=": "),null!==e.parsed.y&&(a+="\xa5"+e.parsed.y.toFixed(2)),a}}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"},ticks:{callback:function(e){return"\xa5"+e},font:{family:"system-ui",size:11}}},x:{grid:{color:"rgba(0, 0, 0, 0.05)"},ticks:{font:{family:"system-ui",size:11}}}},elements:{line:{borderWidth:2},point:{radius:3,hoverRadius:5}},animation:{duration:800,easing:"easeOutQuart"}},R=(e,a)=>0===a?0:Math.round(e/a*100),D=t.chart.map(e=>e.income),A=t.chart.map(e=>e.expense),K=D.reduce((e,a)=>e+a,0)/D.length||0,P=A.reduce((e,a)=>e+a,0)/A.length||0,O=R(t.total_income,t.total_income+t.total_expense),Q=R(t.total_expense,t.total_income+t.total_expense);return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsx)(l.w,{className:"w-full bg-gradient-to-br from-success/5 to-success/20 shadow-sm transform transition-all hover:scale-105 hover:shadow-md",children:(0,n.jsxs)(o.G,{className:"space-y-2 p-4",children:[(0,n.jsx)("div",{className:"text-sm text-default-600",children:"总收入"}),(0,n.jsxs)("div",{className:"text-2xl font-bold text-success flex items-center gap-1",children:[(0,n.jsx)("span",{className:"text-lg",children:"\xa5"}),t.total_income.toFixed(2)]}),(0,n.jsxs)("div",{className:"text-xs text-default-400 flex items-center gap-1",children:[(0,n.jsxs)("span",{children:["平均: \xa5",K.toFixed(2)]}),(0,n.jsx)("div",{className:"w-full bg-default-100 rounded-full h-1 ml-2",children:(0,n.jsx)("div",{className:"bg-success h-1 rounded-full",style:{width:"".concat(O,"%")}})}),(0,n.jsxs)("span",{children:[O,"%"]})]})]})}),(0,n.jsx)(l.w,{className:"w-full bg-gradient-to-br from-danger/5 to-danger/20 shadow-sm transform transition-all hover:scale-105 hover:shadow-md",children:(0,n.jsxs)(o.G,{className:"space-y-2 p-4",children:[(0,n.jsx)("div",{className:"text-sm text-default-600",children:"总支出"}),(0,n.jsxs)("div",{className:"text-2xl font-bold text-danger flex items-center gap-1",children:[(0,n.jsx)("span",{className:"text-lg",children:"\xa5"}),t.total_expense.toFixed(2)]}),(0,n.jsxs)("div",{className:"text-xs text-default-400 flex items-center gap-1",children:[(0,n.jsxs)("span",{children:["平均: \xa5",P.toFixed(2)]}),(0,n.jsx)("div",{className:"w-full bg-default-100 rounded-full h-1 ml-2",children:(0,n.jsx)("div",{className:"bg-danger h-1 rounded-full",style:{width:"".concat(Q,"%")}})}),(0,n.jsxs)("span",{children:[Q,"%"]})]})]})}),(0,n.jsx)(l.w,{className:"w-full bg-gradient-to-br from-primary/5 to-primary/20 shadow-sm transform transition-all hover:scale-105 hover:shadow-md",children:(0,n.jsxs)(o.G,{className:"space-y-2 p-4",children:[(0,n.jsx)("div",{className:"text-sm text-default-600",children:"结余"}),(0,n.jsxs)("div",{className:"text-2xl font-bold flex items-center gap-1 ".concat(t.balance>=0?"text-success":"text-danger"),children:[(0,n.jsx)("span",{className:"text-lg",children:"\xa5"}),t.balance.toFixed(2)]}),(0,n.jsxs)("div",{className:"text-xs text-default-400 flex items-center gap-1",children:[(0,n.jsx)("span",{children:"收支比: "}),(0,n.jsx)("div",{className:"w-full bg-default-100 rounded-full h-1 ml-2",children:(0,n.jsx)("div",{className:"bg-primary h-1 rounded-full",style:{width:"".concat(t.balance>=0?100:100-Math.abs(R(t.balance,t.total_expense)),"%")}})}),(0,n.jsx)("span",{children:t.balance>=0?"盈余":"赤字"})]})]})})]}),(0,n.jsxs)("div",{className:"bg-default-50 p-4 rounded-lg shadow-sm transition-all hover:shadow-md",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h3",{className:"text-md font-medium",children:"收支趋势"}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(c.A,{size:"sm",variant:"line"===z?"solid":"bordered",color:"primary",onPress:()=>C("line"),children:"折线图"}),(0,n.jsx)(c.A,{size:"sm",variant:"bar"===z?"solid":"bordered",color:"primary",onPress:()=>C("bar"),children:"柱状图"})]})]}),(0,n.jsx)("div",{className:"h-[280px]",children:"line"===z?(0,n.jsx)(j.x1,{data:T,options:L}):(0,n.jsx)(j.$Q,{data:T,options:L})})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)(d.g,{label:"时间范围",selectedKeys:new Set([e]),onChange:e=>a(e.target.value),className:"w-36 sm:w-48",size:"sm",children:[(0,n.jsx)(m.R,{value:"month",children:"本月"},"month"),(0,n.jsx)(m.R,{value:"quarter",children:"本季度"},"quarter"),(0,n.jsx)(m.R,{value:"year",children:"本年"},"year")]}),(0,n.jsx)(c.A,{color:"primary",variant:"flat",size:"sm",startContent:(0,n.jsx)(v.Z,{className:"h-4 w-4"}),onPress:()=>{if(!t)return;let{details:e}=t,a=["分类,类型,交易次数,总金额",...e.map(e=>[e.category_name,"income"===e.type?"收入":"支出",e.transaction_count.toString(),e.total_amount.toFixed(2)]).map(e=>e.join(","))].join("\n"),s=new Blob([a],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(s),n.download="统计数据_".concat(new Date().toLocaleDateString(),".csv"),n.click()},children:"导出数据"})]}),(0,n.jsxs)("div",{className:"overflow-x-auto bg-default-50 rounded-lg shadow-sm p-4",children:[(0,n.jsx)("div",{className:"mb-3 text-md font-medium",children:"消费明细"}),(0,n.jsxs)(u.b,{"aria-label":"统计详情",className:"min-w-full",removeWrapper:!0,classNames:{th:"bg-default-100 text-default-600 py-3 px-4 text-sm",td:"py-3 px-4"},children:[(0,n.jsxs)(x.J,{children:[(0,n.jsx)(f.j,{children:"分类"}),(0,n.jsx)(f.j,{children:"类型"}),(0,n.jsx)(f.j,{children:"交易次数"}),(0,n.jsx)(f.j,{children:"总金额"})]}),(0,n.jsx)(h.y,{emptyContent:"暂无数据",children:t.details.map(e=>(0,n.jsxs)(p.g,{className:"border-b hover:bg-default-100",children:[(0,n.jsx)(g.X,{children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-xl",children:e.category_icon}),(0,n.jsx)("span",{className:"font-medium",children:e.category_name})]})}),(0,n.jsx)(g.X,{children:(0,n.jsx)(y.z,{color:"expense"===e.type?"danger":"success",variant:"flat",size:"sm",children:"expense"===e.type?"支出":"收入"})}),(0,n.jsx)(g.X,{children:e.transaction_count}),(0,n.jsx)(g.X,{children:(0,n.jsxs)("span",{className:"font-medium ".concat("expense"===e.type?"text-danger":"text-success"),children:["expense"===e.type?"-":"+","\xa5",e.total_amount.toFixed(2)]})})]},"".concat(e.category_name,"-").concat(e.type)))})]})]})]})}t(44469);var _=t(64848),z=t(18096),C=t(4710);function T(){let[e,a]=(0,r.useState)(!1),{theme:t,setTheme:s}=(0,_.F)();return((0,r.useEffect)(()=>{a(!0)},[]),e)?(0,n.jsx)(c.A,{isIconOnly:!0,variant:"light",onPress:()=>s("dark"===t?"light":"dark"),"aria-label":"切换主题",children:"dark"===t?(0,n.jsx)(z.Z,{className:"h-5 w-5"}):(0,n.jsx)(C.Z,{className:"h-5 w-5"})}):null}t(929),t(20003),t(76663),t(29836);var L=t(8792),R=t(22169);function D(e){let{variant:a="default",showText:t=!0,className:s,linkTo:r="/"}=e,i=(0,n.jsxs)("div",{className:(0,R.cn)("flex items-center gap-3",s),children:[(0,n.jsx)("img",{src:"/icons/icon-192x192.png",alt:"喵呜记账",className:(0,R.cn)("rounded-lg shadow-sm",{small:"w-8 h-8",default:"w-10 h-10",large:"w-16 h-16"}[a])}),t&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:(0,R.cn)("font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",{small:"text-xl",default:"text-2xl",large:"text-3xl"}[a]),children:"喵呜记账"}),"large"===a&&(0,n.jsx)("p",{className:"text-sm text-default-500",children:"智能家庭财务管理工具"})]})]});return r?(0,n.jsx)(L.default,{href:r,className:"no-underline",children:i}):i}var A=t(71272),K=()=>{let[e,a]=(0,r.useState)([]),[t,s]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{s(!0)},[]),(0,r.useEffect)(()=>{t&&a(Array.from({length:6}).map((e,a)=>({id:a,top:"".concat(100*Math.random(),"%"),left:"".concat(100*Math.random(),"%"),duration:2+2*Math.random(),delay:2*Math.random(),xOffset:10*Math.random()-5})))},[t]),(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur-sm",children:(0,n.jsxs)("div",{className:"relative flex flex-col items-center",children:[(0,n.jsx)(A.E.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"mb-8",children:(0,n.jsx)(D,{variant:"large"})}),(0,n.jsx)("div",{className:"relative w-64 h-2 bg-default-100 rounded-full overflow-hidden",children:(0,n.jsx)(A.E.div,{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-primary to-secondary",initial:{width:"0%"},animate:{width:["0%","30%","50%","70%","100%"]},transition:{duration:1.5,ease:"easeInOut",times:[0,.2,.5,.8,1],repeat:1/0}})}),(0,n.jsx)(A.E.p,{className:"mt-4 text-default-600",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:"载入应用中，请稍候..."}),(0,n.jsxs)("div",{className:"absolute -z-10",children:[(0,n.jsx)(A.E.div,{className:"absolute -top-20 -left-20 w-40 h-40 rounded-full bg-primary/5 blur-3xl",animate:{scale:[1,1.2,1],opacity:[.3,.6,.3]},transition:{duration:4,repeat:1/0,ease:"easeInOut"}}),(0,n.jsx)(A.E.div,{className:"absolute -bottom-20 -right-20 w-40 h-40 rounded-full bg-secondary/5 blur-3xl",animate:{scale:[1,1.3,1],opacity:[.3,.5,.3]},transition:{duration:4,repeat:1/0,ease:"easeInOut",delay:.5}})]}),(0,n.jsx)("div",{className:"absolute -z-10 inset-0",children:t&&e.map(e=>(0,n.jsx)(A.E.div,{className:"absolute w-2 h-2 rounded-full bg-primary/30",style:{top:e.top,left:e.left},animate:{y:[0,-20,0],x:[0,e.xOffset,0],opacity:[0,1,0]},transition:{duration:e.duration,repeat:1/0,delay:e.delay}},e.id))})]})})},P=t(29552),O=e=>{let{title:a,description:t,icon:s,gradient:r="primary",className:i}=e;return(0,n.jsx)(A.E.div,{className:(0,R.cn)("w-full",i),initial:"rest",whileHover:"hover",variants:{rest:{scale:1,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.05)"},hover:{scale:1.03,boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"}},transition:{duration:.3},children:(0,n.jsx)(l.w,{className:"group overflow-hidden border border-default-100 p-6 h-full",children:(0,n.jsxs)("div",{className:"relative z-10 flex flex-col h-full",children:[(0,n.jsx)("div",{className:"absolute -top-32 -right-32 w-64 h-64 rounded-full bg-gradient-to-br opacity-10 blur-3xl group-hover:opacity-20 transition-opacity duration-500 pointer-events-none",style:{background:"radial-gradient(circle, var(--".concat(r,"-500) 0%, transparent 70%)")}}),(0,n.jsx)(A.E.div,{className:(0,R.cn)("w-16 h-16 rounded-full flex items-center justify-center mb-4",{primary:"bg-primary/10 text-primary",success:"bg-success/10 text-success",warning:"bg-warning/10 text-warning",danger:"bg-danger/10 text-danger",secondary:"bg-secondary/10 text-secondary"}[r]),variants:{rest:{scale:1},hover:{scale:1.1,rotate:5}},children:s}),(0,n.jsx)("h3",{className:"text-xl font-semibold mb-3 text-foreground group-hover:text-foreground/90",children:a}),(0,n.jsx)("p",{className:"text-default-600 group-hover:text-default-700 transition-colors mt-auto",children:t}),(0,n.jsx)("div",{className:"absolute -bottom-20 -left-20 w-40 h-40 rounded-full bg-gradient-to-tr opacity-0 blur-3xl group-hover:opacity-10 transition-opacity duration-500 pointer-events-none",style:{background:"radial-gradient(circle, var(--".concat(r,"-500) 0%, transparent 70%)")}}),(0,n.jsx)("div",{className:"absolute top-0 right-0 h-12 w-12 overflow-hidden",children:(0,n.jsx)("div",{className:(0,R.cn)("absolute -top-6 -right-6 h-12 w-12 transform rotate-45 bg-gradient-to-r opacity-30",{primary:"from-primary-400 to-primary-600",success:"from-success-400 to-success-600",warning:"from-warning-400 to-warning-600",danger:"from-danger-400 to-danger-600",secondary:"from-secondary-400 to-secondary-600"}[r])})})]})})})},Q=e=>{let{title:a,subtitle:t,className:s,align:r="left",size:i="lg",withUnderline:l=!1}=e,o=a.split(""),c={hidden:{opacity:0,y:20},visible:e=>({opacity:1,y:0,transition:{delay:.05*e,duration:.5,ease:[.22,1,.36,1]}})},d={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{delay:.05*o.length+.2,duration:.5,ease:[.22,1,.36,1]}}},m={hidden:{width:"0%",opacity:0},visible:{width:"100%",opacity:1,transition:{delay:.05*o.length+.1,duration:.8,ease:[.22,1,.36,1]}}};return(0,n.jsxs)("div",{className:(0,R.cn)("overflow-hidden",{left:"text-left",center:"text-center mx-auto",right:"text-right ml-auto"}[r],s),children:[(0,n.jsxs)("h2",{className:(0,R.cn)("font-bold leading-tight tracking-tight",{sm:"text-xl md:text-2xl",md:"text-2xl md:text-3xl",lg:"text-3xl md:text-4xl",xl:"text-4xl md:text-5xl"}[i]),children:[(0,n.jsx)("span",{className:"sr-only",children:a}),(0,n.jsx)("span",{"aria-hidden":"true",className:"block relative",children:o.map((e,a)=>(0,n.jsx)(A.E.span,{custom:a,variants:c,initial:"hidden",whileInView:"visible",viewport:{once:!0},className:(0,R.cn)("inline-block bg-gradient-to-br from-foreground to-foreground/70 bg-clip-text text-transparent"," "===e?"mx-1.5":""),children:e},"".concat(e,"-").concat(a)))})]}),l&&(0,n.jsx)(A.E.div,{className:"h-[3px] bg-gradient-to-r from-primary via-secondary to-primary rounded-full mt-2",variants:m,initial:"hidden",whileInView:"visible",viewport:{once:!0}}),t&&(0,n.jsx)(A.E.p,{className:(0,R.cn)("mt-4 text-default-600",{sm:"text-sm",md:"text-base",lg:"text-lg",xl:"text-xl"}[i]),variants:d,initial:"hidden",whileInView:"visible",viewport:{once:!0},children:t})]})};t(62665)},47281:function(e,a,t){t.d(a,{B:function(){return i}});var s=t(64090),n=t(96770),r=t(58222);function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"month",a=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,[i,l]=(0,s.useState)([]),[o,c]=(0,s.useState)(!0),[d,m]=(0,s.useState)(null),{showToast:u}=(0,n.useToast)();return(0,s.useEffect)(()=>{(async()=>{try{c(!0);let s=new URLSearchParams;s.append("range",e),a&&s.append("user_id",a.toString()),t&&s.append("family_id",t.toString());let n=await (0,r.Io)("/transactions/stats/category?".concat(s.toString()));l(n.data),m(null)}catch(e){console.error("获取分类统计数据失败",e),u&&u((0,r.we)(e,"获取分类统计数据失败"),"error"),m(e)}finally{c(!1)}})()},[e,a,t,u]),{data:i,isLoading:o,error:d}}},20003:function(e,a,t){t.d(a,{Hc:function(){return h},Oh:function(){return f},X$:function(){return j},YF:function(){return x},ao:function(){return y},cW:function(){return d},kN:function(){return g},l0:function(){return m},t3:function(){return p},vP:function(){return u}});var s=t(47082),n=t(94642),r=t(20568),i=t(64090),l=t(58222),o=t(96770),c=t(52131);function d(){let{user:e,updateUser:a}=(0,c.useAuth)(),t=(0,s.NL)(),{showToast:r}=(0,o.useToast)(),[d,m]=(0,i.useState)([]),u=(0,i.useRef)(!1),{data:x,isLoading:f,error:h}=(0,n.a)({queryKey:["families"],queryFn:async()=>{try{let e=await (0,l.Io)("/families/user");return u.current=!1,e.data}catch(e){throw console.error("获取家庭列表失败:",e),u.current=!0,e}},enabled:!!e,staleTime:3e5,retry:u.current?0:2}),p=null==x?void 0:x.find(a=>a.id===(null==e?void 0:e.currentFamilyId)),{data:g,isLoading:y,error:j}=(0,n.a)({queryKey:["familyMembers",null==e?void 0:e.currentFamilyId],queryFn:async()=>(await (0,l.Io)("/families/".concat(null==e?void 0:e.currentFamilyId,"/members"))).data,enabled:!!(null==e?void 0:e.currentFamilyId)&&!u.current,staleTime:3e5,gcTime:3e5,retry:1});(0,i.useEffect)(()=>{h&&console.error("获取家庭列表失败:",h)},[h]),(0,i.useEffect)(()=>{j&&console.error("获取家庭成员失败:",j)},[j]);let b=(0,i.useCallback)(s=>{e&&(a({...e,currentFamilyId:s.id}),t.invalidateQueries({queryKey:["familyMembers"]}),t.invalidateQueries({queryKey:["transactions"]}),t.invalidateQueries({queryKey:["categories"]}),t.invalidateQueries({queryKey:["statistics"]}),t.invalidateQueries({queryKey:["categoryStats"]}),t.invalidateQueries({queryKey:["recentTransactions"]}),localStorage.setItem("currentFamilyId",s.id.toString()))},[e,a,t]),v=(0,i.useCallback)(()=>(null==p?void 0:p.owner_id)===(null==e?void 0:e.id)||(null==g?void 0:g.some(a=>a.user_id===(null==e?void 0:e.id)&&"admin"===a.role)),[p,e,g]);return{families:x,members:g||d,currentFamily:p,isLoading:f||y,error:h,setCurrentFamily:b,isAdmin:v}}function m(){let e=(0,s.NL)(),{showToast:a}=(0,o.useToast)();return(0,r.D)({mutationFn:async e=>(await (0,l.Io)("/families",{method:"POST",body:JSON.stringify(e)})).data,onSuccess:()=>{a("家庭创建成功","success"),e.invalidateQueries({queryKey:["families"]})},onError:e=>{a("创建失败: ".concat(e.message),"error")}})}function u(){let e=(0,s.NL)(),{showToast:a}=(0,o.useToast)();return(0,r.D)({mutationFn:async e=>{let{familyId:a,data:t}=e;return(await (0,l.Io)("/families/".concat(a),{method:"PATCH",body:JSON.stringify(t)})).data},onSuccess:()=>{a("家庭信息已更新","success"),e.invalidateQueries({queryKey:["families"]})},onError:e=>{a("更新失败: ".concat(e.message),"error")}})}function x(){let e=(0,s.NL)(),{showToast:a}=(0,o.useToast)();return(0,r.D)({mutationFn:async e=>{await (0,l.Io)("/families/".concat(e),{method:"DELETE"})},onSuccess:()=>{a("家庭已删除","success"),e.invalidateQueries({queryKey:["families"]})},onError:e=>{a("删除失败: ".concat(e.message),"error")}})}function f(){let e=(0,s.NL)(),{showToast:a}=(0,o.useToast)();return(0,r.D)({mutationFn:async e=>{let{familyId:a,data:t}=e;return(await (0,l.Io)("/families/".concat(a,"/members"),{method:"POST",body:JSON.stringify(t)})).data},onSuccess:()=>{a("成员已添加","success"),e.invalidateQueries({queryKey:["family"]})},onError:e=>{a("添加失败: ".concat(e.message),"error")}})}function h(){let e=(0,s.NL)(),{showToast:a}=(0,o.useToast)();return(0,r.D)({mutationFn:async e=>{let{familyId:a,memberId:t,role:s}=e;return(await (0,l.Io)("/families/".concat(a,"/members/").concat(t),{method:"PATCH",body:JSON.stringify({role:s})})).data},onSuccess:()=>{a("成员角色已更新","success"),e.invalidateQueries({queryKey:["family"]})},onError:e=>{a("更新失败: ".concat(e.message),"error")}})}function p(){let e=(0,s.NL)(),{showToast:a}=(0,o.useToast)();return(0,r.D)({mutationFn:async e=>{let{familyId:a,memberId:t}=e;await (0,l.Io)("/families/".concat(a,"/members/").concat(t),{method:"DELETE"})},onSuccess:()=>{a("成员已移除","success"),e.invalidateQueries({queryKey:["family"]})},onError:e=>{a("移除失败: ".concat(e.message),"error")}})}function g(e){return(0,n.a)({queryKey:["familyInvitations",e],queryFn:async()=>e?(await (0,l.Io)("/families/".concat(e,"/invitations"))).data:[],enabled:!!e})}function y(){let e=(0,s.NL)(),{showToast:a}=(0,o.useToast)();return(0,r.D)({mutationFn:async e=>{let{familyId:a,invitationId:t}=e;await (0,l.Io)("/families/".concat(a,"/invitations/").concat(t),{method:"DELETE"})},onSuccess:()=>{a("邀请已删除","success"),e.invalidateQueries({queryKey:["familyInvitations"]})},onError:e=>{a("删除失败: ".concat(e.message),"error")}})}function j(e){return(0,n.a)({queryKey:["userInvitations",e],queryFn:async()=>e&&(await (0,l.Io)("/users/".concat(e,"/invitations"))).data||[],enabled:!!e})}},15887:function(e,a,t){t.d(a,{T:function(){return i}});var s=t(64090),n=t(96770),r=t(58222);function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"month",a=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,[i,l]=(0,s.useState)({total_income:0,total_expense:0,balance:0,chart:[],details:[]}),[o,c]=(0,s.useState)(!0),[d,m]=(0,s.useState)(null),{showToast:u}=(0,n.useToast)();return(0,s.useEffect)(()=>{(async()=>{try{c(!0);let s=new URLSearchParams;s.append("range",e),a&&s.append("user_id",a.toString()),t&&s.append("family_id",t.toString());let n=await (0,r.Io)("/transactions/stats?".concat(s.toString()));l(n.data),m(null)}catch(e){console.error("获取统计数据失败",e),u&&u((0,r.we)(e,"获取统计数据失败"),"error"),m(e)}finally{c(!1)}})()},[e,a,t,u]),{data:i,isLoading:o,error:d}}}}]);