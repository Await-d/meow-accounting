"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4103],{44469:function(e,t,a){a.d(t,{Z:function(){return I}});var s=a(3827),r=a(69102),n=a.n(r),i=a(64090),l=a(67945),o=a(51055),c=a(77190),d=a(10732),m=a(56178),u=a(14078),x=a(88925),h=a(83176),f=a(59584),p=a(40834),g=a(41196),y=a(46136),b=a(47281),j=a(52131),v=a(929),w=a(4773),N=a(91932),k=a(36254);y.kL.register(y.qi,y.u,y.De);let S=["rgba(54, 162, 235, 0.8)","rgba(255, 99, 132, 0.8)","rgba(75, 192, 192, 0.8)","rgba(255, 159, 64, 0.8)","rgba(153, 102, 255, 0.8)","rgba(255, 205, 86, 0.8)","rgba(201, 203, 207, 0.8)","rgba(100, 255, 100, 0.8)","rgba(200, 100, 100, 0.8)","rgba(100, 100, 255, 0.8)"],E={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){let t=e.label||"",a=e.parsed||0,s=(a/e.dataset.data.reduce((e,t)=>e+t,0)*100).toFixed(1);return"".concat(t,": \xa5").concat(a.toFixed(2)," (").concat(s,"%)")}}}},animation:{animateRotate:!0,animateScale:!0,duration:800,easing:"easeOutQuart"},cutout:"65%"};function I(e){let{timeRange:t,onTimeRangeChange:a}=e,[r,y]=(0,i.useState)("expense"),[I,z]=(0,i.useState)("doughnut"),[_,F]=(0,i.useState)("amount"),[T,q]=(0,i.useState)("desc"),{user:C}=(0,j.useAuth)(),{data:M,isLoading:P,error:D}=(0,b.B)(t),L=(0,i.useRef)(!1);(0,i.useEffect)(()=>{D&&!L.current&&(console.error("获取分类统计数据失败:",D),L.current=!0)},[D]);let R=(0,i.useMemo)(()=>M?[...M.filter(e=>e.type===r)].sort((e,t)=>"amount"===_?"desc"===T?t.amount-e.amount:e.amount-t.amount:"desc"===T?t.name.localeCompare(e.name):e.name.localeCompare(t.name)):[],[M,r,_,T]),O=e=>R&&0!==R.length?{labels:R.map(e=>e.name),datasets:[{data:R.map(e=>e.amount),backgroundColor:R.map((e,t)=>S[t%S.length]),borderWidth:1,hoverOffset:8}]}:{labels:["暂无数据"],datasets:[{data:[1],backgroundColor:["#e5e7eb"]}]},A=(0,i.useMemo)(()=>R&&0!==R.length?R.reduce((e,t)=>e+t.amount,0):0,[R]);return P?(0,s.jsx)(v.Z,{type:"statistics"}):D?(0,s.jsx)(l.w,{className:"w-full",children:(0,s.jsxs)(o.G,{className:"flex flex-col items-center justify-center p-8 text-center",children:[(0,s.jsx)(w.Z,{className:"w-12 h-12 text-warning mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"获取分类统计数据失败"}),(0,s.jsx)("p",{className:"text-default-500 mb-4",children:D instanceof Error?D.message:"请检查网络连接并稍后再试"})]})}):M&&0!==M.length?0===R.length?(0,s.jsx)(l.w,{className:"w-full",children:(0,s.jsxs)(o.G,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)(c.g,{children:[(0,s.jsx)(d.A,{color:"expense"===r?"danger":"default",variant:"expense"===r?"solid":"bordered",onPress:()=>y("expense"),children:"支出"}),(0,s.jsx)(d.A,{color:"income"===r?"success":"default",variant:"income"===r?"solid":"bordered",onPress:()=>y("income"),children:"收入"})]}),(0,s.jsxs)(m.g,{size:"sm",className:"w-36",selectedKeys:[t],onChange:e=>a(e.target.value),children:[(0,s.jsx)(u.R,{value:"week",children:"本周"},"week"),(0,s.jsx)(u.R,{value:"month",children:"本月"},"month"),(0,s.jsx)(u.R,{value:"quarter",children:"本季度"},"quarter"),(0,s.jsx)(u.R,{value:"year",children:"本年"},"year")]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 gap-2",children:[(0,s.jsxs)("p",{className:"text-default-500",children:["暂无","expense"===r?"支出":"收入","分类数据"]}),(0,s.jsxs)(d.A,{color:"expense"===r?"success":"danger",variant:"flat",className:"mt-2",onPress:()=>y("expense"===r?"income":"expense"),children:["查看","expense"===r?"收入":"支出","分类"]})]})]})}):(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 space-y-4",children:[(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 flex justify-between items-center",children:[(0,s.jsxs)(x.n,{selectedKey:r,onSelectionChange:e=>y(e),color:"expense"===r?"danger":"success",variant:"bordered",size:"sm",classNames:{tabList:"gap-2"},children:[(0,s.jsx)(h.r,{title:"支出"},"expense"),(0,s.jsx)(h.r,{title:"收入"},"income")]}),(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 flex items-center gap-2",children:[(0,s.jsxs)(c.g,{size:"sm",children:[(0,s.jsx)(f.e,{content:"饼图",placement:"top",children:(0,s.jsx)(d.A,{isIconOnly:!0,variant:"pie"===I?"solid":"bordered",color:"primary",onPress:()=>z("pie"),children:"◔"})}),(0,s.jsx)(f.e,{content:"环形图",placement:"top",children:(0,s.jsx)(d.A,{isIconOnly:!0,variant:"doughnut"===I?"solid":"bordered",color:"primary",onPress:()=>z("doughnut"),children:"◕"})})]}),(0,s.jsxs)(m.g,{size:"sm",className:"w-24 min-w-fit",selectedKeys:[t],onChange:e=>a(e.target.value),children:[(0,s.jsx)(u.R,{value:"week",children:"本周"},"week"),(0,s.jsx)(u.R,{value:"month",children:"本月"},"month"),(0,s.jsx)(u.R,{value:"quarter",children:"本季度"},"quarter"),(0,s.jsx)(u.R,{value:"year",children:"本年"},"year")]})]})]}),(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 h-64 relative flex items-center justify-center",children:["pie"===I?(0,s.jsx)(g.by,{data:O("pie"),options:E}):(0,s.jsx)(g.$I,{data:O("doughnut"),options:E}),"doughnut"===I&&(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 absolute inset-0 flex items-center justify-center flex-col",children:[(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 text-xs text-default-500",children:["总","expense"===r?"支出":"收入"]}),(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 "+"text-lg font-bold ".concat("expense"===r?"text-danger":"text-success"),children:["\xa5",A.toFixed(2)]})]})]}),(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 space-y-2 h-64 overflow-y-auto pr-1",children:[(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 flex justify-between items-center text-xs text-default-500 px-2 py-1",children:[(0,s.jsx)(d.A,{size:"sm",variant:"light",className:"!p-1 min-w-8 h-6",startContent:"asc"===T?(0,s.jsx)(N.Z,{className:"h-3 w-3"}):(0,s.jsx)(k.Z,{className:"h-3 w-3"}),onPress:()=>q("asc"===T?"desc":"asc"),children:"排序"}),(0,s.jsxs)(c.g,{size:"sm",children:[(0,s.jsx)(d.A,{size:"sm",variant:"name"===_?"solid":"bordered",className:"!p-1 min-w-8 h-6",onPress:()=>F("name"),children:"名称"}),(0,s.jsx)(d.A,{size:"sm",variant:"amount"===_?"solid":"bordered",className:"!p-1 min-w-8 h-6",onPress:()=>F("amount"),children:"金额"})]})]}),R.map((e,t)=>(0,s.jsx)(l.w,{className:"w-full shadow-none border border-default-100 animate-fadeIn",style:{animationDelay:"".concat(50*t,"ms")},children:(0,s.jsxs)(o.G,{className:"py-2 px-3",children:[(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"jsx-93c76048a7f49ee5 flex items-center gap-2",children:[(0,s.jsx)("div",{style:{backgroundColor:S[t%S.length]},className:"jsx-93c76048a7f49ee5 w-2 h-2 rounded-full"}),(0,s.jsx)("span",{className:"jsx-93c76048a7f49ee5 text-sm font-medium line-clamp-1",children:e.name})]}),(0,s.jsx)("div",{className:"jsx-93c76048a7f49ee5 "+"text-sm font-semibold ".concat("expense"===r?"text-danger":"text-success"),children:e.amount.toFixed(2)})]}),(0,s.jsx)("div",{className:"jsx-93c76048a7f49ee5 mt-1",children:(0,s.jsx)(p.W,{size:"sm",value:e.amount,maxValue:A,color:"expense"===r?"danger":"success",className:"mt-1",showValueLabel:!0,formatOptions:{style:"percent",minimumFractionDigits:1,maximumFractionDigits:1}})})]})},e.name))]})]}),(0,s.jsx)(n(),{id:"93c76048a7f49ee5",children:"@-webkit-keyframes fadeIn{from{opacity:0;-webkit-transform:translatey(5px);transform:translatey(5px)}to{opacity:1;-webkit-transform:translatey(0);transform:translatey(0)}}@-moz-keyframes fadeIn{from{opacity:0;-moz-transform:translatey(5px);transform:translatey(5px)}to{opacity:1;-moz-transform:translatey(0);transform:translatey(0)}}@-o-keyframes fadeIn{from{opacity:0;-o-transform:translatey(5px);transform:translatey(5px)}to{opacity:1;-o-transform:translatey(0);transform:translatey(0)}}@keyframes fadeIn{from{opacity:0;-webkit-transform:translatey(5px);-moz-transform:translatey(5px);-o-transform:translatey(5px);transform:translatey(5px)}to{opacity:1;-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}}.animate-fadeIn{-webkit-animation:fadeIn.5s ease-out forwards;-moz-animation:fadeIn.5s ease-out forwards;-o-animation:fadeIn.5s ease-out forwards;animation:fadeIn.5s ease-out forwards}"})]}):(0,s.jsx)(l.w,{className:"w-full",children:(0,s.jsxs)(o.G,{className:"flex flex-col items-center justify-center p-8 gap-4",children:[(0,s.jsx)("p",{className:"text-default-500",children:"暂无分类统计数据"}),(0,s.jsx)("p",{className:"text-sm text-default-400",children:"添加更多交易记录以查看分类统计"})]})})}},29836:function(e,t,a){a.d(t,{S:function(){return c}});var s=a(3827),r=a(64090),n=a(67945),i=a(51055),l=a(10732),o=a(77785);class c extends r.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("组件错误:",e,t)}render(){if(this.state.hasError){var e;return this.props.fallback?this.props.fallback:(0,s.jsx)(n.w,{children:(0,s.jsxs)(i.G,{className:"text-center py-8",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:this.state.error instanceof o.Hx?"加载数据失败":"出现了一些问题"}),(0,s.jsx)("p",{className:"text-default-500 mb-4",children:(null===(e=this.state.error)||void 0===e?void 0:e.message)||"请稍后再试"}),(0,s.jsx)(l.A,{color:"primary",onPress:()=>window.location.reload(),children:"刷新页面"})]})})}return this.props.children}constructor(e){super(e),this.state={hasError:!1,error:null}}}},56172:function(e,t,a){a.r(t);var s=a(3827),r=a(64090),n=a(71272);let i=e=>Array.from({length:e},()=>({top:10+80*Math.random(),left:100*Math.random(),duration:2+3*Math.random(),delay:2*Math.random()}));t.default=()=>{let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{t(i(10)),l(!0)},[]),(0,s.jsxs)("div",{className:"fixed inset-0 -z-10 overflow-hidden pointer-events-none",children:[(0,s.jsx)("div",{className:"absolute top-0 left-0 w-full h-[400px] bg-gradient-to-b from-primary/5 to-transparent"}),(0,s.jsx)("div",{className:"absolute top-0 left-0",children:(0,s.jsxs)("svg",{width:"400",height:"400",viewBox:"0 0 400 400",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"opacity-10",children:[(0,s.jsx)("circle",{cx:"100",cy:"100",r:"100",stroke:"currentColor",strokeWidth:"0.5",strokeDasharray:"4 4"}),(0,s.jsx)("circle",{cx:"100",cy:"100",r:"50",stroke:"currentColor",strokeWidth:"0.5"}),(0,s.jsx)("line",{x1:"0",y1:"100",x2:"200",y2:"100",stroke:"currentColor",strokeWidth:"0.5",strokeDasharray:"4 4"}),(0,s.jsx)("line",{x1:"100",y1:"0",x2:"100",y2:"200",stroke:"currentColor",strokeWidth:"0.5",strokeDasharray:"4 4"})]})}),a&&(0,s.jsx)(n.E.div,{className:"absolute top-16 right-16 w-32 h-32 border border-primary/10 rounded-full",animate:{scale:[1,1.05,1],opacity:[.3,.5,.3]},transition:{duration:5,repeat:1/0,ease:"easeInOut"}}),a&&e.map((e,t)=>(0,s.jsx)(n.E.div,{className:"absolute w-1.5 h-1.5 rounded-full bg-primary/30",style:{top:"".concat(e.top,"%"),left:"".concat(e.left,"%")},animate:{y:[0,-10,0],opacity:[.2,.5,.2]},transition:{duration:e.duration,repeat:1/0,ease:"easeInOut",delay:e.delay}},t)),(0,s.jsx)("div",{className:"absolute inset-0 bg-[linear-gradient(rgba(125,125,125,0.05)_1px,transparent_1px),linear-gradient(to_right,rgba(125,125,125,0.05)_1px,transparent_1px)] bg-[size:32px_32px]"})]})}},4103:function(e,t,a){a.d(t,{qY:function(){return K},vL:function(){return O},TT:function(){return A},a_:function(){return R},TR:function(){return D},gy:function(){return _},R5:function(){return C},vQ:function(){return s.Z}}),a(12751);var s=a(11546),r=a(3827),n=a(64090),i=a(63983),l=a(67945),o=a(51055),c=a(10732),d=a(56178),m=a(14078),u=a(50535),x=a(75129),h=a(63053),f=a(77058),p=a(36685),g=a(92339),y=a(49977),b=a(41196),j=a(46136),v=a(35061),w=a(15887),N=a(96770),k=a(77785),S=a(52131),E=a(89539),I=a.n(E);j.kL.register(j.uw,j.f$,j.od,j.jn,j.ZL,j.Dx,j.u,j.De,j.qi);let z={income:{main:"rgb(34, 197, 94)",bg:"rgba(34, 197, 94, 0.5)",hover:"rgba(34, 197, 94, 0.7)"},expense:{main:"rgb(239, 68, 68)",bg:"rgba(239, 68, 68, 0.5)",hover:"rgba(239, 68, 68, 0.7)"}};function _(){let[e,t]=(0,n.useState)("month"),{data:a,isLoading:s,error:j}=(0,w.T)(e),{showToast:E}=(0,N.useToast)(),{handleUnauthorized:_}=(0,S.useAuth)(),F=(0,n.useRef)(null),[T,q]=(0,n.useState)("line");if((0,n.useEffect)(()=>{(null==j?void 0:j.message)&&F.current!==j.message&&(F.current=j.message,j instanceof k.Hx&&401===j.status?_():E("获取统计数据失败","error"))},[null==j?void 0:j.message,_,E]),s||!a)return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(i.X,{className:"w-48 h-10"}),(0,r.jsx)(i.X,{className:"w-32 h-10"})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(e=>(0,r.jsx)(l.w,{className:"w-full",children:(0,r.jsxs)(o.G,{className:"space-y-3",children:[(0,r.jsx)(i.X,{className:"w-3/4 h-4"}),(0,r.jsx)(i.X,{className:"w-2/3 h-6"})]})},e))})]});let C={labels:a.chart.map(t=>{let a=I()(t.date);return"month"===e?a.format("DD日"):"quarter"===e?a.format("MM月DD日"):a.format("MM月")}),datasets:[{label:"收入",data:a.chart.map(e=>e.income),borderColor:z.income.main,backgroundColor:"line"===T?z.income.bg:z.income.main,tension:.4,hoverBackgroundColor:z.income.hover,borderRadius:4},{label:"支出",data:a.chart.map(e=>e.expense),borderColor:z.expense.main,backgroundColor:"line"===T?z.expense.bg:z.expense.main,tension:.4,hoverBackgroundColor:z.expense.hover,borderRadius:4}]},M={responsive:!0,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:20,font:{family:"system-ui",size:12}}},title:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.7)",padding:10,bodyFont:{size:13},callbacks:{label:function(e){let t=e.dataset.label||"";return t&&(t+=": "),null!==e.parsed.y&&(t+="\xa5"+e.parsed.y.toFixed(2)),t}}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"},ticks:{callback:function(e){return"\xa5"+e},font:{family:"system-ui",size:11}}},x:{grid:{color:"rgba(0, 0, 0, 0.05)"},ticks:{font:{family:"system-ui",size:11}}}},elements:{line:{borderWidth:2},point:{radius:3,hoverRadius:5}},animation:{duration:800,easing:"easeOutQuart"}},P=(e,t)=>0===t?0:Math.round(e/t*100),D=a.chart.map(e=>e.income),L=a.chart.map(e=>e.expense),R=D.reduce((e,t)=>e+t,0)/D.length||0,O=L.reduce((e,t)=>e+t,0)/L.length||0,A=P(a.total_income,a.total_income+a.total_expense),K=P(a.total_expense,a.total_income+a.total_expense);return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsx)(l.w,{className:"w-full bg-gradient-to-br from-success/5 to-success/20 shadow-sm transform transition-all hover:scale-105 hover:shadow-md",children:(0,r.jsxs)(o.G,{className:"space-y-2 p-4",children:[(0,r.jsx)("div",{className:"text-sm text-default-600",children:"总收入"}),(0,r.jsxs)("div",{className:"text-2xl font-bold text-success flex items-center gap-1",children:[(0,r.jsx)("span",{className:"text-lg",children:"\xa5"}),a.total_income.toFixed(2)]}),(0,r.jsxs)("div",{className:"text-xs text-default-400 flex items-center gap-1",children:[(0,r.jsxs)("span",{children:["平均: \xa5",R.toFixed(2)]}),(0,r.jsx)("div",{className:"w-full bg-default-100 rounded-full h-1 ml-2",children:(0,r.jsx)("div",{className:"bg-success h-1 rounded-full",style:{width:"".concat(A,"%")}})}),(0,r.jsxs)("span",{children:[A,"%"]})]})]})}),(0,r.jsx)(l.w,{className:"w-full bg-gradient-to-br from-danger/5 to-danger/20 shadow-sm transform transition-all hover:scale-105 hover:shadow-md",children:(0,r.jsxs)(o.G,{className:"space-y-2 p-4",children:[(0,r.jsx)("div",{className:"text-sm text-default-600",children:"总支出"}),(0,r.jsxs)("div",{className:"text-2xl font-bold text-danger flex items-center gap-1",children:[(0,r.jsx)("span",{className:"text-lg",children:"\xa5"}),a.total_expense.toFixed(2)]}),(0,r.jsxs)("div",{className:"text-xs text-default-400 flex items-center gap-1",children:[(0,r.jsxs)("span",{children:["平均: \xa5",O.toFixed(2)]}),(0,r.jsx)("div",{className:"w-full bg-default-100 rounded-full h-1 ml-2",children:(0,r.jsx)("div",{className:"bg-danger h-1 rounded-full",style:{width:"".concat(K,"%")}})}),(0,r.jsxs)("span",{children:[K,"%"]})]})]})}),(0,r.jsx)(l.w,{className:"w-full bg-gradient-to-br from-primary/5 to-primary/20 shadow-sm transform transition-all hover:scale-105 hover:shadow-md",children:(0,r.jsxs)(o.G,{className:"space-y-2 p-4",children:[(0,r.jsx)("div",{className:"text-sm text-default-600",children:"结余"}),(0,r.jsxs)("div",{className:"text-2xl font-bold flex items-center gap-1 ".concat(a.balance>=0?"text-success":"text-danger"),children:[(0,r.jsx)("span",{className:"text-lg",children:"\xa5"}),a.balance.toFixed(2)]}),(0,r.jsxs)("div",{className:"text-xs text-default-400 flex items-center gap-1",children:[(0,r.jsx)("span",{children:"收支比: "}),(0,r.jsx)("div",{className:"w-full bg-default-100 rounded-full h-1 ml-2",children:(0,r.jsx)("div",{className:"bg-primary h-1 rounded-full",style:{width:"".concat(a.balance>=0?100:100-Math.abs(P(a.balance,a.total_expense)),"%")}})}),(0,r.jsx)("span",{children:a.balance>=0?"盈余":"赤字"})]})]})})]}),(0,r.jsxs)("div",{className:"bg-default-50 p-4 rounded-lg shadow-sm transition-all hover:shadow-md",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h3",{className:"text-md font-medium",children:"收支趋势"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(c.A,{size:"sm",variant:"line"===T?"solid":"bordered",color:"primary",onPress:()=>q("line"),children:"折线图"}),(0,r.jsx)(c.A,{size:"sm",variant:"bar"===T?"solid":"bordered",color:"primary",onPress:()=>q("bar"),children:"柱状图"})]})]}),(0,r.jsx)("div",{className:"h-[280px]",children:"line"===T?(0,r.jsx)(b.x1,{data:C,options:M}):(0,r.jsx)(b.$Q,{data:C,options:M})})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)(d.g,{label:"时间范围",selectedKeys:new Set([e]),onChange:e=>t(e.target.value),className:"w-36 sm:w-48",size:"sm",children:[(0,r.jsx)(m.R,{value:"month",children:"本月"},"month"),(0,r.jsx)(m.R,{value:"quarter",children:"本季度"},"quarter"),(0,r.jsx)(m.R,{value:"year",children:"本年"},"year")]}),(0,r.jsx)(c.A,{color:"primary",variant:"flat",size:"sm",startContent:(0,r.jsx)(v.Z,{className:"h-4 w-4"}),onPress:()=>{if(!a)return;let{details:e}=a,t=["分类,类型,交易次数,总金额",...e.map(e=>[e.category_name,"income"===e.type?"收入":"支出",e.transaction_count.toString(),e.total_amount.toFixed(2)]).map(e=>e.join(","))].join("\n"),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(s),r.download="统计数据_".concat(new Date().toLocaleDateString(),".csv"),r.click()},children:"导出数据"})]}),(0,r.jsxs)("div",{className:"overflow-x-auto bg-default-50 rounded-lg shadow-sm p-4",children:[(0,r.jsx)("div",{className:"mb-3 text-md font-medium",children:"消费明细"}),(0,r.jsxs)(u.b,{"aria-label":"统计详情",className:"min-w-full",removeWrapper:!0,classNames:{th:"bg-default-100 text-default-600 py-3 px-4 text-sm",td:"py-3 px-4"},children:[(0,r.jsxs)(x.J,{children:[(0,r.jsx)(h.j,{children:"分类"}),(0,r.jsx)(h.j,{children:"类型"}),(0,r.jsx)(h.j,{children:"交易次数"}),(0,r.jsx)(h.j,{children:"总金额"})]}),(0,r.jsx)(f.y,{emptyContent:"暂无数据",children:a.details.map(e=>(0,r.jsxs)(p.g,{className:"border-b hover:bg-default-100",children:[(0,r.jsx)(g.X,{children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xl",children:e.category_icon}),(0,r.jsx)("span",{className:"font-medium",children:e.category_name})]})}),(0,r.jsx)(g.X,{children:(0,r.jsx)(y.z,{color:"expense"===e.type?"danger":"success",variant:"flat",size:"sm",children:"expense"===e.type?"支出":"收入"})}),(0,r.jsx)(g.X,{children:e.transaction_count}),(0,r.jsx)(g.X,{children:(0,r.jsxs)("span",{className:"font-medium ".concat("expense"===e.type?"text-danger":"text-success"),children:["expense"===e.type?"-":"+","\xa5",e.total_amount.toFixed(2)]})})]},"".concat(e.category_name,"-").concat(e.type)))})]})]})]})}a(44469);var F=a(64848),T=a(18096),q=a(4710);function C(){let[e,t]=(0,n.useState)(!1),{theme:a,setTheme:s}=(0,F.F)();return((0,n.useEffect)(()=>{t(!0)},[]),e)?(0,r.jsx)(c.A,{isIconOnly:!0,variant:"light",onPress:()=>s("dark"===a?"light":"dark"),"aria-label":"切换主题",children:"dark"===a?(0,r.jsx)(T.Z,{className:"h-5 w-5"}):(0,r.jsx)(q.Z,{className:"h-5 w-5"})}):null}a(929),a(20003),a(76663),a(29836);var M=a(8792),P=a(22169);function D(e){let{variant:t="default",showText:a=!0,className:s,linkTo:n="/"}=e,i=(0,r.jsxs)("div",{className:(0,P.cn)("flex items-center gap-3",s),children:[(0,r.jsx)("img",{src:"/icons/icon-192x192.png",alt:"喵呜记账",className:(0,P.cn)("rounded-lg shadow-sm",{small:"w-8 h-8",default:"w-10 h-10",large:"w-16 h-16"}[t])}),a&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:(0,P.cn)("font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",{small:"text-xl",default:"text-2xl",large:"text-3xl"}[t]),children:"喵呜记账"}),"large"===t&&(0,r.jsx)("p",{className:"text-sm text-default-500",children:"智能家庭财务管理工具"})]})]});return n?(0,r.jsx)(M.default,{href:n,className:"no-underline",children:i}):i}var L=a(71272),R=()=>{let[e,t]=(0,n.useState)([]),[a,s]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{s(!0)},[]),(0,n.useEffect)(()=>{a&&t(Array.from({length:6}).map((e,t)=>({id:t,top:"".concat(100*Math.random(),"%"),left:"".concat(100*Math.random(),"%"),duration:2+2*Math.random(),delay:2*Math.random(),xOffset:10*Math.random()-5})))},[a]),(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur-sm",children:(0,r.jsxs)("div",{className:"relative flex flex-col items-center",children:[(0,r.jsx)(L.E.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"mb-8",children:(0,r.jsx)(D,{variant:"large"})}),(0,r.jsx)("div",{className:"relative w-64 h-2 bg-default-100 rounded-full overflow-hidden",children:(0,r.jsx)(L.E.div,{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-primary to-secondary",initial:{width:"0%"},animate:{width:["0%","30%","50%","70%","100%"]},transition:{duration:1.5,ease:"easeInOut",times:[0,.2,.5,.8,1],repeat:1/0}})}),(0,r.jsx)(L.E.p,{className:"mt-4 text-default-600",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:"载入应用中，请稍候..."}),(0,r.jsxs)("div",{className:"absolute -z-10",children:[(0,r.jsx)(L.E.div,{className:"absolute -top-20 -left-20 w-40 h-40 rounded-full bg-primary/5 blur-3xl",animate:{scale:[1,1.2,1],opacity:[.3,.6,.3]},transition:{duration:4,repeat:1/0,ease:"easeInOut"}}),(0,r.jsx)(L.E.div,{className:"absolute -bottom-20 -right-20 w-40 h-40 rounded-full bg-secondary/5 blur-3xl",animate:{scale:[1,1.3,1],opacity:[.3,.5,.3]},transition:{duration:4,repeat:1/0,ease:"easeInOut",delay:.5}})]}),(0,r.jsx)("div",{className:"absolute -z-10 inset-0",children:a&&e.map(e=>(0,r.jsx)(L.E.div,{className:"absolute w-2 h-2 rounded-full bg-primary/30",style:{top:e.top,left:e.left},animate:{y:[0,-20,0],x:[0,e.xOffset,0],opacity:[0,1,0]},transition:{duration:e.duration,repeat:1/0,delay:e.delay}},e.id))})]})})},O=e=>{let{variant:t="default"}=e,a=(0,n.useRef)(null);return(0,n.useEffect)(()=>{if(!a.current)return;let e=a.current,s=e.getContext("2d");if(!s)return;let r=()=>{e.width=window.innerWidth,e.height=window.innerHeight};r(),window.addEventListener("resize",r);let n=[],i="minimal"===t?50:100;class l{update(){this.x+=this.speedX,this.y+=this.speedY,this.x>e.width?this.x=0:this.x<0&&(this.x=e.width),this.y>e.height?this.y=0:this.y<0&&(this.y=e.height)}draw(){s&&(s.fillStyle=this.color,s.beginPath(),s.arc(this.x,this.y,this.size,0,2*Math.PI),s.fill())}constructor(){this.x=Math.random()*e.width,this.y=Math.random()*e.height,this.size=2*Math.random()+.5,this.speedX=.5*Math.random()-.25,this.speedY=.5*Math.random()-.25,this.color="hsla(".concat(60*Math.random()+200,", 70%, 60%, ").concat(.8*Math.random()+.2,")")}}let o=()=>{if(s)for(let e=0;e<n.length;e++)for(let t=e;t<n.length;t++){let a=n[e].x-n[t].x,r=n[e].y-n[t].y,i=Math.sqrt(a*a+r*r);if(i<150){let a=1-i/150;s.strokeStyle="rgba(150, 150, 255, ".concat(.15*a,")"),s.lineWidth=.8,s.beginPath(),s.moveTo(n[e].x,n[e].y),s.lineTo(n[t].x,n[t].y),s.stroke()}}},c=()=>{if(s){for(let a of(s.clearRect(0,0,e.width,e.height),"default"===t&&d(),n))a.update(),a.draw();o(),requestAnimationFrame(c)}},d=()=>{if(!s)return;s.strokeStyle="rgba(100, 100, 255, 0.1)",s.beginPath(),s.lineWidth=1.5,s.arc(0,0,200,0,.5*Math.PI),s.stroke(),s.beginPath(),s.arc(e.width,e.height,250,Math.PI,1.5*Math.PI),s.stroke(),s.beginPath(),s.lineWidth=.8;let t=e.width/2,a=e.height/2,r=.4*Math.min(e.width,e.height);s.moveTo(t-r/2,a-r/2),s.lineTo(t+r/2,a-r/2),s.lineTo(t+r/2,a+r/2),s.lineTo(t-r/2,a+r/2),s.lineTo(t-r/2,a-r/2),s.stroke()};return(()=>{for(let e=0;e<i;e++)n.push(new l)})(),c(),()=>{window.removeEventListener("resize",r)}},[t]),(0,r.jsxs)("div",{className:"fixed inset-0 -z-10 overflow-hidden",children:[(0,r.jsx)("canvas",{ref:a,className:"absolute inset-0 w-full h-full"}),(0,r.jsx)("div",{className:"absolute top-0 -left-[10%] w-[50%] h-[50%] bg-primary/10 rounded-full blur-[150px] -z-10"}),(0,r.jsx)("div",{className:"absolute bottom-[10%] right-[10%] w-[40%] h-[40%] bg-secondary/10 rounded-full blur-[150px] -z-10"}),(0,r.jsx)(L.E.div,{className:"absolute top-[20%] right-[10%] w-16 h-16 border border-primary/20 rounded-full",animate:{y:[0,15,0],opacity:[.6,.9,.6],scale:[1,1.05,1]},transition:{duration:6,repeat:1/0,ease:"easeInOut"}}),(0,r.jsx)(L.E.div,{className:"absolute top-[10%] left-[20%] w-24 h-24 border border-secondary/30 rounded-xl rotate-45",animate:{y:[0,-20,0],opacity:[.3,.6,.3],rotate:[45,35,45]},transition:{duration:8,repeat:1/0,ease:"easeInOut"}}),(0,r.jsx)(L.E.div,{className:"absolute bottom-[30%] left-[5%] w-20 h-20 bg-gradient-to-tr from-primary/5 to-secondary/5 rounded-lg",animate:{x:[0,10,0],opacity:[.4,.7,.4],rotate:[0,10,0]},transition:{duration:7,repeat:1/0,ease:"easeInOut"}})]})},A=e=>{let{title:t,description:a,icon:s,gradient:n="primary",className:i}=e;return(0,r.jsx)(L.E.div,{className:(0,P.cn)("w-full",i),initial:"rest",whileHover:"hover",variants:{rest:{scale:1,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.05)"},hover:{scale:1.03,boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"}},transition:{duration:.3},children:(0,r.jsx)(l.w,{className:"group overflow-hidden border border-default-100 p-6 h-full",children:(0,r.jsxs)("div",{className:"relative z-10 flex flex-col h-full",children:[(0,r.jsx)("div",{className:"absolute -top-32 -right-32 w-64 h-64 rounded-full bg-gradient-to-br opacity-10 blur-3xl group-hover:opacity-20 transition-opacity duration-500 pointer-events-none",style:{background:"radial-gradient(circle, var(--".concat(n,"-500) 0%, transparent 70%)")}}),(0,r.jsx)(L.E.div,{className:(0,P.cn)("w-16 h-16 rounded-full flex items-center justify-center mb-4",{primary:"bg-primary/10 text-primary",success:"bg-success/10 text-success",warning:"bg-warning/10 text-warning",danger:"bg-danger/10 text-danger",secondary:"bg-secondary/10 text-secondary"}[n]),variants:{rest:{scale:1},hover:{scale:1.1,rotate:5}},children:s}),(0,r.jsx)("h3",{className:"text-xl font-semibold mb-3 text-foreground group-hover:text-foreground/90",children:t}),(0,r.jsx)("p",{className:"text-default-600 group-hover:text-default-700 transition-colors mt-auto",children:a}),(0,r.jsx)("div",{className:"absolute -bottom-20 -left-20 w-40 h-40 rounded-full bg-gradient-to-tr opacity-0 blur-3xl group-hover:opacity-10 transition-opacity duration-500 pointer-events-none",style:{background:"radial-gradient(circle, var(--".concat(n,"-500) 0%, transparent 70%)")}}),(0,r.jsx)("div",{className:"absolute top-0 right-0 h-12 w-12 overflow-hidden",children:(0,r.jsx)("div",{className:(0,P.cn)("absolute -top-6 -right-6 h-12 w-12 transform rotate-45 bg-gradient-to-r opacity-30",{primary:"from-primary-400 to-primary-600",success:"from-success-400 to-success-600",warning:"from-warning-400 to-warning-600",danger:"from-danger-400 to-danger-600",secondary:"from-secondary-400 to-secondary-600"}[n])})})]})})})},K=e=>{let{title:t,subtitle:a,className:s,align:n="left",size:i="lg",withUnderline:l=!1}=e,o=t.split(""),c={hidden:{opacity:0,y:20},visible:e=>({opacity:1,y:0,transition:{delay:.05*e,duration:.5,ease:[.22,1,.36,1]}})},d={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{delay:.05*o.length+.2,duration:.5,ease:[.22,1,.36,1]}}},m={hidden:{width:"0%",opacity:0},visible:{width:"100%",opacity:1,transition:{delay:.05*o.length+.1,duration:.8,ease:[.22,1,.36,1]}}};return(0,r.jsxs)("div",{className:(0,P.cn)("overflow-hidden",{left:"text-left",center:"text-center mx-auto",right:"text-right ml-auto"}[n],s),children:[(0,r.jsxs)("h2",{className:(0,P.cn)("font-bold leading-tight tracking-tight",{sm:"text-xl md:text-2xl",md:"text-2xl md:text-3xl",lg:"text-3xl md:text-4xl",xl:"text-4xl md:text-5xl"}[i]),children:[(0,r.jsx)("span",{className:"sr-only",children:t}),(0,r.jsx)("span",{"aria-hidden":"true",className:"block relative",children:o.map((e,t)=>(0,r.jsx)(L.E.span,{custom:t,variants:c,initial:"hidden",whileInView:"visible",viewport:{once:!0},className:(0,P.cn)("inline-block bg-gradient-to-br from-foreground to-foreground/70 bg-clip-text text-transparent"," "===e?"mx-1.5":""),children:e},"".concat(e,"-").concat(t)))})]}),l&&(0,r.jsx)(L.E.div,{className:"h-[3px] bg-gradient-to-r from-primary via-secondary to-primary rounded-full mt-2",variants:m,initial:"hidden",whileInView:"visible",viewport:{once:!0}}),a&&(0,r.jsx)(L.E.p,{className:(0,P.cn)("mt-4 text-default-600",{sm:"text-sm",md:"text-base",lg:"text-lg",xl:"text-xl"}[i]),variants:d,initial:"hidden",whileInView:"visible",viewport:{once:!0},children:a})]})};a(56172)},47281:function(e,t,a){a.d(t,{B:function(){return i}});var s=a(64090),r=a(96770),n=a(58222);function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"month",t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,[i,l]=(0,s.useState)([]),[o,c]=(0,s.useState)(!0),[d,m]=(0,s.useState)(null),{showToast:u}=(0,r.useToast)();return(0,s.useEffect)(()=>{(async()=>{try{c(!0);let s=new URLSearchParams;s.append("range",e),t&&s.append("user_id",t.toString()),a&&s.append("family_id",a.toString());let r=await (0,n.Io)("/transactions/stats/category?".concat(s.toString()));l(r.data),m(null)}catch(e){console.error("获取分类统计数据失败",e),u&&u((0,n.we)(e,"获取分类统计数据失败"),"error"),m(e)}finally{c(!1)}})()},[e,t,a,u]),{data:i,isLoading:o,error:d}}},20003:function(e,t,a){a.d(t,{Hc:function(){return f},Oh:function(){return h},X$:function(){return b},YF:function(){return x},ao:function(){return y},cW:function(){return d},kN:function(){return g},l0:function(){return m},t3:function(){return p},vP:function(){return u}});var s=a(47082),r=a(94642),n=a(20568),i=a(64090),l=a(58222),o=a(96770),c=a(52131);function d(){let{user:e,updateUser:t}=(0,c.useAuth)(),a=(0,s.NL)(),{showToast:n}=(0,o.useToast)(),[d,m]=(0,i.useState)([]),u=(0,i.useRef)(!1),{data:x,isLoading:h,error:f}=(0,r.a)({queryKey:["families"],queryFn:async()=>{try{let e=await (0,l.Io)("/families/user");return u.current=!1,e.data}catch(e){throw console.error("获取家庭列表失败:",e),u.current=!0,e}},enabled:!!e,staleTime:3e5,retry:u.current?0:2}),p=null==x?void 0:x.find(t=>t.id===(null==e?void 0:e.currentFamilyId)),{data:g,isLoading:y,error:b}=(0,r.a)({queryKey:["familyMembers",null==e?void 0:e.currentFamilyId],queryFn:async()=>(await (0,l.Io)("/families/".concat(null==e?void 0:e.currentFamilyId,"/members"))).data,enabled:!!(null==e?void 0:e.currentFamilyId)&&!u.current,staleTime:3e5,gcTime:3e5,retry:1});(0,i.useEffect)(()=>{f&&console.error("获取家庭列表失败:",f)},[f]),(0,i.useEffect)(()=>{b&&console.error("获取家庭成员失败:",b)},[b]);let j=(0,i.useCallback)(s=>{e&&(t({...e,currentFamilyId:s.id}),a.invalidateQueries({queryKey:["familyMembers"]}),a.invalidateQueries({queryKey:["transactions"]}),a.invalidateQueries({queryKey:["categories"]}),a.invalidateQueries({queryKey:["statistics"]}),a.invalidateQueries({queryKey:["categoryStats"]}),a.invalidateQueries({queryKey:["recentTransactions"]}),localStorage.setItem("currentFamilyId",s.id.toString()))},[e,t,a]),v=(0,i.useCallback)(()=>(null==p?void 0:p.owner_id)===(null==e?void 0:e.id)||(null==g?void 0:g.some(t=>t.user_id===(null==e?void 0:e.id)&&"admin"===t.role)),[p,e,g]);return{families:x,members:g||d,currentFamily:p,isLoading:h||y,error:f,setCurrentFamily:j,isAdmin:v}}function m(){let e=(0,s.NL)(),{showToast:t}=(0,o.useToast)();return(0,n.D)({mutationFn:async e=>(await (0,l.Io)("/families",{method:"POST",body:JSON.stringify(e)})).data,onSuccess:()=>{t("家庭创建成功","success"),e.invalidateQueries({queryKey:["families"]})},onError:e=>{t("创建失败: ".concat(e.message),"error")}})}function u(){let e=(0,s.NL)(),{showToast:t}=(0,o.useToast)();return(0,n.D)({mutationFn:async e=>{let{familyId:t,data:a}=e;return(await (0,l.Io)("/families/".concat(t),{method:"PATCH",body:JSON.stringify(a)})).data},onSuccess:()=>{t("家庭信息已更新","success"),e.invalidateQueries({queryKey:["families"]})},onError:e=>{t("更新失败: ".concat(e.message),"error")}})}function x(){let e=(0,s.NL)(),{showToast:t}=(0,o.useToast)();return(0,n.D)({mutationFn:async e=>{await (0,l.Io)("/families/".concat(e),{method:"DELETE"})},onSuccess:()=>{t("家庭已删除","success"),e.invalidateQueries({queryKey:["families"]})},onError:e=>{t("删除失败: ".concat(e.message),"error")}})}function h(){let e=(0,s.NL)(),{showToast:t}=(0,o.useToast)();return(0,n.D)({mutationFn:async e=>{let{familyId:t,data:a}=e;return(await (0,l.Io)("/families/".concat(t,"/members"),{method:"POST",body:JSON.stringify(a)})).data},onSuccess:()=>{t("成员已添加","success"),e.invalidateQueries({queryKey:["family"]})},onError:e=>{t("添加失败: ".concat(e.message),"error")}})}function f(){let e=(0,s.NL)(),{showToast:t}=(0,o.useToast)();return(0,n.D)({mutationFn:async e=>{let{familyId:t,memberId:a,role:s}=e;return(await (0,l.Io)("/families/".concat(t,"/members/").concat(a),{method:"PATCH",body:JSON.stringify({role:s})})).data},onSuccess:()=>{t("成员角色已更新","success"),e.invalidateQueries({queryKey:["family"]})},onError:e=>{t("更新失败: ".concat(e.message),"error")}})}function p(){let e=(0,s.NL)(),{showToast:t}=(0,o.useToast)();return(0,n.D)({mutationFn:async e=>{let{familyId:t,memberId:a}=e;await (0,l.Io)("/families/".concat(t,"/members/").concat(a),{method:"DELETE"})},onSuccess:()=>{t("成员已移除","success"),e.invalidateQueries({queryKey:["family"]})},onError:e=>{t("移除失败: ".concat(e.message),"error")}})}function g(e){return(0,r.a)({queryKey:["familyInvitations",e],queryFn:async()=>e?(await (0,l.Io)("/families/".concat(e,"/invitations"))).data:[],enabled:!!e})}function y(){let e=(0,s.NL)(),{showToast:t}=(0,o.useToast)();return(0,n.D)({mutationFn:async e=>{let{familyId:t,invitationId:a}=e;await (0,l.Io)("/families/".concat(t,"/invitations/").concat(a),{method:"DELETE"})},onSuccess:()=>{t("邀请已删除","success"),e.invalidateQueries({queryKey:["familyInvitations"]})},onError:e=>{t("删除失败: ".concat(e.message),"error")}})}function b(e){return(0,r.a)({queryKey:["userInvitations",e],queryFn:async()=>e&&(await (0,l.Io)("/users/".concat(e,"/invitations"))).data||[],enabled:!!e})}},15887:function(e,t,a){a.d(t,{T:function(){return i}});var s=a(64090),r=a(96770),n=a(58222);function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"month",t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,[i,l]=(0,s.useState)({total_income:0,total_expense:0,balance:0,chart:[],details:[]}),[o,c]=(0,s.useState)(!0),[d,m]=(0,s.useState)(null),{showToast:u}=(0,r.useToast)();return(0,s.useEffect)(()=>{(async()=>{try{c(!0);let s=new URLSearchParams;s.append("range",e),t&&s.append("user_id",t.toString()),a&&s.append("family_id",a.toString());let r=await (0,n.Io)("/transactions/stats?".concat(s.toString()));l(r.data),m(null)}catch(e){console.error("获取统计数据失败",e),u&&u((0,n.we)(e,"获取统计数据失败"),"error"),m(e)}finally{c(!1)}})()},[e,t,a,u]),{data:i,isLoading:o,error:d}}}}]);