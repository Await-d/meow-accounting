"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7923,3121],{27923:function(e,t,s){s.r(t),s.d(t,{default:function(){return eB}});var a=s(3827),l=s(64090),n=s(30034),r=s(1635),i=s(10732),c=s(73400),o=s(82264),d=s(59584),u=s(67945),m=s(51055),x=s(49430),h=s(534),f=s(88925),p=s(83176),j=s(73031),g=s(45623),y=s(4248),v=s(99510),N=s(22561),b=s(7725),w=s(2646),C=s(47385),k=s(9410),S=s(52131),z=s(63121),A=s(15887),I=s(47281),P=s(79991),L=s(58222),Z=s(23441),E=s(70094),F=s(83051),M=s(8967),_=s(68005),O=s(34059),R=s(29733),D=s(77731),T=s(50489),G=s(89539),W=s.n(G),Y=s(49977),H=s(26587),B=s(66694),K=s(38333),V=s(23356),U=s(22983),q=s(10166),J=s(94866),$=s(78720),X=s(98061),Q=s(71272),ee=s(10775);function et(e){let{statistics:t,isLoading:s,timeRange:n}=e,r=(0,l.useMemo)(()=>(null==t?void 0:t.chart)?t.chart.map(e=>({...e,balance:e.income-e.expense})):[],[t]),i=(0,l.useMemo)(()=>{if(r.length<2)return 0;let e=r[0].balance;return r[r.length-1].balance-e},[r]),c=e=>{let{x:t,y:s,width:l,height:n,fill:r}=e;return(0,a.jsx)(Q.E.rect,{x:t,y:s,width:l,height:n,fill:r,rx:4,ry:4,initial:{height:0,y:s+n},animate:{height:n,y:s},transition:{duration:.5,ease:"easeOut"}})},o={month:"本月收支统计",quarter:"本季度收支统计",year:"本年收支统计"},d=e=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY",minimumFractionDigits:0}).format(e);return s?(0,a.jsxs)(u.w,{className:"h-full",children:[(0,a.jsx)(j.u,{className:"pb-0",children:(0,a.jsx)("h3",{className:"text-lg font-medium",children:o[n]})}),(0,a.jsx)(m.G,{children:(0,a.jsx)("div",{className:"flex justify-center items-center h-[300px]",children:(0,a.jsx)(g.c,{})})})]}):t&&t.chart&&0!==t.chart.length?(0,a.jsxs)(u.w,{className:"overflow-hidden border border-default-100",children:[(0,a.jsxs)(j.u,{className:"pb-0 pt-4 px-4 flex-col items-start",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,a.jsx)("h4",{className:"font-bold text-large",children:"收支趋势"}),0!==i&&(0,a.jsxs)(Y.z,{color:i>0?"success":"danger",variant:"flat",startContent:i>0?(0,a.jsx)(R.Z,{size:14}):(0,a.jsx)(ee.Z,{size:14}),children:[i>0?"+":"",d(i)]})]}),(0,a.jsxs)("p",{className:"text-tiny text-default-500",children:["month"===n?"本月":"quarter"===n?"本季度":"本年","收支情况",t&&" (总收入: ".concat(d(t.total_income),", 总支出: ").concat(d(t.total_expense),")")]})]}),(0,a.jsx)(m.G,{className:"overflow-hidden py-5",children:s?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(g.c,{size:"lg"})}):(0,a.jsx)("div",{className:"w-full h-80",children:(0,a.jsx)(H.h,{width:"100%",height:"100%",children:(0,a.jsxs)(B.c,{data:r,margin:{top:20,right:30,left:20,bottom:5},"aria-label":"收入支出趋势图表",children:[(0,a.jsxs)("defs",{children:[(0,a.jsxs)("linearGradient",{id:"incomeGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,a.jsx)("stop",{offset:"5%",stopColor:"var(--success)",stopOpacity:.8}),(0,a.jsx)("stop",{offset:"95%",stopColor:"var(--success)",stopOpacity:.2})]}),(0,a.jsxs)("linearGradient",{id:"expenseGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,a.jsx)("stop",{offset:"5%",stopColor:"var(--danger)",stopOpacity:.8}),(0,a.jsx)("stop",{offset:"95%",stopColor:"var(--danger)",stopOpacity:.2})]}),(0,a.jsxs)("linearGradient",{id:"balanceGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,a.jsx)("stop",{offset:"5%",stopColor:"var(--primary)",stopOpacity:.8}),(0,a.jsx)("stop",{offset:"95%",stopColor:"var(--primary)",stopOpacity:.2})]})]}),(0,a.jsx)(K.q,{strokeDasharray:"3 3",stroke:"var(--default-200)",opacity:.3}),(0,a.jsx)(V.K,{dataKey:"date",tick:{fill:"var(--foreground-500)"},axisLine:{stroke:"var(--default-200)"},tickLine:{stroke:"var(--default-200)"}}),(0,a.jsx)(U.B,{tick:{fill:"var(--foreground-500)"},axisLine:{stroke:"var(--default-200)"},tickLine:{stroke:"var(--default-200)"}}),(0,a.jsx)(q.u,{content:(0,a.jsx)(e=>{let{active:t,payload:s,label:l}=e;return t&&s&&s.length?(0,a.jsxs)("div",{className:"bg-content1 p-3 rounded-lg shadow-lg border border-default-100",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-foreground",children:"日期: ".concat(l)}),(0,a.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,a.jsxs)("p",{className:"text-xs flex items-center",children:[(0,a.jsx)("span",{className:"w-3 h-3 inline-block mr-2 rounded-full bg-success"}),(0,a.jsx)("span",{children:"收入: "}),(0,a.jsxs)("span",{className:"ml-1 font-medium text-success",children:[s[0].value," 元"]})]}),(0,a.jsxs)("p",{className:"text-xs flex items-center",children:[(0,a.jsx)("span",{className:"w-3 h-3 inline-block mr-2 rounded-full bg-danger"}),(0,a.jsx)("span",{children:"支出: "}),(0,a.jsxs)("span",{className:"ml-1 font-medium text-danger",children:[s[1].value," 元"]})]}),(0,a.jsxs)("p",{className:"text-xs flex items-center",children:[(0,a.jsx)("span",{className:"w-3 h-3 inline-block mr-2 rounded-full bg-primary"}),(0,a.jsx)("span",{children:"余额: "}),(0,a.jsxs)("span",{className:"ml-1 font-medium text-primary",children:[s[2].value," 元"]})]})]})]}):null},{})}),(0,a.jsx)(J.D,{wrapperStyle:{paddingTop:10}}),(0,a.jsx)($.$,{dataKey:"income",name:"收入",fill:"url(#incomeGradient)",shape:(0,a.jsx)(c,{}),radius:[4,4,0,0],barSize:"month"===n?15:10}),(0,a.jsx)($.$,{dataKey:"expense",name:"支出",fill:"url(#expenseGradient)",shape:(0,a.jsx)(c,{}),radius:[4,4,0,0],barSize:"month"===n?15:10}),(0,a.jsx)(X.x,{type:"monotone",dataKey:"balance",name:"余额",stroke:"var(--primary)",strokeWidth:2,dot:{r:4,strokeWidth:1,fill:"var(--content1)",stroke:"var(--primary)"},activeDot:{r:6,strokeWidth:1,fill:"var(--primary)",stroke:"var(--content1)"}})]})})})})]}):(0,a.jsxs)(u.w,{className:"h-full",children:[(0,a.jsx)(j.u,{className:"pb-0",children:(0,a.jsx)("h3",{className:"text-lg font-medium",children:o[n]})}),(0,a.jsx)(m.G,{children:(0,a.jsx)("div",{className:"flex justify-center items-center h-[300px]",children:(0,a.jsx)("p",{className:"text-default-500",children:"暂无数据"})})})]})}var es=s(24897),ea=s(98308),el=s(74994);let en=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#83a6ed","#8dd1e1","#82ca9d","#a4de6c"];function er(e){let{data:t,isLoading:s}=e;if(s)return(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(g.c,{})});if(!t||0===t.length)return(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)("p",{className:"text-gray-500",children:"暂无数据"})});let l=t.find(e=>"expense"===e.type);if(!l||!l.categories||0===l.categories.length)return(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)("p",{className:"text-gray-500",children:"暂无支出数据"})});let n=[...l.categories].sort((e,t)=>t.amount-e.amount).slice(0,8);return(0,a.jsx)(H.h,{width:"100%",height:"100%",children:(0,a.jsxs)(es.u,{"aria-label":"支出分类饼图",children:[(0,a.jsx)(ea.b,{data:n,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"amount",nameKey:"name",label:e=>{let{name:t,percent:s}=e;return"".concat(t,": ").concat((100*s).toFixed(0),"%")},animationBegin:0,animationDuration:1500,animationEasing:"ease-out","aria-label":"支出分类占比饼图",children:n.map((e,t)=>(0,a.jsx)(el.b,{fill:e.color||en[t%en.length]},"cell-".concat(t)))}),(0,a.jsx)(q.u,{formatter:e=>["".concat(e," 元"),""],labelFormatter:e=>"类别: ".concat(e)})]})})}var ei=s(63983),ec=s(62456),eo=e=>{let{transactions:t,isLoading:s=!1,onEdit:n,onDelete:r,isPersonalMode:c=!1,userId:o,limit:d=5,onViewMore:x}=e;console.log("RecentTransactions组件接收到的交易数据:",t);let h=e=>{if(!e)return"";try{return(0,ec.WU)(new Date(e),"yyyy-MM-dd")}catch(t){return console.error("日期格式化错误:",t,e),""}},f=e=>{if(null==e)return"";let t="string"==typeof e?parseFloat(e):e;return isNaN(t)?"":new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY",minimumFractionDigits:2}).format(t)},p=e=>!!e&&!!o&&(e.user_id||e.createdBy)===Number(o),j=(0,l.useMemo)(()=>{if(!t)return console.log("交易数据为null或undefined"),[];if(!Array.isArray(t))return console.log("交易数据不是数组类型:",typeof t),[];if(0===t.length)return console.log("交易数组为空"),[];console.log("过滤前交易数量:",t.length);let e=t.filter(e=>null!=e&&"object"==typeof e&&("id"in e||"amount"in e||"type"in e));e.length<t.length&&console.warn("发现无效交易数据，已过滤");let s=[...e].sort((e,t)=>{try{let s=e.date?new Date(e.date).getTime():0;return(t.date?new Date(t.date).getTime():0)-s}catch(e){return console.error("日期排序错误:",e),0}}).slice(0,d);return console.log("过滤后交易数量:",s.length),s.forEach((e,t)=>{console.log("交易".concat(t+1,":"),{id:e.id,type:e.type,amount:e.amount,date:e.date,category:e.category_name})}),s},[t,d]);return console.log("过滤后的交易数据:",j),(0,a.jsx)("div",{className:"w-full",children:s?(0,a.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsx)(ei.X,{className:"h-20 w-full rounded-lg"},t))}):j.length?(0,a.jsxs)("div",{className:"space-y-3",children:[j.map((e,t)=>(console.log("渲染交易项:",t,null==e?void 0:e.id),(0,a.jsx)(u.w,{className:"bg-content1/50",children:(0,a.jsx)(m.G,{className:"p-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-full ".concat((null==e?void 0:e.type)==="income"?"bg-success/10":"bg-danger/10"),children:(null==e?void 0:e.type)==="income"?(0,a.jsx)(M.Z,{size:20,className:"text-success"}):(0,a.jsx)(F.Z,{size:20,className:"text-danger"})}),(0,a.jsx)("div",{className:"flex-grow",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:(null==e?void 0:e.category_name)||"未分类"}),(0,a.jsxs)("p",{className:"text-xs text-default-500",children:[h((null==e?void 0:e.date)||new Date),!c&&(null==e?void 0:e.user_id)&&(0,a.jsxs)("span",{className:"ml-2 ".concat(p(e)?"text-primary font-medium":"text-default-500"),children:[(null==e?void 0:e.user_id)?"用户".concat(e.user_id):"未知用户",p(e)&&" (我)"]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-semibold ".concat((null==e?void 0:e.type)==="income"?"text-success":"text-danger"),children:[(null==e?void 0:e.type)==="income"?"+":"-",f(null==e?void 0:e.amount)]}),(null==e?void 0:e.description)&&(0,a.jsx)("p",{className:"text-xs text-default-500",children:null==e?void 0:e.description})]})]})}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(i.A,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>n&&n(e),children:(0,a.jsx)(D.Z,{size:16})}),(0,a.jsx)(i.A,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>r&&(null==e?void 0:e.id)&&r(e.id),className:"text-danger",children:(0,a.jsx)(T.Z,{size:16})})]})]})})},(null==e?void 0:e.id)||"trans-".concat(t)))),x&&t.length>d&&(0,a.jsx)(i.A,{className:"w-full mt-2",variant:"flat",color:"primary",onPress:x,children:"查看更多交易记录"})]}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-default-500 mb-2",children:c?"您暂无交易记录":"暂无家庭交易记录"}),(0,a.jsx)(i.A,{size:"sm",color:"primary",onPress:()=>n&&n({}),children:"添加第一笔交易"})]})})},ed=s(24232),eu=s(89812),em=s(27095),ex=s(41310),eh=s(20003),ef=s(4103),ep=s(29910),ej=s(5423),eg=s(93276),ey=s(69475),ev=s(77326),eN=s(47907),eb=e=>{let{className:t,variant:s="solid"}=e,l=(0,eN.useRouter)(),d=e=>{switch(e){case"system":l.push("/settings/system");break;case"users":l.push("/settings/users");break;case"families":l.push("/settings/families");break;case"categories":l.push("/settings/categories");break;case"logs":l.push("/settings/logs");break;case"backup":l.push("/settings/backup");break;default:l.push("/settings")}};return(0,a.jsxs)(n.F,{children:[(0,a.jsx)(r.S,{children:(0,a.jsx)(i.A,{className:"".concat("shadow"!==s?"bg-gradient-to-r from-purple-500 to-purple-600 text-white":t),endContent:(0,a.jsx)(Z.Z,{size:16}),startContent:(0,a.jsx)(Q.E.div,{animate:{rotate:[0,15,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:(0,a.jsx)(ep.Z,{size:18})}),radius:"full",size:"md",variant:s,color:"secondary",children:"后台管理"})}),(0,a.jsxs)(c.a,{"aria-label":"后台管理操作",variant:"flat",children:[(0,a.jsx)(o.W,{startContent:(0,a.jsx)(ej.Z,{size:16}),description:"管理系统仪表盘",onPress:()=>d("system"),children:"系统设置"},"dashboard"),(0,a.jsx)(o.W,{startContent:(0,a.jsx)(O.Z,{size:16}),description:"管理用户账户",onPress:()=>d("users"),children:"用户管理"},"users"),(0,a.jsx)(o.W,{startContent:(0,a.jsx)(O.Z,{size:16}),description:"管理家庭信息和成员",onPress:()=>d("families"),children:"家庭管理"},"families"),(0,a.jsx)(o.W,{startContent:(0,a.jsx)(eg.Z,{size:16}),description:"管理收支分类",onPress:()=>d("categories"),children:"分类管理"},"categories"),(0,a.jsx)(o.W,{startContent:(0,a.jsx)(ey.Z,{size:16}),description:"查看系统日志",onPress:()=>d("logs"),children:"系统日志"},"logs"),(0,a.jsx)(o.W,{startContent:(0,a.jsx)(ev.Z,{size:16}),description:"备份与恢复数据",onPress:()=>d("backup"),children:"备份恢复"},"backup")]})]})},ew=s(56178),eC=s(14078),ek=s(96459),eS=s(48219),ez=s(3665),eA=s(20372),eI=s(2391),eP=s(36747),eL=s(97307),eZ=s(82995),eE=s(62754);function eF(e){let{date:t,setDate:s,placeholder:n="选择日期",className:r}=e,[c,o]=(0,l.useState)(!1),d=(0,l.useRef)(null),x=t?(0,ec.WU)(t,"yyyy年MM月dd日",{locale:eZ.U}):"",h=()=>{o(!1)};return(0,l.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,a.jsx)("div",{className:r,ref:d,children:(0,a.jsxs)(eA.j,{placement:"bottom",isOpen:c,onOpenChange:o,children:[(0,a.jsx)(eI.b,{children:(0,a.jsx)(C.Y,{type:"text",label:"日期",placeholder:n,value:x,readOnly:!0,onClick:()=>o(!0),startContent:(0,a.jsx)(eL.Z,{size:16,className:"text-default-500"})})}),(0,a.jsx)(eP.g,{children:(0,a.jsx)(u.w,{className:"border-none",children:(0,a.jsx)(m.G,{className:"p-0",children:(0,a.jsx)(eE._,{mode:"single",selected:t,onSelect:e=>{e&&(s(e),h())},locale:eZ.U,weekStartsOn:1,footer:(0,a.jsx)("div",{className:"mt-3 flex justify-end",children:(0,a.jsx)(i.A,{variant:"flat",size:"sm",onPress:h,children:"取消"})}),className:"p-3"})})})})]})})}s(23759);var eM=s(55621),e_=e=>{let{isOpen:t,onClose:s,onSuccess:n,transaction:r,type:c="expense",familyId:o}=e,d=(0,l.useRef)({type:c,amount:0,date:new Date,note:"",categoryId:"",familyId:o||void 0}).current,u=(0,l.useCallback)(e=>{console.log(e.title)},[]),[m,x]=(0,l.useState)(!1),[h,f]=(0,l.useState)(d),{mutate:p}=(0,P.lr)(),{mutate:j}=(0,P.wI)();(0,l.useMemo)(()=>o,[o]);let{categories:g}=(0,eM.L)(),k=(0,l.useMemo)(()=>(null==g?void 0:g.filter(e=>e.type===h.type))||[],[g,h.type]),S=(0,l.useRef)(!1);(0,l.useEffect)(()=>{if(!t){S.current=!1;return}if(!S.current){if(r){var e;f({type:r.type,amount:parseFloat(r.amount.toString()),date:W()(r.date).toDate(),note:r.description||"",categoryId:(null===(e=r.category_id)||void 0===e?void 0:e.toString())||"",familyId:o||void 0})}else f({type:c||"expense",amount:0,date:new Date,note:"",categoryId:"",familyId:o||void 0});S.current=!0}},[t,r,c,o]);let z=(0,l.useCallback)((e,t)=>{f(s=>({...s,[e]:t}))},[]),A=async()=>{try{if(x(!0),!h.amount||0>=parseFloat(h.amount.toString())){u({title:"请输入有效的金额",variant:"destructive"});return}if(!h.categoryId){u({title:"请选择分类",variant:"destructive"});return}let e={type:h.type,amount:Number(h.amount),category_id:Number(h.categoryId),date:"string"==typeof h.date?h.date:(0,ec.WU)(h.date,"yyyy-MM-dd"),description:h.note||"",family_id:h.familyId?Number(h.familyId):void 0};(null==r?void 0:r.id)?(j({...r,...e}),u({title:"交易已更新",variant:"success"})):(p(e),u({title:"交易已创建",variant:"success"})),n(),s()}catch(e){console.error("交易保存失败",e),u({title:"保存失败",variant:"destructive"})}finally{x(!1)}},I=(0,l.useCallback)(e=>{switch(e){case"income":return"success";case"expense":return"danger";default:return"default"}},[]);return(0,a.jsx)(y.R,{isOpen:t,onClose:s,size:"md",children:(0,a.jsx)(v.A,{children:()=>{var e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N.k,{className:"flex flex-col gap-1",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(null==r?void 0:r.id)?"编辑交易":"新增交易",(0,a.jsx)(Y.z,{color:I(h.type),variant:"flat",radius:"sm",size:"sm",children:"income"===h.type?"收入":"支出"})]})}),(0,a.jsxs)(b.I,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(i.A,{className:"flex-1 ".concat("expense"===h.type?"bg-danger text-white":"bg-default-100"),onPress:()=>z("type","expense"),children:"支出"}),(0,a.jsx)(i.A,{className:"flex-1 ".concat("income"===h.type?"bg-success text-white":"bg-default-100"),onPress:()=>z("type","income"),children:"收入"})]}),(0,a.jsx)(C.Y,{type:"number",label:"金额",placeholder:"0.00",startContent:(0,a.jsx)(eS.Z,{size:16}),value:(null===(e=h.amount)||void 0===e?void 0:e.toString())||"",onChange:e=>z("amount",parseFloat(e.target.value)||0)}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(eF,{date:h.date,setDate:e=>z("date",e)})})}),(0,a.jsx)(ew.g,{label:"分类",placeholder:"选择分类",selectedKeys:h.categoryId?[h.categoryId]:[],startContent:(0,a.jsx)(ez.Z,{size:16}),onChange:e=>z("categoryId",e.target.value),children:k.map(e=>(0,a.jsx)(eC.R,{value:e.id.toString(),children:e.name},e.id.toString()))}),(0,a.jsx)(ek.Y,{label:"备注",placeholder:"添加备注信息",startContent:(0,a.jsx)(ey.Z,{size:16}),value:h.note||"",onChange:e=>z("note",e.target.value)})]}),(0,a.jsxs)(w.R,{children:[(0,a.jsx)(i.A,{variant:"flat",onPress:s,children:"取消"}),(0,a.jsx)(i.A,{color:"primary",onPress:A,isLoading:m,children:"保存"})]})]})}})})},eO=s(40834),eR=s(85159),eD=e=>{let{transactions:t,isLoading:s=!1,isPersonalMode:l=!1}=e,n=new Date,r=new Date(n.getFullYear(),n.getMonth(),1),i=(null==t?void 0:t.filter(e=>"expense"===e.type&&new Date(e.date)>=r&&new Date(e.date)<=n).reduce((e,t)=>e+t.amount,0))||0,c={};null==t||t.filter(e=>"expense"===e.type&&new Date(e.date)>=r&&new Date(e.date)<=n).forEach(e=>{let t=e.category_name||"分类ID:".concat(e.category_id)||0;c[t]=(c[t]||0)+e.amount});let o=Object.entries(c).sort((e,t)=>{let[,s]=e,[,a]=t;return a-s}).slice(0,3).map(e=>{let[t,s]=e;return{name:t,amount:s,percentage:s/i*100}}),d=o.length>1?o[0].percentage-o[1].percentage:null,x=e=>"\xa5".concat(e.toFixed(2)),h=e=>0===e?"danger":1===e?"warning":"success";return(0,a.jsxs)(u.w,{className:"h-full border border-default-100",children:[(0,a.jsxs)(j.u,{className:"flex gap-3 items-center",children:[(0,a.jsx)("div",{className:"p-2 rounded-full bg-danger/10",children:(0,a.jsx)(ee.Z,{size:20,className:"text-danger"})}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("p",{className:"text-md font-semibold",children:l?"我的支出":"家庭支出"}),(0,a.jsx)("p",{className:"text-small text-default-500",children:"本月支出统计"})]})]}),(0,a.jsx)(m.G,{className:"py-2",children:s?(0,a.jsx)(g.c,{size:"sm"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("p",{className:"text-3xl font-bold text-danger",children:x(i)}),null!==d&&(0,a.jsxs)(Y.z,{size:"sm",variant:"flat",color:d>0?"danger":"success",className:"ml-2",startContent:d>0?(0,a.jsx)(eR.Z,{className:"h-3 w-3"}):(0,a.jsx)(Z.Z,{className:"h-3 w-3"}),children:[Math.abs(d).toFixed(0),"%"]})]}),(0,a.jsxs)("p",{className:"text-sm text-default-500 mt-1 mb-3",children:[l?"较上月":"家庭总支出较上月",null!==d&&(0,a.jsxs)("span",{className:d>0?"text-danger":"text-success",children:[d>0?" 增加":" 减少",Math.abs(d).toFixed(0),"%"]})]}),(0,a.jsx)("div",{className:"space-y-3",children:o.map((e,t)=>(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:e.name}),(0,a.jsx)("p",{className:"text-sm",children:x(e.amount)})]}),(0,a.jsx)(eO.W,{value:e.percentage,color:h(t),size:"sm",className:"h-1","aria-label":"".concat(e.name,"支出百分比")})]},t))})]})})]})},eT=s(17252),eG=s(62985),eW=e=>{let{transactions:t=[],isLoading:s=!1,isPersonalMode:n=!1}=e,{accounts:r,isLoading:c,error:o}=function(){let[e,t]=(0,l.useState)([]),[s,a]=(0,l.useState)(!0),[n,r]=(0,l.useState)(null),{user:i}=(0,S.useAuth)(),c=(0,l.useRef)(!1);return(0,l.useEffect)(()=>{i&&(c.current=!1);let e=async()=>{if(!c.current||!n)try{a(!0);let e="/accounts";(null==i?void 0:i.currentFamilyId)?e+="?family_id=".concat(i.currentFamilyId):(null==i?void 0:i.id)&&(e+="?user_id=".concat(i.id));let s=await (0,L.Io)(e);t(s.data),r(null)}catch(e){console.error("获取账户失败",e),r(e),t([]),c.current=!0}finally{a(!1)}};i?e():(t([]),a(!1))},[i]),{accounts:e,isLoading:s,error:n}}(),d=(0,l.useMemo)(()=>(null==t?void 0:t.length)?t.filter(e=>"income"===e.type).reduce((e,t)=>e+t.amount,0):0,[t]),x=(0,l.useMemo)(()=>(null==t?void 0:t.length)?t.filter(e=>"expense"===e.type).reduce((e,t)=>e+t.amount,0):0,[t]),h=(0,l.useMemo)(()=>d-x,[d,x]),f=e=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY",minimumFractionDigits:2}).format(e);return(0,a.jsxs)(u.w,{className:"overflow-hidden h-full border border-default-100",children:[(0,a.jsxs)(j.u,{className:"flex gap-3 items-center",children:[(0,a.jsx)("div",{className:"p-2 rounded-full bg-primary/10",children:(0,a.jsx)(eT.Z,{size:20,className:"text-primary"})}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("p",{className:"text-md font-semibold",children:n?"我的账户":"家庭账户"}),(0,a.jsx)("p",{className:"text-small text-default-500",children:"总览"})]})]}),(0,a.jsx)(m.G,{className:"py-2",children:s||c?(0,a.jsx)(g.c,{size:"sm"}):o?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center text-center p-4",children:[(0,a.jsx)(eG.Z,{className:"text-danger mb-2",size:24}),(0,a.jsx)("p",{className:"text-danger",children:"加载账户信息失败"}),(0,a.jsx)(i.A,{size:"sm",variant:"flat",color:"primary",startContent:(0,a.jsx)(_.Z,{size:16}),className:"mt-2",onPress:()=>{window.location.reload()},children:"重试"})]}):(null==r?void 0:r.length)===0?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center text-center p-4",children:[(0,a.jsx)(eS.Z,{className:"text-primary/50 h-10 w-10 mb-2"}),(0,a.jsx)("p",{className:"font-medium mb-2",children:"尚未添加账户"}),(0,a.jsx)("p",{className:"text-sm text-default-500",children:"请在设置中添加您的账户"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-3xl font-bold text-primary",children:f(h)}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-default-500",children:"收入"}),(0,a.jsx)("p",{className:"text-xl font-semibold text-success",children:f(d)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-default-500",children:"支出"}),(0,a.jsx)("p",{className:"text-xl font-semibold text-danger",children:f(x)})]})]})]})})]})};let eY=(0,ed.default)(()=>Promise.resolve().then(s.bind(s,56172)),{loadableGenerated:{webpack:()=>[56172]},ssr:!1}),eH=async(e,t)=>{let s="";if(e){let t=new URLSearchParams;for(let[s,a]of Object.entries(e))t.append(s,a);s="?".concat(t.toString())}return(null==t?void 0:t.pageSize)&&(s+=s?"&pageSize=".concat(t.pageSize):"?pageSize=".concat(t.pageSize)),(await (0,L.Io)("/transactions".concat(s))).data};function eB(){let{user:e}=(0,S.useAuth)(),{currentRoute:t}=(0,z.useRoute)(),[s,L]=(0,l.useState)("month"),[G,Y]=(0,l.useState)(null),[H,B]=(0,l.useState)(!1),[K,V]=(0,l.useState)(!0),{showToast:U}=(0,ex.p)(),{families:q,currentFamily:J,setCurrentFamily:$,isLoading:X}=(0,eh.cW)(),[ee,es]=(0,l.useState)(""),[ea,el]=(0,l.useState)(!1),[en,ei]=(0,l.useState)("expense"),[ec,ed]=(0,l.useState)([]),[ep,ej]=(0,l.useState)(!0),eg=(0,P.A3)(),[ey,ev]=(0,l.useState)(!1),[eN,ew]=(0,l.useState)(1),[eC,ek]=(0,l.useState)(10),[eS,ez]=(0,l.useState)([]),[eA,eI]=(0,l.useState)(1),[eP,eL]=(0,l.useState)(""),eZ=l.useRef(!1);(0,l.useEffect)(()=>{let e=new Date().getHours();e<6?es("夜深了"):e<12?es("早上好"):e<14?es("中午好"):e<18?es("下午好"):es("晚上好")},[]);let{data:eE,isLoading:eF}=(0,A.T)(s,K&&"number"==typeof(null==e?void 0:e.id)?e.id:void 0,!K&&J?J.id:void 0),{data:eM,isLoading:eO}=(0,I.B)(s),eR=()=>{eU()};(0,l.useEffect)(()=>{e&&eR()},[K,null==J?void 0:J.id]);let eT=(0,l.useCallback)(()=>{K||X||q&&0!==q.length||(V(!0),eZ.current||(U&&U("您还没有家庭，已自动切换到个人模式","warning"),eZ.current=!0))},[K,q,X,U]),[eG,eB]=(0,l.useState)(!0),[eK,eV]=(0,l.useState)(void 0);(0,l.useEffect)(()=>{let e=setTimeout(()=>{eB(!1),X||q&&0!==q.length||V(!0)},1e3);return()=>clearTimeout(e)},[q,X,V]),(0,l.useEffect)(()=>{e&&eU()},[null==e?void 0:e.id,K,null==J?void 0:J.id]);let eU=async()=>{if(e){ej(!0),console.log("开始加载交易数据...");try{let t={};K||!J?t.user_id=String(e.id):J&&(t.family_id=String(J.id)),console.log("查询参数:",t);let s=await eH(t);console.log("获取到的交易数据:",s),Array.isArray(s)?(ed(s),console.log("成功设置交易数据，数量:",s.length)):(console.error("返回的交易数据不是数组格式",s),ed([]))}catch(e){console.error("获取交易记录失败",e),ed([])}finally{ej(!1),console.log("加载状态已重置为false")}}},eq=e=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY",minimumFractionDigits:2}).format(e),eJ=e=>W()(e).format("YYYY-MM-DD"),e$=e=>{eV(void 0),ei(e),el(!0)},eX=e=>{let t=null==q?void 0:q.find(t=>t.id===e);t&&($(t),V(!1))},eQ=e=>{eV(e),el(!0)},e0=async e=>{if(confirm("确定要删除这笔交易吗？"))try{await eg.mutateAsync(e),eU()}catch(e){console.error("删除交易失败",e)}};(0,l.useEffect)(()=>{console.log("RecentTransactions组件状态:",{isLoading:ep,transactionsCount:(null==ec?void 0:ec.length)||0,hasTransactions:Array.isArray(ec)&&ec.length>0})},[ec,ep]);let e1=async()=>{try{ej(!0);let t={};K?t.user_id=String(null==e?void 0:e.id):J&&(t.family_id=String(J.id)),console.log("加载所有交易数据的查询参数:",t);let s=await eH(t,{pageSize:100});Array.isArray(s)?(ez(s),eI(Math.ceil(s.length/eC)),console.log("加载到的所有交易数据:",s.length)):(console.error("返回的所有交易数据不是数组格式",s),ez([]))}catch(e){console.error("获取所有交易记录失败",e),ez([])}finally{ej(!1)}},e2=(0,l.useCallback)(()=>{ev(!0)},[]);(0,l.useEffect)(()=>{ey&&e1()},[ey]);let e4=(0,l.useCallback)(()=>{let e=[...eS];if(eP){let t=eP.toLowerCase();e=e.filter(e=>e.category_name&&e.category_name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||e.amount&&String(e.amount).includes(t))}let t=(eN-1)*eC;return e.slice(t,t+eC)},[eS,eP,eN,eC]);(0,l.useEffect)(()=>{if(ey&&eS.length>0){let e=[...eS];if(eP){let t=eP.toLowerCase();e=e.filter(e=>e.category_name&&e.category_name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||e.amount&&String(e.amount).includes(t))}eI(Math.ceil(e.length/eC))}},[eS,eP,eC,ey]);let e5=e=>{ew(e)};return((0,l.useEffect)(()=>{eT()},[eT,K]),(0,l.useEffect)(()=>{!X&&q&&q.length>0&&(J||$(q[0]),V(!1))},[q,X,J,$]),(0,l.useEffect)(()=>{!X&&q&&q.length>0&&(eZ.current=!1)},[q,X]),eG)?(0,a.jsx)(ef.a_,{}):(0,a.jsxs)("div",{className:"relative min-h-screen",suppressHydrationWarning:!0,children:[(0,a.jsx)(eY,{}),(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)(Q.E.div,{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(ef.TR,{variant:"default",showText:!1}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[(0,a.jsx)("span",{children:"仪表盘"}),(null==t?void 0:t.name)&&"仪表盘"!==t.name&&(0,a.jsxs)("span",{className:"text-default-500",children:["- ",t.name]})]}),(0,a.jsxs)("p",{className:"text-sm text-default-500",children:[e?"".concat(ee,"，").concat(e.username):"欢迎使用喵呜记账",K&&(0,a.jsx)("span",{className:"ml-2 text-primary font-medium",children:"(个人模式)"}),!K&&J&&(0,a.jsxs)("span",{className:"ml-2 text-success font-medium",children:["(",J.name,")"]})]})]})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 items-center",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)(n.F,{children:[(0,a.jsx)(r.S,{children:(0,a.jsx)(i.A,{color:"primary",variant:"shadow",className:"bg-gradient-to-r from-blue-500 to-blue-600 border-0",endContent:(0,a.jsx)(Z.Z,{size:16}),startContent:(0,a.jsx)(E.Z,{size:18}),radius:"full",size:"md",children:"添加交易"})}),(0,a.jsxs)(c.a,{"aria-label":"交易操作",children:[(0,a.jsx)(o.W,{description:"记录新的支出",startContent:(0,a.jsx)(F.Z,{className:"text-danger",size:18}),onPress:()=>e$("expense"),children:"添加支出"},"add-expense"),(0,a.jsx)(o.W,{description:"记录新的收入",startContent:(0,a.jsx)(M.Z,{className:"text-success",size:18}),onPress:()=>e$("income"),children:"添加收入"},"add-income")]})]}),(null==e?void 0:e.role)==="admin"&&(0,a.jsx)(eb,{variant:"shadow",className:"bg-gradient-to-r from-purple-500 to-purple-600 border-0"}),(0,a.jsx)(d.e,{content:"切换主题",children:(0,a.jsxs)(i.A,{isIconOnly:!0,variant:"light","aria-label":"切换主题",radius:"full",className:"bg-default-100",onPress:()=>{document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",document.documentElement.classList.contains("dark")?"dark":"light")},children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",className:"hidden dark:block text-yellow-300",fill:"currentColor",children:(0,a.jsx)("path",{d:"M12 18C8.68629 18 6 15.3137 6 12C6 8.68629 8.68629 6 12 6C15.3137 6 18 8.68629 18 12C18 15.3137 15.3137 18 12 18ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16ZM11 1H13V4H11V1ZM11 20H13V23H11V20ZM3.51472 4.92893L4.92893 3.51472L7.05025 5.63604L5.63604 7.05025L3.51472 4.92893ZM16.9497 18.364L18.364 16.9497L20.4853 19.0711L19.0711 20.4853L16.9497 18.364ZM19.0711 3.51472L20.4853 4.92893L18.364 7.05025L16.9497 5.63604L19.0711 3.51472ZM5.63604 16.9497L7.05025 18.364L4.92893 20.4853L3.51472 19.0711L5.63604 16.9497ZM23 11V13H20V11H23ZM4 11V13H1V11H4Z"})}),(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",className:"block dark:hidden text-blue-900",fill:"currentColor",children:(0,a.jsx)("path",{d:"M10 6C10 10.4183 13.5817 14 18 14C19.4386 14 20.7885 13.6203 21.9549 12.9556C21.4738 18.0175 17.1419 22 12 22C6.47715 22 2 17.5228 2 12C2 6.85808 5.98249 2.5262 11.0444 2.04506C10.3797 3.21152 10 4.56142 10 6ZM4 12C4 16.4183 7.58172 20 12 20C14.9654 20 17.5757 18.3788 18.9571 15.9546C18.6407 15.9848 18.3212 16 18 16C12.4772 16 8 11.5228 8 6C8 5.67879 8.01524 5.35933 8.04536 5.04293C5.62119 6.42426 4 9.03458 4 12Z"})})]})}),(0,a.jsx)(i.A,{isIconOnly:!0,variant:"light","aria-label":"刷新数据",onPress:eR,radius:"full",className:"ml-auto",children:(0,a.jsx)(_.Z,{className:"h-4 w-4"})})]})})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(u.w,{className:"bg-content1/70 backdrop-blur-sm",children:(0,a.jsx)(m.G,{className:"py-4",children:(0,a.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.i,{size:"sm",color:K?"secondary":"primary",isSelected:K,onValueChange:e=>{if(X){U("家庭数据加载中，请稍候...","warning");return}if(!e&&(!q||0===q.length)){U("您还没有家庭，请先创建或加入一个家庭","warning");return}V(e),e||(eZ.current=!1),!e&&q&&q.length>0&&!J&&$(q[0])},startContent:(0,a.jsx)(eu.Z,{className:"h-4 w-4"}),endContent:(0,a.jsx)(em.Z,{className:"h-4 w-4"})}),(0,a.jsx)("span",{className:"text-sm font-medium whitespace-nowrap",children:K?"个人数据":"家庭数据"})]}),!K&&q&&q.length>0&&(0,a.jsxs)(n.F,{children:[(0,a.jsx)(r.S,{children:(0,a.jsx)(i.A,{variant:"flat",size:"sm",startContent:(0,a.jsx)(O.Z,{size:16}),endContent:(0,a.jsx)(Z.Z,{size:16}),color:"primary",children:(null==J?void 0:J.name)||"选择家庭"})}),(0,a.jsx)(c.a,{"aria-label":"家庭选择",children:q.map(e=>(0,a.jsx)(o.W,{onPress:()=>eX(e.id),startContent:(0,a.jsx)(h.h,{name:e.name.charAt(0),size:"sm",radius:"full",className:"mr-2 bg-primary/20"}),description:e.description,className:(null==J?void 0:J.id)===e.id?"bg-primary/10":"",children:e.name},e.id))})]})]}),(0,a.jsxs)(f.n,{selectedKey:s,onSelectionChange:e=>L(e),classNames:{base:"max-w-fit",tabList:"gap-2 relative rounded-lg p-1 bg-default-100",tab:"max-w-fit px-3 h-8 data-[selected=true]:bg-primary data-[selected=true]:text-white",cursor:"w-full",tabContent:"group-data-[selected=true]:text-inherit"},size:"sm",children:[(0,a.jsx)(p.r,{title:"本月"},"month"),(0,a.jsx)(p.r,{title:"本季度"},"quarter"),(0,a.jsx)(p.r,{title:"本年"},"year")]})]})})})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[(0,a.jsx)(eW,{transactions:ec,isPersonalMode:K,isLoading:ep}),(0,a.jsx)(eD,{transactions:ec,isPersonalMode:K,isLoading:ep}),(0,a.jsxs)(u.w,{className:"overflow-hidden h-full border border-default-100",children:[(0,a.jsxs)(j.u,{className:"flex gap-3 items-center",children:[(0,a.jsx)("div",{className:"p-2 rounded-full bg-blue-500/10",children:(0,a.jsx)(R.Z,{size:20,className:"text-blue-500"})}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("p",{className:"text-md font-semibold",children:K?"个人结余":"家庭结余"}),(0,a.jsx)("p",{className:"text-small text-default-500",children:K?"本月收支差额":"本月收支统计"})]})]}),(0,a.jsx)(m.G,{className:"py-2",children:eF?(0,a.jsx)(g.c,{size:"sm"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-3xl font-bold text-blue-500",children:eq(((null==eE?void 0:eE.total_income)||0)-((null==eE?void 0:eE.total_expense)||0))}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-default-500",children:"month"===s?"本月":"quarter"===s?"本季度":"今年"}),(0,a.jsx)("p",{className:"text-xl font-semibold text-blue-500",children:eq(((null==eE?void 0:eE.total_income)||0)-((null==eE?void 0:eE.total_expense)||0))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-default-500",children:K?"个人":"".concat((null==J?void 0:J.name)||"家庭")}),(0,a.jsx)("p",{className:"text-xl font-semibold text-blue-500",children:eq(((null==eE?void 0:eE.total_income)||0)-((null==eE?void 0:eE.total_expense)||0))})]})]})]})})]})]}),(0,a.jsxs)(Q.E.div,{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[(0,a.jsx)(et,{statistics:eE,isLoading:eF,timeRange:s}),(0,a.jsxs)(u.w,{className:"overflow-hidden border border-default-100",children:[(0,a.jsxs)(j.u,{className:"pb-0 pt-4 px-4 flex-col items-start",children:[(0,a.jsx)("h4",{className:"font-bold text-large",children:"支出分类占比"}),(0,a.jsxs)("p",{className:"text-tiny text-default-500",children:["month"===s?"本月":"quarter"===s?"本季度":"本年","支出分类比例"]})]}),(0,a.jsx)(m.G,{className:"py-5 h-80",children:(0,a.jsx)(er,{data:eM?[{type:"expense",categories:eM.filter(e=>"expense"===e.type).map(e=>({id:e.id||0,name:e.name||"未分类",amount:e.amount||0,count:1,color:e.color}))}]:null,isLoading:eO})})]})]}),(0,a.jsx)(Q.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},children:(0,a.jsxs)(u.w,{className:"overflow-hidden border border-default-100",children:[(0,a.jsxs)(j.u,{className:"pb-0 pt-4 px-4 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-bold text-large",children:K?"我的最近交易":"".concat((null==J?void 0:J.name)||"家庭","最近交易")}),(0,a.jsx)("p",{className:"text-tiny text-default-500",children:"最近的5笔交易记录"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.A,{size:"sm",color:"default",variant:"light",onPress:eU,startContent:(0,a.jsx)(_.Z,{size:14}),children:"刷新"}),(0,a.jsx)(i.A,{size:"sm",color:"secondary",variant:"flat",onPress:e2,children:"查看全部"}),(0,a.jsx)(i.A,{size:"sm",color:"primary",variant:"flat",onPress:()=>{if(!K&&(!J||!q||0===q.length)){U("请先创建或加入一个家庭","error");return}el(!0)},startContent:(0,a.jsx)(E.Z,{size:14}),children:"添加交易"})]})]}),(0,a.jsx)(m.G,{children:(0,a.jsx)(eo,{transactions:ec,isLoading:ep,onEdit:eQ,onDelete:e0,isPersonalMode:K,userId:null==e?void 0:e.id,onViewMore:e2})})]})}),(0,a.jsx)(y.R,{isOpen:H,onOpenChange:B,children:(0,a.jsx)(v.A,{children:e=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N.k,{className:"flex flex-col gap-1",children:"交易详情"}),(0,a.jsx)(b.I,{children:G&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-default-500",children:"类型"}),(0,a.jsx)("span",{className:"income"===G.type?"text-success":"expense"===G.type?"text-danger":"text-warning",children:"income"===G.type?"收入":"expense"===G.type?"支出":"转账"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-default-500",children:"金额"}),(0,a.jsx)("span",{className:"font-semibold",children:eq(G.amount)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-default-500",children:"分类"}),(0,a.jsx)("span",{children:G.category_name||"未分类"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-default-500",children:"日期"}),(0,a.jsx)("span",{children:eJ(G.date)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-default-500",children:"描述"}),(0,a.jsx)("span",{children:G.description||"无描述"})]})]})}),(0,a.jsxs)(w.R,{children:[(0,a.jsx)(i.A,{color:"danger",variant:"light",onPress:e,children:"关闭"}),(0,a.jsx)(i.A,{color:"primary",onPress:()=>{e(),G&&(eV(G),el(!0))},children:"编辑"})]})]})})}),(0,a.jsx)(y.R,{isOpen:ey,onOpenChange:ev,size:"4xl",scrollBehavior:"inside",children:(0,a.jsx)(v.A,{children:t=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N.k,{className:"flex flex-col gap-1",children:K?"我的所有交易记录":"".concat((null==J?void 0:J.name)||"家庭","交易记录")}),(0,a.jsxs)(b.I,{children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(C.Y,{placeholder:"搜索交易记录...",value:eP,onChange:e=>eL(e.target.value),startContent:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-default-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),className:"w-full"})}),ep?(0,a.jsx)("div",{className:"flex justify-center py-10",children:(0,a.jsx)(g.c,{})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"space-y-3",children:e4().map((s,l)=>(0,a.jsx)(u.w,{className:"bg-content1/50",children:(0,a.jsx)(m.G,{className:"p-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-full ".concat((null==s?void 0:s.type)==="income"?"bg-success/10":"bg-danger/10"),children:(null==s?void 0:s.type)==="income"?(0,a.jsx)(M.Z,{size:20,className:"text-success"}):(0,a.jsx)(F.Z,{size:20,className:"text-danger"})}),(0,a.jsx)("div",{className:"flex-grow",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:(null==s?void 0:s.category_name)||"未分类"}),(0,a.jsxs)("p",{className:"text-xs text-default-500",children:[eJ((null==s?void 0:s.date)||new Date),!K&&(null==s?void 0:s.user_id)&&(0,a.jsxs)("span",{className:"ml-2 ".concat(Number(null==s?void 0:s.user_id)===Number(null==e?void 0:e.id)?"text-primary font-medium":"text-default-500"),children:[(null==s?void 0:s.user_id)?"用户".concat(s.user_id):"未知用户",Number(null==s?void 0:s.user_id)===Number(null==e?void 0:e.id)&&" (我)"]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-semibold ".concat((null==s?void 0:s.type)==="income"?"text-success":"text-danger"),children:[(null==s?void 0:s.type)==="income"?"+":"-",eq(null==s?void 0:s.amount)]}),(null==s?void 0:s.description)&&(0,a.jsx)("p",{className:"text-xs text-default-500",children:null==s?void 0:s.description})]})]})}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(i.A,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>{t(),eQ(s)},children:(0,a.jsx)(D.Z,{size:16})}),(0,a.jsx)(i.A,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>{(null==s?void 0:s.id)&&e0(s.id)},className:"text-danger",children:(0,a.jsx)(T.Z,{size:16})})]})]})})},(null==s?void 0:s.id)||"trans-".concat(l)))}),eA>1&&(0,a.jsx)("div",{className:"flex justify-center mt-4",children:(0,a.jsx)(k.g,{total:eA,initialPage:1,page:eN,onChange:e5})})]})]}),(0,a.jsxs)(w.R,{children:[(0,a.jsx)(i.A,{color:"danger",variant:"light",onPress:t,children:"关闭"}),(0,a.jsx)(i.A,{color:"primary",onPress:()=>{t(),el(!0)},children:"添加交易"})]})]})})}),(0,a.jsx)(e_,{isOpen:ea,onClose:()=>el(!1),onSuccess:()=>{eR(),el(!1)},transaction:eK,type:en,familyId:!K&&J?J.id.toString():void 0})]})]})}},63121:function(e,t,s){s.r(t),s.d(t,{RouteProvider:function(){return y},useRoute:function(){return v}});var a=s(3827),l=s(64090),n=s(47907),r=s(52131),i=s(77785),c=s(58222),o=s(41310),d=s(26632);let u={[i.Yt.DASHBOARD]:1,[i.Yt.TRANSACTIONS]:2,[i.Yt.STATISTICS]:3,[i.Yt.SETTINGS]:4,[i.Yt.CUSTOM]:5},m={maxConcurrent:2,interval:5e3,timeout:1e4};function x(){let e=(0,l.useRef)(new Set),t=(0,l.useRef)(new Set),s=(0,l.useCallback)(e=>u[e.type]||1/0,[]),a=(0,l.useCallback)(e=>[...e].sort((e,t)=>s(e)-s(t)),[s]),n=(0,l.useCallback)(async s=>{if(!(e.current.has(s.path)||t.current.has(s.path))){e.current.add(s.path);try{let e=d.Kz[s.type];if(!e)return;let a=new Promise((e,t)=>{setTimeout(()=>t(Error("预热超时")),m.timeout)}),l=Promise.all([e.component(),e.layout?e.layout():Promise.resolve(null)]);await Promise.race([l,a]),t.current.add(s.path)}catch(e){console.warn("路由预热失败: ".concat(s.path),e)}finally{e.current.delete(s.path)}}},[]),r=(0,l.useCallback)(async e=>{let t=a(e),s=[];for(let e=0;e<t.length;e+=m.maxConcurrent)s.push(t.slice(e,e+m.maxConcurrent));for(let e of s)await Promise.all(e.map(e=>n(e))),s.indexOf(e)<s.length-1&&await new Promise(e=>setTimeout(e,m.interval))},[n,a]),i=(0,l.useCallback)(e=>t.current.has(e),[]),c=(0,l.useCallback)(()=>({preheating:Array.from(e.current),preheated:Array.from(t.current)}),[]),o=(0,l.useCallback)(()=>{e.current.clear(),t.current.clear()},[]);return(0,l.useEffect)(()=>()=>{o()},[o]),{preheatRoute:n,preheatRoutes:r,isRoutePreheated:i,getPreheatStatus:c,clearPreheatCache:o,getRoutePriority:s,sortRoutesByPriority:a}}let h={maxSize:5242880,maxAge:18e5,minPriority:3},f="route_params";var p=s(56288);let j=(0,l.createContext)(void 0);function g(e){let{children:t}=e,s=(0,n.useRouter)(),u=(0,n.usePathname)(),m=(0,n.useSearchParams)(),{user:g}=(0,r.useAuth)(),[y,v]=(0,l.useState)(),[N,b]=(0,l.useState)({}),[w,C]=(0,l.useState)([]),[k,S]=(0,l.useState)([]),[z,A]=(0,l.useState)(!1),[I,P]=(0,l.useState)(!1),{showToast:L}=(0,o.p)(),{getCachedRoute:Z,cacheRoute:E,clearExpiredCache:F}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{maxSize:t,maxAge:s,minPriority:a}={...h,...e},[n,r]=(0,l.useState)(new Map),{getRoutePriority:i}=x(),c=(0,l.useRef)(0),o=(0,l.useCallback)(e=>JSON.stringify(e).length,[]),d=(0,l.useCallback)(e=>Date.now()-e.lastAccessed>s,[s]),u=(0,l.useCallback)(e=>i(e)<=a,[i,a]),m=(0,l.useCallback)(e=>{let t=n.get(e);return t?d(t)?(n.delete(e),c.current-=t.size,r(new Map(n)),null):(t.lastAccessed=Date.now(),r(new Map(n)),t):null},[n,d]),f=(0,l.useCallback)(e=>{let s=Array.from(n.entries());if(Date.now(),s.forEach(e=>{let[t,s]=e;d(s)&&(n.delete(t),c.current-=s.size)}),c.current+e>t)for(let[a,l]of s.filter(e=>{let[t,s]=e;return!d(s)}).sort((e,t)=>{let s=t[1].priority-e[1].priority;return 0!==s?s:e[1].lastAccessed-t[1].lastAccessed})){if(c.current+e<=t)break;n.delete(a),c.current-=l.size}r(new Map(n))},[n,d,t]);return{getCachedRoute:m,cacheRoute:(0,l.useCallback)(e=>{if(!u(e))return;let s=o(e),a=i(e);c.current+s>t&&f(s);let l={...e,lastAccessed:Date.now(),priority:a,size:s};n.set(e.path,l),c.current+=s,r(new Map(n))},[u,o,i,t,f,n]),clearExpiredCache:(0,l.useCallback)(()=>{let e=!1;n.forEach((t,s)=>{d(t)&&(n.delete(s),c.current-=t.size,e=!0)}),e&&r(new Map(n))},[n,d]),getCacheStats:(0,l.useCallback)(()=>({totalSize:c.current,itemCount:n.size,maxSize:t,usage:c.current/t*100}),[n,t])}}(),{preloadRoute:M,preloadRoutes:_}=function(){let e=(0,l.useCallback)(async e=>{try{let t=d.Kz[e.type];if(!t)return;let s=t.component(),a=t.layout?t.layout():Promise.resolve(null);await Promise.all([s,a])}catch(t){console.error("预加载路由失败: ".concat(e.path),t)}},[]),t=(0,l.useCallback)(async t=>{let s=t.map(t=>e(t));await Promise.allSettled(s)},[e]);return{preloadRoute:e,preloadRoutes:t,preloadRouteType:(0,l.useCallback)(async e=>{try{let t=d.Kz[e];if(!t)return;let s=t.component(),a=t.layout?t.layout():Promise.resolve(null);await Promise.all([s,a])}catch(t){console.error("预加载路由类型失败: ".concat(e),t)}},[])}}(),{addToHistory:O,goBack:R,goForward:D,getCurrentRoute:T,getHistorySummary:G}=function(){let[e,t]=(0,l.useState)([]),[s,a]=(0,l.useState)(-1),n=(0,l.useCallback)(e=>{t(t=>{var l;if((null===(l=t[s])||void 0===l?void 0:l.path)===e.path)return t;let n=t.slice(0,s+1);return n.push(e),n.length>20&&n.shift(),a(n.length-1),n})},[s]),r=(0,l.useCallback)(()=>s>0?(a(e=>e-1),e[s-1]):null,[e,s]),i=(0,l.useCallback)(()=>s<e.length-1?(a(e=>e+1),e[s+1]):null,[e,s]);return{addToHistory:n,goBack:r,goForward:i,getCurrentRoute:(0,l.useCallback)(()=>e[s]||null,[e,s]),clearHistory:(0,l.useCallback)(()=>{t([]),a(-1)},[]),getHistorySummary:(0,l.useCallback)(()=>({canGoBack:s>0,canGoForward:s<e.length-1,historyLength:e.length,currentIndex:s}),[e.length,s])}}(),{startRouteLoad:W,endRouteLoad:Y,getPerformanceReport:H,clearPerformanceData:B}=function(){let[e,t]=(0,l.useState)({}),s=(0,l.useCallback)(e=>performance.now(),[]);return{startRouteLoad:s,endRouteLoad:(0,l.useCallback)(function(e,s,a,l){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=l?performance.now()-l:0;t(t=>{let a=t[e]||{accessCount:0,errorCount:0,totalLoadTime:0,averageLoadTime:0,lastAccessed:new Date().toISOString()},l={...a,accessCount:a.accessCount+1,errorCount:s?a.errorCount:a.errorCount+1,totalLoadTime:a.totalLoadTime+(n?0:r),averageLoadTime:n?a.averageLoadTime:(a.totalLoadTime+r)/(a.accessCount+1),lastAccessed:new Date().toISOString()};return{...t,[e]:l}})},[]),getPerformanceReport:(0,l.useCallback)(()=>{let t=Object.keys(e);if(0===t.length)return{totalRoutes:0,totalAccesses:0,totalErrors:0,averageLoadTime:0,mostAccessed:null,mostErrors:null,routeStats:{}};let s=0,a=0,l=0,n=t[0],r=t[0];return t.forEach(t=>{let i=e[t];s+=i.accessCount,a+=i.errorCount,l+=i.totalLoadTime,i.accessCount>e[n].accessCount&&(n=t),i.errorCount>e[r].errorCount&&(r=t)}),{totalRoutes:t.length,totalAccesses:s,totalErrors:a,averageLoadTime:l/s,mostAccessed:{path:n,...e[n]},mostErrors:{path:r,...e[r]},routeStats:e}},[e]),clearPerformanceData:(0,l.useCallback)(()=>{t({})},[])}}(),{preheatRoute:K,preheatRoutes:V,isRoutePreheated:U,getPreheatStatus:q,getRoutePriority:J}=x(),{saveParams:$,getParams:X,clearParams:Q}=function(){let[e,t]=(0,l.useState)({});(0,l.useEffect)(()=>{try{let e=localStorage.getItem(f);e&&t(JSON.parse(e))}catch(e){console.error("Failed to load route params:",e)}},[]);let s=(0,l.useCallback)(e=>{try{localStorage.setItem(f,JSON.stringify(e))}catch(e){console.error("Failed to save route params:",e)}},[]);return{saveParams:(0,l.useCallback)((e,a)=>{t(t=>{let l={...t,[e]:a};return s(l),l})},[s]),getParams:(0,l.useCallback)(t=>e[t],[e]),clearParams:(0,l.useCallback)(e=>{e?t(t=>{let{[e]:a,...l}=t;return s(l),l}):(t({}),localStorage.removeItem(f))},[s])}}(),ee=(0,l.useCallback)(()=>{let e={};return m.forEach((t,s)=>{"page"===s||"limit"===s?e[s]=parseInt(t):e[s]=t}),e},[m]),et=e=>{let t=new URLSearchParams;return Object.entries(e).forEach(e=>{let[s,a]=e;null!=a&&t.append(s,String(a))}),t.toString()},es=(0,l.useCallback)(e=>null==y||!y.validateParams||y.validateParams(e),[y]),ea=(0,l.useCallback)(e=>{let t={...N,...e};if(es(t)){let e=et(t);s.push("".concat(u).concat(e?"?".concat(e):"")),b(t),u&&$(u,t)}},[N,u,s,es,$]);(0,l.useEffect)(()=>{let e=ee();if(Object.keys(e).length>0)b(e),u&&$(u,e);else if(u){let e=X(u);e&&Object.keys(e).length>0&&ea(e)}},[u,ee,X,$,ea]);let el=(0,l.useCallback)(()=>{u&&(Q(u),b({}),s.push(u))},[u,s,Q]),en=(0,l.useCallback)(async()=>{if(g){A(!0);try{let e=await (0,c.Io)("/routes/user/routes");C(e.data)}catch(e){console.error("获取用户路由失败:",e)}finally{A(!1)}}},[g]),er=(0,l.useCallback)(async e=>{if(g){P(!0);try{let t=await (0,c.Io)("/routes/family/".concat(e,"/routes"));S(t.data)}catch(e){console.error("获取家庭路由失败:",e)}finally{P(!1)}}},[g]);(0,l.useEffect)(()=>{g&&en()},[g,en]),(0,l.useEffect)(()=>{(null==g?void 0:g.currentFamilyId)&&er(g.currentFamilyId)},[null==g?void 0:g.currentFamilyId,er]);let ei=(0,l.useCallback)(async e=>{if(g)try{let t=await (0,c.Io)("/api/routes",{method:"POST",body:JSON.stringify(e)});return e.family_id?er(e.family_id):en(),L("路由创建成功","success"),t.data.id}catch(e){console.error("创建路由失败:",e),L("创建路由失败","error")}},[g,er,en,L]),ec=(0,l.useCallback)(async e=>{let{id:t,data:s}=e;if(g)try{await (0,c.Io)("/api/routes/".concat(t),{method:"PUT",body:JSON.stringify(s)}),en(),g.currentFamilyId&&er(g.currentFamilyId)}catch(e){throw console.error("更新路由失败:",e),e}},[g,en,er]),eo=(0,l.useCallback)(async e=>{if(g)try{await (0,c.Io)("/api/routes/".concat(e),{method:"DELETE"}),en(),g.currentFamilyId&&er(g.currentFamilyId)}catch(e){throw console.error("删除路由失败:",e),e}},[g,en,er]),ed=(0,l.useCallback)(()=>[{key:i.wI.PUBLIC,label:"公开"},{key:i.wI.PRIVATE,label:"私有"},{key:i.wI.FAMILY,label:"家庭"},{key:i.wI.ADMIN,label:"管理员"}],[]),eu=e=>(0,d.AW)(e.type,e.permission,null==g?void 0:g.id,null==g?void 0:g.currentFamilyId);(0,l.useEffect)(()=>{y&&V([...w,...k].filter(e=>e.type===y.type&&(!y.id||e.id!==y.id)))},[y,w,k,V]);let em=(0,l.useCallback)(async(e,t)=>{let a=[...w,...k].find(t=>t.path===e);if(a&&!eu(a)){p.Am.error("无权访问该路由");return}try{let l=W(e),n=Z(e);if(n){v(n),O(n),s.push("".concat(e).concat(t?et(t):"")),t&&b(t),Y(e,!0,void 0,l,!0);return}if(U(e)){a&&(E(a),v(a),O(a)),s.push("".concat(e).concat(t?et(t):"")),t&&b(t),Y(e,!0,void 0,l,!1);return}s.push("".concat(e).concat(t?et(t):"")),t&&b(t),a&&(await K(a),E(a),v(a),O(a)),Y(e,!0,void 0,l,!1)}catch(t){console.error("导航失败:",t),Y(e,!1,t),p.Am.error("导航失败")}},[s,w,k,eu,W,Y,Z,U,K,E,O,et]),ex=(0,l.useCallback)(async()=>{let e=R();e&&await em(e.path,e.params||{})},[R,em]),eh=(0,l.useCallback)(async()=>{let e=D();e&&await em(e.path,e.params||{})},[D,em]);(0,l.useEffect)(()=>{let e=setInterval(F,6e4);return()=>clearInterval(e)},[F]);let ef=(0,l.useCallback)(()=>{let e=H(),{preheated:t,preheating:s}=q();return{...e,cacheHitRate:0,preheatingStatus:{total:s.length+t.length,completed:t.length}}},[H,q]);return(0,a.jsx)(j.Provider,{value:{currentRoute:y,params:N,userRoutes:w,familyRoutes:k,isLoadingUserRoutes:z,isLoadingFamilyRoutes:I,fetchUserRoutes:en,fetchFamilyRoutes:er,createRoute:ei,updateRoute:ec,deleteRoute:eo,getPermissionOptions:ed,navigateToRoute:em,checkAccess:eu,handleGoBack:ex,handleGoForward:eh,getHistorySummary:G,getPerformanceReport:ef,getCacheStats:()=>({totalSize:0,itemCount:0,maxSize:0,usage:0}),getPreheatStatus:q,updateParams:ea,validateParams:es,clearPerformanceData:B,resetParams:el},children:t})}function y(e){let{children:t}=e;return(0,a.jsx)(l.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading routes..."}),children:(0,a.jsx)(g,{children:t})})}function v(){let e=(0,l.useContext)(j);if(!e)throw Error("useRoute must be used within a RouteProvider");return e}},41310:function(e,t,s){s.d(t,{p:function(){return l}});var a=s(10963);function l(){return{showToast:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",s={duration:3e3,style:{padding:"16px",borderRadius:"8px"}};switch(t){case"success":a.Am.success(e,s);break;case"error":a.Am.error(e,s);break;case"warning":(0,a.Am)(e,{...s,icon:"⚠️"});break;default:(0,a.Am)(e,{...s,icon:"ℹ️"})}}}}}}]);