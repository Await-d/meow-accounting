(()=>{var e={};e.id=6133,e.ids=[6133,366],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39468:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>o,routeModule:()=>x,tree:()=>d});var t=a(50482),r=a(69108),l=a(62563),n=a.n(l),i=a(68300),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);a.d(s,c);let d=["",{children:["settings",{children:["category",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,12318)),"/home/runner/work/meow-accounting/meow-accounting/frontend/src/app/settings/category/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,37384)),"/home/runner/work/meow-accounting/meow-accounting/frontend/src/app/settings/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,66053)),"/home/runner/work/meow-accounting/meow-accounting/frontend/src/app/layout.tsx"],error:[()=>Promise.resolve().then(a.bind(a,24117)),"/home/runner/work/meow-accounting/meow-accounting/frontend/src/app/error.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,69361,23)),"next/dist/client/components/not-found-error"]}],o=["/home/runner/work/meow-accounting/meow-accounting/frontend/src/app/settings/category/page.tsx"],m="/settings/category/page",u={require:a,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/settings/category/page",pathname:"/settings/category",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},60088:(e,s,a)=>{Promise.resolve().then(a.bind(a,46056))},27661:(e,s,a)=>{Promise.resolve().then(a.bind(a,70366))},99046:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(97075).Z)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]])},37121:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(97075).Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},2273:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(97075).Z)("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]])},13746:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(97075).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},23485:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(97075).Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},54052:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(97075).Z)("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]])},89895:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(97075).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},46056:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>z});var t=a(95344),r=a(3729),l=a(80089),n=a(44738),i=a(56686),c=a(40237),d=a(16),o=a(44360),m=a(98400),u=a(20516),x=a(61387),h=a(3394),f=a(52914),p=a(1629),j=a(70596),y=a(81686),g=a(26417),b=a(97446),N=a(41931),v=a(75462),w=a(98138),k=a(3594),P=a(33759);let q=r.forwardRef(function({title:e,titleId:s,...a},t){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},a),e?r.createElement("title",{id:s},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859m-19.5.338V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H6.911a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661Z"}))});var Z=a(61561),E=a(89023),I=a(30853),C=a(65004);let A=r.forwardRef(function({title:e,titleId:s,...a},t){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},a),e?r.createElement("title",{id:s},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"}))});var _=a(25384),L=a(56506);function z(){let{categories:e,isLoading:s,error:a}=(0,Z.L)(),z=e.filter(e=>e.is_default),S=e.filter(e=>!e.is_default),$=async e=>{},R=async e=>{},M=async e=>{},[T,F]=(0,r.useState)(!1),[O,K]=(0,r.useState)(!1),[D,X]=(0,r.useState)(null),[G,Q]=(0,r.useState)({name:"",icon:"",type:"expense"}),{showToast:H}=(0,E.useToast)(),{user:J,isGuest:V}=(0,I.useAuth)(),{families:W=[],currentFamily:Y,setCurrentFamily:B}=(0,_.cW)(),U=(0,r.useMemo)(()=>!!J&&("admin"===J.role||"owner"===J.role),[J]),ee=(0,r.useMemo)(()=>[{key:"icon",label:"图标"},{key:"name",label:"名称"},{key:"type",label:"类型"},{key:"actions",label:"操作"}],[U]),es=(0,r.useMemo)(()=>[{key:"icon",label:"图标"},{key:"name",label:"名称"},{key:"type",label:"类型"},{key:"actions",label:"操作"}],[]);console.log("分类数据:",e),console.log("默认分类:",z),console.log("自定义分类:",S),console.log("用户信息:",J);let ea=()=>{if(!G.name||!G.icon||!G.type){H("请填写完整信息","error");return}if(D){if(D.is_default&&!U){H("只有管理员可以修改默认分类","error");return}R({...D,name:G.name,icon:G.icon,type:G.type})}else{if(!Y&&!G.is_default){H("请先选择一个家庭","error");return}if(G.is_default&&!U){H("只有管理员可以创建默认分类","error");return}G.name&&G.icon&&G.type?$({name:G.name,icon:G.icon,type:G.type,is_default:G.is_default||!1}):H("请填写完整信息","error")}F(!1),X(null),Q({name:"",icon:"",type:"expense"})},et=e=>{if(console.log("handleEdit被调用，category:",e),V){H("访客模式下无法编辑","error");return}if(e.is_default&&!U){H("只有管理员可以修改默认分类","error");return}X(e),Q(e),console.log("准备打开模态框"),F(!0),console.log("模态框应该已打开")},er=e=>{if(console.log("handleDelete被调用，category:",e),V){H("访客模式下无法删除","error");return}if(e.is_default&&!U){H("只有管理员可以删除默认分类","error");return}X(e),K(!0)},el=()=>{D&&M("string"==typeof D.id?parseInt(D.id):D.id),K(!1),X(null)},en=(e,s)=>{switch(s){case"icon":return t.jsx("div",{className:"text-xl",children:e.icon});case"name":return t.jsx("div",{className:"font-medium",children:e.name});case"type":return t.jsx(l.z,{color:"expense"===e.type?"danger":"success",variant:"flat",size:"sm",className:"capitalize",children:"expense"===e.type?"支出":"收入"});case"actions":if(!U)return null;return(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx(n.A,{isIconOnly:!0,size:"sm",variant:"light",color:"primary",onPress:()=>et(e),className:"rounded-full",children:t.jsx(w.Z,{className:"h-4 w-4"})}),t.jsx(n.A,{isIconOnly:!0,size:"sm",color:"danger",variant:"light",onPress:()=>er(e),className:"rounded-full",children:t.jsx(k.Z,{className:"h-4 w-4"})})]});default:return null}},ei=(e,s)=>{switch(s){case"icon":return t.jsx("div",{className:"text-xl",children:e.icon});case"name":return t.jsx("div",{className:"font-medium",children:e.name});case"type":return t.jsx(l.z,{color:"expense"===e.type?"danger":"success",variant:"flat",size:"sm",className:"capitalize",children:"expense"===e.type?"支出":"收入"});case"actions":return(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx(n.A,{isIconOnly:!0,size:"sm",variant:"light",color:"primary",onPress:()=>et(e),isDisabled:V,className:"rounded-full",children:t.jsx(w.Z,{className:"h-4 w-4"})}),t.jsx(n.A,{isIconOnly:!0,size:"sm",color:"danger",variant:"light",onPress:()=>er(e),isDisabled:V,className:"rounded-full",children:t.jsx(k.Z,{className:"h-4 w-4"})})]});default:return null}},ec=()=>{console.log("handleAddDefaultCategory被调用"),X(null),Q({name:"",icon:"",type:"expense",is_default:!0}),F(!0)};return s?t.jsx("div",{className:"w-full",children:t.jsx("div",{className:"p-4",children:t.jsx(C.Z,{})})}):a?t.jsx("div",{className:"w-full p-4",children:t.jsx(i.w,{children:(0,t.jsxs)(c.G,{className:"flex flex-col items-center justify-center gap-4 py-8",children:[t.jsx("div",{className:"text-danger text-4xl",children:t.jsx(A,{className:"h-12 w-12"})}),t.jsx("h3",{className:"text-xl font-semibold",children:"加载失败"}),t.jsx("p",{className:"text-default-500",children:a instanceof Error?a.message:"获取分类数据失败，请稍后重试"}),t.jsx(n.A,{color:"primary",onPress:()=>window.location.reload(),children:"重新加载"})]})})}):Y?(0,t.jsxs)("div",{className:"space-y-8 max-w-6xl mx-auto",children:[t.jsx(i.w,{className:"shadow-sm hover:shadow-md transition-shadow duration-200",children:t.jsx(c.G,{className:"p-6",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,t.jsxs)("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-primary",children:"当前家庭"}),t.jsx("p",{className:"text-default-500 mt-1",children:Y.name})]}),t.jsx(d.g,{label:"切换家庭",selectedKeys:[Y.id.toString()],className:"max-w-xs w-full",size:"sm",onChange:e=>{let s=parseInt(e.target.value),a=W.find(e=>e.id===s);a&&(B(a),H("已切换到家庭: "+a.name,"success"))},children:W.map(e=>t.jsx(o.R,{value:e.id,children:e.name},e.id))})]})})}),t.jsx(i.w,{className:"shadow-sm hover:shadow-md transition-shadow duration-200",children:(0,t.jsxs)(c.G,{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[(0,t.jsxs)("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-primary",children:"自定义分类"}),(0,t.jsxs)("p",{className:"text-sm text-default-500 mt-1",children:[Y.name," 家庭的自定义分类"]})]}),t.jsx(n.A,{color:"primary",startContent:t.jsx(P.Z,{className:"h-5 w-5"}),onPress:()=>{if(!Y){H("请先选择一个家庭","error");return}X(null),Q({name:"",icon:"",type:"expense"}),F(!0)},isDisabled:V,size:"md",className:"min-w-[140px]",children:"添加分类"})]}),S.length>0?t.jsx("div",{className:"overflow-x-auto",children:(0,t.jsxs)(m.b,{"aria-label":"自定义分类列表",classNames:{base:"min-w-full",table:"min-w-full",thead:"bg-default-50",th:"text-default-700 font-semibold",tr:"hover:bg-default-50 transition-colors border-b border-default-100"},children:[t.jsx(u.J,{children:es.map(e=>t.jsx(x.j,{className:"text-sm",children:e.label},e.key))}),t.jsx(h.y,{items:S,emptyContent:"暂无自定义分类",children:e=>t.jsx(f.g,{className:"h-14",children:es.map(s=>t.jsx(p.X,{children:ei(e,s.key)},s.key))},e.id)})]})}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center bg-default-50 rounded-lg",children:[t.jsx("div",{className:"text-default-300 mb-4",children:t.jsx(q,{className:"h-16 w-16"})}),t.jsx("p",{className:"text-default-600 font-medium mb-2",children:"暂无自定义分类"}),t.jsx("p",{className:"text-default-400 text-sm",children:'点击上方"添加分类"按钮创建'})]})]})}),t.jsx(i.w,{className:"shadow-sm hover:shadow-md transition-shadow duration-200",children:(0,t.jsxs)(c.G,{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[(0,t.jsxs)("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-primary",children:"默认分类"}),(0,t.jsxs)("p",{className:"text-sm text-default-500 mt-1",children:["系统预设的分类",U?"，管理员可以修改":""]})]}),U&&t.jsx(n.A,{color:"primary",startContent:t.jsx(P.Z,{className:"h-5 w-5"}),onPress:ec,isDisabled:V,size:"md",className:"min-w-[140px]",children:"添加默认分类"})]}),z.length>0?t.jsx("div",{className:"overflow-x-auto",children:(0,t.jsxs)(m.b,{"aria-label":"默认分类列表",classNames:{base:"min-w-full",table:"min-w-full",thead:"bg-default-50",th:"text-default-700 font-semibold",tr:"hover:bg-default-50 transition-colors border-b border-default-100"},children:[t.jsx(u.J,{children:ee.map(e=>t.jsx(x.j,{className:"text-sm",children:e.label},e.key))}),t.jsx(h.y,{items:z,emptyContent:"暂无默认分类",children:e=>t.jsx(f.g,{className:"h-14",children:ee.map(s=>t.jsx(p.X,{children:en(e,s.key)},s.key))},e.id)})]})}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center bg-default-50 rounded-lg",children:[t.jsx("div",{className:"text-default-300 mb-4",children:t.jsx(q,{className:"h-16 w-16"})}),t.jsx("p",{className:"text-default-600 font-medium mb-2",children:"暂无默认分类"}),U&&t.jsx("p",{className:"text-default-400 text-sm",children:'点击上方"添加默认分类"按钮创建'})]})]})}),t.jsx(j.R,{isOpen:T,onClose:()=>F(!1),classNames:{base:"max-w-md mx-auto",header:"border-b border-default-100 pb-2",body:"py-6",footer:"border-t border-default-100 pt-2"},backdrop:"blur",children:(0,t.jsxs)(y.A,{children:[(0,t.jsxs)(g.k,{className:"flex flex-col gap-1",children:[t.jsx("h3",{className:"text-xl font-bold",children:D?"编辑分类":"添加分类"}),t.jsx("p",{className:"text-sm text-default-500",children:D?"修改分类信息":"创建新的分类"})]}),t.jsx(b.I,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[t.jsx(N.Y,{label:"名称",placeholder:"请输入分类名称",value:G.name,onChange:e=>Q({...G,name:e.target.value}),variant:"bordered",labelPlacement:"outside",isRequired:!0,startContent:t.jsx("div",{className:"pointer-events-none flex items-center",children:t.jsx("span",{className:"text-default-400 text-sm",children:"名称"})})}),t.jsx(N.Y,{label:"图标",placeholder:"请输入分类图标",value:G.icon,onChange:e=>Q({...G,icon:e.target.value}),variant:"bordered",labelPlacement:"outside",isRequired:!0,startContent:t.jsx("div",{className:"pointer-events-none flex items-center",children:t.jsx("span",{className:"text-default-400 text-sm",children:"图标"})})}),(0,t.jsxs)(d.g,{label:"类型",selectedKeys:G.type?[G.type]:[],onChange:e=>Q({...G,type:e.target.value}),variant:"bordered",labelPlacement:"outside",isRequired:!0,children:[t.jsx(o.R,{value:"expense",children:"支出"},"expense"),t.jsx(o.R,{value:"income",children:"收入"},"income")]})]})}),(0,t.jsxs)(v.R,{children:[t.jsx(n.A,{variant:"bordered",onPress:()=>F(!1),className:"min-w-[80px]",children:"取消"}),t.jsx(n.A,{color:"primary",onPress:ea,className:"min-w-[80px]",children:"确定"})]})]})}),t.jsx(j.R,{isOpen:O,onClose:()=>K(!1),classNames:{base:"max-w-md mx-auto",header:"border-b border-default-100 pb-2",body:"py-6",footer:"border-t border-default-100 pt-2"},backdrop:"blur",children:(0,t.jsxs)(y.A,{children:[(0,t.jsxs)(g.k,{className:"flex flex-col gap-1",children:[t.jsx("h3",{className:"text-xl font-bold",children:"确认删除"}),t.jsx("p",{className:"text-sm text-default-500",children:"此操作不可撤销"})]}),(0,t.jsxs)(b.I,{children:[t.jsx("div",{className:"flex items-center justify-center py-4",children:t.jsx("div",{className:"bg-danger-50 p-4 rounded-full mb-4",children:t.jsx(k.Z,{className:"h-8 w-8 text-danger"})})}),(0,t.jsxs)("p",{className:"text-center",children:["确定要删除 ",t.jsx("span",{className:"font-bold",children:D?.name})," 分类吗？"]}),t.jsx("p",{className:"text-center text-default-500 text-sm mt-2",children:"删除后无法恢复，相关的交易记录将失去分类关联。"})]}),(0,t.jsxs)(v.R,{children:[t.jsx(n.A,{variant:"bordered",onPress:()=>K(!1),className:"min-w-[80px]",children:"取消"}),t.jsx(n.A,{color:"danger",onPress:el,className:"min-w-[80px]",children:"删除"})]})]})})]}):(0,t.jsxs)("div",{className:"w-full space-y-8 max-w-6xl mx-auto",children:[t.jsx(i.w,{className:"shadow-sm hover:shadow-md transition-shadow duration-200",children:(0,t.jsxs)(c.G,{className:"flex flex-col items-center justify-center py-10 text-center",children:[t.jsx("div",{className:"text-warning mb-6",children:t.jsx(A,{className:"h-16 w-16"})}),t.jsx("h3",{className:"text-2xl font-bold mb-3",children:"请选择一个家庭"}),t.jsx("p",{className:"text-default-500 mb-8 max-w-md",children:"您需要选择一个家庭才能管理自定义分类。自定义分类将与您选择的家庭关联。"}),W.length>0?(0,t.jsxs)("div",{className:"max-w-xs w-full",children:[t.jsx(d.g,{label:"选择家庭",placeholder:"请选择一个家庭",className:"w-full mb-4",size:"lg",onChange:e=>{let s=parseInt(e.target.value),a=W.find(e=>e.id===s);a&&(B(a),H("已切换到家庭: "+a.name,"success"))},children:W.map(e=>t.jsx(o.R,{value:e.id,children:e.name},e.id))}),t.jsx("p",{className:"text-sm text-default-400",children:"选择一个家庭后，您可以管理该家庭的自定义分类"})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[t.jsx("p",{className:"text-default-500 mb-4",children:"您还没有创建任何家庭"}),t.jsx(n.A,{color:"primary",as:L.default,href:"/settings/family",size:"lg",children:"创建家庭"})]})]})}),t.jsx(i.w,{className:"shadow-sm hover:shadow-md transition-shadow duration-200",children:(0,t.jsxs)(c.G,{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[(0,t.jsxs)("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-primary",children:"默认分类"}),(0,t.jsxs)("p",{className:"text-sm text-default-500 mt-1",children:["系统预设的分类",U?"，管理员可以修改":""]})]}),U&&t.jsx(n.A,{color:"primary",startContent:t.jsx(P.Z,{className:"h-5 w-5"}),onPress:ec,isDisabled:V,size:"md",className:"min-w-[140px]",children:"添加默认分类"})]}),z.length>0?t.jsx("div",{className:"overflow-x-auto",children:(0,t.jsxs)(m.b,{"aria-label":"默认分类列表",classNames:{base:"min-w-full",table:"min-w-full",thead:"bg-default-50",th:"text-default-700 font-semibold",tr:"hover:bg-default-50 transition-colors border-b border-default-100"},children:[t.jsx(u.J,{children:ee.map(e=>t.jsx(x.j,{className:"text-sm",children:e.label},e.key))}),t.jsx(h.y,{items:z,emptyContent:"暂无默认分类",children:e=>t.jsx(f.g,{className:"h-14",children:ee.map(s=>t.jsx(p.X,{children:en(e,s.key)},s.key))},e.id)})]})}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center bg-default-50 rounded-lg",children:[t.jsx("div",{className:"text-default-300 mb-4",children:t.jsx(q,{className:"h-16 w-16"})}),t.jsx("p",{className:"text-default-600 font-medium mb-2",children:"暂无默认分类"}),U&&t.jsx("p",{className:"text-default-400 text-sm",children:'点击上方"添加默认分类"按钮创建'})]})]})}),t.jsx(j.R,{isOpen:T,onClose:()=>F(!1),classNames:{base:"max-w-md mx-auto",header:"border-b border-default-100 pb-2",body:"py-6",footer:"border-t border-default-100 pt-2"},backdrop:"blur",children:(0,t.jsxs)(y.A,{children:[(0,t.jsxs)(g.k,{className:"flex flex-col gap-1",children:[t.jsx("h3",{className:"text-xl font-bold",children:D?"编辑分类":"添加分类"}),t.jsx("p",{className:"text-sm text-default-500",children:D?"修改分类信息":"创建新的分类"})]}),t.jsx(b.I,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[t.jsx(N.Y,{label:"名称",placeholder:"请输入分类名称",value:G.name,onChange:e=>Q({...G,name:e.target.value}),variant:"bordered",labelPlacement:"outside",isRequired:!0,startContent:t.jsx("div",{className:"pointer-events-none flex items-center",children:t.jsx("span",{className:"text-default-400 text-sm",children:"名称"})})}),t.jsx(N.Y,{label:"图标",placeholder:"请输入分类图标",value:G.icon,onChange:e=>Q({...G,icon:e.target.value}),variant:"bordered",labelPlacement:"outside",isRequired:!0,startContent:t.jsx("div",{className:"pointer-events-none flex items-center",children:t.jsx("span",{className:"text-default-400 text-sm",children:"图标"})})}),(0,t.jsxs)(d.g,{label:"类型",selectedKeys:G.type?[G.type]:[],onChange:e=>Q({...G,type:e.target.value}),variant:"bordered",labelPlacement:"outside",isRequired:!0,children:[t.jsx(o.R,{value:"expense",children:"支出"},"expense"),t.jsx(o.R,{value:"income",children:"收入"},"income")]})]})}),(0,t.jsxs)(v.R,{children:[t.jsx(n.A,{variant:"bordered",onPress:()=>F(!1),className:"min-w-[80px]",children:"取消"}),t.jsx(n.A,{color:"primary",onPress:ea,className:"min-w-[80px]",children:"确定"})]})]})}),t.jsx(j.R,{isOpen:O,onClose:()=>K(!1),classNames:{base:"max-w-md mx-auto",header:"border-b border-default-100 pb-2",body:"py-6",footer:"border-t border-default-100 pt-2"},backdrop:"blur",children:(0,t.jsxs)(y.A,{children:[(0,t.jsxs)(g.k,{className:"flex flex-col gap-1",children:[t.jsx("h3",{className:"text-xl font-bold",children:"确认删除"}),t.jsx("p",{className:"text-sm text-default-500",children:"此操作不可撤销"})]}),(0,t.jsxs)(b.I,{children:[t.jsx("div",{className:"flex items-center justify-center py-4",children:t.jsx("div",{className:"bg-danger-50 p-4 rounded-full mb-4",children:t.jsx(k.Z,{className:"h-8 w-8 text-danger"})})}),(0,t.jsxs)("p",{className:"text-center",children:["确定要删除 ",t.jsx("span",{className:"font-bold",children:D?.name})," 分类吗？"]}),t.jsx("p",{className:"text-center text-default-500 text-sm mt-2",children:"删除后无法恢复，相关的交易记录将失去分类关联。"})]}),(0,t.jsxs)(v.R,{children:[t.jsx(n.A,{variant:"bordered",onPress:()=>K(!1),className:"min-w-[80px]",children:"取消"}),t.jsx(n.A,{color:"danger",onPress:el,className:"min-w-[80px]",children:"删除"})]})]})})]})}},70366:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>p});var t=a(95344);a(3729);var r=a(8428),l=a(56506),n=a(56686),i=a(2273),c=a(89895),d=a(54052),o=a(99046),m=a(37121),u=a(23485),x=a(13746),h=a(91529);let f=[{name:"系统设置",href:"/settings/system",icon:t.jsx(i.Z,{size:20})},{name:"用户管理",href:"/settings/users",icon:t.jsx(c.Z,{size:20})},{name:"家庭管理",href:"/settings/family",icon:t.jsx(d.Z,{size:20})},{name:"分类管理",href:"/settings/category",icon:t.jsx(o.Z,{size:20})},{name:"系统日志",href:"/settings/logs",icon:t.jsx(m.Z,{size:20})},{name:"备份恢复",href:"/settings/backup",icon:t.jsx(u.Z,{size:20})}];function p({children:e}){let s=(0,r.usePathname)();return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background to-default-100",children:t.jsx("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)("div",{className:"flex gap-6",children:[(0,t.jsxs)(n.w,{className:"w-64 h-fit p-2 shrink-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 p-4 mb-2",children:[t.jsx(h.E.div,{animate:{rotate:[0,15,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:t.jsx(x.Z,{size:24,className:"text-primary"})}),t.jsx("h2",{className:"text-xl font-bold",children:"后台管理"})]}),t.jsx("nav",{children:f.map(e=>{let a=s===e.href;return(0,t.jsxs)(l.default,{href:e.href,className:`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${a?"bg-primary text-white":"hover:bg-default-100"}`,children:[e.icon,t.jsx("span",{children:e.name})]},e.href)})})]}),t.jsx(n.w,{className:"flex-1 p-6",children:e})]})})})}},65004:(e,s,a)=>{"use strict";a.d(s,{Z:()=>i});var t=a(95344),r=a(56686),l=a(40237),n=a(41501);function i({type:e="transaction",className:s=""}){return"statistics"===e?t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(e=>t.jsx(r.w,{className:"w-full",children:(0,t.jsxs)(l.G,{className:"space-y-3",children:[t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-3 w-3/4 rounded-lg bg-default-200"})}),t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-6 w-2/3 rounded-lg bg-default-200"})})]})},e))}):"category"===e?t.jsx(r.w,{className:"w-full",children:(0,t.jsxs)(l.G,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-6 w-32 rounded-lg bg-default-200"})}),t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-8 w-48 rounded-lg bg-default-200"})})]}),t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-[300px] w-full rounded-lg bg-default-200"})}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(e=>t.jsx(r.w,{className:"w-full",children:(0,t.jsxs)(l.G,{className:"space-y-2",children:[t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-3 w-3/4 rounded-lg bg-default-200"})}),t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-5 w-2/3 rounded-lg bg-default-200"})})]})},e))})]})}):"table"===e?(0,t.jsxs)("div",{className:`space-y-3 ${s}`,children:[t.jsx("div",{className:"flex space-x-2 mb-4",children:[1,2,3,4].map(e=>t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-8 w-24 rounded-lg bg-default-200"})},e))}),[1,2,3,4,5].map(e=>t.jsx("div",{className:"flex space-x-4 items-center",children:t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-10 w-full rounded-lg bg-default-200"})})},e))]}):t.jsx("div",{className:`space-y-3 ${s}`,children:[1,2,3,4,5].map(e=>t.jsx(r.w,{className:"w-full",children:t.jsx(l.G,{children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-3 w-24 rounded-lg bg-default-200"})}),t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-3 w-32 rounded-lg bg-default-200"})})]}),t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-6 w-20 rounded-lg bg-default-200"})})]})})},e))})}},61561:(e,s,a)=>{"use strict";a.d(s,{L:()=>n});var t=a(3729),r=a(96548),l=a(30853);function n(){let[e,s]=(0,t.useState)([]),[a,n]=(0,t.useState)(!0),[i,c]=(0,t.useState)(null),{user:d}=(0,l.useAuth)(),o=(0,t.useRef)(!1);return(0,t.useEffect)(()=>{d&&(o.current=!1);let e=async()=>{if(!o.current||!i)try{n(!0);let e="/categories";d?.currentFamilyId?e+=`?familyId=${d.currentFamilyId}`:d?.id&&(e+=`?userId=${d.id}`);let a=await (0,r.Io)(e);s(a.data),c(null)}catch(e){console.error("获取分类失败",e),c(e),s([]),o.current=!0}finally{n(!1)}};d?e():(s([]),n(!1))},[d]),{categories:e,isLoading:a,error:i}}},25384:(e,s,a)=>{"use strict";a.d(s,{Hc:()=>f,Oh:()=>h,X$:()=>g,YF:()=>x,ao:()=>y,cW:()=>o,kN:()=>j,l0:()=>m,t3:()=>p,vP:()=>u});var t=a(26274),r=a(81271),l=a(31296),n=a(3729),i=a(96548),c=a(89023),d=a(30853);function o(){let{user:e,updateUser:s}=(0,d.useAuth)(),a=(0,t.NL)(),{showToast:l}=(0,c.useToast)(),[o,m]=(0,n.useState)([]),u=(0,n.useRef)(!1),{data:x,isLoading:h,error:f}=(0,r.a)({queryKey:["families"],queryFn:async()=>{try{let e=await (0,i.Io)("/families/user");return u.current=!1,e.data}catch(e){throw console.error("获取家庭列表失败:",e),u.current=!0,e}},enabled:!!e,staleTime:3e5,retry:u.current?0:2}),p=x?.find(s=>s.id===e?.currentFamilyId),{data:j,isLoading:y,error:g}=(0,r.a)({queryKey:["familyMembers",e?.currentFamilyId],queryFn:async()=>(await (0,i.Io)(`/families/${e?.currentFamilyId}/members`)).data,enabled:!!e?.currentFamilyId&&!u.current,staleTime:3e5,gcTime:3e5,retry:1});(0,n.useEffect)(()=>{f&&console.error("获取家庭列表失败:",f)},[f]),(0,n.useEffect)(()=>{g&&console.error("获取家庭成员失败:",g)},[g]);let b=(0,n.useCallback)(t=>{e&&(s({...e,currentFamilyId:t.id}),a.invalidateQueries({queryKey:["familyMembers"]}),a.invalidateQueries({queryKey:["transactions"]}),a.invalidateQueries({queryKey:["categories"]}),a.invalidateQueries({queryKey:["statistics"]}),a.invalidateQueries({queryKey:["categoryStats"]}),a.invalidateQueries({queryKey:["recentTransactions"]}),localStorage.setItem("currentFamilyId",t.id.toString()))},[e,s,a]),N=(0,n.useCallback)(()=>p?.owner_id===e?.id||j?.some(s=>s.user_id===e?.id&&"admin"===s.role),[p,e,j]);return{families:x,members:j||o,currentFamily:p,isLoading:h||y,error:f,setCurrentFamily:b,isAdmin:N}}function m(){let e=(0,t.NL)(),{showToast:s}=(0,c.useToast)();return(0,l.D)({mutationFn:async e=>(await (0,i.Io)("/families",{method:"POST",body:JSON.stringify(e)})).data,onSuccess:()=>{s("家庭创建成功","success"),e.invalidateQueries({queryKey:["families"]})},onError:e=>{s(`创建失败: ${e.message}`,"error")}})}function u(){let e=(0,t.NL)(),{showToast:s}=(0,c.useToast)();return(0,l.D)({mutationFn:async({familyId:e,data:s})=>(await (0,i.Io)(`/families/${e}`,{method:"PATCH",body:JSON.stringify(s)})).data,onSuccess:()=>{s("家庭信息已更新","success"),e.invalidateQueries({queryKey:["families"]})},onError:e=>{s(`更新失败: ${e.message}`,"error")}})}function x(){let e=(0,t.NL)(),{showToast:s}=(0,c.useToast)();return(0,l.D)({mutationFn:async e=>{await (0,i.Io)(`/families/${e}`,{method:"DELETE"})},onSuccess:()=>{s("家庭已删除","success"),e.invalidateQueries({queryKey:["families"]})},onError:e=>{s(`删除失败: ${e.message}`,"error")}})}function h(){let e=(0,t.NL)(),{showToast:s}=(0,c.useToast)();return(0,l.D)({mutationFn:async({familyId:e,data:s})=>(await (0,i.Io)(`/families/${e}/members`,{method:"POST",body:JSON.stringify(s)})).data,onSuccess:()=>{s("成员已添加","success"),e.invalidateQueries({queryKey:["family"]})},onError:e=>{s(`添加失败: ${e.message}`,"error")}})}function f(){let e=(0,t.NL)(),{showToast:s}=(0,c.useToast)();return(0,l.D)({mutationFn:async({familyId:e,memberId:s,role:a})=>(await (0,i.Io)(`/families/${e}/members/${s}`,{method:"PATCH",body:JSON.stringify({role:a})})).data,onSuccess:()=>{s("成员角色已更新","success"),e.invalidateQueries({queryKey:["family"]})},onError:e=>{s(`更新失败: ${e.message}`,"error")}})}function p(){let e=(0,t.NL)(),{showToast:s}=(0,c.useToast)();return(0,l.D)({mutationFn:async({familyId:e,memberId:s})=>{await (0,i.Io)(`/families/${e}/members/${s}`,{method:"DELETE"})},onSuccess:()=>{s("成员已移除","success"),e.invalidateQueries({queryKey:["family"]})},onError:e=>{s(`移除失败: ${e.message}`,"error")}})}function j(e){return(0,r.a)({queryKey:["familyInvitations",e],queryFn:async()=>e?(await (0,i.Io)(`/families/${e}/invitations`)).data:[],enabled:!!e})}function y(){let e=(0,t.NL)(),{showToast:s}=(0,c.useToast)();return(0,l.D)({mutationFn:async({familyId:e,invitationId:s})=>{await (0,i.Io)(`/families/${e}/invitations/${s}`,{method:"DELETE"})},onSuccess:()=>{s("邀请已删除","success"),e.invalidateQueries({queryKey:["familyInvitations"]})},onError:e=>{s(`删除失败: ${e.message}`,"error")}})}function g(e){return(0,r.a)({queryKey:["userInvitations",e],queryFn:async()=>e&&(await (0,i.Io)(`/users/${e}/invitations`)).data||[],enabled:!!e})}},12318:(e,s,a)=>{"use strict";a.r(s),a.d(s,{$$typeof:()=>l,__esModule:()=>r,default:()=>n});let t=(0,a(86843).createProxy)(String.raw`/home/runner/work/meow-accounting/meow-accounting/frontend/src/app/settings/category/page.tsx`),{__esModule:r,$$typeof:l}=t,n=t.default},37384:(e,s,a)=>{"use strict";a.r(s),a.d(s,{$$typeof:()=>l,__esModule:()=>r,default:()=>n});let t=(0,a(86843).createProxy)(String.raw`/home/runner/work/meow-accounting/meow-accounting/frontend/src/app/settings/layout.tsx`),{__esModule:r,$$typeof:l}=t,n=t.default},98138:(e,s,a)=>{"use strict";a.d(s,{Z:()=>r});var t=a(3729);let r=t.forwardRef(function({title:e,titleId:s,...a},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},a),e?t.createElement("title",{id:s},e):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))})},33759:(e,s,a)=>{"use strict";a.d(s,{Z:()=>r});var t=a(3729);let r=t.forwardRef(function({title:e,titleId:s,...a},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},a),e?t.createElement("title",{id:s},e):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))})}};var s=require("../../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),t=s.X(0,[3715,1599,8974,7279,7721,352,1327,9799,5261,3729,6536,6250,1271,7390,3751,5975,4037],()=>a(39468));module.exports=t})();