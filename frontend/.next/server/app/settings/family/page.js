(()=>{var e={};e.id=7158,e.ids=[7158],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},26341:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>n.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>o,routeModule:()=>h,tree:()=>c});var i=a(50482),r=a(69108),t=a(62563),n=a.n(t),l=a(68300),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);a.d(s,d);let c=["",{children:["settings",{children:["family",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,46409)),"/home/runner/work/meow-accounting/meow-accounting/frontend/src/app/settings/family/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,37384)),"/home/runner/work/meow-accounting/meow-accounting/frontend/src/app/settings/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,66053)),"/home/runner/work/meow-accounting/meow-accounting/frontend/src/app/layout.tsx"],error:[()=>Promise.resolve().then(a.bind(a,24117)),"/home/runner/work/meow-accounting/meow-accounting/frontend/src/app/error.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,69361,23)),"next/dist/client/components/not-found-error"]}],o=["/home/runner/work/meow-accounting/meow-accounting/frontend/src/app/settings/family/page.tsx"],m="/settings/family/page",x={require:a,loadChunk:()=>Promise.resolve()},h=new i.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/settings/family/page",pathname:"/settings/family",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},71368:(e,s,a)=>{Promise.resolve().then(a.bind(a,83066))},31498:(e,s,a)=>{"use strict";a.d(s,{Z:()=>i});let i=(0,a(97075).Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},83066:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>V});var i=a(95344),r=a(3729),t=a(78225),n=a(41501),l=a(30891),d=a(45191),c=a(56686),o=a(40237),m=a(44738),x=a(98400),h=a(20516),u=a(61387),j=a(3394),p=a(52914),f=a(1629),b=a(80089),g=a(16),N=a(44360),v=a(41931),y=a(4521),w=a(3635),P=a(70596),C=a(81686),S=a(26417),A=a(97446),k=a(75462),I=a(33759),_=a(98138),z=a(3594);let E=r.forwardRef(function({title:e,titleId:s,...a},i){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":s},a),e?r.createElement("title",{id:s},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"}))});var O=a(72416),q=a(31498),G=a(25384),L=a(89023),D=a(30853),$=a(26274),Z=a(96548),R=a(81271),X=a(31296),F=a(25581),M=a(12061);function K({isOpen:e,onClose:s,onSubmit:a,role:t,permissions:n=[],isLoading:l}){let[d,c]=(0,r.useState)({name:"",description:"",permissions:[]});(0,r.useEffect)(()=>{t?c({name:t.name,description:t.description,permissions:t.permissions.map(e=>e.code)}):c({name:"",description:"",permissions:[]})},[t]);let o=n.reduce((e,s)=>{let a=s.code.split(":")[0];return e[a]||(e[a]=[]),e[a].push(s),e},{});return i.jsx(P.R,{isOpen:e,onClose:s,size:"2xl",scrollBehavior:"inside",classNames:{base:"max-w-2xl mx-auto",header:"border-b border-default-100 pb-2",body:"py-6",footer:"border-t border-default-100 pt-2"},backdrop:"blur",children:(0,i.jsxs)(C.A,{children:[(0,i.jsxs)(S.k,{className:"flex flex-col gap-1",children:[i.jsx("h3",{className:"text-xl font-bold",children:t?"编辑角色":"创建角色"}),i.jsx("p",{className:"text-sm text-default-500",children:t?"修改角色信息和权限":"创建新的角色并设置权限"})]}),i.jsx(A.I,{children:(0,i.jsxs)("div",{className:"space-y-6",children:[i.jsx(v.Y,{label:"角色名称",placeholder:"请输入角色名称",value:d.name,onChange:e=>c({...d,name:e.target.value}),variant:"bordered",isRequired:!0,isDisabled:t?.isSystem}),i.jsx(v.Y,{label:"角色描述",placeholder:"请输入角色描述",value:d.description,onChange:e=>c({...d,description:e.target.value}),variant:"bordered",isDisabled:t?.isSystem}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"权限设置"}),i.jsx(F.o,{className:"h-[300px]",children:i.jsx("div",{className:"space-y-6",children:Object.entries(o).map(([e,s])=>(0,i.jsxs)("div",{className:"space-y-2",children:[i.jsx("h4",{className:"font-medium capitalize",children:e}),i.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.map(e=>i.jsx(M.K,{isSelected:d.permissions.includes(e.code),onValueChange:s=>{c(a=>({...a,permissions:s?[...a.permissions,e.code]:a.permissions.filter(s=>s!==e.code)}))},isDisabled:t?.isSystem,children:(0,i.jsxs)("div",{children:[i.jsx("p",{className:"text-sm",children:e.name}),i.jsx("p",{className:"text-xs text-default-500",children:e.description})]})},e.code))})]},e))})})]})]})}),(0,i.jsxs)(k.R,{children:[i.jsx(m.A,{variant:"bordered",onPress:s,className:"min-w-[80px]",children:"取消"}),i.jsx(m.A,{color:"primary",onPress:()=>{d.name&&a(d)},className:"min-w-[80px]",isLoading:l,isDisabled:!d.name||t?.isSystem,children:"确定"})]})]})})}var H=a(16512);function V(){let{families:e,members:s,isLoading:a,currentFamily:F,setCurrentFamily:M}=(0,G.cW)(),{data:V,isLoading:T}=(0,G.kN)(F?.id),{mutate:Y}=(0,G.l0)(),{mutate:B}=(0,G.vP)(),{mutate:U}=(0,G.YF)(),{mutate:J,data:Q}=(0,G.Oh)(),{mutate:W}=(0,G.Hc)(),{mutate:ee}=(0,G.t3)(),{mutate:es}=(0,G.ao)(),{isOpen:ea,onOpen:ei,onClose:er}=(0,t.q)(),{isOpen:et,onOpen:en,onClose:el}=(0,t.q)(),{isOpen:ed,onOpen:ec,onClose:eo}=(0,t.q)(),[em,ex]=(0,r.useState)(null),{settings:eh,isLoading:eu,updateSettings:ej}=function(e){let s=(0,$.NL)(),{showToast:a}=(0,L.useToast)(),{data:i,isLoading:r}=(0,R.a)({queryKey:["familySettings",e],queryFn:async()=>e?(await (0,Z.Io)(`/families/${e}/settings`)).data:null,enabled:!!e}),{mutate:t}=(0,X.D)({mutationFn:async s=>{if(!e)throw Error("No family selected");return(await (0,Z.Io)(`/families/${e}/settings`,{method:"PATCH",body:JSON.stringify(s)})).data},onSuccess:()=>{a("设置已保存","success"),s.invalidateQueries({queryKey:["familySettings",e]})},onError:e=>{a(`保存设置失败: ${e.message}`,"error")}});return{settings:i,isLoading:r,updateSettings:t}}(F?.id),[ep,ef]=(0,r.useState)({defaultSharedBooks:!1,expenseLimitAlert:!1,newMemberNotification:!0,largeExpenseNotification:!0,budgetOverspendingNotification:!0}),[eb,eg]=(0,r.useState)(null),[eN,ev]=(0,r.useState)({name:"",description:""}),[ey,ew]=(0,r.useState)({email:"",role:"member",isGeneric:!1,expiresInHours:48,maxUses:1}),{showToast:eP}=(0,L.useToast)(),{user:eC}=(0,D.useAuth)(),{data:eS,isLoading:eA,refetch:ek}=(0,G.X$)(eC?.id),[eI,e_]=(0,r.useState)(null),[ez,eE]=(0,r.useState)("members"),[eO,eq]=(0,r.useState)("families"),eG=(0,$.NL)(),{roles:eL,permissions:eD,isLoading:e$,createRole:eZ,updateRole:eR,deleteRole:eX}=function(e){let s=(0,$.NL)(),{showToast:a}=(0,L.useToast)(),{data:i,isLoading:r}=(0,R.a)({queryKey:["roles",e],queryFn:async()=>e?(await (0,Z.Io)(`/families/${e}/roles`)).data:[],enabled:!!e}),{data:t}=(0,R.a)({queryKey:["permissions"],queryFn:async()=>(await (0,Z.Io)("/permissions")).data}),{mutate:n}=(0,X.D)({mutationFn:async s=>{if(!e)throw Error("No family selected");return(await (0,Z.Io)(`/families/${e}/roles`,{method:"POST",body:JSON.stringify(s)})).data},onSuccess:()=>{a("角色创建成功","success"),s.invalidateQueries({queryKey:["roles",e]})},onError:e=>{a(`创建角色失败: ${e.message}`,"error")}}),{mutate:l}=(0,X.D)({mutationFn:async({roleId:s,data:a})=>{if(!e)throw Error("No family selected");return(await (0,Z.Io)(`/families/${e}/roles/${s}`,{method:"PATCH",body:JSON.stringify(a)})).data},onSuccess:()=>{a("角色更新成功","success"),s.invalidateQueries({queryKey:["roles",e]})},onError:e=>{a(`更新角色失败: ${e.message}`,"error")}}),{mutate:d}=(0,X.D)({mutationFn:async s=>{if(!e)throw Error("No family selected");await (0,Z.Io)(`/families/${e}/roles/${s}`,{method:"DELETE"})},onSuccess:()=>{a("角色删除成功","success"),s.invalidateQueries({queryKey:["roles",e]})},onError:e=>{a(`删除角色失败: ${e.message}`,"error")}});return{roles:i,permissions:t,isLoading:r,createRole:n,updateRole:l,deleteRole:d}}(F?.id),[eF,eM]=(0,r.useState)(void 0),{isOpen:eK,onOpen:eH,onClose:eV}=(0,t.q)(),eT=(0,r.useMemo)(()=>{if(!F||!eC)return!1;if(F.owner_id===eC.id)return!0;let e=s?.find(e=>e.user_id===eC.id);return e?.role==="admin"},[F,eC,s]);(0,r.useEffect)(()=>{console.log("刷新用户邀请"),ek().catch(e=>{console.error("刷新用户邀请失败:",e),eP("获取邀请失败","error")})},[ek,eP]),(0,r.useEffect)(()=>{console.log("收到的邀请数据:",eS)},[eS]),(0,r.useEffect)(()=>{eh&&"object"==typeof eh&&ef(eh)},[eh]);let eY=(e,s)=>{ef(a=>({...a,[e]:s}))},eB=e=>{ex(e),en()},eU=async(e,s)=>{F&&W({familyId:F.id,memberId:e,role:s})},eJ=e=>{F&&(console.log("准备移除成员:",e),eg(e),en())},eQ=async e=>{try{await (0,Z.Io)(`/families/invitations/${e}/accept`,{method:"POST"}),eP("已成功加入家庭","success"),ek(),eG.invalidateQueries({queryKey:["families"]})}catch(e){console.error("接受邀请失败:",e),eP("接受邀请失败","error")}},eW=async e=>{try{await (0,Z.Io)(`/families/invitations/${e}/reject`,{method:"POST"}),eP("已拒绝邀请","success"),ek()}catch(e){console.error("拒绝邀请失败:",e),eP("拒绝邀请失败","error")}},e0=e=>{eM(e),eH()},e1=e=>{confirm(`确定要删除角色 "${e.name}" 吗？`)&&eX(e.id)};return a?i.jsx(n.X,{className:"h-64 rounded-lg"}):(0,i.jsxs)("div",{className:"space-y-8 max-w-6xl mx-auto",children:[(0,i.jsxs)(l.n,{"aria-label":"主选项卡",selectedKey:eO,onSelectionChange:e=>eq(e),className:"mb-4",children:[(0,i.jsxs)(d.r,{title:"家庭管理",children:[i.jsx(c.w,{className:"shadow-sm hover:shadow-md transition-shadow duration-200",children:(0,i.jsxs)(o.G,{className:"p-6",children:[(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[(0,i.jsxs)("div",{children:[i.jsx("h2",{className:"text-2xl font-bold text-primary",children:"我的家庭"}),i.jsx("p",{className:"text-sm text-default-500 mt-1",children:"管理您的家庭信息和成员"})]}),i.jsx(m.A,{color:"primary",startContent:i.jsx(I.Z,{className:"h-5 w-5"}),onPress:()=>{ex(null),ev({name:"",description:""}),ei()},size:"md",className:"min-w-[140px]",children:"创建家庭"})]}),i.jsx("div",{className:"overflow-x-auto",children:(0,i.jsxs)(x.b,{"aria-label":"家庭列表",classNames:{base:"min-w-full",table:"min-w-full",thead:"bg-default-50",th:"text-default-700 font-semibold",tr:"hover:bg-default-50 transition-colors border-b border-default-100"},children:[(0,i.jsxs)(h.J,{children:[i.jsx(u.j,{className:"text-sm",children:"名称"}),i.jsx(u.j,{className:"text-sm",children:"描述"}),i.jsx(u.j,{className:"text-sm",children:"成员数"}),i.jsx(u.j,{className:"text-sm",children:"状态"}),i.jsx(u.j,{className:"text-sm",children:"操作"})]}),i.jsx(j.y,{items:e||[],emptyContent:"暂无家庭，点击右上角创建",children:e=>(0,i.jsxs)(p.g,{className:"h-14",children:[i.jsx(f.X,{children:i.jsx("div",{className:"font-medium",children:e.name})}),i.jsx(f.X,{children:i.jsx("div",{className:"text-default-500",children:e.description||"无描述"})}),i.jsx(f.X,{children:(0,i.jsxs)(b.z,{color:"primary",variant:"flat",size:"sm",children:[e.members?.length||0," 人"]})}),i.jsx(f.X,{children:i.jsx(b.z,{color:F?.id===e.id?"success":"default",variant:"flat",size:"sm",className:"capitalize",children:F?.id===e.id?"当前":"未选择"})}),i.jsx(f.X,{children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[i.jsx(m.A,{size:"sm",variant:"flat",color:"primary",onPress:()=>M(e),isDisabled:F?.id===e.id,className:"min-w-[80px]",children:F?.id===e.id?"已选择":"切换"}),i.jsx(m.A,{isIconOnly:!0,size:"sm",variant:"light",color:"primary",onPress:()=>{ex(e),ev(e),ei()},className:"rounded-full",children:i.jsx(_.Z,{className:"h-4 w-4"})}),i.jsx(m.A,{isIconOnly:!0,size:"sm",color:"danger",variant:"light",onPress:()=>eB(e),isDisabled:e.owner_id!==eC?.id,className:"rounded-full",children:i.jsx(z.Z,{className:"h-4 w-4"})})]})})]},e.id)})]})})]})}),F&&i.jsx(c.w,{className:"shadow-sm hover:shadow-md transition-shadow duration-200 mt-8",children:(0,i.jsxs)(o.G,{className:"p-6",children:[(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[(0,i.jsxs)("div",{children:[i.jsx("h2",{className:"text-2xl font-bold",children:F.name}),i.jsx("p",{className:"text-sm text-default-500 mt-1",children:F.description||"暂无描述"})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[i.jsx(m.A,{color:"primary",variant:"flat",startContent:i.jsx(_.Z,{className:"h-4 w-4"}),onPress:()=>{ex(F),ev({name:F.name,description:F.description}),ei()},size:"sm",children:"编辑"}),F.owner_id!==eC?.id&&i.jsx(m.A,{color:"default",variant:"flat",onPress:()=>{if(F&&eC&&confirm(`确定要退出 ${F.name} 家庭吗？退出后将无法访问该家庭的数据。`)){if(F.owner_id===eC.id){eP("您是家庭创建者，不能退出家庭。如需解散家庭，请使用解散功能。","error");return}ee({familyId:F.id,memberId:eC.id})}},size:"sm",children:"退出家庭"}),F.owner_id===eC?.id&&i.jsx(m.A,{color:"danger",variant:"flat",onPress:()=>{if(F&&eC&&confirm(`确定要解散 ${F.name} 家庭吗？解散后所有数据将被删除，此操作不可撤销。`)){if(F.owner_id!==eC.id){eP("只有家庭创建者才能解散家庭","error");return}U(F.id)}},size:"sm",children:"解散家庭"}),i.jsx(m.A,{color:"danger",variant:"flat",startContent:i.jsx(z.Z,{className:"h-4 w-4"}),onPress:()=>eB(F),size:"sm",isDisabled:F.owner_id!==eC?.id,children:"删除"}),i.jsx(m.A,{color:"primary",startContent:i.jsx(E,{className:"h-4 w-4"}),onPress:()=>{e_(null),ew({email:"",role:"member",isGeneric:!1,expiresInHours:48,maxUses:1}),ec()},size:"sm",isDisabled:!eT,children:"添加成员"})]})]}),(0,i.jsxs)(l.n,{"aria-label":"家庭管理选项",selectedKey:ez,onSelectionChange:e=>eE(e),children:[i.jsx(d.r,{title:"成员管理",children:i.jsx("div",{className:"overflow-x-auto mt-4",children:(0,i.jsxs)(x.b,{"aria-label":"成员列表",classNames:{base:"min-w-full",table:"min-w-full",thead:"bg-default-50",th:"text-default-700 font-semibold",tr:"hover:bg-default-50 transition-colors border-b border-default-100"},children:[(0,i.jsxs)(h.J,{children:[i.jsx(u.j,{className:"text-sm",children:"用户名"}),i.jsx(u.j,{className:"text-sm",children:"邮箱"}),i.jsx(u.j,{className:"text-sm",children:"角色"}),i.jsx(u.j,{className:"text-sm",children:"操作"})]}),i.jsx(j.y,{items:s||[],emptyContent:"暂无成员，点击右上角添加",children:e=>(0,i.jsxs)(p.g,{className:"h-14",children:[i.jsx(f.X,{children:i.jsx("div",{className:"font-medium",children:e.name})}),i.jsx(f.X,{children:i.jsx("div",{className:"text-default-500",children:e.email})}),i.jsx(f.X,{children:F?.owner_id===e.user_id?i.jsx(b.z,{color:"warning",variant:"flat",size:"sm",children:"创建者"}):"admin"===e.role?i.jsx(b.z,{color:"primary",variant:"flat",size:"sm",children:"管理员"}):i.jsx(b.z,{color:"default",variant:"flat",size:"sm",children:"成员"})}),i.jsx(f.X,{children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[F?.owner_id!==e.user_id&&F?.owner_id===eC?.id&&(0,i.jsxs)(g.g,{"aria-label":"修改角色",selectedKeys:[e.role],onChange:s=>eU(e.id,s.target.value),size:"sm",className:"max-w-[120px]",children:[i.jsx(N.R,{value:"admin",children:"管理员"},"admin"),i.jsx(N.R,{value:"member",children:"成员"},"member")]}),i.jsx(m.A,{isIconOnly:!0,size:"sm",color:"danger",variant:"light",onPress:()=>eJ(e),isDisabled:F?.owner_id===e.user_id||F?.owner_id!==eC?.id,className:"rounded-full",children:i.jsx(z.Z,{className:"h-4 w-4"})})]})})]},e.id)})]})})},"members"),i.jsx(d.r,{title:"邀请管理",children:i.jsx("div",{className:"mt-4",children:T?i.jsx(n.X,{className:"h-64"}):i.jsx(H.Z,{invitations:V||[],type:"sent",onDelete:eT?e=>{F&&es({familyId:F.id,invitationId:e})}:void 0})})},"invitations"),i.jsx(d.r,{title:"角色权限",children:i.jsx("div",{className:"mt-4",children:i.jsx(c.w,{children:i.jsx(o.G,{children:(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{children:[i.jsx("h3",{className:"text-lg font-semibold",children:"角色权限设置"}),i.jsx("p",{className:"text-sm text-default-500",children:"管理家庭成员的角色和权限"})]}),eT&&i.jsx(m.A,{color:"primary",size:"sm",startContent:i.jsx(I.Z,{className:"h-4 w-4"}),onPress:()=>{eM(void 0),eH()},children:"添加角色"})]}),e$?(0,i.jsxs)("div",{className:"space-y-4",children:[i.jsx(n.X,{className:"h-16 rounded-lg"}),i.jsx(n.X,{className:"h-16 rounded-lg"}),i.jsx(n.X,{className:"h-16 rounded-lg"})]}):i.jsx("div",{className:"space-y-4",children:eL?.map(e=>i.jsxs("div",{className:"border rounded-lg p-4",children:[i.jsxs("div",{className:"flex justify-between items-start mb-3",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium",children:e.name}),i.jsx("p",{className:"text-sm text-default-500",children:e.description})]}),eT&&!e.isSystem&&i.jsxs("div",{className:"flex gap-2",children:[i.jsx(m.A,{isIconOnly:!0,size:"sm",variant:"light",color:"primary",onPress:()=>e0(e),className:"rounded-full",children:i.jsx(_.Z,{className:"h-4 w-4"})}),i.jsx(m.A,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",onPress:()=>e1(e),className:"rounded-full",children:i.jsx(z.Z,{className:"h-4 w-4"})})]})]}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:e.permissions.map(s=>i.jsx(b.z,{color:e.isSystem?"warning":"primary",variant:"flat",size:"sm",children:s.name},s.code))})]},e.id))})]})})})})},"roles"),i.jsx(d.r,{title:"家庭设置",children:i.jsx("div",{className:"mt-4",children:i.jsx(c.w,{children:i.jsx(o.G,{children:(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[i.jsx("h3",{className:"text-lg font-semibold",children:"基本设置"}),(0,i.jsxs)("div",{className:"mt-4 space-y-4",children:[i.jsx(v.Y,{label:"家庭名称",value:eN.name,onChange:e=>ev({...eN,name:e.target.value}),variant:"bordered",isDisabled:!eT}),i.jsx(v.Y,{label:"家庭描述",value:eN.description,onChange:e=>ev({...eN,description:e.target.value}),variant:"bordered",isDisabled:!eT})]})]}),i.jsx(y.j,{}),(0,i.jsxs)("div",{children:[i.jsx("h3",{className:"text-lg font-semibold",children:"账本设置"}),(0,i.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{children:[i.jsx("p",{className:"font-medium",children:"默认共享账本"}),i.jsx("p",{className:"text-sm text-default-500",children:"新成员加入时自动共享的账本"})]}),i.jsx(w.i,{isSelected:ep.defaultSharedBooks,onValueChange:e=>eY("defaultSharedBooks",e),isDisabled:!eT})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{children:[i.jsx("p",{className:"font-medium",children:"支出限额提醒"}),i.jsx("p",{className:"text-sm text-default-500",children:"成员超出支出限额时发送提醒"})]}),i.jsx(w.i,{isSelected:ep.expenseLimitAlert,onValueChange:e=>eY("expenseLimitAlert",e),isDisabled:!eT})]})]})]}),i.jsx(y.j,{}),(0,i.jsxs)("div",{children:[i.jsx("h3",{className:"text-lg font-semibold",children:"通知设置"}),(0,i.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{children:[i.jsx("p",{className:"font-medium",children:"新成员加入通知"}),i.jsx("p",{className:"text-sm text-default-500",children:"有新成员加入时通知所有成员"})]}),i.jsx(w.i,{isSelected:ep.newMemberNotification,onValueChange:e=>eY("newMemberNotification",e),isDisabled:!eT})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{children:[i.jsx("p",{className:"font-medium",children:"大额支出通知"}),i.jsx("p",{className:"text-sm text-default-500",children:"发生大额支出时通知管理员"})]}),i.jsx(w.i,{isSelected:ep.largeExpenseNotification,onValueChange:e=>eY("largeExpenseNotification",e),isDisabled:!eT})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{children:[i.jsx("p",{className:"font-medium",children:"预算超支通知"}),i.jsx("p",{className:"text-sm text-default-500",children:"预算超支时通知相关成员"})]}),i.jsx(w.i,{isSelected:ep.budgetOverspendingNotification,onValueChange:e=>eY("budgetOverspendingNotification",e),isDisabled:!eT})]})]})]}),eT&&(0,i.jsxs)(i.Fragment,{children:[i.jsx(y.j,{}),i.jsx("div",{className:"flex justify-end",children:i.jsx(m.A,{color:"primary",startContent:i.jsx(q.Z,{className:"h-4 w-4"}),onPress:()=>{F&&ej(ep)},isLoading:eu,children:"保存设置"})})]})]})})})})},"settings")]})]})})]},"families"),i.jsx(d.r,{title:"我的邀请",children:i.jsx(c.w,{className:"shadow-sm hover:shadow-md transition-shadow duration-200",children:(0,i.jsxs)(o.G,{className:"p-6",children:[i.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:(0,i.jsxs)("div",{children:[i.jsx("h2",{className:"text-2xl font-bold text-primary",children:"我的邀请"}),i.jsx("p",{className:"text-sm text-default-500 mt-1",children:"查看所有收到的和发出的邀请"})]})}),(0,i.jsxs)(l.n,{children:[i.jsx(d.r,{title:"收到的邀请",children:i.jsx("div",{className:"mt-4",children:eA?i.jsx(n.X,{className:"h-64"}):eS&&eS.length>0?(0,i.jsxs)(i.Fragment,{children:[i.jsx("div",{className:"mb-4",children:(0,i.jsxs)("p",{className:"text-sm text-default-500",children:["您有 ",eS.length," 个待处理的邀请，请选择接受或拒绝"]})}),i.jsx(c.w,{className:"shadow-sm",children:i.jsx(o.G,{children:i.jsx(H.Z,{invitations:eS,type:"received",onAccept:eQ,onReject:eW})})})]}):i.jsx(c.w,{children:(0,i.jsxs)(o.G,{className:"py-8 text-center",children:[i.jsx("div",{className:"text-default-400 mb-2",children:i.jsx(O.Z,{className:"h-12 w-12 mx-auto"})}),i.jsx("p",{className:"text-default-600",children:"暂无收到的邀请"}),i.jsx(m.A,{color:"primary",variant:"light",size:"sm",className:"mt-4",onPress:()=>ek(),children:"刷新"})]})})})},"received"),i.jsx(d.r,{title:"发出的邀请",children:i.jsx("div",{className:"mt-4",children:i.jsx(c.w,{children:(0,i.jsxs)(o.G,{className:"py-4",children:[i.jsx("p",{className:"text-default-600 mb-4",children:"选择一个家庭查看已发送的邀请："}),i.jsx(g.g,{label:"选择家庭",placeholder:"请选择家庭",className:"max-w-xs mb-4",onChange:s=>{let a=parseInt(s.target.value),i=e?.find(e=>e.id===a);i&&(M(i),eq("families"),eE("invitations"))},children:(e||[]).map(e=>i.jsx(N.R,{value:e.id,children:e.name},e.id))})]})})})},"sent")]})]})})},"invitations")]}),i.jsx(P.R,{isOpen:ea,onClose:er,classNames:{base:"max-w-md mx-auto",header:"border-b border-default-100 pb-2",body:"py-6",footer:"border-t border-default-100 pt-2"},backdrop:"blur",children:(0,i.jsxs)(C.A,{children:[(0,i.jsxs)(S.k,{className:"flex flex-col gap-1",children:[i.jsx("h3",{className:"text-xl font-bold",children:em?"编辑家庭":"创建家庭"}),i.jsx("p",{className:"text-sm text-default-500",children:em?"修改家庭信息":"创建新的家庭"})]}),i.jsx(A.I,{children:(0,i.jsxs)("div",{className:"space-y-6",children:[i.jsx(v.Y,{label:"名称",placeholder:"请输入家庭名称",value:eN.name,onChange:e=>ev({...eN,name:e.target.value}),variant:"bordered",labelPlacement:"outside",isRequired:!0,startContent:i.jsx("div",{className:"pointer-events-none flex items-center",children:i.jsx("span",{className:"text-default-400 text-sm",children:"名称"})})}),i.jsx(v.Y,{label:"描述",placeholder:"请输入家庭描述",value:eN.description,onChange:e=>ev({...eN,description:e.target.value}),variant:"bordered",labelPlacement:"outside",startContent:i.jsx("div",{className:"pointer-events-none flex items-center",children:i.jsx("span",{className:"text-default-400 text-sm",children:"描述"})})})]})}),(0,i.jsxs)(k.R,{children:[i.jsx(m.A,{variant:"bordered",onPress:er,className:"min-w-[80px]",children:"取消"}),i.jsx(m.A,{color:"primary",onPress:()=>{if(!eN.name){eP("请填写家庭名称","error");return}em?B({familyId:em.id,data:eN}):Y(eN),er(),ex(null),ev({name:"",description:""})},className:"min-w-[80px]",children:"确定"})]})]})}),i.jsx(P.R,{isOpen:ed,onClose:eo,classNames:{base:"max-w-md mx-auto",header:"border-b border-default-100 pb-2",body:"py-6",footer:"border-t border-default-100 pt-2"},backdrop:"blur",children:(0,i.jsxs)(C.A,{children:[(0,i.jsxs)(S.k,{className:"flex flex-col gap-1",children:[i.jsx("h3",{className:"text-xl font-bold",children:"添加成员"}),i.jsx("p",{className:"text-sm text-default-500",children:ey.isGeneric?"创建通用邀请链接":"发送邀请给指定用户"})]}),i.jsx(A.I,{children:eI?(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"bg-success-50 p-4 rounded-lg text-center",children:[i.jsx("div",{className:"text-success text-xl mb-2",children:"✓"}),i.jsx("p",{className:"font-medium",children:"邀请已创建"}),i.jsx("p",{className:"text-sm text-default-500 mt-1",children:ey.isGeneric?"请将以下链接分享给需要加入的成员":`请将以下链接发送给 ${ey.email}`})]}),i.jsx("div",{className:"border border-default-200 rounded-lg p-3 bg-default-50",children:i.jsx("p",{className:"text-sm break-all",children:eI})}),(0,i.jsxs)("p",{className:"text-sm text-default-500",children:["邀请链接有效期为",ey.expiresInHours,"小时",ey.isGeneric?`，最多可被使用${ey.maxUses}次`:"","。",!ey.isGeneric&&"对方需要登录后才能接受邀请。"]})]}):(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[i.jsx(w.i,{isSelected:ey.isGeneric,onValueChange:e=>ew({...ey,isGeneric:e})}),i.jsx("span",{children:"创建通用邀请链接（无需指定邮箱）"})]}),!ey.isGeneric&&i.jsx(v.Y,{label:"邮箱",placeholder:"请输入邮箱",value:ey.email,onValueChange:e=>ew({...ey,email:e})}),(0,i.jsxs)(g.g,{label:"角色",selectedKeys:[ey.role],onChange:e=>ew({...ey,role:e.target.value}),children:[i.jsx(N.R,{value:"member",children:"成员"},"member"),i.jsx(N.R,{value:"admin",children:"管理员"},"admin")]}),i.jsx(v.Y,{type:"number",label:"有效期（小时）",placeholder:"请输入有效期",value:ey.expiresInHours.toString(),onValueChange:e=>ew({...ey,expiresInHours:parseInt(e)||48})}),ey.isGeneric&&i.jsx(v.Y,{type:"number",label:"最大使用次数",placeholder:"请输入最大使用次数",value:ey.maxUses.toString(),onValueChange:e=>ew({...ey,maxUses:parseInt(e)||1}),description:"设置为1表示只能使用一次，设置更大的值可以多次使用"})]})}),i.jsx(k.R,{children:eI?(0,i.jsxs)(i.Fragment,{children:[i.jsx(m.A,{color:"primary",variant:"light",onPress:()=>{navigator.clipboard.writeText(eI),eP("邀请链接已复制到剪贴板","success")},children:"复制链接"}),i.jsx(m.A,{color:"primary",onPress:()=>{e_(null),eo(),ew({email:"",role:"member",isGeneric:!1,expiresInHours:48,maxUses:1})},children:"完成"})]}):(0,i.jsxs)(i.Fragment,{children:[i.jsx(m.A,{color:"danger",variant:"light",onPress:eo,children:"取消"}),i.jsx(m.A,{color:"primary",onPress:()=>{if(F){if(!ey.isGeneric&&!ey.email){eP("请输入邮箱","error");return}J({familyId:F.id,data:{email:ey.email,role:ey.role}},{onSuccess:e=>{e&&e.inviteLink?e_(e.inviteLink):(eo(),ew({email:"",role:"member",isGeneric:!1,expiresInHours:48,maxUses:1}))}})}},children:"创建邀请"})]})})]})}),i.jsx(P.R,{isOpen:et,onClose:el,classNames:{base:"max-w-md mx-auto",header:"border-b border-default-100 pb-2",body:"py-6",footer:"border-t border-default-100 pt-2"},backdrop:"blur",children:(0,i.jsxs)(C.A,{children:[(0,i.jsxs)(S.k,{className:"flex flex-col gap-1",children:[i.jsx("h3",{className:"text-xl font-bold",children:"确认删除"}),i.jsx("p",{className:"text-sm text-default-500",children:"此操作不可撤销"})]}),(0,i.jsxs)(A.I,{children:[i.jsx("div",{className:"flex items-center justify-center py-4",children:i.jsx("div",{className:"bg-danger-50 p-4 rounded-full mb-4",children:i.jsx(z.Z,{className:"h-8 w-8 text-danger"})})}),i.jsx("p",{className:"text-center",children:em?(0,i.jsxs)(i.Fragment,{children:["确定要删除 ",i.jsx("span",{className:"font-bold",children:em.name})," 家庭吗？"]}):(0,i.jsxs)(i.Fragment,{children:["确定要移除 ",i.jsx("span",{className:"font-bold",children:eb?.name})," 成员吗？"]})}),i.jsx("p",{className:"text-center text-default-500 text-sm mt-2",children:em?"删除后所有相关数据将无法恢复。":"移除后该成员将无法访问此家庭的数据。"})]}),(0,i.jsxs)(k.R,{children:[i.jsx(m.A,{variant:"bordered",onPress:el,className:"min-w-[80px]",children:"取消"}),i.jsx(m.A,{color:"danger",onPress:em?()=>{em&&U(em.id),el(),ex(null)}:()=>{eb&&F&&(console.log("确认移除成员:",eb,"家庭ID:",F.id),ee({familyId:F.id,memberId:eb.user_id}),el(),eg(null))},className:"min-w-[80px]",children:"删除"})]})]})}),i.jsx(K,{isOpen:eK,onClose:eV,onSubmit:e=>{eF?eR({roleId:eF.id,data:{name:e.name,description:e.description,permissions:e.permissions.map(e=>({id:0,code:e,name:eD?.find(s=>s.code===e)?.name||"",description:eD?.find(s=>s.code===e)?.description||""}))}}):eZ(e),eV()},role:eF,permissions:eD,isLoading:e$})]})}},46409:(e,s,a)=>{"use strict";a.r(s),a.d(s,{$$typeof:()=>t,__esModule:()=>r,default:()=>n});let i=(0,a(86843).createProxy)(String.raw`/home/runner/work/meow-accounting/meow-accounting/frontend/src/app/settings/family/page.tsx`),{__esModule:r,$$typeof:t}=i,n=i.default},98138:(e,s,a)=>{"use strict";a.d(s,{Z:()=>r});var i=a(3729);let r=i.forwardRef(function({title:e,titleId:s,...a},r){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},a),e?i.createElement("title",{id:s},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))})},33759:(e,s,a)=>{"use strict";a.d(s,{Z:()=>r});var i=a(3729);let r=i.forwardRef(function({title:e,titleId:s,...a},r){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},a),e?i.createElement("title",{id:s},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))})}};var s=require("../../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),i=s.X(0,[3715,1599,8974,7279,7721,352,1327,9799,5261,3729,6536,6250,1271,7390,3751,8275,5975,5019,492,4037,2634],()=>a(26341));module.exports=i})();