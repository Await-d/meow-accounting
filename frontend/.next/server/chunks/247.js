"use strict";exports.id=247,exports.ids=[247],exports.modules={65004:(e,s,a)=>{a.d(s,{Z:()=>i});var t=a(95344),r=a(56686),l=a(40237),n=a(41501);function i({type:e="transaction",className:s=""}){return"statistics"===e?t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(e=>t.jsx(r.w,{className:"w-full",children:(0,t.jsxs)(l.G,{className:"space-y-3",children:[t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-3 w-3/4 rounded-lg bg-default-200"})}),t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-6 w-2/3 rounded-lg bg-default-200"})})]})},e))}):"category"===e?t.jsx(r.w,{className:"w-full",children:(0,t.jsxs)(l.G,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-6 w-32 rounded-lg bg-default-200"})}),t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-8 w-48 rounded-lg bg-default-200"})})]}),t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-[300px] w-full rounded-lg bg-default-200"})}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(e=>t.jsx(r.w,{className:"w-full",children:(0,t.jsxs)(l.G,{className:"space-y-2",children:[t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-3 w-3/4 rounded-lg bg-default-200"})}),t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-5 w-2/3 rounded-lg bg-default-200"})})]})},e))})]})}):"table"===e?(0,t.jsxs)("div",{className:`space-y-3 ${s}`,children:[t.jsx("div",{className:"flex space-x-2 mb-4",children:[1,2,3,4].map(e=>t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-8 w-24 rounded-lg bg-default-200"})},e))}),[1,2,3,4,5].map(e=>t.jsx("div",{className:"flex space-x-4 items-center",children:t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-10 w-full rounded-lg bg-default-200"})})},e))]}):t.jsx("div",{className:`space-y-3 ${s}`,children:[1,2,3,4,5].map(e=>t.jsx(r.w,{className:"w-full",children:t.jsx(l.G,{children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-3 w-24 rounded-lg bg-default-200"})}),t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-3 w-32 rounded-lg bg-default-200"})})]}),t.jsx(n.X,{className:"rounded-lg",children:t.jsx("div",{className:"h-6 w-20 rounded-lg bg-default-200"})})]})})},e))})}},58112:(e,s,a)=>{a.d(s,{s:()=>C,Z:()=>D});var t=a(95344),r=a(3729),l=a.n(r),n=a(44738),i=a(56686),c=a(40237),d=a(4521),o=a(56782),u=a(1542),m=a(41931),x=a(12061),h=a(14513),j=a(61561),g=a(66732),p=a(38854),f=a(53503),v=a(56223),y=a(15766),N=a(55794),b=a(11453);function w({value:e,onChange:s,label:a,placeholder:l="选择日期",className:n}){let[i,c]=(0,r.useState)(!1);return(0,t.jsxs)(g.j,{isOpen:i,onOpenChange:c,children:[t.jsx(p.b,{children:t.jsx(m.Y,{label:a,placeholder:l,value:e?(0,v.WU)(e,"yyyy-MM-dd",{locale:y.U}):"",readOnly:!0,classNames:{input:"cursor-pointer"},endContent:(0,t.jsxs)("div",{className:"flex items-center",children:[e&&t.jsx("button",{onClick:e=>{e.stopPropagation(),s(void 0)},className:"text-default-400 hover:text-default-900 focus:outline-none mr-2",children:"✕"}),t.jsx(N.Z,{className:"h-5 w-5 text-default-400"})]}),className:n})}),t.jsx(f.g,{children:t.jsx("div",{className:"p-1",children:t.jsx(S,{mode:"single",selected:e,onSelect:e=>{s(e),c(!1)},initialFocus:!0})})})]})}function S({mode:e,selected:s,onSelect:a,initialFocus:n}){let[i,c]=(0,r.useState)(s||new Date),d=i.getFullYear(),o=i.getMonth(),u=new Date(d,o+1,0).getDate(),m=new Date(d,o,1).getDay(),x=e=>{a(new Date(d,o,e))},h=[],j=1;for(let e=0;e<6;e++){let s=[];for(let a=0;a<7;a++)0===e&&a<m?s.push(null):j<=u?(s.push(j),j++):s.push(null);h.push(s)}return(0,t.jsxs)("div",{className:"p-3",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("button",{onClick:()=>{c(new Date(d,o-1,1))},className:"p-1",children:"<"}),t.jsx("h3",{children:(0,v.WU)(i,"yyyy年MM月",{locale:y.U})}),t.jsx("button",{onClick:()=>{c(new Date(d,o+1,1))},className:"p-1",children:">"})]}),t.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:["日","一","二","三","四","五","六"].map(e=>t.jsx("div",{className:"text-sm font-medium",children:e},e))}),t.jsx("div",{className:"grid grid-cols-7 gap-1",children:h.map((e,a)=>t.jsx(l().Fragment,{children:e.map((e,r)=>t.jsx("div",{className:(0,b.cn)("h-8 w-8 p-0 flex items-center justify-center rounded-full text-sm",null===e?"invisible":"cursor-pointer hover:bg-primary-100",s&&e===s.getDate()&&o===s.getMonth()&&d===s.getFullYear()?"bg-primary text-white":""),onClick:()=>null!==e&&x(e),children:e},`${a}-${r}`))},a))})]})}function D({onFilter:e}){let[s,a]=(0,r.useState)({});return t.jsx(n.A,{size:"sm",onPress:()=>e(s),children:"过滤"})}function C({isOpen:e,onClose:s,onApply:a,initialFilter:l={}}){let[g,p]=(0,r.useState)(l),{categories:f}=(0,j.L)();return((0,r.useEffect)(()=>{p(l)},[l]),e)?t.jsx(i.w,{className:"w-full max-w-md mx-auto",children:(0,t.jsxs)(c.G,{className:"p-5",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-bold",children:"交易筛选"}),t.jsx(n.A,{isIconOnly:!0,variant:"light",onPress:s,children:t.jsx(h.Z,{size:18})})]}),t.jsx(d.j,{className:"my-3"}),(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsxs)("div",{children:[t.jsx("h4",{className:"text-md font-medium mb-2",children:"交易类型"}),(0,t.jsxs)(o.X,{value:g.type,onValueChange:e=>p(s=>({...s,type:e})),children:[t.jsx(u.J,{value:"all",children:"全部"}),t.jsx(u.J,{value:"income",children:"收入"}),t.jsx(u.J,{value:"expense",children:"支出"})]})]}),(0,t.jsxs)("div",{children:[t.jsx("h4",{className:"text-md font-medium mb-2",children:"金额范围"}),(0,t.jsxs)("div",{className:"flex gap-3",children:[t.jsx(m.Y,{type:"number",label:"最小金额",placeholder:"0",value:g.minAmount?.toString()||"",onChange:e=>p(s=>({...s,minAmount:e.target.value?Number(e.target.value):void 0})),className:"flex-1"}),t.jsx(m.Y,{type:"number",label:"最大金额",placeholder:"不限",value:g.maxAmount?.toString()||"",onChange:e=>p(s=>({...s,maxAmount:e.target.value?Number(e.target.value):void 0})),className:"flex-1"})]})]}),(0,t.jsxs)("div",{children:[t.jsx("h4",{className:"text-md font-medium mb-2",children:"日期范围"}),(0,t.jsxs)("div",{className:"flex gap-3",children:[t.jsx(w,{label:"开始日期",value:g.startDate?new Date(g.startDate):void 0,onChange:e=>p(s=>({...s,startDate:e?e.toISOString().split("T")[0]:void 0})),className:"flex-1"}),t.jsx(w,{label:"结束日期",value:g.endDate?new Date(g.endDate):void 0,onChange:e=>p(s=>({...s,endDate:e?e.toISOString().split("T")[0]:void 0})),className:"flex-1"})]})]}),f&&f.length>0&&(0,t.jsxs)("div",{children:[t.jsx("h4",{className:"text-md font-medium mb-2",children:"分类"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:f.map(e=>t.jsx(x.K,{isSelected:g.categoryIds?.includes(Number(e.id)),onValueChange:s=>{p(a=>{let t=a.categoryIds||[];return s?{...a,categoryIds:[...t,Number(e.id)]}:{...a,categoryIds:t.filter(s=>s!==Number(e.id))}})},children:e.name},e.id))})]})]}),t.jsx(d.j,{className:"my-4"}),(0,t.jsxs)("div",{className:"flex justify-between gap-2",children:[t.jsx(n.A,{variant:"flat",color:"danger",onPress:()=>{p({})},className:"flex-1",children:"重置"}),t.jsx(n.A,{color:"primary",onPress:()=>{a(g),s()},className:"flex-1",children:"应用筛选"})]})]})}):null}},86842:(e,s,a)=>{a.d(s,{Z:()=>p});var t=a(95344),r=a(70596),l=a(81686),n=a(26417),i=a(97446),c=a(16),d=a(44360),o=a(41931),u=a(75462),m=a(44738),x=a(61561),h=a(15006),j=a(89023),g=a(3729);let p=({isOpen:e,onClose:s,transaction:a})=>{let[p,f]=(0,g.useState)("expense"),[v,y]=(0,g.useState)(""),[N,b]=(0,g.useState)(""),[w,S]=(0,g.useState)(""),[D,C]=(0,g.useState)(new Date().toISOString().split("T")[0]),{categories:A=[],isLoading:Y}=(0,x.L)(),{showToast:I}=(0,j.useToast)(),O=(0,h.lr)(),P=(0,h.wI)(),R=A.filter(e=>e.type===p);(0,g.useEffect)(()=>{a&&(f(a.type),y(a.amount.toString()),b(a.category_id?.toString()||""),S(a.description),C(a.date))},[a]);let M=()=>{f("expense"),y(""),b(""),S(""),C(new Date().toISOString().split("T")[0])},k=()=>{M(),s()},E=async e=>{if(e.preventDefault(),!v||!N||!w||!D){I("请填写所有必填字段","error");return}let t=A.find(e=>e.id.toString()===N);if(!t){I("请选择有效的分类","error");return}let r={type:p,amount:Number(v),category_id:Number(N),description:w,date:D,category_name:t.name,category_icon:t.icon};try{a?(await P.mutateAsync({...r,id:a.id}),I("修改成功","success")):(await O.mutateAsync(r),I("添加成功","success")),s(),M()}catch(e){I("操作失败："+(e instanceof Error?e.message:"未知错误"),"error")}};return t.jsx(r.R,{isOpen:e,onClose:k,size:"lg",children:t.jsx(l.A,{children:(0,t.jsxs)("form",{onSubmit:E,children:[t.jsx(n.k,{children:a?"编辑交易":"新增交易"}),t.jsx(i.I,{className:"gap-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)(c.g,{label:"类型",selectedKeys:new Set([p]),onChange:e=>f(e.target.value),"aria-label":"选择交易类型",children:[t.jsx(d.R,{value:"expense","aria-label":"支出",children:"支出"},"expense"),t.jsx(d.R,{value:"income","aria-label":"收入",children:"收入"},"income")]}),t.jsx(o.Y,{type:"number",label:"金额",value:v,onChange:e=>y(e.target.value),"aria-label":"输入金额"}),t.jsx(c.g,{label:"分类",selectedKeys:N?new Set([N]):new Set,onChange:e=>b(e.target.value),isLoading:Y,"aria-label":"选择交易分类",errorMessage:0!==R.length||Y?void 0:"请先选择一个家庭并添加分类",children:R.map(e=>t.jsx(d.R,{value:e.id.toString(),textValue:e.name,"aria-label":e.name,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("span",{"aria-hidden":"true",children:e.icon}),t.jsx("span",{children:e.name})]})},e.id.toString()))}),t.jsx(o.Y,{type:"date",label:"日期",value:D,onChange:e=>C(e.target.value),"aria-label":"选择日期"}),t.jsx(o.Y,{className:"md:col-span-2",label:"描述",value:w,onChange:e=>S(e.target.value),"aria-label":"输入交易描述"})]})}),(0,t.jsxs)(u.R,{children:[t.jsx(m.A,{color:"danger",variant:"light",onPress:k,children:"取消"}),t.jsx(m.A,{color:"primary",type:"submit",children:a?"保存":"添加"})]})]})})})}},80247:(e,s,a)=>{a.d(s,{Z:()=>M});var t=a(95344),r=a(3729),l=a.n(r),n=a(78225),i=a(44738),c=a(70596),d=a(81686),o=a(26417),u=a(97446),m=a(41931),x=a(75462),h=a(47623),j=a(67993),g=a(82514),p=a(8853),f=a(33759),v=a(98138),y=a(3594),N=a(40997),b=a(48869),w=a.n(b),S=a(15006),D=a(89023),C=a(30853),A=a(65004),Y=a(86842),I=a(58112);function O({isOpen:e,onClose:s}){let a=(0,r.useRef)(null),[l,n]=(0,r.useState)(null),{mutate:h,isPending:j}=(0,S.En)(),{showToast:p}=(0,D.useToast)(),f=async()=>{if(!l){p("请选择要导入的文件","error");return}let e=new FormData;e.append("file",l);try{await h(e),s(),n(null),a.current&&(a.current.value="")}catch(e){console.error("导入失败:",e)}};return t.jsx(c.R,{isOpen:e,onClose:s,children:(0,t.jsxs)(d.A,{children:[t.jsx(o.k,{children:"导入交易记录"}),t.jsx(u.I,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-sm text-default-500",children:"请选择要导入的CSV文件，文件格式如下："}),t.jsx("pre",{className:"text-xs bg-default-100 p-2 rounded-lg",children:"日期,类型,金额,分类,描述 2024-03-01,expense,100,餐饮,午餐 2024-03-02,income,5000,工资,3月工资"}),t.jsx(m.Y,{type:"file",accept:".csv",ref:a,onChange:e=>{let s=e.target.files?.[0];if(s){if("text/csv"!==s.type){p("请选择CSV文件","error");return}n(s)}},startContent:t.jsx(g.Z,{className:"h-4 w-4"}),description:"支持.csv格式文件"})]})}),(0,t.jsxs)(x.R,{children:[t.jsx(i.A,{variant:"bordered",onPress:s,children:"取消"}),t.jsx(i.A,{color:"primary",onPress:f,isLoading:j,isDisabled:!l,children:"导入"})]})]})})}function P({isOpen:e,onClose:s}){let[a,l]=(0,r.useState)(w()().startOf("month").format("YYYY-MM-DD")),[n,h]=(0,r.useState)(w()().format("YYYY-MM-DD")),{mutate:j,isPending:g}=(0,S.v9)(),{showToast:f}=(0,D.useToast)(),v=async()=>{if(!a||!n){f("请选择日期范围","error");return}if(w()(a).isAfter(n)){f("开始日期不能晚于结束日期","error");return}try{await j({startDate:a,endDate:n}),s()}catch(e){console.error("导出失败:",e)}};return t.jsx(c.R,{isOpen:e,onClose:s,children:(0,t.jsxs)(d.A,{children:[t.jsx(o.k,{children:"导出交易记录"}),t.jsx(u.I,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-sm text-default-500",children:"请选择要导出的日期范围："}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(m.Y,{type:"date",label:"开始日期",value:a,onChange:e=>l(e.target.value)}),t.jsx(m.Y,{type:"date",label:"结束日期",value:n,onChange:e=>h(e.target.value)})]})]})}),(0,t.jsxs)(x.R,{children:[t.jsx(i.A,{variant:"bordered",onPress:s,children:"取消"}),t.jsx(i.A,{color:"primary",startContent:t.jsx(p.Z,{className:"h-4 w-4"}),onPress:v,isLoading:g,children:"导出"})]})]})})}var R=a(77850);function M(){let[e,s]=(0,r.useState)(1),[a,b]=(0,r.useState)({}),{user:M,isGuest:k,enterGuestMode:E,exitGuestMode:T}=(0,C.useAuth)(),{transactions:L,isLoading:Z,error:$}=(0,S.nC)(M?.currentFamilyId),{mutate:F}=(0,S.A3)(),{showToast:X}=(0,D.useToast)(),{isOpen:q,onOpen:K,onClose:z}=(0,n.q)(),{isOpen:U,onOpen:Q,onClose:_}=(0,n.q)(),{isOpen:G,onOpen:J,onClose:V}=(0,n.q)(),[B,W]=(0,r.useState)(""),[H,ee]=(0,r.useState)(null),[es,ea]=(0,r.useState)(!1),[et,er]=(0,r.useState)(!1),el=(0,r.useRef)(null);(0,N.MG)({count:L.length,getScrollElement:()=>el.current,estimateSize:()=>70,overscan:10});let en=(0,r.useMemo)(()=>L?L.filter(e=>!0):[],[L,a]),ei=e=>{if(k){X("访客模式下无法编辑","error");return}ee(e),ea(!0)},ec=e=>{if(k){X("访客模式下无法删除","error");return}ee(e),er(!0)},ed=async()=>{try{await E(B),z(),W(""),X("已进入访客模式","success")}catch(e){X("访客密码错误","error")}},eo=(e,s)=>k?"****":`${"expense"===s?"-":"+"}${e.toFixed(2)}`;return Z?t.jsx(A.Z,{type:"transaction"}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center sticky top-0 bg-background/70 backdrop-blur-lg z-10 py-2 px-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx(I.Z,{onFilter:b}),M?.privacy_mode&&t.jsx(i.A,{size:"sm",variant:"flat",startContent:k?t.jsx(h.Z,{className:"h-4 w-4"}):t.jsx(j.Z,{className:"h-4 w-4"}),onPress:k?()=>T():K,children:k?"退出访客模式":"访客模式"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[t.jsx(i.A,{size:"sm",variant:"flat",startContent:t.jsx(g.Z,{className:"h-4 w-4"}),onPress:Q,isDisabled:k,children:"导入"}),t.jsx(i.A,{size:"sm",variant:"flat",startContent:t.jsx(p.Z,{className:"h-4 w-4"}),onPress:J,isDisabled:k,children:"导出"})]})]}),t.jsx("div",{ref:el,className:"h-[calc(100vh-350px)] md:h-[calc(100vh-230px)] overflow-auto px-4",children:0===en.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[t.jsx("div",{className:"bg-default-100 rounded-full p-6 mb-4",children:t.jsx(R.Z,{className:"h-10 w-10 text-default-400"})}),t.jsx("p",{className:"text-default-500",children:"暂无交易记录"}),t.jsx(i.A,{color:"primary",variant:"flat",className:"mt-4",startContent:t.jsx(f.Z,{className:"h-4 w-4"}),onPress:()=>ea(!0),isDisabled:k,children:"添加交易"})]}):t.jsx("div",{className:"space-y-2 pb-4",children:en.map((e,s)=>{let a=w()(e.date).format("YYYY-MM-DD"),r=0===s||a!==w()(en[s-1].date).format("YYYY-MM-DD");return(0,t.jsxs)(l().Fragment,{children:[r&&t.jsx("div",{className:"sticky top-0 bg-background/80 backdrop-blur-md py-2 px-1 text-sm font-medium border-b z-10 mt-2 first:mt-0",children:a===w()().format("YYYY-MM-DD")?"今天":a===w()().subtract(1,"day").format("YYYY-MM-DD")?"昨天":w()(a).format("MM月DD日 ddd")}),(0,t.jsxs)("div",{className:"p-3 rounded-lg hover:bg-default-100 transition-colors cursor-pointer flex justify-between items-center border-b border-default-100",onClick:()=>ei(e),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`p-2 rounded-full ${"expense"===e.type?"bg-danger/10 text-danger":"bg-success/10 text-success"}`,children:t.jsx("span",{className:"text-xl",children:e.category||"\uD83D\uDCB0"})}),(0,t.jsxs)("div",{children:[t.jsx("div",{className:"font-medium",children:e.category||"未分类"}),t.jsx("div",{className:"text-xs text-default-400",children:e.description||"无描述"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-end",children:[t.jsx("div",{className:`font-semibold ${"expense"===e.type?"text-danger":"text-success"}`,children:eo(e.amount,e.type)}),(0,t.jsxs)("div",{className:"flex gap-1 mt-1",children:[t.jsx("span",{onClick:e=>e.stopPropagation(),children:t.jsx(i.A,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>ei(e),className:"h-6 w-6 min-w-0",isDisabled:k,children:t.jsx(v.Z,{className:"h-3 w-3"})})}),t.jsx("span",{onClick:e=>e.stopPropagation(),children:t.jsx(i.A,{isIconOnly:!0,size:"sm",color:"danger",variant:"light",onPress:()=>ec(e),className:"h-6 w-6 min-w-0",isDisabled:k,children:t.jsx(y.Z,{className:"h-3 w-3"})})})]})]})]})]},e.id)})})}),t.jsx(c.R,{isOpen:q,onClose:z,children:(0,t.jsxs)(d.A,{children:[t.jsx(o.k,{children:"访客模式"}),t.jsx(u.I,{children:t.jsx(m.Y,{type:"password",label:"访客密码",placeholder:"请输入访客密码",value:B,onChange:e=>W(e.target.value)})}),(0,t.jsxs)(x.R,{children:[t.jsx(i.A,{variant:"bordered",onPress:z,children:"取消"}),t.jsx(i.A,{color:"primary",onPress:ed,children:"确认"})]})]})}),t.jsx(O,{isOpen:U,onClose:_}),t.jsx(P,{isOpen:G,onClose:V}),t.jsx(Y.Z,{isOpen:es,onClose:()=>ea(!1),transaction:H}),t.jsx(c.R,{isOpen:et,onClose:()=>er(!1),children:(0,t.jsxs)(d.A,{children:[t.jsx(o.k,{children:"确认删除"}),t.jsx(u.I,{children:"确定要删除这条交易记录吗？"}),(0,t.jsxs)(x.R,{children:[t.jsx(i.A,{variant:"bordered",onPress:()=>er(!1),children:"取消"}),t.jsx(i.A,{color:"danger",onPress:()=>{H&&F(H.id),er(!1),ee(null)},children:"删除"})]})]})})]})}},61561:(e,s,a)=>{a.d(s,{L:()=>n});var t=a(3729),r=a(96548),l=a(30853);function n(){let[e,s]=(0,t.useState)([]),[a,n]=(0,t.useState)(!0),[i,c]=(0,t.useState)(null),{user:d}=(0,l.useAuth)(),o=(0,t.useRef)(!1);return(0,t.useEffect)(()=>{d&&(o.current=!1);let e=async()=>{if(!o.current||!i)try{n(!0);let e="/categories";d?.currentFamilyId?e+=`?familyId=${d.currentFamilyId}`:d?.id&&(e+=`?userId=${d.id}`);let a=await (0,r.Io)(e);s(a.data),c(null)}catch(e){console.error("获取分类失败",e),c(e),s([]),o.current=!0}finally{n(!1)}};d?e():(s([]),n(!1))},[d]),{categories:e,isLoading:a,error:i}}},15006:(e,s,a)=>{a.d(s,{A3:()=>u,En:()=>x,lr:()=>d,nC:()=>c,v9:()=>m,wI:()=>o});var t=a(3729),r=a(89023),l=a(26274),n=a(31296),i=a(96548);function c(e){let[s,a]=(0,t.useState)([]),[l,n]=(0,t.useState)(!0),[c,d]=(0,t.useState)(null),{showToast:o}=(0,r.useToast)(),u=(0,t.useRef)(!1),m=(0,t.useRef)(!1);return(0,t.useEffect)(()=>{e&&(u.current=!1,m.current=!1);let s=async()=>{if(!e){a([]),n(!1);return}if(!u.current||!m.current)try{n(!0),u.current=!0;let s=await (0,i.Io)(`/families/${e}/transactions`);a(s.data),d(null),m.current=!1}catch(e){console.error("获取交易记录失败",e),o&&o((0,i.we)(e,"获取交易记录失败"),"error"),d(e),a([]),m.current=!0}finally{n(!1)}};!e||u.current&&m.current?e||(a([]),n(!1)):s()},[e,o]),{transactions:s,isLoading:l,error:c}}function d(){let e=(0,l.NL)(),{showToast:s}=(0,r.useToast)();return(0,n.D)({mutationFn:async e=>(await (0,i.Io)("/transactions",{method:"POST",body:JSON.stringify(e)})).data,onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),s("创建成功","success")},onError:e=>{console.error("创建交易失败:",e),s((0,i.we)(e,"创建交易失败"),"error")}})}function o(){let e=(0,l.NL)(),{showToast:s}=(0,r.useToast)();return(0,n.D)({mutationFn:async e=>(await (0,i.Io)(`/transactions/${e.id}`,{method:"PUT",body:JSON.stringify(e)})).data,onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),s("更新成功","success")},onError:e=>{console.error("更新交易失败:",e),s((0,i.we)(e,"更新交易失败"),"error")}})}function u(){let e=(0,l.NL)(),{showToast:s}=(0,r.useToast)();return(0,n.D)({mutationFn:async e=>{await (0,i.Io)(`/transactions/${e}`,{method:"DELETE"})},onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),e.invalidateQueries({queryKey:["categoryStats"]}),s("删除成功","success")},onError:e=>{401===e.status?s("请先登录","error"):s("删除失败","error")}})}function m(){let{showToast:e}=(0,r.useToast)();return(0,n.D)({mutationFn:async({startDate:e,endDate:s})=>{let a=new URLSearchParams;a.append("startDate",e),a.append("endDate",s);let t=`${process.env.NEXT_PUBLIC_API_URL||"http://localhost:3001/api"}/transactions/export?${a.toString()}`,r=localStorage.getItem("token"),l=await fetch(t,{method:"GET",headers:{Accept:"application/octet-stream",...r?{Authorization:`Bearer ${r}`}:{}}});if(!l.ok)throw Error("导出失败");let n=await l.blob(),i=window.URL.createObjectURL(n),c=document.createElement("a"),d=`交易记录_${e}_${s}.csv`;return c.href=i,c.setAttribute("download",d),document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(i),n},onSuccess:()=>{e("导出成功","success")},onError:s=>{console.error("导出失败:",s),e("导出失败","error")}})}function x(){let e=(0,l.NL)(),{showToast:s}=(0,r.useToast)();return(0,n.D)({mutationFn:async e=>(await (0,i.Io)("/transactions/import",{method:"POST",body:e,headers:{Accept:"application/json"}})).data,onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),e.invalidateQueries({queryKey:["categoryStats"]}),s("导入成功","success")},onError:e=>{console.error("导入失败:",e),s("导入失败: "+(e instanceof Error?e.message:"未知错误"),"error")}})}},11453:(e,s,a)=>{a.d(s,{cn:()=>l});var t=a(56815),r=a(79377);function l(...e){return(0,r.m6)((0,t.W)(e))}}};