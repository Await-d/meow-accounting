"use strict";exports.id=4670,exports.ids=[4670],exports.modules={87265:(e,s,t)=>{t.d(s,{Z:()=>n});var a=t(95344),r=t(3729),l=t(91529);let n=({variant:e="default"})=>{let s=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(!s.current)return;let t=s.current,a=t.getContext("2d");if(!a)return;let r=()=>{t.width=window.innerWidth,t.height=window.innerHeight};r(),window.addEventListener("resize",r);let l=[],n="minimal"===e?50:100;class i{constructor(){this.x=Math.random()*t.width,this.y=Math.random()*t.height,this.size=2*Math.random()+.5,this.speedX=.5*Math.random()-.25,this.speedY=.5*Math.random()-.25,this.color=`hsla(${60*Math.random()+200}, 70%, 60%, ${.8*Math.random()+.2})`}update(){this.x+=this.speedX,this.y+=this.speedY,this.x>t.width?this.x=0:this.x<0&&(this.x=t.width),this.y>t.height?this.y=0:this.y<0&&(this.y=t.height)}draw(){a&&(a.fillStyle=this.color,a.beginPath(),a.arc(this.x,this.y,this.size,0,2*Math.PI),a.fill())}}let c=()=>{if(a)for(let e=0;e<l.length;e++)for(let s=e;s<l.length;s++){let t=l[e].x-l[s].x,r=l[e].y-l[s].y,n=Math.sqrt(t*t+r*r);if(n<150){let t=1-n/150;a.strokeStyle=`rgba(150, 150, 255, ${.15*t})`,a.lineWidth=.8,a.beginPath(),a.moveTo(l[e].x,l[e].y),a.lineTo(l[s].x,l[s].y),a.stroke()}}},d=()=>{if(a){for(let s of(a.clearRect(0,0,t.width,t.height),"default"===e&&o(),l))s.update(),s.draw();c(),requestAnimationFrame(d)}},o=()=>{if(!a)return;a.strokeStyle="rgba(100, 100, 255, 0.1)",a.beginPath(),a.lineWidth=1.5,a.arc(0,0,200,0,.5*Math.PI),a.stroke(),a.beginPath(),a.arc(t.width,t.height,250,Math.PI,1.5*Math.PI),a.stroke(),a.beginPath(),a.lineWidth=.8;let e=t.width/2,s=t.height/2,r=.4*Math.min(t.width,t.height);a.moveTo(e-r/2,s-r/2),a.lineTo(e+r/2,s-r/2),a.lineTo(e+r/2,s+r/2),a.lineTo(e-r/2,s+r/2),a.lineTo(e-r/2,s-r/2),a.stroke()};return(()=>{for(let e=0;e<n;e++)l.push(new i)})(),d(),()=>{window.removeEventListener("resize",r)}},[e]),(0,a.jsxs)("div",{className:"fixed inset-0 -z-10 overflow-hidden",children:[a.jsx("canvas",{ref:s,className:"absolute inset-0 w-full h-full"}),a.jsx("div",{className:"absolute top-0 -left-[10%] w-[50%] h-[50%] bg-primary/10 rounded-full blur-[150px] -z-10"}),a.jsx("div",{className:"absolute bottom-[10%] right-[10%] w-[40%] h-[40%] bg-secondary/10 rounded-full blur-[150px] -z-10"}),a.jsx(l.E.div,{className:"absolute top-[20%] right-[10%] w-16 h-16 border border-primary/20 rounded-full",animate:{y:[0,15,0],opacity:[.6,.9,.6],scale:[1,1.05,1]},transition:{duration:6,repeat:1/0,ease:"easeInOut"}}),a.jsx(l.E.div,{className:"absolute top-[10%] left-[20%] w-24 h-24 border border-secondary/30 rounded-xl rotate-45",animate:{y:[0,-20,0],opacity:[.3,.6,.3],rotate:[45,35,45]},transition:{duration:8,repeat:1/0,ease:"easeInOut"}}),a.jsx(l.E.div,{className:"absolute bottom-[30%] left-[5%] w-20 h-20 bg-gradient-to-tr from-primary/5 to-secondary/5 rounded-lg",animate:{x:[0,10,0],opacity:[.4,.7,.4],rotate:[0,10,0]},transition:{duration:7,repeat:1/0,ease:"easeInOut"}})]})}},41575:(e,s,t)=>{t.d(s,{Z:()=>i});var a=t(95344),r=t(87265);let l={lg:"max-w-5xl",xl:"max-w-7xl",full:"w-full max-w-none"},n={sm:"py-6",md:"py-10",lg:"py-16"},i=function({title:e,description:s,actions:t,children:i,backgroundVariant:c="minimal",maxWidth:d="xl",padding:o="md",contentClassName:u="",headerClassName:m=""}){let h=["relative","mx-auto","w-full","px-4",l[d],n[o],u].filter(Boolean).join(" "),x=e||s||t;return(0,a.jsxs)("main",{className:"relative min-h-screen overflow-hidden",children:["none"!==c&&a.jsx(r.Z,{variant:"default"===c?"default":"minimal"}),(0,a.jsxs)("div",{className:h,children:[x&&(0,a.jsxs)("div",{className:["mb-8","flex flex-col gap-4","sm:flex-row sm:items-center sm:justify-between",m].filter(Boolean).join(" "),children:[(0,a.jsxs)("div",{className:"space-y-1",children:[e&&a.jsx("h1",{className:"text-2xl font-bold md:text-3xl",children:e}),s&&a.jsx("p",{className:"max-w-2xl text-base text-default-500 md:text-lg",children:s})]}),t&&a.jsx("div",{className:"flex flex-wrap items-center gap-2 sm:justify-end",children:t})]}),a.jsx("div",{className:"relative z-10",children:i})]})]})}},65004:(e,s,t)=>{t.d(s,{Z:()=>i});var a=t(95344),r=t(56686),l=t(40237),n=t(41501);function i({type:e="transaction",className:s=""}){return"statistics"===e?a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(e=>a.jsx(r.w,{className:"w-full",children:(0,a.jsxs)(l.G,{className:"space-y-3",children:[a.jsx(n.X,{className:"rounded-lg",children:a.jsx("div",{className:"h-3 w-3/4 rounded-lg bg-default-200"})}),a.jsx(n.X,{className:"rounded-lg",children:a.jsx("div",{className:"h-6 w-2/3 rounded-lg bg-default-200"})})]})},e))}):"category"===e?a.jsx(r.w,{className:"w-full",children:(0,a.jsxs)(l.G,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx(n.X,{className:"rounded-lg",children:a.jsx("div",{className:"h-6 w-32 rounded-lg bg-default-200"})}),a.jsx(n.X,{className:"rounded-lg",children:a.jsx("div",{className:"h-8 w-48 rounded-lg bg-default-200"})})]}),a.jsx(n.X,{className:"rounded-lg",children:a.jsx("div",{className:"h-[300px] w-full rounded-lg bg-default-200"})}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(e=>a.jsx(r.w,{className:"w-full",children:(0,a.jsxs)(l.G,{className:"space-y-2",children:[a.jsx(n.X,{className:"rounded-lg",children:a.jsx("div",{className:"h-3 w-3/4 rounded-lg bg-default-200"})}),a.jsx(n.X,{className:"rounded-lg",children:a.jsx("div",{className:"h-5 w-2/3 rounded-lg bg-default-200"})})]})},e))})]})}):"table"===e?(0,a.jsxs)("div",{className:`space-y-3 ${s}`,children:[a.jsx("div",{className:"flex space-x-2 mb-4",children:[1,2,3,4].map(e=>a.jsx(n.X,{className:"rounded-lg",children:a.jsx("div",{className:"h-8 w-24 rounded-lg bg-default-200"})},e))}),[1,2,3,4,5].map(e=>a.jsx("div",{className:"flex space-x-4 items-center",children:a.jsx(n.X,{className:"rounded-lg",children:a.jsx("div",{className:"h-10 w-full rounded-lg bg-default-200"})})},e))]}):a.jsx("div",{className:`space-y-3 ${s}`,children:[1,2,3,4,5].map(e=>a.jsx(r.w,{className:"w-full",children:a.jsx(l.G,{children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(n.X,{className:"rounded-lg",children:a.jsx("div",{className:"h-3 w-24 rounded-lg bg-default-200"})}),a.jsx(n.X,{className:"rounded-lg",children:a.jsx("div",{className:"h-3 w-32 rounded-lg bg-default-200"})})]}),a.jsx(n.X,{className:"rounded-lg",children:a.jsx("div",{className:"h-6 w-20 rounded-lg bg-default-200"})})]})})},e))})}},58112:(e,s,t)=>{t.d(s,{s:()=>C,Z:()=>D});var a=t(95344),r=t(3729),l=t.n(r),n=t(44738),i=t(56686),c=t(40237),d=t(4521),o=t(56782),u=t(1542),m=t(41931),h=t(12061),x=t(14513),j=t(61561),f=t(66732),g=t(38854),p=t(53503),v=t(56223),y=t(15766),N=t(55794),b=t(11453);function w({value:e,onChange:s,label:t,placeholder:l="选择日期",className:n}){let[i,c]=(0,r.useState)(!1);return(0,a.jsxs)(f.j,{isOpen:i,onOpenChange:c,children:[a.jsx(g.b,{children:a.jsx(m.Y,{label:t,placeholder:l,value:e?(0,v.WU)(e,"yyyy-MM-dd",{locale:y.U}):"",readOnly:!0,classNames:{input:"cursor-pointer"},endContent:(0,a.jsxs)("div",{className:"flex items-center",children:[e&&a.jsx("button",{onClick:e=>{e.stopPropagation(),s(void 0)},className:"text-default-400 hover:text-default-900 focus:outline-none mr-2",children:"✕"}),a.jsx(N.Z,{className:"h-5 w-5 text-default-400"})]}),className:n})}),a.jsx(p.g,{children:a.jsx("div",{className:"p-1",children:a.jsx(S,{mode:"single",selected:e,onSelect:e=>{s(e),c(!1)},initialFocus:!0})})})]})}function S({mode:e,selected:s,onSelect:t,initialFocus:n}){let[i,c]=(0,r.useState)(s||new Date),d=i.getFullYear(),o=i.getMonth(),u=new Date(d,o+1,0).getDate(),m=new Date(d,o,1).getDay(),h=e=>{t(new Date(d,o,e))},x=[],j=1;for(let e=0;e<6;e++){let s=[];for(let t=0;t<7;t++)0===e&&t<m?s.push(null):j<=u?(s.push(j),j++):s.push(null);x.push(s)}return(0,a.jsxs)("div",{className:"p-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("button",{onClick:()=>{c(new Date(d,o-1,1))},className:"p-1",children:"<"}),a.jsx("h3",{children:(0,v.WU)(i,"yyyy年MM月",{locale:y.U})}),a.jsx("button",{onClick:()=>{c(new Date(d,o+1,1))},className:"p-1",children:">"})]}),a.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:["日","一","二","三","四","五","六"].map(e=>a.jsx("div",{className:"text-sm font-medium",children:e},e))}),a.jsx("div",{className:"grid grid-cols-7 gap-1",children:x.map((e,t)=>a.jsx(l().Fragment,{children:e.map((e,r)=>a.jsx("div",{className:(0,b.cn)("h-8 w-8 p-0 flex items-center justify-center rounded-full text-sm",null===e?"invisible":"cursor-pointer hover:bg-primary-100",s&&e===s.getDate()&&o===s.getMonth()&&d===s.getFullYear()?"bg-primary text-white":""),onClick:()=>null!==e&&h(e),children:e},`${t}-${r}`))},t))})]})}function D({onFilter:e}){let[s,t]=(0,r.useState)({});return a.jsx(n.A,{size:"sm",onPress:()=>e(s),children:"过滤"})}function C({isOpen:e,onClose:s,onApply:t,initialFilter:l={}}){let[f,g]=(0,r.useState)(l),{categories:p}=(0,j.L)();return((0,r.useEffect)(()=>{g(l)},[l]),e)?a.jsx(i.w,{className:"w-full max-w-md mx-auto",children:(0,a.jsxs)(c.G,{className:"p-5",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h3",{className:"text-lg font-bold",children:"交易筛选"}),a.jsx(n.A,{isIconOnly:!0,variant:"light",onPress:s,children:a.jsx(x.Z,{size:18})})]}),a.jsx(d.j,{className:"my-3"}),(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"text-md font-medium mb-2",children:"交易类型"}),(0,a.jsxs)(o.X,{value:f.type,onValueChange:e=>g(s=>({...s,type:e})),children:[a.jsx(u.J,{value:"all",children:"全部"}),a.jsx(u.J,{value:"income",children:"收入"}),a.jsx(u.J,{value:"expense",children:"支出"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"text-md font-medium mb-2",children:"金额范围"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[a.jsx(m.Y,{type:"number",label:"最小金额",placeholder:"0",value:f.minAmount?.toString()||"",onChange:e=>g(s=>({...s,minAmount:e.target.value?Number(e.target.value):void 0})),className:"flex-1"}),a.jsx(m.Y,{type:"number",label:"最大金额",placeholder:"不限",value:f.maxAmount?.toString()||"",onChange:e=>g(s=>({...s,maxAmount:e.target.value?Number(e.target.value):void 0})),className:"flex-1"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"text-md font-medium mb-2",children:"日期范围"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[a.jsx(w,{label:"开始日期",value:f.startDate?new Date(f.startDate):void 0,onChange:e=>g(s=>({...s,startDate:e?e.toISOString().split("T")[0]:void 0})),className:"flex-1"}),a.jsx(w,{label:"结束日期",value:f.endDate?new Date(f.endDate):void 0,onChange:e=>g(s=>({...s,endDate:e?e.toISOString().split("T")[0]:void 0})),className:"flex-1"})]})]}),p&&p.length>0&&(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"text-md font-medium mb-2",children:"分类"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(e=>a.jsx(h.K,{isSelected:f.categoryIds?.includes(Number(e.id)),onValueChange:s=>{g(t=>{let a=t.categoryIds||[];return s?{...t,categoryIds:[...a,Number(e.id)]}:{...t,categoryIds:a.filter(s=>s!==Number(e.id))}})},children:e.name},e.id))})]})]}),a.jsx(d.j,{className:"my-4"}),(0,a.jsxs)("div",{className:"flex justify-between gap-2",children:[a.jsx(n.A,{variant:"flat",color:"danger",onPress:()=>{g({})},className:"flex-1",children:"重置"}),a.jsx(n.A,{color:"primary",onPress:()=>{t(f),s()},className:"flex-1",children:"应用筛选"})]})]})}):null}},86842:(e,s,t)=>{t.d(s,{Z:()=>g});var a=t(95344),r=t(70596),l=t(81686),n=t(26417),i=t(97446),c=t(16),d=t(44360),o=t(41931),u=t(75462),m=t(44738),h=t(61561),x=t(15006),j=t(89023),f=t(3729);let g=({isOpen:e,onClose:s,transaction:t})=>{let[g,p]=(0,f.useState)("expense"),[v,y]=(0,f.useState)(""),[N,b]=(0,f.useState)(""),[w,S]=(0,f.useState)(""),[D,C]=(0,f.useState)(new Date().toISOString().split("T")[0]),{categories:A=[],isLoading:I}=(0,h.L)(),{showToast:Y}=(0,j.useToast)(),P=(0,x.lr)(),M=(0,x.wI)(),O=A.filter(e=>e.type===g);(0,f.useEffect)(()=>{t&&(p(t.type),y(t.amount.toString()),b(t.category_id?.toString()||""),S(t.description),C(t.date))},[t]);let k=()=>{p("expense"),y(""),b(""),S(""),C(new Date().toISOString().split("T")[0])},E=()=>{k(),s()},T=async e=>{if(e.preventDefault(),!v||!N||!w||!D){Y("请填写所有必填字段","error");return}let a=A.find(e=>e.id.toString()===N);if(!a){Y("请选择有效的分类","error");return}let r={type:g,amount:Number(v),category_id:Number(N),description:w,date:D,category_name:a.name,category_icon:a.icon};try{t?(await M.mutateAsync({...r,id:t.id}),Y("修改成功","success")):(await P.mutateAsync(r),Y("添加成功","success")),s(),k()}catch(e){Y("操作失败："+(e instanceof Error?e.message:"未知错误"),"error")}};return a.jsx(r.R,{isOpen:e,onClose:E,size:"lg",children:a.jsx(l.A,{children:(0,a.jsxs)("form",{onSubmit:T,children:[a.jsx(n.k,{children:t?"编辑交易":"新增交易"}),a.jsx(i.I,{className:"gap-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)(c.g,{label:"类型",selectedKeys:new Set([g]),onChange:e=>p(e.target.value),"aria-label":"选择交易类型",children:[a.jsx(d.R,{value:"expense","aria-label":"支出",children:"支出"},"expense"),a.jsx(d.R,{value:"income","aria-label":"收入",children:"收入"},"income")]}),a.jsx(o.Y,{type:"number",label:"金额",value:v,onChange:e=>y(e.target.value),"aria-label":"输入金额"}),a.jsx(c.g,{label:"分类",selectedKeys:N?new Set([N]):new Set,onChange:e=>b(e.target.value),isLoading:I,"aria-label":"选择交易分类",errorMessage:0!==O.length||I?void 0:"请先选择一个家庭并添加分类",children:O.map(e=>a.jsx(d.R,{value:e.id.toString(),textValue:e.name,"aria-label":e.name,children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("span",{"aria-hidden":"true",children:e.icon}),a.jsx("span",{children:e.name})]})},e.id.toString()))}),a.jsx(o.Y,{type:"date",label:"日期",value:D,onChange:e=>C(e.target.value),"aria-label":"选择日期"}),a.jsx(o.Y,{className:"md:col-span-2",label:"描述",value:w,onChange:e=>S(e.target.value),"aria-label":"输入交易描述"})]})}),(0,a.jsxs)(u.R,{children:[a.jsx(m.A,{color:"danger",variant:"light",onPress:E,children:"取消"}),a.jsx(m.A,{color:"primary",type:"submit",children:t?"保存":"添加"})]})]})})})}},80247:(e,s,t)=>{t.d(s,{Z:()=>k});var a=t(95344),r=t(3729),l=t.n(r),n=t(78225),i=t(44738),c=t(70596),d=t(81686),o=t(26417),u=t(97446),m=t(41931),h=t(75462),x=t(47623),j=t(67993),f=t(82514),g=t(8853),p=t(33759),v=t(98138),y=t(3594),N=t(40997),b=t(48869),w=t.n(b),S=t(15006),D=t(89023),C=t(30853),A=t(65004),I=t(86842),Y=t(58112);function P({isOpen:e,onClose:s}){let t=(0,r.useRef)(null),[l,n]=(0,r.useState)(null),{mutate:x,isPending:j}=(0,S.En)(),{showToast:g}=(0,D.useToast)(),p=async()=>{if(!l){g("请选择要导入的文件","error");return}let e=new FormData;e.append("file",l);try{await x(e),s(),n(null),t.current&&(t.current.value="")}catch(e){console.error("导入失败:",e)}};return a.jsx(c.R,{isOpen:e,onClose:s,children:(0,a.jsxs)(d.A,{children:[a.jsx(o.k,{children:"导入交易记录"}),a.jsx(u.I,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("p",{className:"text-sm text-default-500",children:"请选择要导入的CSV文件，文件格式如下："}),a.jsx("pre",{className:"text-xs bg-default-100 p-2 rounded-lg",children:"日期,类型,金额,分类,描述 2024-03-01,expense,100,餐饮,午餐 2024-03-02,income,5000,工资,3月工资"}),a.jsx(m.Y,{type:"file",accept:".csv",ref:t,onChange:e=>{let s=e.target.files?.[0];if(s){if("text/csv"!==s.type){g("请选择CSV文件","error");return}n(s)}},startContent:a.jsx(f.Z,{className:"h-4 w-4"}),description:"支持.csv格式文件"})]})}),(0,a.jsxs)(h.R,{children:[a.jsx(i.A,{variant:"bordered",onPress:s,children:"取消"}),a.jsx(i.A,{color:"primary",onPress:p,isLoading:j,isDisabled:!l,children:"导入"})]})]})})}function M({isOpen:e,onClose:s}){let[t,l]=(0,r.useState)(w()().startOf("month").format("YYYY-MM-DD")),[n,x]=(0,r.useState)(w()().format("YYYY-MM-DD")),{mutate:j,isPending:f}=(0,S.v9)(),{showToast:p}=(0,D.useToast)(),v=async()=>{if(!t||!n){p("请选择日期范围","error");return}if(w()(t).isAfter(n)){p("开始日期不能晚于结束日期","error");return}try{await j({startDate:t,endDate:n}),s()}catch(e){console.error("导出失败:",e)}};return a.jsx(c.R,{isOpen:e,onClose:s,children:(0,a.jsxs)(d.A,{children:[a.jsx(o.k,{children:"导出交易记录"}),a.jsx(u.I,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("p",{className:"text-sm text-default-500",children:"请选择要导出的日期范围："}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(m.Y,{type:"date",label:"开始日期",value:t,onChange:e=>l(e.target.value)}),a.jsx(m.Y,{type:"date",label:"结束日期",value:n,onChange:e=>x(e.target.value)})]})]})}),(0,a.jsxs)(h.R,{children:[a.jsx(i.A,{variant:"bordered",onPress:s,children:"取消"}),a.jsx(i.A,{color:"primary",startContent:a.jsx(g.Z,{className:"h-4 w-4"}),onPress:v,isLoading:f,children:"导出"})]})]})})}var O=t(77850);function k(){let[e,s]=(0,r.useState)(1),[t,b]=(0,r.useState)({}),{user:k,isGuest:E,enterGuestMode:T,exitGuestMode:R}=(0,C.useAuth)(),{transactions:Z,isLoading:L,error:$}=(0,S.nC)(k?.currentFamilyId),{mutate:z}=(0,S.A3)(),{showToast:F}=(0,D.useToast)(),{isOpen:X,onOpen:q,onClose:K}=(0,n.q)(),{isOpen:U,onOpen:Q,onClose:_}=(0,n.q)(),{isOpen:G,onOpen:W,onClose:B}=(0,n.q)(),[J,V]=(0,r.useState)(""),[H,ee]=(0,r.useState)(null),[es,et]=(0,r.useState)(!1),[ea,er]=(0,r.useState)(!1),el=(0,r.useRef)(null);(0,N.MG)({count:Z.length,getScrollElement:()=>el.current,estimateSize:()=>70,overscan:10});let en=(0,r.useMemo)(()=>Z?Z.filter(e=>!0):[],[Z,t]),ei=e=>{if(E){F("访客模式下无法编辑","error");return}ee(e),et(!0)},ec=e=>{if(E){F("访客模式下无法删除","error");return}ee(e),er(!0)},ed=async()=>{try{await T(J),K(),V(""),F("已进入访客模式","success")}catch(e){F("访客密码错误","error")}},eo=(e,s)=>E?"****":`${"expense"===s?"-":"+"}${e.toFixed(2)}`;return L?a.jsx(A.Z,{type:"transaction"}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center sticky top-0 bg-background/70 backdrop-blur-lg z-10 py-2 px-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(Y.Z,{onFilter:b}),k?.privacy_mode&&a.jsx(i.A,{size:"sm",variant:"flat",startContent:E?a.jsx(x.Z,{className:"h-4 w-4"}):a.jsx(j.Z,{className:"h-4 w-4"}),onPress:E?()=>R():q,children:E?"退出访客模式":"访客模式"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[a.jsx(i.A,{size:"sm",variant:"flat",startContent:a.jsx(f.Z,{className:"h-4 w-4"}),onPress:Q,isDisabled:E,children:"导入"}),a.jsx(i.A,{size:"sm",variant:"flat",startContent:a.jsx(g.Z,{className:"h-4 w-4"}),onPress:W,isDisabled:E,children:"导出"})]})]}),a.jsx("div",{ref:el,className:"h-[calc(100vh-350px)] md:h-[calc(100vh-230px)] overflow-auto px-4",children:0===en.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[a.jsx("div",{className:"bg-default-100 rounded-full p-6 mb-4",children:a.jsx(O.Z,{className:"h-10 w-10 text-default-400"})}),a.jsx("p",{className:"text-default-500",children:"暂无交易记录"}),a.jsx(i.A,{color:"primary",variant:"flat",className:"mt-4",startContent:a.jsx(p.Z,{className:"h-4 w-4"}),onPress:()=>et(!0),isDisabled:E,children:"添加交易"})]}):a.jsx("div",{className:"space-y-2 pb-4",children:en.map((e,s)=>{let t=w()(e.date).format("YYYY-MM-DD"),r=0===s||t!==w()(en[s-1].date).format("YYYY-MM-DD");return(0,a.jsxs)(l().Fragment,{children:[r&&a.jsx("div",{className:"sticky top-0 bg-background/80 backdrop-blur-md py-2 px-1 text-sm font-medium border-b z-10 mt-2 first:mt-0",children:t===w()().format("YYYY-MM-DD")?"今天":t===w()().subtract(1,"day").format("YYYY-MM-DD")?"昨天":w()(t).format("MM月DD日 ddd")}),(0,a.jsxs)("div",{className:"p-3 rounded-lg hover:bg-default-100 transition-colors cursor-pointer flex justify-between items-center border-b border-default-100",onClick:()=>ei(e),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`p-2 rounded-full ${"expense"===e.type?"bg-danger/10 text-danger":"bg-success/10 text-success"}`,children:a.jsx("span",{className:"text-xl",children:e.category||"\uD83D\uDCB0"})}),(0,a.jsxs)("div",{children:[a.jsx("div",{className:"font-medium",children:e.category||"未分类"}),a.jsx("div",{className:"text-xs text-default-400",children:e.description||"无描述"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end",children:[a.jsx("div",{className:`font-semibold ${"expense"===e.type?"text-danger":"text-success"}`,children:eo(e.amount,e.type)}),(0,a.jsxs)("div",{className:"flex gap-1 mt-1",children:[a.jsx("span",{onClick:e=>e.stopPropagation(),children:a.jsx(i.A,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>ei(e),className:"h-6 w-6 min-w-0",isDisabled:E,children:a.jsx(v.Z,{className:"h-3 w-3"})})}),a.jsx("span",{onClick:e=>e.stopPropagation(),children:a.jsx(i.A,{isIconOnly:!0,size:"sm",color:"danger",variant:"light",onPress:()=>ec(e),className:"h-6 w-6 min-w-0",isDisabled:E,children:a.jsx(y.Z,{className:"h-3 w-3"})})})]})]})]})]},e.id)})})}),a.jsx(c.R,{isOpen:X,onClose:K,children:(0,a.jsxs)(d.A,{children:[a.jsx(o.k,{children:"访客模式"}),a.jsx(u.I,{children:a.jsx(m.Y,{type:"password",label:"访客密码",placeholder:"请输入访客密码",value:J,onChange:e=>V(e.target.value)})}),(0,a.jsxs)(h.R,{children:[a.jsx(i.A,{variant:"bordered",onPress:K,children:"取消"}),a.jsx(i.A,{color:"primary",onPress:ed,children:"确认"})]})]})}),a.jsx(P,{isOpen:U,onClose:_}),a.jsx(M,{isOpen:G,onClose:B}),a.jsx(I.Z,{isOpen:es,onClose:()=>et(!1),transaction:H}),a.jsx(c.R,{isOpen:ea,onClose:()=>er(!1),children:(0,a.jsxs)(d.A,{children:[a.jsx(o.k,{children:"确认删除"}),a.jsx(u.I,{children:"确定要删除这条交易记录吗？"}),(0,a.jsxs)(h.R,{children:[a.jsx(i.A,{variant:"bordered",onPress:()=>er(!1),children:"取消"}),a.jsx(i.A,{color:"danger",onPress:()=>{H&&z(H.id),er(!1),ee(null)},children:"删除"})]})]})})]})}},61561:(e,s,t)=>{t.d(s,{L:()=>n});var a=t(3729),r=t(96548),l=t(30853);function n(){let[e,s]=(0,a.useState)([]),[t,n]=(0,a.useState)(!0),[i,c]=(0,a.useState)(null),{user:d}=(0,l.useAuth)(),o=(0,a.useCallback)(async()=>{if(!d){s([]),c(null),n(!1);return}try{n(!0);let e="/categories";d.currentFamilyId?e+=`?familyId=${d.currentFamilyId}`:d.id&&(e+=`?userId=${d.id}`);let t=await (0,r.Io)(e);s(t.data),c(null)}catch(e){console.error("获取分类失败",e),c(e),s([])}finally{n(!1)}},[d]);return(0,a.useEffect)(()=>{o()},[o]),{categories:e,isLoading:t,error:i,refetch:o}}},15006:(e,s,t)=>{t.d(s,{A3:()=>u,En:()=>h,lr:()=>d,nC:()=>c,v9:()=>m,wI:()=>o});var a=t(3729),r=t(89023),l=t(26274),n=t(31296),i=t(96548);function c(e){let[s,t]=(0,a.useState)([]),[l,n]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null),{showToast:o}=(0,r.useToast)(),u=(0,a.useRef)(!1),m=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{e&&(u.current=!1,m.current=!1);let s=async()=>{if(!e){t([]),n(!1);return}if(!u.current||!m.current)try{n(!0),u.current=!0;let s=await (0,i.Io)(`/families/${e}/transactions`);t(s.data),d(null),m.current=!1}catch(e){console.error("获取交易记录失败",e),o&&o((0,i.we)(e,"获取交易记录失败"),"error"),d(e),t([]),m.current=!0}finally{n(!1)}};!e||u.current&&m.current?e||(t([]),n(!1)):s()},[e,o]),{transactions:s,isLoading:l,error:c}}function d(){let e=(0,l.NL)(),{showToast:s}=(0,r.useToast)();return(0,n.D)({mutationFn:async e=>(await (0,i.Io)("/transactions",{method:"POST",body:JSON.stringify(e)})).data,onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),s("创建成功","success")},onError:e=>{console.error("创建交易失败:",e),s((0,i.we)(e,"创建交易失败"),"error")}})}function o(){let e=(0,l.NL)(),{showToast:s}=(0,r.useToast)();return(0,n.D)({mutationFn:async e=>(await (0,i.Io)(`/transactions/${e.id}`,{method:"PUT",body:JSON.stringify(e)})).data,onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),s("更新成功","success")},onError:e=>{console.error("更新交易失败:",e),s((0,i.we)(e,"更新交易失败"),"error")}})}function u(){let e=(0,l.NL)(),{showToast:s}=(0,r.useToast)();return(0,n.D)({mutationFn:async e=>{await (0,i.Io)(`/transactions/${e}`,{method:"DELETE"})},onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),e.invalidateQueries({queryKey:["categoryStats"]}),s("删除成功","success")},onError:e=>{401===e.status?s("请先登录","error"):s("删除失败","error")}})}function m(){let{showToast:e}=(0,r.useToast)();return(0,n.D)({mutationFn:async({startDate:e,endDate:s})=>{let t=new URLSearchParams;t.append("startDate",e),t.append("endDate",s);let a=`${process.env.NEXT_PUBLIC_API_URL||"http://localhost:3001/api"}/transactions/export?${t.toString()}`,r=localStorage.getItem("token"),l=await fetch(a,{method:"GET",headers:{Accept:"application/octet-stream",...r?{Authorization:`Bearer ${r}`}:{}}});if(!l.ok)throw Error("导出失败");let n=await l.blob(),i=window.URL.createObjectURL(n),c=document.createElement("a"),d=`交易记录_${e}_${s}.csv`;return c.href=i,c.setAttribute("download",d),document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(i),n},onSuccess:()=>{e("导出成功","success")},onError:s=>{console.error("导出失败:",s),e("导出失败","error")}})}function h(){let e=(0,l.NL)(),{showToast:s}=(0,r.useToast)();return(0,n.D)({mutationFn:async e=>(await (0,i.Io)("/transactions/import",{method:"POST",body:e,headers:{Accept:"application/json"}})).data,onSuccess:()=>{e.invalidateQueries({queryKey:["transactions"]}),e.invalidateQueries({queryKey:["statistics"]}),e.invalidateQueries({queryKey:["categoryStats"]}),s("导入成功","success")},onError:e=>{console.error("导入失败:",e),s("导入失败: "+(e instanceof Error?e.message:"未知错误"),"error")}})}},11453:(e,s,t)=>{t.d(s,{cn:()=>l});var a=t(56815),r=t(79377);function l(...e){return(0,r.m6)((0,a.W)(e))}}};