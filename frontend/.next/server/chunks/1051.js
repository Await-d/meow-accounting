"use strict";exports.id=1051,exports.ids=[1051],exports.modules={8355:(e,a,s)=>{s.d(a,{Z:()=>E});var t=s(95344),r=s(47983),n=s.n(r),i=s(3729),l=s(56686),o=s(40237),c=s(69071),d=s(44738),m=s(16),u=s(44360),x=s(30891),h=s(45191),f=s(75019),p=s(22031),y=s(18816),g=s(92465),b=s(71699),j=s(30853),v=s(65004),w=s(800),N=s(33693),S=s(9164);g.kL.register(g.qi,g.u,g.De);let k=["rgba(54, 162, 235, 0.8)","rgba(255, 99, 132, 0.8)","rgba(75, 192, 192, 0.8)","rgba(255, 159, 64, 0.8)","rgba(153, 102, 255, 0.8)","rgba(255, 205, 86, 0.8)","rgba(201, 203, 207, 0.8)","rgba(100, 255, 100, 0.8)","rgba(200, 100, 100, 0.8)","rgba(100, 100, 255, 0.8)"],I={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){let a=e.label||"",s=e.parsed||0,t=(s/e.dataset.data.reduce((e,a)=>e+a,0)*100).toFixed(1);return`${a}: \xa5${s.toFixed(2)} (${t}%)`}}}},animation:{animateRotate:!0,animateScale:!0,duration:800,easing:"easeOutQuart"},cutout:"65%"};function E({timeRange:e,onTimeRangeChange:a}){let[s,r]=(0,i.useState)("expense"),[g,E]=(0,i.useState)("doughnut"),[$,z]=(0,i.useState)("amount"),[F,T]=(0,i.useState)("desc"),{user:q}=(0,j.useAuth)(),{data:P,isLoading:M,error:L}=(0,b.B)(e),R=(0,i.useRef)(!1);(0,i.useEffect)(()=>{L&&!R.current&&(console.error("获取分类统计数据失败:",L),R.current=!0)},[L]);let _=(0,i.useMemo)(()=>P?[...P.filter(e=>e.type===s)].sort((e,a)=>"amount"===$?"desc"===F?a.amount-e.amount:e.amount-a.amount:"desc"===F?a.name.localeCompare(e.name):e.name.localeCompare(a.name)):[],[P,s,$,F]),C=e=>_&&0!==_.length?{labels:_.map(e=>e.name),datasets:[{data:_.map(e=>e.amount),backgroundColor:_.map((e,a)=>k[a%k.length]),borderWidth:1,hoverOffset:8}]}:{labels:["暂无数据"],datasets:[{data:[1],backgroundColor:["#e5e7eb"]}]},D=(0,i.useMemo)(()=>_&&0!==_.length?_.reduce((e,a)=>e+a.amount,0):0,[_]);return M?t.jsx(v.Z,{type:"statistics"}):L?t.jsx(l.w,{className:"w-full",children:(0,t.jsxs)(o.G,{className:"flex flex-col items-center justify-center p-8 text-center",children:[t.jsx(w.Z,{className:"w-12 h-12 text-warning mb-4"}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"获取分类统计数据失败"}),t.jsx("p",{className:"text-default-500 mb-4",children:L instanceof Error?L.message:"请检查网络连接并稍后再试"})]})}):P&&0!==P.length?0===_.length?t.jsx(l.w,{className:"w-full",children:(0,t.jsxs)(o.G,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(c.g,{children:[t.jsx(d.A,{color:"expense"===s?"danger":"default",variant:"expense"===s?"solid":"bordered",onPress:()=>r("expense"),children:"支出"}),t.jsx(d.A,{color:"income"===s?"success":"default",variant:"income"===s?"solid":"bordered",onPress:()=>r("income"),children:"收入"})]}),(0,t.jsxs)(m.g,{size:"sm",className:"w-36",selectedKeys:[e],onChange:e=>a(e.target.value),children:[t.jsx(u.R,{value:"week",children:"本周"},"week"),t.jsx(u.R,{value:"month",children:"本月"},"month"),t.jsx(u.R,{value:"quarter",children:"本季度"},"quarter"),t.jsx(u.R,{value:"year",children:"本年"},"year")]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 gap-2",children:[(0,t.jsxs)("p",{className:"text-default-500",children:["暂无","expense"===s?"支出":"收入","分类数据"]}),(0,t.jsxs)(d.A,{color:"expense"===s?"success":"danger",variant:"flat",className:"mt-2",onPress:()=>r("expense"===s?"income":"expense"),children:["查看","expense"===s?"收入":"支出","分类"]})]})]})}):(0,t.jsxs)("div",{className:"jsx-93c76048a7f49ee5 space-y-4",children:[(0,t.jsxs)("div",{className:"jsx-93c76048a7f49ee5 flex justify-between items-center",children:[(0,t.jsxs)(x.n,{selectedKey:s,onSelectionChange:e=>r(e),color:"expense"===s?"danger":"success",variant:"bordered",size:"sm",classNames:{tabList:"gap-2"},children:[t.jsx(h.r,{title:"支出"},"expense"),t.jsx(h.r,{title:"收入"},"income")]}),(0,t.jsxs)("div",{className:"jsx-93c76048a7f49ee5 flex items-center gap-2",children:[(0,t.jsxs)(c.g,{size:"sm",children:[t.jsx(f.e,{content:"饼图",placement:"top",children:t.jsx(d.A,{isIconOnly:!0,variant:"pie"===g?"solid":"bordered",color:"primary",onPress:()=>E("pie"),children:"◔"})}),t.jsx(f.e,{content:"环形图",placement:"top",children:t.jsx(d.A,{isIconOnly:!0,variant:"doughnut"===g?"solid":"bordered",color:"primary",onPress:()=>E("doughnut"),children:"◕"})})]}),(0,t.jsxs)(m.g,{size:"sm",className:"w-24 min-w-fit",selectedKeys:[e],onChange:e=>a(e.target.value),children:[t.jsx(u.R,{value:"week",children:"本周"},"week"),t.jsx(u.R,{value:"month",children:"本月"},"month"),t.jsx(u.R,{value:"quarter",children:"本季度"},"quarter"),t.jsx(u.R,{value:"year",children:"本年"},"year")]})]})]}),(0,t.jsxs)("div",{className:"jsx-93c76048a7f49ee5 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"jsx-93c76048a7f49ee5 h-64 relative flex items-center justify-center",children:["pie"===g?t.jsx(y.by,{data:C("pie"),options:I}):t.jsx(y.$I,{data:C("doughnut"),options:I}),"doughnut"===g&&(0,t.jsxs)("div",{className:"jsx-93c76048a7f49ee5 absolute inset-0 flex items-center justify-center flex-col",children:[(0,t.jsxs)("div",{className:"jsx-93c76048a7f49ee5 text-xs text-default-500",children:["总","expense"===s?"支出":"收入"]}),(0,t.jsxs)("div",{className:`jsx-93c76048a7f49ee5 text-lg font-bold ${"expense"===s?"text-danger":"text-success"}`,children:["\xa5",D.toFixed(2)]})]})]}),(0,t.jsxs)("div",{className:"jsx-93c76048a7f49ee5 space-y-2 h-64 overflow-y-auto pr-1",children:[(0,t.jsxs)("div",{className:"jsx-93c76048a7f49ee5 flex justify-between items-center text-xs text-default-500 px-2 py-1",children:[t.jsx(d.A,{size:"sm",variant:"light",className:"!p-1 min-w-8 h-6",startContent:"asc"===F?t.jsx(N.Z,{className:"h-3 w-3"}):t.jsx(S.Z,{className:"h-3 w-3"}),onPress:()=>T("asc"===F?"desc":"asc"),children:"排序"}),(0,t.jsxs)(c.g,{size:"sm",children:[t.jsx(d.A,{size:"sm",variant:"name"===$?"solid":"bordered",className:"!p-1 min-w-8 h-6",onPress:()=>z("name"),children:"名称"}),t.jsx(d.A,{size:"sm",variant:"amount"===$?"solid":"bordered",className:"!p-1 min-w-8 h-6",onPress:()=>z("amount"),children:"金额"})]})]}),_.map((e,a)=>t.jsx(l.w,{className:"w-full shadow-none border border-default-100 animate-fadeIn",style:{animationDelay:`${50*a}ms`},children:(0,t.jsxs)(o.G,{className:"py-2 px-3",children:[(0,t.jsxs)("div",{className:"jsx-93c76048a7f49ee5 flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"jsx-93c76048a7f49ee5 flex items-center gap-2",children:[t.jsx("div",{style:{backgroundColor:k[a%k.length]},className:"jsx-93c76048a7f49ee5 w-2 h-2 rounded-full"}),t.jsx("span",{className:"jsx-93c76048a7f49ee5 text-sm font-medium line-clamp-1",children:e.name})]}),t.jsx("div",{className:`jsx-93c76048a7f49ee5 text-sm font-semibold ${"expense"===s?"text-danger":"text-success"}`,children:e.amount.toFixed(2)})]}),t.jsx("div",{className:"jsx-93c76048a7f49ee5 mt-1",children:t.jsx(p.W,{size:"sm",value:e.amount,maxValue:D,color:"expense"===s?"danger":"success",className:"mt-1",showValueLabel:!0,formatOptions:{style:"percent",minimumFractionDigits:1,maximumFractionDigits:1}})})]})},e.name))]})]}),t.jsx(n(),{id:"93c76048a7f49ee5",children:"@-webkit-keyframes fadeIn{from{opacity:0;-webkit-transform:translatey(5px);transform:translatey(5px)}to{opacity:1;-webkit-transform:translatey(0);transform:translatey(0)}}@-moz-keyframes fadeIn{from{opacity:0;-moz-transform:translatey(5px);transform:translatey(5px)}to{opacity:1;-moz-transform:translatey(0);transform:translatey(0)}}@-o-keyframes fadeIn{from{opacity:0;-o-transform:translatey(5px);transform:translatey(5px)}to{opacity:1;-o-transform:translatey(0);transform:translatey(0)}}@keyframes fadeIn{from{opacity:0;-webkit-transform:translatey(5px);-moz-transform:translatey(5px);-o-transform:translatey(5px);transform:translatey(5px)}to{opacity:1;-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}}.animate-fadeIn{-webkit-animation:fadeIn.5s ease-out forwards;-moz-animation:fadeIn.5s ease-out forwards;-o-animation:fadeIn.5s ease-out forwards;animation:fadeIn.5s ease-out forwards}"})]}):t.jsx(l.w,{className:"w-full",children:(0,t.jsxs)(o.G,{className:"flex flex-col items-center justify-center p-8 gap-4",children:[t.jsx("p",{className:"text-default-500",children:"暂无分类统计数据"}),t.jsx("p",{className:"text-sm text-default-400",children:"添加更多交易记录以查看分类统计"})]})})}},81365:(e,a,s)=>{s.d(a,{S:()=>d});var t=s(95344),r=s(3729),n=s.n(r),i=s(56686),l=s(40237),o=s(44738),c=s(61261);class d extends n().Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,a){console.error("组件错误:",e,a)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:t.jsx(i.w,{children:(0,t.jsxs)(l.G,{className:"text-center py-8",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:this.state.error instanceof c.Hx?"加载数据失败":"出现了一些问题"}),t.jsx("p",{className:"text-default-500 mb-4",children:this.state.error?.message||"请稍后再试"}),t.jsx(o.A,{color:"primary",onPress:()=>window.location.reload(),children:"刷新页面"})]})}):this.props.children}}},38765:(e,a,s)=>{s(95344),s(3729)},41051:(e,a,s)=>{s.d(a,{qY:()=>A,vL:()=>D,TT:()=>O,a_:()=>C,TR:()=>R,gy:()=>z,R5:()=>P,vQ:()=>t.Z}),s(80247);var t=s(86842),r=s(95344),n=s(3729),i=s(41501),l=s(56686),o=s(40237),c=s(44738),d=s(16),m=s(44360),u=s(98400),x=s(20516),h=s(61387),f=s(3394),p=s(52914),y=s(1629),g=s(80089),b=s(18816),j=s(92465),v=s(8853),w=s(80954),N=s(89023),S=s(61261),k=s(30853),I=s(48869),E=s.n(I);j.kL.register(j.uw,j.f$,j.od,j.jn,j.ZL,j.Dx,j.u,j.De,j.qi);let $={income:{main:"rgb(34, 197, 94)",bg:"rgba(34, 197, 94, 0.5)",hover:"rgba(34, 197, 94, 0.7)"},expense:{main:"rgb(239, 68, 68)",bg:"rgba(239, 68, 68, 0.5)",hover:"rgba(239, 68, 68, 0.7)"}};function z(){let[e,a]=(0,n.useState)("month"),{data:s,isLoading:t,error:j}=(0,w.T)(e),{showToast:I}=(0,N.useToast)(),{handleUnauthorized:z}=(0,k.useAuth)(),F=(0,n.useRef)(null),[T,q]=(0,n.useState)("line");if((0,n.useEffect)(()=>{j?.message&&F.current!==j.message&&(F.current=j.message,j instanceof S.Hx&&401===j.status?z():I("获取统计数据失败","error"))},[j?.message,z,I]),t||!s)return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[r.jsx(i.X,{className:"w-48 h-10"}),r.jsx(i.X,{className:"w-32 h-10"})]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(e=>r.jsx(l.w,{className:"w-full",children:(0,r.jsxs)(o.G,{className:"space-y-3",children:[r.jsx(i.X,{className:"w-3/4 h-4"}),r.jsx(i.X,{className:"w-2/3 h-6"})]})},e))})]});let P={labels:s.chart.map(a=>{let s=E()(a.date);return"month"===e?s.format("DD日"):"quarter"===e?s.format("MM月DD日"):s.format("MM月")}),datasets:[{label:"收入",data:s.chart.map(e=>e.income),borderColor:$.income.main,backgroundColor:"line"===T?$.income.bg:$.income.main,tension:.4,hoverBackgroundColor:$.income.hover,borderRadius:4},{label:"支出",data:s.chart.map(e=>e.expense),borderColor:$.expense.main,backgroundColor:"line"===T?$.expense.bg:$.expense.main,tension:.4,hoverBackgroundColor:$.expense.hover,borderRadius:4}]},M={responsive:!0,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:20,font:{family:"system-ui",size:12}}},title:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.7)",padding:10,bodyFont:{size:13},callbacks:{label:function(e){let a=e.dataset.label||"";return a&&(a+=": "),null!==e.parsed.y&&(a+="\xa5"+e.parsed.y.toFixed(2)),a}}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"},ticks:{callback:function(e){return"\xa5"+e},font:{family:"system-ui",size:11}}},x:{grid:{color:"rgba(0, 0, 0, 0.05)"},ticks:{font:{family:"system-ui",size:11}}}},elements:{line:{borderWidth:2},point:{radius:3,hoverRadius:5}},animation:{duration:800,easing:"easeOutQuart"}},L=(e,a)=>0===a?0:Math.round(e/a*100),R=s.chart.map(e=>e.income),_=s.chart.map(e=>e.expense),C=R.reduce((e,a)=>e+a,0)/R.length||0,D=_.reduce((e,a)=>e+a,0)/_.length||0,O=L(s.total_income,s.total_income+s.total_expense),A=L(s.total_expense,s.total_income+s.total_expense);return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsx(l.w,{className:"w-full bg-gradient-to-br from-success/5 to-success/20 shadow-sm transform transition-all hover:scale-105 hover:shadow-md",children:(0,r.jsxs)(o.G,{className:"space-y-2 p-4",children:[r.jsx("div",{className:"text-sm text-default-600",children:"总收入"}),(0,r.jsxs)("div",{className:"text-2xl font-bold text-success flex items-center gap-1",children:[r.jsx("span",{className:"text-lg",children:"\xa5"}),s.total_income.toFixed(2)]}),(0,r.jsxs)("div",{className:"text-xs text-default-400 flex items-center gap-1",children:[(0,r.jsxs)("span",{children:["平均: \xa5",C.toFixed(2)]}),r.jsx("div",{className:"w-full bg-default-100 rounded-full h-1 ml-2",children:r.jsx("div",{className:"bg-success h-1 rounded-full",style:{width:`${O}%`}})}),(0,r.jsxs)("span",{children:[O,"%"]})]})]})}),r.jsx(l.w,{className:"w-full bg-gradient-to-br from-danger/5 to-danger/20 shadow-sm transform transition-all hover:scale-105 hover:shadow-md",children:(0,r.jsxs)(o.G,{className:"space-y-2 p-4",children:[r.jsx("div",{className:"text-sm text-default-600",children:"总支出"}),(0,r.jsxs)("div",{className:"text-2xl font-bold text-danger flex items-center gap-1",children:[r.jsx("span",{className:"text-lg",children:"\xa5"}),s.total_expense.toFixed(2)]}),(0,r.jsxs)("div",{className:"text-xs text-default-400 flex items-center gap-1",children:[(0,r.jsxs)("span",{children:["平均: \xa5",D.toFixed(2)]}),r.jsx("div",{className:"w-full bg-default-100 rounded-full h-1 ml-2",children:r.jsx("div",{className:"bg-danger h-1 rounded-full",style:{width:`${A}%`}})}),(0,r.jsxs)("span",{children:[A,"%"]})]})]})}),r.jsx(l.w,{className:"w-full bg-gradient-to-br from-primary/5 to-primary/20 shadow-sm transform transition-all hover:scale-105 hover:shadow-md",children:(0,r.jsxs)(o.G,{className:"space-y-2 p-4",children:[r.jsx("div",{className:"text-sm text-default-600",children:"结余"}),(0,r.jsxs)("div",{className:`text-2xl font-bold flex items-center gap-1 ${s.balance>=0?"text-success":"text-danger"}`,children:[r.jsx("span",{className:"text-lg",children:"\xa5"}),s.balance.toFixed(2)]}),(0,r.jsxs)("div",{className:"text-xs text-default-400 flex items-center gap-1",children:[r.jsx("span",{children:"收支比: "}),r.jsx("div",{className:"w-full bg-default-100 rounded-full h-1 ml-2",children:r.jsx("div",{className:"bg-primary h-1 rounded-full",style:{width:`${s.balance>=0?100:100-Math.abs(L(s.balance,s.total_expense))}%`}})}),r.jsx("span",{children:s.balance>=0?"盈余":"赤字"})]})]})})]}),(0,r.jsxs)("div",{className:"bg-default-50 p-4 rounded-lg shadow-sm transition-all hover:shadow-md",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h3",{className:"text-md font-medium",children:"收支趋势"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx(c.A,{size:"sm",variant:"line"===T?"solid":"bordered",color:"primary",onPress:()=>q("line"),children:"折线图"}),r.jsx(c.A,{size:"sm",variant:"bar"===T?"solid":"bordered",color:"primary",onPress:()=>q("bar"),children:"柱状图"})]})]}),r.jsx("div",{className:"h-[280px]",children:"line"===T?r.jsx(b.x1,{data:P,options:M}):r.jsx(b.$Q,{data:P,options:M})})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)(d.g,{label:"时间范围",selectedKeys:new Set([e]),onChange:e=>a(e.target.value),className:"w-36 sm:w-48",size:"sm",children:[r.jsx(m.R,{value:"month",children:"本月"},"month"),r.jsx(m.R,{value:"quarter",children:"本季度"},"quarter"),r.jsx(m.R,{value:"year",children:"本年"},"year")]}),r.jsx(c.A,{color:"primary",variant:"flat",size:"sm",startContent:r.jsx(v.Z,{className:"h-4 w-4"}),onPress:()=>{if(!s)return;let{details:e}=s,a=["分类,类型,交易次数,总金额",...e.map(e=>[e.category_name,"income"===e.type?"收入":"支出",e.transaction_count.toString(),e.total_amount.toFixed(2)]).map(e=>e.join(","))].join("\n"),t=new Blob([a],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(t),r.download=`统计数据_${new Date().toLocaleDateString()}.csv`,r.click()},children:"导出数据"})]}),(0,r.jsxs)("div",{className:"overflow-x-auto bg-default-50 rounded-lg shadow-sm p-4",children:[r.jsx("div",{className:"mb-3 text-md font-medium",children:"消费明细"}),(0,r.jsxs)(u.b,{"aria-label":"统计详情",className:"min-w-full",removeWrapper:!0,classNames:{th:"bg-default-100 text-default-600 py-3 px-4 text-sm",td:"py-3 px-4"},children:[(0,r.jsxs)(x.J,{children:[r.jsx(h.j,{children:"分类"}),r.jsx(h.j,{children:"类型"}),r.jsx(h.j,{children:"交易次数"}),r.jsx(h.j,{children:"总金额"})]}),r.jsx(f.y,{emptyContent:"暂无数据",children:s.details.map(e=>(0,r.jsxs)(p.g,{className:"border-b hover:bg-default-100",children:[r.jsx(y.X,{children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-xl",children:e.category_icon}),r.jsx("span",{className:"font-medium",children:e.category_name})]})}),r.jsx(y.X,{children:r.jsx(g.z,{color:"expense"===e.type?"danger":"success",variant:"flat",size:"sm",children:"expense"===e.type?"支出":"收入"})}),r.jsx(y.X,{children:e.transaction_count}),r.jsx(y.X,{children:(0,r.jsxs)("span",{className:`font-medium ${"expense"===e.type?"text-danger":"text-success"}`,children:["expense"===e.type?"-":"+","\xa5",e.total_amount.toFixed(2)]})})]},`${e.category_name}-${e.type}`))})]})]})]})}s(8355);var F=s(99558),T=s(8471),q=s(57379);function P(){let[e,a]=(0,n.useState)(!1),{theme:s,setTheme:t}=(0,F.F)();return((0,n.useEffect)(()=>{a(!0)},[]),e)?r.jsx(c.A,{isIconOnly:!0,variant:"light",onPress:()=>t("dark"===s?"light":"dark"),"aria-label":"切换主题",children:"dark"===s?r.jsx(T.Z,{className:"h-5 w-5"}):r.jsx(q.Z,{className:"h-5 w-5"})}):null}s(65004),s(25384),s(58112),s(81365);var M=s(56506),L=s(11453);function R({variant:e="default",showText:a=!0,className:s,linkTo:t="/"}){let n=(0,r.jsxs)("div",{className:(0,L.cn)("flex items-center gap-3",s),children:[r.jsx("img",{src:"/icons/icon-192x192.png",alt:"喵呜记账",className:(0,L.cn)("rounded-lg shadow-sm",{small:"w-8 h-8",default:"w-10 h-10",large:"w-16 h-16"}[e])}),a&&(0,r.jsxs)("div",{children:[r.jsx("h1",{className:(0,L.cn)("font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",{small:"text-xl",default:"text-2xl",large:"text-3xl"}[e]),children:"喵呜记账"}),"large"===e&&r.jsx("p",{className:"text-sm text-default-500",children:"智能家庭财务管理工具"})]})]});return t?r.jsx(M.default,{href:t,className:"no-underline",children:n}):n}var _=s(91529);let C=()=>{let[e,a]=(0,n.useState)([]),[s,t]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{t(!0)},[]),(0,n.useEffect)(()=>{s&&a(Array.from({length:6}).map((e,a)=>({id:a,top:`${100*Math.random()}%`,left:`${100*Math.random()}%`,duration:2+2*Math.random(),delay:2*Math.random(),xOffset:10*Math.random()-5})))},[s]),r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur-sm",children:(0,r.jsxs)("div",{className:"relative flex flex-col items-center",children:[r.jsx(_.E.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"mb-8",children:r.jsx(R,{variant:"large"})}),r.jsx("div",{className:"relative w-64 h-2 bg-default-100 rounded-full overflow-hidden",children:r.jsx(_.E.div,{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-primary to-secondary",initial:{width:"0%"},animate:{width:["0%","30%","50%","70%","100%"]},transition:{duration:1.5,ease:"easeInOut",times:[0,.2,.5,.8,1],repeat:1/0}})}),r.jsx(_.E.p,{className:"mt-4 text-default-600",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:"载入应用中，请稍候..."}),(0,r.jsxs)("div",{className:"absolute -z-10",children:[r.jsx(_.E.div,{className:"absolute -top-20 -left-20 w-40 h-40 rounded-full bg-primary/5 blur-3xl",animate:{scale:[1,1.2,1],opacity:[.3,.6,.3]},transition:{duration:4,repeat:1/0,ease:"easeInOut"}}),r.jsx(_.E.div,{className:"absolute -bottom-20 -right-20 w-40 h-40 rounded-full bg-secondary/5 blur-3xl",animate:{scale:[1,1.3,1],opacity:[.3,.5,.3]},transition:{duration:4,repeat:1/0,ease:"easeInOut",delay:.5}})]}),r.jsx("div",{className:"absolute -z-10 inset-0",children:s&&e.map(e=>r.jsx(_.E.div,{className:"absolute w-2 h-2 rounded-full bg-primary/30",style:{top:e.top,left:e.left},animate:{y:[0,-20,0],x:[0,e.xOffset,0],opacity:[0,1,0]},transition:{duration:e.duration,repeat:1/0,delay:e.delay}},e.id))})]})})},D=({variant:e="default"})=>{let a=(0,n.useRef)(null);return(0,n.useEffect)(()=>{if(!a.current)return;let s=a.current,t=s.getContext("2d");if(!t)return;let r=()=>{s.width=window.innerWidth,s.height=window.innerHeight};r(),window.addEventListener("resize",r);let n=[],i="minimal"===e?50:100;class l{constructor(){this.x=Math.random()*s.width,this.y=Math.random()*s.height,this.size=2*Math.random()+.5,this.speedX=.5*Math.random()-.25,this.speedY=.5*Math.random()-.25,this.color=`hsla(${60*Math.random()+200}, 70%, 60%, ${.8*Math.random()+.2})`}update(){this.x+=this.speedX,this.y+=this.speedY,this.x>s.width?this.x=0:this.x<0&&(this.x=s.width),this.y>s.height?this.y=0:this.y<0&&(this.y=s.height)}draw(){t&&(t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.size,0,2*Math.PI),t.fill())}}let o=()=>{if(t)for(let e=0;e<n.length;e++)for(let a=e;a<n.length;a++){let s=n[e].x-n[a].x,r=n[e].y-n[a].y,i=Math.sqrt(s*s+r*r);if(i<150){let s=1-i/150;t.strokeStyle=`rgba(150, 150, 255, ${.15*s})`,t.lineWidth=.8,t.beginPath(),t.moveTo(n[e].x,n[e].y),t.lineTo(n[a].x,n[a].y),t.stroke()}}},c=()=>{if(t){for(let a of(t.clearRect(0,0,s.width,s.height),"default"===e&&d(),n))a.update(),a.draw();o(),requestAnimationFrame(c)}},d=()=>{if(!t)return;t.strokeStyle="rgba(100, 100, 255, 0.1)",t.beginPath(),t.lineWidth=1.5,t.arc(0,0,200,0,.5*Math.PI),t.stroke(),t.beginPath(),t.arc(s.width,s.height,250,Math.PI,1.5*Math.PI),t.stroke(),t.beginPath(),t.lineWidth=.8;let e=s.width/2,a=s.height/2,r=.4*Math.min(s.width,s.height);t.moveTo(e-r/2,a-r/2),t.lineTo(e+r/2,a-r/2),t.lineTo(e+r/2,a+r/2),t.lineTo(e-r/2,a+r/2),t.lineTo(e-r/2,a-r/2),t.stroke()};return(()=>{for(let e=0;e<i;e++)n.push(new l)})(),c(),()=>{window.removeEventListener("resize",r)}},[e]),(0,r.jsxs)("div",{className:"fixed inset-0 -z-10 overflow-hidden",children:[r.jsx("canvas",{ref:a,className:"absolute inset-0 w-full h-full"}),r.jsx("div",{className:"absolute top-0 -left-[10%] w-[50%] h-[50%] bg-primary/10 rounded-full blur-[150px] -z-10"}),r.jsx("div",{className:"absolute bottom-[10%] right-[10%] w-[40%] h-[40%] bg-secondary/10 rounded-full blur-[150px] -z-10"}),r.jsx(_.E.div,{className:"absolute top-[20%] right-[10%] w-16 h-16 border border-primary/20 rounded-full",animate:{y:[0,15,0],opacity:[.6,.9,.6],scale:[1,1.05,1]},transition:{duration:6,repeat:1/0,ease:"easeInOut"}}),r.jsx(_.E.div,{className:"absolute top-[10%] left-[20%] w-24 h-24 border border-secondary/30 rounded-xl rotate-45",animate:{y:[0,-20,0],opacity:[.3,.6,.3],rotate:[45,35,45]},transition:{duration:8,repeat:1/0,ease:"easeInOut"}}),r.jsx(_.E.div,{className:"absolute bottom-[30%] left-[5%] w-20 h-20 bg-gradient-to-tr from-primary/5 to-secondary/5 rounded-lg",animate:{x:[0,10,0],opacity:[.4,.7,.4],rotate:[0,10,0]},transition:{duration:7,repeat:1/0,ease:"easeInOut"}})]})},O=({title:e,description:a,icon:s,gradient:t="primary",className:n})=>r.jsx(_.E.div,{className:(0,L.cn)("w-full",n),initial:"rest",whileHover:"hover",variants:{rest:{scale:1,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.05)"},hover:{scale:1.03,boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"}},transition:{duration:.3},children:r.jsx(l.w,{className:"group overflow-hidden border border-default-100 p-6 h-full",children:(0,r.jsxs)("div",{className:"relative z-10 flex flex-col h-full",children:[r.jsx("div",{className:"absolute -top-32 -right-32 w-64 h-64 rounded-full bg-gradient-to-br opacity-10 blur-3xl group-hover:opacity-20 transition-opacity duration-500 pointer-events-none",style:{background:`radial-gradient(circle, var(--${t}-500) 0%, transparent 70%)`}}),r.jsx(_.E.div,{className:(0,L.cn)("w-16 h-16 rounded-full flex items-center justify-center mb-4",{primary:"bg-primary/10 text-primary",success:"bg-success/10 text-success",warning:"bg-warning/10 text-warning",danger:"bg-danger/10 text-danger",secondary:"bg-secondary/10 text-secondary"}[t]),variants:{rest:{scale:1},hover:{scale:1.1,rotate:5}},children:s}),r.jsx("h3",{className:"text-xl font-semibold mb-3 text-foreground group-hover:text-foreground/90",children:e}),r.jsx("p",{className:"text-default-600 group-hover:text-default-700 transition-colors mt-auto",children:a}),r.jsx("div",{className:"absolute -bottom-20 -left-20 w-40 h-40 rounded-full bg-gradient-to-tr opacity-0 blur-3xl group-hover:opacity-10 transition-opacity duration-500 pointer-events-none",style:{background:`radial-gradient(circle, var(--${t}-500) 0%, transparent 70%)`}}),r.jsx("div",{className:"absolute top-0 right-0 h-12 w-12 overflow-hidden",children:r.jsx("div",{className:(0,L.cn)("absolute -top-6 -right-6 h-12 w-12 transform rotate-45 bg-gradient-to-r opacity-30",{primary:"from-primary-400 to-primary-600",success:"from-success-400 to-success-600",warning:"from-warning-400 to-warning-600",danger:"from-danger-400 to-danger-600",secondary:"from-secondary-400 to-secondary-600"}[t])})})]})})}),A=({title:e,subtitle:a,className:s,align:t="left",size:n="lg",withUnderline:i=!1})=>{let l=e.split(""),o={hidden:{opacity:0,y:20},visible:e=>({opacity:1,y:0,transition:{delay:.05*e,duration:.5,ease:[.22,1,.36,1]}})},c={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{delay:.05*l.length+.2,duration:.5,ease:[.22,1,.36,1]}}},d={hidden:{width:"0%",opacity:0},visible:{width:"100%",opacity:1,transition:{delay:.05*l.length+.1,duration:.8,ease:[.22,1,.36,1]}}};return(0,r.jsxs)("div",{className:(0,L.cn)("overflow-hidden",{left:"text-left",center:"text-center mx-auto",right:"text-right ml-auto"}[t],s),children:[(0,r.jsxs)("h2",{className:(0,L.cn)("font-bold leading-tight tracking-tight",{sm:"text-xl md:text-2xl",md:"text-2xl md:text-3xl",lg:"text-3xl md:text-4xl",xl:"text-4xl md:text-5xl"}[n]),children:[r.jsx("span",{className:"sr-only",children:e}),r.jsx("span",{"aria-hidden":"true",className:"block relative",children:l.map((e,a)=>r.jsx(_.E.span,{custom:a,variants:o,initial:"hidden",whileInView:"visible",viewport:{once:!0},className:(0,L.cn)("inline-block bg-gradient-to-br from-foreground to-foreground/70 bg-clip-text text-transparent"," "===e?"mx-1.5":""),children:e},`${e}-${a}`))})]}),i&&r.jsx(_.E.div,{className:"h-[3px] bg-gradient-to-r from-primary via-secondary to-primary rounded-full mt-2",variants:d,initial:"hidden",whileInView:"visible",viewport:{once:!0}}),a&&r.jsx(_.E.p,{className:(0,L.cn)("mt-4 text-default-600",{sm:"text-sm",md:"text-base",lg:"text-lg",xl:"text-xl"}[n]),variants:c,initial:"hidden",whileInView:"visible",viewport:{once:!0},children:a})]})};s(38765)},71699:(e,a,s)=>{s.d(a,{B:()=>i});var t=s(3729),r=s(89023),n=s(96548);function i(e="month",a,s){let[i,l]=(0,t.useState)([]),[o,c]=(0,t.useState)(!0),[d,m]=(0,t.useState)(null),{showToast:u}=(0,r.useToast)();return(0,t.useEffect)(()=>{(async()=>{try{c(!0);let t=new URLSearchParams;t.append("range",e),a&&t.append("user_id",a.toString()),s&&t.append("family_id",s.toString());let r=await (0,n.Io)(`/transactions/stats/category?${t.toString()}`);l(r.data),m(null)}catch(e){console.error("获取分类统计数据失败",e),u&&u((0,n.we)(e,"获取分类统计数据失败"),"error"),m(e)}finally{c(!1)}})()},[e,a,s,u]),{data:i,isLoading:o,error:d}}},25384:(e,a,s)=>{s.d(a,{Hc:()=>f,Oh:()=>h,X$:()=>b,YF:()=>x,ao:()=>g,cW:()=>d,kN:()=>y,l0:()=>m,t3:()=>p,vP:()=>u});var t=s(26274),r=s(81271),n=s(31296),i=s(3729),l=s(96548),o=s(89023),c=s(30853);function d(){let{user:e,updateUser:a}=(0,c.useAuth)(),s=(0,t.NL)(),{showToast:n}=(0,o.useToast)(),[d,m]=(0,i.useState)([]),u=(0,i.useRef)(!1),{data:x,isLoading:h,error:f}=(0,r.a)({queryKey:["families"],queryFn:async()=>{try{let e=await (0,l.Io)("/families/user");return u.current=!1,e.data}catch(e){throw console.error("获取家庭列表失败:",e),u.current=!0,e}},enabled:!!e,staleTime:3e5,retry:u.current?0:2}),p=x?.find(a=>a.id===e?.currentFamilyId),{data:y,isLoading:g,error:b}=(0,r.a)({queryKey:["familyMembers",e?.currentFamilyId],queryFn:async()=>(await (0,l.Io)(`/families/${e?.currentFamilyId}/members`)).data,enabled:!!e?.currentFamilyId&&!u.current,staleTime:3e5,gcTime:3e5,retry:1});(0,i.useEffect)(()=>{f&&console.error("获取家庭列表失败:",f)},[f]),(0,i.useEffect)(()=>{b&&console.error("获取家庭成员失败:",b)},[b]);let j=(0,i.useCallback)(t=>{e&&(a({...e,currentFamilyId:t.id}),s.invalidateQueries({queryKey:["familyMembers"]}),s.invalidateQueries({queryKey:["transactions"]}),s.invalidateQueries({queryKey:["categories"]}),s.invalidateQueries({queryKey:["statistics"]}),s.invalidateQueries({queryKey:["categoryStats"]}),s.invalidateQueries({queryKey:["recentTransactions"]}),localStorage.setItem("currentFamilyId",t.id.toString()))},[e,a,s]),v=(0,i.useCallback)(()=>p?.owner_id===e?.id||y?.some(a=>a.user_id===e?.id&&"admin"===a.role),[p,e,y]);return{families:x,members:y||d,currentFamily:p,isLoading:h||g,error:f,setCurrentFamily:j,isAdmin:v}}function m(){let e=(0,t.NL)(),{showToast:a}=(0,o.useToast)();return(0,n.D)({mutationFn:async e=>(await (0,l.Io)("/families",{method:"POST",body:JSON.stringify(e)})).data,onSuccess:()=>{a("家庭创建成功","success"),e.invalidateQueries({queryKey:["families"]})},onError:e=>{a(`创建失败: ${e.message}`,"error")}})}function u(){let e=(0,t.NL)(),{showToast:a}=(0,o.useToast)();return(0,n.D)({mutationFn:async({familyId:e,data:a})=>(await (0,l.Io)(`/families/${e}`,{method:"PATCH",body:JSON.stringify(a)})).data,onSuccess:()=>{a("家庭信息已更新","success"),e.invalidateQueries({queryKey:["families"]})},onError:e=>{a(`更新失败: ${e.message}`,"error")}})}function x(){let e=(0,t.NL)(),{showToast:a}=(0,o.useToast)();return(0,n.D)({mutationFn:async e=>{await (0,l.Io)(`/families/${e}`,{method:"DELETE"})},onSuccess:()=>{a("家庭已删除","success"),e.invalidateQueries({queryKey:["families"]})},onError:e=>{a(`删除失败: ${e.message}`,"error")}})}function h(){let e=(0,t.NL)(),{showToast:a}=(0,o.useToast)();return(0,n.D)({mutationFn:async({familyId:e,data:a})=>(await (0,l.Io)(`/families/${e}/members`,{method:"POST",body:JSON.stringify(a)})).data,onSuccess:()=>{a("成员已添加","success"),e.invalidateQueries({queryKey:["family"]})},onError:e=>{a(`添加失败: ${e.message}`,"error")}})}function f(){let e=(0,t.NL)(),{showToast:a}=(0,o.useToast)();return(0,n.D)({mutationFn:async({familyId:e,memberId:a,role:s})=>(await (0,l.Io)(`/families/${e}/members/${a}`,{method:"PATCH",body:JSON.stringify({role:s})})).data,onSuccess:()=>{a("成员角色已更新","success"),e.invalidateQueries({queryKey:["family"]})},onError:e=>{a(`更新失败: ${e.message}`,"error")}})}function p(){let e=(0,t.NL)(),{showToast:a}=(0,o.useToast)();return(0,n.D)({mutationFn:async({familyId:e,memberId:a})=>{await (0,l.Io)(`/families/${e}/members/${a}`,{method:"DELETE"})},onSuccess:()=>{a("成员已移除","success"),e.invalidateQueries({queryKey:["family"]})},onError:e=>{a(`移除失败: ${e.message}`,"error")}})}function y(e){return(0,r.a)({queryKey:["familyInvitations",e],queryFn:async()=>e?(await (0,l.Io)(`/families/${e}/invitations`)).data:[],enabled:!!e})}function g(){let e=(0,t.NL)(),{showToast:a}=(0,o.useToast)();return(0,n.D)({mutationFn:async({familyId:e,invitationId:a})=>{await (0,l.Io)(`/families/${e}/invitations/${a}`,{method:"DELETE"})},onSuccess:()=>{a("邀请已删除","success"),e.invalidateQueries({queryKey:["familyInvitations"]})},onError:e=>{a(`删除失败: ${e.message}`,"error")}})}function b(e){return(0,r.a)({queryKey:["userInvitations",e],queryFn:async()=>e&&(await (0,l.Io)(`/users/${e}/invitations`)).data||[],enabled:!!e})}},80954:(e,a,s)=>{s.d(a,{T:()=>i});var t=s(3729),r=s(89023),n=s(96548);function i(e="month",a,s){let[i,l]=(0,t.useState)({total_income:0,total_expense:0,balance:0,chart:[],details:[]}),[o,c]=(0,t.useState)(!0),[d,m]=(0,t.useState)(null),{showToast:u}=(0,r.useToast)();return(0,t.useEffect)(()=>{(async()=>{try{c(!0);let t=new URLSearchParams;t.append("range",e),a&&t.append("user_id",a.toString()),s&&t.append("family_id",s.toString());let r=await (0,n.Io)(`/transactions/stats?${t.toString()}`);l(r.data),m(null)}catch(e){console.error("获取统计数据失败",e),u&&u((0,n.we)(e,"获取统计数据失败"),"error"),m(e)}finally{c(!1)}})()},[e,a,s,u]),{data:i,isLoading:o,error:d}}}};